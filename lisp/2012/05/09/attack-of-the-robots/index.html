<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Attack of the Robots | Reverland的行知阁</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="land-of-lisp," />
  

  <meta name="description" content="Powerful formatformat又是一个在common lisp中灵活“过头”，争议超多的一个宏。它十分强大。
基本用法如下
1(princ (reverse (format nil &amp;#34;Add onion rings for only ~$ dollars more!&amp;#34; 1.5))) &amp;#10;;;;Control sequences for printing lisp">
<meta property="og:type" content="article">
<meta property="og:title" content="Attack of the Robots">
<meta property="og:url" content="http://reverland.org/lisp/2012/05/09/attack-of-the-robots/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="Powerful formatformat又是一个在common lisp中灵活“过头”，争议超多的一个宏。它十分强大。
基本用法如下
1(princ (reverse (format nil &amp;#34;Add onion rings for only ~$ dollars more!&amp;#34; 1.5))) &amp;#10;;;;Control sequences for printing lisp">
<meta property="og:updated_time" content="2015-11-15T06:01:30.163Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Attack of the Robots">
<meta name="twitter:description" content="Powerful formatformat又是一个在common lisp中灵活“过头”，争议超多的一个宏。它十分强大。
基本用法如下
1(princ (reverse (format nil &amp;#34;Add onion rings for only ~$ dollars more!&amp;#34; 1.5))) &amp;#10;;;;Control sequences for printing lisp">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  

</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/archives/"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/category/"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/tag/"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/link/"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/about/"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/atom.xml"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Powerful_format"><span class="toc-text">Powerful format</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Attack_by_robots"><span class="toc-text">Attack by robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写在最后"><span class="toc-text">写在最后</span></a></li></ol>
  </div>


<a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-attack-of-the-robots" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Attack of the Robots</h1>

    <div class="article-meta">
      <span>2012-05-09</span>

      <span> | </span>

      <span class="article-author">Liu Yuyang</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/lisp/">lisp</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <h2 id="Powerful_format">Powerful format</h2><p>format又是一个在common lisp中灵活“过头”，争议超多的一个宏。它十分强大。</p>
<p>基本用法如下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(princ (reverse (format nil &#34;Add onion rings for only ~$ dollars more!&#34; 1.5))) &#10;;;;Control sequences for printing lisp values&#10;;;(prin1 &#34;foo&#34;)&#10;(format t &#34;I am printing ~s in the middle of this sentence&#34; &#34;foo&#34;)&#10;;;(princ &#34;foo&#34;)&#10;(format t &#34;I am printing ~a in the middle of this sentence&#34; &#34;foo&#34;)&#10;;;&#31532;&#19968;&#20010;&#21442;&#25968;,&#21491;&#36793;&#34917;&#30333;&#10;(format t &#34;I am printing ~10a within ten spaces of room.&#34; &#34;foo&#34;)&#10;;;&#31532;&#20108;&#20010;&#21442;&#25968;&#65292;&#20998;&#25104;3&#37096;&#20998;&#65292;&#34917;&#30333;9&#26684;&#10;(format t &#34;I am printing ~10,3a within ten (or more) spaces of room.&#34; &#34;foo&#34;)&#10;;;&#31532;&#19977;&#20010;&#21442;&#25968;&#65292;&#21491;&#36793;&#34917;&#30333;4&#26684;&#10;(format t &#34;I am printing ~,,4a in the middle of this sentence.&#34; &#34;foo&#34;)&#10;;;&#31532;&#22235;&#20010;&#21442;&#25968;&#65292;&#34917;&#20805;&#31526;&#21495;&#10;(format t &#34;The world ~,,4,&#39;!a feels very important.&#34; &#34;foo&#34;)&#10;(format t &#34;The world ~,,4,&#39;!@a feels very important.&#34; &#34;foo&#34;)&#10;;;;Control Sequences for formatting numbers&#10;;;Integers&#10;(format t &#34;The number 1000 in hexadrcimal is ~x&#34; 1000)&#10;(format t &#34;The number 1000 in hexadrcimal is ~b&#34; 1000)&#10;(format t &#34;The number 1000 in hexadrcimal is ~d&#34; 1000)&#10;;digit group separators&#10;(format t &#34;Numbers with commas in them are ~:d times better.&#34; 1000000)&#10;(format t &#34;I am printing ~10d within ten spaces of room.&#34; 1000000)&#10;(format t &#34;I am printing ~10,&#39;xd within ten spaces of room.&#34; 1000000)&#10;;;;Control Sequences for formatting Floating-point numbers&#10;;;default&#10;(format t &#34;PI can be estimated as ~4f&#34; 3.141593)&#10;;;&#23567;&#25968;&#28857;&#21518;&#25968;&#20301;&#10;(format t &#34;PI can be estimated as ~,4f&#34; pi)&#10;;;Percentage&#10;(format t &#34;Percentages are ~,,2f percent better than fractions&#34; 0.77)&#10;;;Format currency&#10;(format t &#34;I wish I had ~$ dollars in my bank account.&#34; 1000000.2)&#10;;;;Print multiple lines of output&#10;;;terpri&#10;(progn (princ 22)&#10;       (terpri)&#10;       (princ 33))&#10;;;fresh-line&#10;(progn (princ 22)&#10;       (fresh-line)&#10;       (fresh-line)&#10;       (princ 33))&#10;;;~% like terpri&#10;;;~&#38; like fresh-line&#10;(progn (format t &#34;This is on one line ~%&#34;)&#10;       (format t &#34;~%This is on another line&#34;)) &#10;(progn (format t &#34;This is on one line ~&#38;&#34;)&#10;       (format t &#34;~&#38;This is on another line&#34;))&#10;;;there can be a number in front of them&#10;(format t &#34;this will print ~5%on two lines spread far apart&#34;)&#10;(format t &#34;this will print ~5&#38;on two lines spread far apart&#34;)&#10;;;;Justifying output&#10;;;for example a function&#10;(defun random-animal ()&#10;  (nth (random 5) &#39;(&#34;dog&#34; &#34;tick&#34; &#34;tiger&#34; &#34;walrus&#34; &#34;kangaroo&#34;)))&#10;;;equally width&#10;(loop repeat 10&#10;      do (format t &#34;~5t~a ~15t~a ~25t~a~%&#34;&#10;                 (random-animal)&#10;                 (random-animal)&#10;                 (random-animal)))&#10;;;equally apart&#10;(loop repeat 10&#10;      do (format t &#34;~30&#60;~a~;~a~;~a~&#62;~%&#34;&#10;                 (random-animal)&#10;                 (random-animal)&#10;                 (random-animal)))&#10;;;center&#10;(loop repeat 10&#10;      do (format t &#34;~30:@&#60;~a~&#62;~%&#34; (random-animal)))&#10;(loop repeat 10&#10;      do (format t &#34;~30:@&#60;~a~;~a~;~a~&#62;~%&#34;&#10;                 (random-animal)&#10;                 (random-animal)&#10;                 (random-animal)))&#10;;;still wavy?to make it like this&#10;(loop repeat 10&#10;      do (format t &#34;~10:@&#60;~a~&#62;~10:@&#60;~a~&#62;~10:@&#60;~a~&#62;~%&#34;&#10;                 (random-animal)&#10;                 (random-animal)&#10;                 (random-animal)))&#10;;;;Iterating Through Lists Using Control Sequences&#10;;;Lets create a list of animals&#10;(defparameter *animals* (loop repeat 10 collect (random-animal)))&#10;;;loop through sequenses&#10;(format t &#34;~&#123;I see a ~a! ~%~&#125;&#34; *animals*) &#10;;;not only one item&#10;(format t &#34;~&#123;I see a ~a... or was it a ~a?~%~&#125;&#34; *animals*)&#10;;;;A crazy formatting trick for creating pretty tables of data&#10;(format t &#34;|~&#123;~&#60;|~%|~,33:;~2d ~&#62;~&#125;|&#34;&#10;        (loop for x below 100 collect x))</span><br></pre></td></tr></table></figure>
<p>可以看到，format的参数多的……而且像perl一样有很多“奇怪”的符号。</p>
<h2 id="Attack_by_robots">Attack by robots</h2><p>让我们接下来看看一个被作者称作可怕的游戏，It’s really drive me crazy!!</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;;;&#25972;&#20010;&#30028;&#38754;&#22823;&#23567;&#20026;16x64&#65292;&#20135;&#29983;&#20010;1024&#38271;&#24230;&#24207;&#21015;&#10;(defun robots ()&#10;  (loop named main;&#20415;&#20110;&#36339;&#20986;&#10;     ;;&#26041;&#21521;&#10;     with directions = &#39;((q . -65) (w . -64) (e . -63) (a . -1)&#10;                         (d .   1) (z .  63) (x .  64) (c . 65))&#10;     ;;&#21021;&#22987;&#20301;&#32622;&#10;     for pos = 544&#10;     then (progn (format t &#34;~%qwe/asd/zxc to move, (t)eleport, (l)eave:&#34;)&#10;                 (force-output);clean any output not waiting return&#10;                 (let* ((c (read))&#10;                        (d (assoc c directions)))&#10;                   (cond (d (+ pos (cdr d)))&#10;                         ((eq &#39;t c) (random 1024))&#10;                         ((eq &#39;l c) (return-from main &#39;bye))&#10;                         (t pos))))&#10;     ;;&#33719;&#24471;monster&#30340;&#20301;&#32622;&#10;     for monsters = (loop repeat 10&#10;                          collect (random 1024))&#10;     then (loop for mpos in monsters&#10;                collect (if (&#62; (count mpos monsters) 1)&#10;                          mpos&#10;                          ;;&#37117;&#36208;&#20102;&#19968;&#36941;&#12290;&#10;                          (cdar (sort (loop for (k . d) in directions&#10;                                            for new-mpos = (+ mpos d)&#10;                                            ;&#34892;&#19982;&#21015;&#36317;&#31163;&#21644;&#19982;&#26032;&#20301;&#32622;cons                                &#10;                                            collect (cons (+ (abs (- (mod new-mpos 64) &#10;                                                                     (mod pos 64)))&#10;                                                             (abs (- (ash new-mpos -6)&#10;                                                                     (ash pos -6))))&#10;                                                          new-mpos))&#10;                                      &#39;&#60;&#10;                                      :key #&#39;car))))&#10;     when (loop for mpos in monsters&#10;                always (&#62; (count mpos monsters) 1))&#10;     return &#39;player-wins&#10;     do (format t&#10;                &#34;~%|~&#123;~&#60;|~%|~,65:;~A~&#62;~&#125;|&#34;&#10;                (loop for p &#10;                      below 1024&#10;                      collect (cond ((member p monsters) &#10;                                     (cond ((= p pos) (return-from main &#39;player-loses))&#10;                                           ((&#62; (count p monsters) 1) #\#)&#10;                                           (t #\A)))&#10;                                    ((= p pos) &#10;                                     #\@)&#10;                                    (t &#10;                                     #\ ))))))</span><br></pre></td></tr></table></figure>
<p>整个游戏就一个函数，由loop和format这种强大的lisp异类来完成。</p>
<h2 id="写在最后">写在最后</h2><p>挺好玩的一个游戏。挺难理解的代码……</p>
<p>为了看懂又回头看看作者的loop周期表，再次见识了format和loop的强大之处，也感受到了它们的复杂。</p>

    
  </div>
</article>

</div>


  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'reverlandblog';
    
    var disqus_url = 'http://reverland.org/lisp/2012/05/09/attack-of-the-robots/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    




  </div>

  

</body>
</html>
