<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="linux,security," />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="Guide to the Secure Configuration of Red Hat Enterprise Linux 5安全审计部分，章节2.6.2
rhel提供了安全审计服务audit，默认情况下，该服务审计SELinux AVC denials和一些类型的安全事件。比如程序执行的系统登录、账户修改、和认证事件。
默认情况下，auditd消耗的磁盘空间不影响系统性能。无论你的系统有没有开启">
<meta property="og:type" content="article">
<meta property="og:title" content="linux安全审计">
<meta property="og:url" content="http://reverland.org/linux/2014/11/17/linux-audit/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="Guide to the Secure Configuration of Red Hat Enterprise Linux 5安全审计部分，章节2.6.2
rhel提供了安全审计服务audit，默认情况下，该服务审计SELinux AVC denials和一些类型的安全事件。比如程序执行的系统登录、账户修改、和认证事件。
默认情况下，auditd消耗的磁盘空间不影响系统性能。无论你的系统有没有开启">
<meta property="og:updated_time" content="2015-11-15T06:01:31.543Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux安全审计">
<meta name="twitter:description" content="Guide to the Secure Configuration of Red Hat Enterprise Linux 5安全审计部分，章节2.6.2
rhel提供了安全审计服务audit，默认情况下，该服务审计SELinux AVC denials和一些类型的安全事件。比如程序执行的系统登录、账户修改、和认证事件。
默认情况下，auditd消耗的磁盘空间不影响系统性能。无论你的系统有没有开启">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> linux安全审计 | Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                linux安全审计
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-11-17T00:00:00+08:00" content="2014-11-17">
              2014-11-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/linux/2014/11/17/linux-audit/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="linux/2014/11/17/linux-audit/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p><a href="https://www.nsa.gov/ia/_files/os/redhat/rhel5-guide-i731.pdf" target="_blank" rel="external">Guide to the Secure Configuration of Red Hat Enterprise Linux 5</a>安全审计部分，章节2.6.2</p>
<p>rhel提供了安全审计服务audit，默认情况下，该服务审计SELinux <a href="https://www.nsa.gov/research/_files/selinux/papers/slinux/node30.shtml" target="_blank" rel="external">AVC</a> denials和一些类型的安全事件。比如程序执行的系统登录、账户修改、和认证事件。</p>
<p>默认情况下，auditd消耗的磁盘空间不影响系统性能。无论你的系统有没有开启SELinux支持，都建议开启auditd的默认配置。</p>
<p>比如美国国防部常见的审计需求有：</p>
<ul>
<li>确保审计确定的系统事件：<ul>
<li>成功和不成功的使用打印机的命令</li>
<li>成功或不成功的启动和关闭事件</li>
</ul>
</li>
<li>确保被审计软件可以被记录以下审计事件：<ul>
<li>事件的日期和时间</li>
<li>执行时间的用户id</li>
<li>时间类型</li>
<li>时间成功或失败</li>
<li>标识和认证事件请求的来源(比如terminal ID)</li>
<li>对向用户地址空间引入对象的事件，对对象删除操作、对象名称和<a href="http://en.wikipedia.org/wiki/Multilevel_security" target="_blank" rel="external">MLS系统</a>中对象的安全级别。</li>
</ul>
</li>
<li>确保至少每周备份到另一个系统或媒介上</li>
<li>确保旧日志被关闭，新的审计日志每天开始。</li>
<li>确保配置不可更改。在audit.rule中<code>-e 2</code>设定更改审计规则需要重启。</li>
<li>确保审计数据文件权限为<code>644</code>或者更严格。</li>
</ul>
<h2 id="开启auditd服务">开启auditd服务</h2><p>enable auditd服务：</p>
<pre><code>chkconfig auditd <span class="function_start"><span class="keyword">on</span></span>
</code></pre><p>默认情况下，auditd只记录SELinux denials，特定安全事件类型比如用户账户更改，登录事件和调用<code>sudo</code></p>
<p>数据保存在<code>/var/log/audit/audit.log</code>。默认情况下<code>auditd</code>rotates 4个5MB日志，总共占据20MB空间。这样减小了系统压力，但可能丢失审计数据。</p>
<h2 id="配置auditd数据存储">配置auditd数据存储</h2><ul>
<li><p>确定当个日志文件的最大大小<code>STOREMB</code>(单位为mb)，增减或更改<code>/etc/audit/auditd.conf</code>的如下行：</p>
<p>  max_log_file = STOREMB</p>
</li>
<li><p>对日志文件使用单独的分区或者逻辑卷。在安装时分区，要比auditd要用的稍微大点(大于<code>max_log_file x num_logs</code>)，确保审计分区挂载在<code>/var/log/audit</code></p>
</li>
<li><p>如果当审计无法执行时需要停机，配置auditd在磁盘空间不足时中止系统。编辑<code>/etc/audit/auditd.conf</code>，增加或修改如下行(磁盘空间不足给管理员发邮件)：</p>
<p>  space_left_action = email<br>  action_mail_act = root<br>  admin_space_left_action= halt</p>
</li>
</ul>
<p>默认的action是当日志达到单个日志的最大大小，循环日志，丢弃最老的。如果保留尽可能多的日志很重要，即使空间耗尽执行<code>admin_space_left_action</code>中定义行为，添加或修改如下行：</p>
<pre><code>max_<span class="built_in">log</span>_file_action = keep_logs
</code></pre><p>需要日志文件的大小和审计的事件类型密切相关。首先配置审计记录所有感兴趣的事件，人工监控一段时间日志大小去做决定。</p>
<p>使用单独的分区<code>/var/log/audit</code>来阻止auditd日志耗尽磁盘空间影响系统功能，最重要的是，阻止其它/var中的程序填满审计日志空间。</p>
<p>有些机器需要不做出action，如果是这样，直接设定成在耗尽磁盘空间时关机就行。</p>
<p>注意：较老的日志会被循环丢弃！</p>
<p>注意！！！！：如果系统配置为不能记录日志时停机，确定正常情况下不会发生这种事！确保<code>/var/log/audit</code>在单独的分区上，并且比auditd需要的保留数据的最大大小要大。</p>
<h2 id="配置使先于audit守护进程启动的进程生效">配置使先于audit守护进程启动的进程生效</h2><p>为了确保先于audit进程启动的进程被审计，在<code>/etc/grub.conf</code>添加内核启动参数<code>audit=1</code>：</p>
<pre><code>kernel <span class="regexp">/vmlinuz-version ro vga=ext root=/</span>dev<span class="regexp">/VolGroup00/</span>LogVol00 rhgb quiet audit=<span class="number">1</span>
</code></pre><p>系统上每个进程都有个<code>auditable</code>标志标识它们是否能被审计。尽管auditd负责使所有它之后被启动的进程被审计，添加内核参数确保在启动时为每个进程设置参数。</p>
<h2 id="配置全面的审计规则">配置全面的审计规则</h2><p>auditd能对系统活动实行全面的审计。这一部分描述了推荐的设置，更全面的请参照其它资源。<code>linux-audit@redhat.com</code>邮件列表是个好的信息来源。</p>
<p>审计子系统支持大量事件类型，包括：</p>
<ul>
<li>追踪任何进入或退出的系统调用(以名称或编号命名)。</li>
<li>以PID，UID，调用成功与否，系统调用参数(有些限制)等等来过滤。</li>
<li>监控特殊文件内容和元数据的更改。</li>
</ul>
<p>审计规则在<code>/etc/audit/audit.rules</code>控制，添加满足你审计需求的规则。该文件中每一行代表一系列传递给<code>auditctl</code>的参数，能用<code>auditctl</code>独立测试。参见<code>/usr/share/doc/audit-version</code>和相关man页面获取更多信息。</p>
<p>推荐的审计规则在<code>/usr/share/doc/audit-version/stig.rules</code>提供，激活这些规则：</p>
<pre><code>cp <span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>audit-version<span class="regexp">/stig.rules /</span>etc<span class="regexp">/audit/</span>audit.rules
</code></pre><p>然后编辑<code>/etc/audit/audit.rules</code>注释掉不适合你的架构的包含<code>arch=</code>的行。然后检查和理解其中的规则，确保需要的规则在合适的架构上被激活。</p>
<p>检查完所有规则后，阅读以下章节，编辑和激活需要的新规则：</p>
<pre><code><span class="title">service</span> auditd restart
</code></pre><h2 id="记录更改日期和时间信息的事件">记录更改日期和时间信息的事件</h2><p>添加以下规则到<code>/etc/audit/audit.rules</code>，设置<code>ARCH</code>为你系统合适的架构，要么是<code>b32</code>，要么是<code>b64</code>:</p>
<pre><code>-a always,exit -F arch=ARCH -S adjtimex -S settimeofday -S stime -k time-<span class="operator"><span class="keyword">change</span>
-a <span class="keyword">always</span>,<span class="keyword">exit</span> -<span class="keyword">F</span> arch=ARCH -S clock_settime -<span class="keyword">k</span> <span class="keyword">time</span>-<span class="keyword">change</span>
-w /etc/<span class="keyword">localtime</span> -<span class="keyword">p</span> wa -<span class="keyword">k</span> <span class="keyword">time</span>-<span class="keyword">change</span></span>
</code></pre><p>(参见<code>man auditctl</code>)</p>
<h2 id="记录更改用户/组信息的事件">记录更改用户/组信息的事件</h2><p>添加以下规则到<code>/etc/audit/audit.rules</code>，为了捕捉更改账户变化的事件：</p>
<pre><code>-w /etc/group -<span class="tag">p</span> wa -k identity
-w /etc/passwd -<span class="tag">p</span> wa -k identity
-w /etc/gshadow -<span class="tag">p</span> wa -k identity
-w /etc/shadow -<span class="tag">p</span> wa -k identity
-w /etc/security/opasswd -<span class="tag">p</span> wa -k identity
</code></pre><h2 id="记录更改系统网络环境的事件">记录更改系统网络环境的事件</h2><p>添加以下规则到<code>/etc/audit/audit.rules</code>，根据系统架构设置<code>ARCH</code>为或者<code>b32</code>或者<code>b64</code>：</p>
<pre><code>-<span class="tag">a</span> exit,always -F arch=ARCH -S sethostname -S setdomainname -k system-locale
-w /etc/issue -<span class="tag">p</span> wa -k system-locale
-w /etc/issue<span class="class">.net</span> -<span class="tag">p</span> wa -k system-locale
-w /etc/hosts -<span class="tag">p</span> wa -k system-locale
-w /etc/sysconfig/network -<span class="tag">p</span> wa -k system-locale
</code></pre><h2 id="记录更改系统强制访问存取(MAC)策略的事件">记录更改系统强制访问存取(MAC)策略的事件</h2><p>添加<code>/etc/audit/audit.rules</code>:</p>
<pre><code>-w /etc/selinux/ -<span class="tag">p</span> wa -k MAC-policy
</code></pre><h2 id="记录登入注销变更事件的尝试">记录登入注销变更事件的尝试</h2><p>审计系统已经收集了所有用户和root的登录信息。去监视尝试手工更改存储登入事件的文件，向<code>/etc/audit.rules</code>添加以下行：</p>
<pre><code>-<span class="ruby">w /var/log/faillog -p wa -k logins <span class="comment"># RHEL6中再无这个，pam_tally不再写入其中</span>
</span>-<span class="ruby">w /var/log/lastlog -p wa -k logins</span>
</code></pre><h2 id="记录更改进程和会话初始化信息的尝试">记录更改进程和会话初始化信息的尝试</h2><pre><code>-w /<span class="keyword">var</span>/<span class="keyword">run</span>/utmp -p wa -k session
-w /<span class="keyword">var</span>/<span class="keyword">log</span>/btmp -p wa -k session
-w /<span class="keyword">var</span>/<span class="keyword">log</span>/wtmp -p wa -k session
</code></pre><h2 id="确保auditd收集任意存取控制权限更改事件">确保auditd收集任意存取控制权限更改事件</h2><p>最起码审计系统会收集所有用户和root的文件权限更改。添加以下到<code>/etc/audit/audit.rules</code>，设置<code>ARCH</code>为系统合适的架构，要么<code>b32</code>或者<code>b64</code>：</p>
<pre><code>-a always,<span class="built_in">exit</span> -F arch=ARCH -S chmod -S fchmod -S fchmodat -F auid&gt;=<span class="number">500</span> \
    -F auid!=<span class="number">4294967295</span> -k perm_mod
-a always,<span class="built_in">exit</span> -F arch=ARCH -S chown -S fchown -S fchownat -S lchown -F auid&gt;=<span class="number">500</span> \
    -F auid!=<span class="number">4294967295</span> -k perm_mod
-a always,<span class="built_in">exit</span> -F arch=ARCH -S setxattr -S lsetxattr -S fsetxattr -S removexattr -S \
    lremovexattr -S fremovexattr -F auid&gt;=<span class="number">500</span> -F auid!=<span class="number">4294967295</span> -k perm_mod <span class="preprocessor"># 红帽的非权限用户起始uid为<span class="number">500</span>, <span class="number">4294967295</span>为最大<span class="number">32</span>位无符号整数</span>
</code></pre><h2 id="使用auditd收集未认证的文件访问尝试(失败)">使用auditd收集未认证的文件访问尝试(失败)</h2><p>最起码审计系统收集所有用户和root的未授权文件访问信息。添加以下行到<code>/etc/audit/audit.rules</code>，设置<code>ARCH</code>：</p>
<pre><code>-a always,exit -F arch=ARCH -S creat -S open -S openat -S <span class="operator"><span class="keyword">truncate</span> -S ftruncate \
    -<span class="keyword">F</span> <span class="keyword">exit</span>=-EACCES -<span class="keyword">F</span> auid&gt;=<span class="number">500</span> -<span class="keyword">F</span> auid!=<span class="number">4294967295</span> -<span class="keyword">k</span> <span class="keyword">access</span>
-a <span class="keyword">always</span>,<span class="keyword">exit</span> -<span class="keyword">F</span> arch=ARCH -S creat -S <span class="keyword">open</span> -S openat -S <span class="keyword">truncate</span> -S ftruncate \
    -<span class="keyword">F</span> <span class="keyword">exit</span>=-EPERM -<span class="keyword">F</span> auid&gt;=<span class="number">500</span> -<span class="keyword">F</span> auid!=<span class="number">4294967295</span> -<span class="keyword">k</span> <span class="keyword">access</span></span>
</code></pre><h2 id="确保auditd收集权限命令使用的信息">确保auditd收集权限命令使用的信息</h2><p>最起码审计系统收集所有用户和root的权限命令执行信息。这需要为每个要监视执行的<code>setuid</code>或者<code>setgid</code>程序添加规则。</p>
<p>首先运行以下命令找到所有本地分区<code>PART</code>来生成规则，每个<code>setuid</code>或<code>setgid</code>程序一个规则：</p>
<pre><code>find PART -xdev \( -perm -<span class="number">4000</span> -o -perm -<span class="number">2000</span> \) -type f | awk {print \
    <span class="string">"-a always,exit -F path="</span> <span class="variable">$1</span> <span class="string">" -F perm=x -F auid&gt;=500 -F auid!=4294967295 \
    -k privileged"</span> }
</code></pre><p>然后添加打印的行到<code>/etc/audit/audit.rules</code>。</p>
<h2 id="确保auditd搜集导出到介质上的信息(成功)">确保auditd搜集导出到介质上的信息(成功)</h2><p>(我不是很明白，看上去似乎是收集非权限用户的挂载信息)</p>
<p>最起码审计系统收集所有用户和root的媒体导出事件。添加以下行到<code>/etc/audit/audit.rules</code>，设置<code>ARCH</code>：</p>
<pre><code>-a always,<span class="built_in">exit</span> -F arch=ARCH -S mount -F auid&gt;=<span class="number">500</span> -F auid!=<span class="number">4294967295</span> -k <span class="keyword">export</span>
</code></pre><h2 id="确保auditd搜集用户的文件删除事件(成功与失败)">确保auditd搜集用户的文件删除事件(成功与失败)</h2><p>最起码审计系统应该收集所有用户和root的文件删除事件。添加以下行到<code>/etc/audit/audit.rules</code>，设置ARCH：</p>
<pre><code>-a always,exit -F arch=ARCH -S unlink -S unlinkat -S <span class="operator"><span class="keyword">rename</span> -S renameat -<span class="keyword">F</span> auid&gt;=<span class="number">500</span> \
    -<span class="keyword">F</span> auid!=<span class="number">4294967295</span> -<span class="keyword">k</span> <span class="keyword">delete</span></span>
</code></pre><h2 id="确保auditd收集系统管理行为">确保auditd收集系统管理行为</h2><p>(其实就是监视sudoer文件)</p>
<p>最起码审计系统应该收集用户和root的管理员行为。添加以下到<code>/etc/audit/audit.rules</code>:</p>
<pre><code>-w /etc/sudoers -<span class="tag">p</span> wa -k actions
</code></pre><h2 id="确保auditd收集内核加载卸载信息">确保auditd收集内核加载卸载信息</h2><p>添加以下到<code>/etc/audit/audit.rules</code>，设置ARCH：</p>
<pre><code>-w /sbin/insmod -<span class="tag">p</span> x -k modules
-w /sbin/rmmod -<span class="tag">p</span> x -k modules
-w /sbin/modprobe -<span class="tag">p</span> x -k modules
-<span class="tag">a</span> always,exit -F arch=ARCH -S init_module -S delete_module -k modules
</code></pre><h2 id="确保auditd配置不可更改">确保auditd配置不可更改</h2><p>添加以下作为<code>/etc/audit/audit.rules</code>的 <em>最后一行</em> ：</p>
<pre><code><span class="operator">-e</span> <span class="number">2</span>
</code></pre><p>通过这个设定，更改审计规则需要重启机器。</p>
<h2 id="通过aureport总结和查看审计日志">通过aureport总结和查看审计日志</h2><p>仔细检查<code>aureport</code>的man页面。然后设计一系列便于日常研究审计日志的命令。这些命令可以通过在合适的命名文件在<code>/etc/crond.daily</code>中被加入到cron job中。(其它章节中有有关如何确保审计系统收集所有需要事件的信息)</p>
<p>例如，为每个登录到机器的用户生成日报，可在<code>cron</code>中运行以下命令：</p>
<pre><code>aureport -<span class="keyword">l</span> -i -ts yesterday -<span class="keyword">te</span> today
</code></pre><p>查看所有异常行为审计活动，通常先从被触发审计规则摘要看起：</p>
<pre><code><span class="comment">aureport</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">key</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">summary</span>
</code></pre><p>如果违规访问很多，检查它们：</p>
<pre><code><span class="comment">ausearch</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">key</span> <span class="comment">access</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raw</span> <span class="comment">|</span> <span class="comment">aureport</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">file</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">summary</span>
</code></pre><p>看看执行了哪些可执行文件：</p>
<pre><code><span class="comment">ausearch</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">key</span> <span class="comment">access</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raw</span> <span class="comment">|</span> <span class="comment">airport</span> <span class="literal">-</span><span class="comment">x</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">summary</span>
</code></pre><p>如果非法访问发生在特定文件上，并且你想看看哪个用户做的：</p>
<pre><code><span class="comment">ausearch</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">key</span> <span class="comment">access</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">file</span> <span class="comment">/etc/shadow</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">raw</span> <span class="comment">|</span> <span class="comment">aureport</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">user</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">summary</span> <span class="literal">-</span><span class="comment">i</span>
</code></pre><p>检查异常活动(比如网卡设备更改到混杂模式，进程异常中止，登录失败次数达到上限)</p>
<pre><code>aureport <span class="comment">--anomaly</span>
</code></pre><p>审计分析的基础是使用key来分类事件。有关使用ausearch获取SELinux问题的信息在其它章节讨论</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/linux/" rel="tag">#linux</a>
          
            <a href="/tags/security/" rel="tag">#security</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/reverse/2014/11/15/" rel="next" title="linux下函数参数调用">
                <i class="fa fa-chevron-left"></i> linux下函数参数调用
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/linux/2014/11/18/file-permissions-and-masks/" rel="prev" title="File Permissions and Masks">
                File Permissions and Masks <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


        </div>

        


        
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    
  </div>


      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">177</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">62</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.suzibin.cn/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lazymind.me/" target="_blank">mapleray</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#开启auditd服务"><span class="nav-number">1.</span> <span class="nav-text">开启auditd服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置auditd数据存储"><span class="nav-number">2.</span> <span class="nav-text">配置auditd数据存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置使先于audit守护进程启动的进程生效"><span class="nav-number">3.</span> <span class="nav-text">配置使先于audit守护进程启动的进程生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置全面的审计规则"><span class="nav-number">4.</span> <span class="nav-text">配置全面的审计规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录更改日期和时间信息的事件"><span class="nav-number">5.</span> <span class="nav-text">记录更改日期和时间信息的事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录更改用户/组信息的事件"><span class="nav-number">6.</span> <span class="nav-text">记录更改用户/组信息的事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录更改系统网络环境的事件"><span class="nav-number">7.</span> <span class="nav-text">记录更改系统网络环境的事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录更改系统强制访问存取(MAC)策略的事件"><span class="nav-number">8.</span> <span class="nav-text">记录更改系统强制访问存取(MAC)策略的事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录登入注销变更事件的尝试"><span class="nav-number">9.</span> <span class="nav-text">记录登入注销变更事件的尝试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#记录更改进程和会话初始化信息的尝试"><span class="nav-number">10.</span> <span class="nav-text">记录更改进程和会话初始化信息的尝试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd收集任意存取控制权限更改事件"><span class="nav-number">11.</span> <span class="nav-text">确保auditd收集任意存取控制权限更改事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用auditd收集未认证的文件访问尝试(失败)"><span class="nav-number">12.</span> <span class="nav-text">使用auditd收集未认证的文件访问尝试(失败)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd收集权限命令使用的信息"><span class="nav-number">13.</span> <span class="nav-text">确保auditd收集权限命令使用的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd搜集导出到介质上的信息(成功)"><span class="nav-number">14.</span> <span class="nav-text">确保auditd搜集导出到介质上的信息(成功)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd搜集用户的文件删除事件(成功与失败)"><span class="nav-number">15.</span> <span class="nav-text">确保auditd搜集用户的文件删除事件(成功与失败)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd收集系统管理行为"><span class="nav-number">16.</span> <span class="nav-text">确保auditd收集系统管理行为</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd收集内核加载卸载信息"><span class="nav-number">17.</span> <span class="nav-text">确保auditd收集内核加载卸载信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#确保auditd配置不可更改"><span class="nav-number">18.</span> <span class="nav-text">确保auditd配置不可更改</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过aureport总结和查看审计日志"><span class="nav-number">19.</span> <span class="nav-text">通过aureport总结和查看审计日志</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'linux/2014/11/17/linux-audit/';
      var disqus_title = 'linux安全审计';
      var disqus_url = 'http://reverland.org/linux/2014/11/17/linux-audit/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
