<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Upgrade Gentoo Linux | Reverland的行知阁</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="linux," />
  

  <meta name="description" content="Nowadays, I upgraded my gentoo linux.
I have not synchronoused the portage tree for nearly half of the year. When I came with upgrading my system, I got stuck with a lot of things I’ve never thought.">
<meta property="og:type" content="article">
<meta property="og:title" content="Upgrade Gentoo Linux">
<meta property="og:url" content="http://reverland.org/linux/2014/07/26/upgrade-gentoo-linux/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="Nowadays, I upgraded my gentoo linux.
I have not synchronoused the portage tree for nearly half of the year. When I came with upgrading my system, I got stuck with a lot of things I’ve never thought.">
<meta property="og:updated_time" content="2015-11-15T06:01:31.531Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Upgrade Gentoo Linux">
<meta name="twitter:description" content="Nowadays, I upgraded my gentoo linux.
I have not synchronoused the portage tree for nearly half of the year. When I came with upgrading my system, I got stuck with a lot of things I’ve never thought.">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  

</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <div class="toolbox-entry">盒子</div>
    <ul class="list-toolbox">
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/archives/">博客</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/category/">分类</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/">标签</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/">友链</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/">关于</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/atom.xml">RSS</a>
          </li>
        
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Upgrade_The_Stable"><span class="toc-text">Upgrade The Stable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Upgrade_it"><span class="toc-text">Upgrade it</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Problems"><span class="toc-text">Problems</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Dependency_Conflict"><span class="toc-text">Dependency Conflict</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Build_or_Configure_Error"><span class="toc-text">Build or Configure Error</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#New_XXX_Need_to_be_Changed_to_Proceed"><span class="toc-text">New XXX Need to be Changed to Proceed</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Post_Upgrading"><span class="toc-text">Post Upgrading</span></a></li></ol>
  </div>


<div class="content-post CENTER">
   <article id="post-upgrade-gentoo-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Upgrade Gentoo Linux</h1>

    <div class="article-meta">
      <span>2014-07-26</span>

      <span> | </span>

      <span class="article-author">Liu Yuyang</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <p>Nowadays, I upgraded my gentoo linux.</p>
<p>I have not synchronoused the portage tree for nearly half of the year. When I came with upgrading my system, I got stuck with a lot of things I’ve never thought.</p>
<p>Luckily enough, gentoo use a mechanism to incremental upgrade. So I spent days to completely upgrade the system just with the system working properly.</p>
<p>This is a simple notes. I can’t really remember the details.</p>
<p>I’ll just write down what I learned from this lesson. To more smoothly upgrade the  system the next time.</p>
<h2 id="Upgrade_The_Stable">Upgrade The Stable</h2><h3 id="Upgrade_it">Upgrade it</h3><p>First, syncing the portage tree.</p>
<pre><code>emerge-websync
</code></pre><p>Select a good source, if you encounter with something wrong just remove the portage tree in <code>/usr/portage/</code>.</p>
<p color="red">NEVER NEVER FORGET TO READ THE NEWS</p>

<pre><code>eselect <span class="keyword">news</span> <span class="keyword">list</span>
</code></pre><p>Then, emerge the world. You can edit <code>/usr/portage/world</code> to select what you really want. I’ve play a lot of things I may never explore later, so I just edit it to minimize the time for upgrading.</p>
<p>We can emerge world now. And, preparing for struggling for hours or days…Always use <code>--with-bdeps=y</code>.</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">@world</span>
</code></pre><p>As a alternative, emerge system first.</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">system</span>
</code></pre><p>Always, there exists tons of conflicts and some other problems like licenses and so on.</p>
<p>As far as I know, one have to solve them step by step.</p>
<h3 id="Problems">Problems</h3><p>There may three major problems:</p>
<h4 id="Dependency_Conflict">Dependency Conflict</h4><p>Check if you have emerge softwares are not included in the stable portage tree. Remove it like this:</p>
<pre><code>emerge <span class="comment">--depclean google-chrome</span>
</code></pre><p>Check if you’ve masked some software. Remove them…</p>
<p>Re-emerge.</p>
<h4 id="Build_or_Configure_Error">Build or Configure Error</h4><p>Just search via google. You may re-emerge something portage won’t handle properly.</p>
<p>Sometimes, this is because you have to rebuild Perl modules.</p>
<pre><code><span class="comment">perl</span><span class="literal">-</span><span class="comment">cleaner</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">all</span> <span class="literal">-</span><span class="literal">-</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">exclude=perl</span><span class="literal">-</span><span class="comment">core/Module</span><span class="literal">-</span><span class="comment">CoreList</span>
</code></pre><h4 id="New_XXX_Need_to_be_Changed_to_Proceed">New XXX Need to be Changed to Proceed</h4><p>Use <code>--auto-unmask-write</code> if you know what you are doing.</p>
<p>then:</p>
<pre><code><span class="built_in">dispatch</span>-conf
</code></pre><p>or:</p>
<pre><code>etc-<span class="keyword">update</span>
</code></pre><h2 id="Post_Upgrading">Post Upgrading</h2><p>You may want to update the overlay too.</p>
<pre><code><span class="title">layman</span> -S
</code></pre><p>Yet another emerge world(If you encounter with problems, refer to the notes above):</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">@world</span>
</code></pre><p>Remove orphaned packages.</p>
<pre><code>emerge <span class="comment">--depclean -a</span>
</code></pre><p>Check obsolete packages:</p>
<pre><code>eix-test-<span class="pragma">obsolete</span>
</code></pre><p>Update configure files:</p>
<pre><code>etc-<span class="keyword">update</span>
</code></pre><p>Rebuild broken packages:</p>
<pre><code>revdep-rebuild
</code></pre><p>Update eix databases:</p>
<pre><code>eix-<span class="keyword">update</span>
</code></pre><p>If you compile a new kernel(you do not have to), don’t forget to:</p>
<pre><code><span class="title">emerge</span> <span class="variable">@module</span>-rebuild
</code></pre><p>That’s all, hope this helps.</p>

    
  </div>
</article>



<section class="disqus-comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>




</div>

  
<script>
  var disqus_shortname = 'reverlandblog';
  
  var disqus_url = 'http://reverland.org/linux/2014/07/26/upgrade-gentoo-linux/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"undefined"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0]
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

</body>
</html>
