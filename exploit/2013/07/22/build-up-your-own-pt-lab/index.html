<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>建立渗透测试实验环境 | Reverland的行知阁</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="metasploit," />
  

  <meta name="description" content="用虚拟机建立Host-only靶机内网警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。
大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气">
<meta property="og:type" content="article">
<meta property="og:title" content="建立渗透测试实验环境">
<meta property="og:url" content="http://reverland.org/exploit/2013/07/22/build-up-your-own-pt-lab/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="用虚拟机建立Host-only靶机内网警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。
大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气">
<meta property="og:updated_time" content="2015-11-15T06:01:31.503Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="建立渗透测试实验环境">
<meta name="twitter:description" content="用虚拟机建立Host-only靶机内网警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。
大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  

</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/archives/"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/category/"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/tag/"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/link/"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/about/"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/atom.xml"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#用虚拟机建立Host-only靶机内网"><span class="toc-text">用虚拟机建立Host-only靶机内网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置要求"><span class="toc-text">配置要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#metasploitable"><span class="toc-text">metasploitable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows_XP_+_mssql_+_av_+_office_+_…"><span class="toc-text">Windows XP + mssql + av + office + …</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#网络配置"><span class="toc-text">网络配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置metasploit"><span class="toc-text">配置metasploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用metasploit"><span class="toc-text">使用metasploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Social_Engineer_Toolkits"><span class="toc-text">Social Engineer Toolkits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#墙内tips"><span class="toc-text">墙内tips</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
  </div>


<a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-build-up-your-own-pt-lab" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">建立渗透测试实验环境</h1>

    <div class="article-meta">
      <span>2013-07-22</span>

      <span> | </span>

      <span class="article-author">Liu Yuyang</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/exploit/">exploit</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <h2 id="用虚拟机建立Host-only靶机内网">用虚拟机建立Host-only靶机内网</h2><p><strong>警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。</strong></p>
<p>大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气其实就是个playground)。</p>
<p>对所有新手来说，一个简单的渗透目标对入门并保持兴趣非常重要，幸运的是，总有人已经做过这些事，你可以搜寻到rapid7团队配置好的充满漏洞的metasploitable系列目标机器镜像，还有UltimateLamp。但总有些事在法律上有些人不能做，你需要自己付费购买一个合法的License来安装Windows XP。如果你在下载和搜集资料上遇到问题，可以参见本文的最后部分，如果还有问题，别忘了google是个好东西。</p>
<p>另外，大致哪国法律都不会容忍人在未经许可的情况下对他人正在运营的机器和网络环境实行破坏性的渗透测试，所以，别犯傻。想试试具有破坏性的技术，自己搭建个内网玩。</p>
<h3 id="配置要求">配置要求</h3><p>有些地方写的要求很高，其实用不着太高，但起码得有个支持虚拟技术的cpu。我的是i3，用着就不错.</p>
<p>内存要求至少两G，你得经得起同时运行两三个虚拟机吧。如果宿主机内存太小，即使一个虚拟机只分配256M内存两三个虚拟机最后也能把内存撑到全满，拖得硬盘灯狂亮，图形界面狂卡。好吧，2G其实就是这种情况。但凑合能用，你无需虚拟机运行良好，只需要它在安全上脆弱不堪。</p>
<p>还有就是硬盘空间，你要放置虚拟机镜像文件，可能要放置很多资料和论文，可能会准备一大套工具集并在日后不断扩展。所以，想想硬盘还有多大，当然可以不够用了在想办法，这也不是什么必须的。</p>
<p>综上，感谢万恶的虚拟化技术，即使一个i3 cpu 2G渣内存 30G硬盘空间你也足够建立一个两三个虚拟机器的渗透测试实验室了，而不用花费不菲准备一大堆机器和网线。</p>
<h3 id="metasploitable">metasploitable</h3><p>metasploitable系列第一个镜像大概10年发布，在我的vbox下毫无问题。他的镜像是vmware制成，但vbox可以直接使用vmware的镜像，不要去转换了！</p>
<p>很幸运这个别人帮你配置好了，满是漏洞，能让你玩到无聊。不过却很方便熟悉下metasploit的使用过程。</p>
<p>metasploitable 2 大概2012年释出，悲剧的是，我的vbox无法启动，可是又懒得在渣gentoo上装vmware。无所谓了。</p>
<h3 id="Windows_XP_+_mssql_+_av_+_office_+_…">Windows XP + mssql + av + office + …</h3><p>metasploit中的有些模块，不，是很多模块是有关windows的，甚至是win上的特定软件的。如果你想试试，最好在你的实验室中安装一个xp的虚拟机。另外，个人觉得meterpreter在win下表现得比linux下厉害。</p>
<p>获取正版XP，下载安装mssql，并按照邪恶的魔法禁书《metasploit：渗透测试魔法师指南》P269配置。</p>
<p>当然，有些东西如果想试试还得有其它软件。请自行search并use然后info查看那些exploit的信息。</p>
<h3 id="网络配置">网络配置</h3><p>渗透测试实验室的核心在于几个虚拟机的网络配置。</p>
<p>首先，要保证这些漏洞百出的靶机们与互联网隔绝，省得一不小心成功把互联网上什么政府网站搞挂，然后警察叔叔就找上门了。</p>
<p>vbox可以建立host-only的内网很好的实现宿主机和虚拟机共享的局域网。</p>
<p>首先选中File-Preference-Network添加一个host-only network。默认是vboxnet0，并且dhcp是自动开启的，如果不是，请打开它(当然你也可以对每台机器设置静态地址，我觉得这挺费事，通常我只对宿主机设置静态地址)。</p>
<p>然后在我的渣gentoo中是这样，其它linux发行版大致差不多或类似，unix大致类似，windows自己想办法我不知道：</p>
<pre><code>sudo ifconfig vboxnet0 inet <span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> up
</code></pre><p>注意，以上地址自己看怎么写，这都可以在设置dhcp同样的地方设置。</p>
<h2 id="配置metasploit">配置metasploit</h2><p>然后就是在宿主机上设置metasploit，准备好你的枪。建议直接从github上git clone。</p>
<p>metasploit项目在github上的wiki有一个很完整的参考<a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment" target="_blank" rel="external">Setting Up a Metasploit Development Environment</a></p>
<p>我就说说在gentoo上的问题和为什么不选择gentoo官方源里的稳定版本。</p>
<p>首先，我好像什么依赖问题也没碰到。自己对照ubuntu的看看少什么，你需要libpcap来处理网络流量、一个完整的编译工具链，nasm，curl，wget，还有postgresql作为数据库。总之，我什么问题也没碰到。</p>
<p>然后跟着把rvm装上，完全照着wiki来就是了。</p>
<p>将metasploit项目git clone到本地(别给我说不知道怎么做)，进入到其目录。</p>
<pre><code>./msfconsole
</code></pre><p>如果提示：</p>
<pre><code>[*] Metasploit requires the <span class="keyword">Bundler </span>gem to <span class="keyword">be </span>installed
$ gem install <span class="keyword">bundler</span>
</code></pre><p>照它说得就是。</p>
<p>还有最后一个问题，对metasploit，有一个数据库来跟踪渗透测试过程非常有用。你需要自己配置数据库，默认数据库是postgre，当然你也可以选其它的。</p>
<p>参考这里，虽然是fedora的，基本原理对所有linux发行版都适用:</p>
<p><a href="https://fedoraproject.org/wiki/Metasploit_Postgres_Setup" target="_blank" rel="external">Metasploit Postgres Setup</a></p>
<p>很多不想看拉倒。关键在于创建数据库和用户，然后能在msfconsole里连上就行。</p>
<p>为了方便，你可能想让postgre开机启动。每个发行版可能都不一样吧，gentoo上这样：</p>
<pre><code>sudo rc-update <span class="built_in">set</span> postgresql-<span class="number">9.2</span> <span class="keyword">default</span>
</code></pre><p>至此，你的靶子和枪都准备好了。</p>
<h2 id="使用metasploit">使用metasploit</h2><p>metasploit提供的工具可以分为几类：</p>
<ul>
<li>auxiliary</li>
<li>exploit</li>
<li>tools<br>其它如msfencode，msfpayload</li>
</ul>
<p>不在本文讨论范围内，参考这里<a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page" target="_blank" rel="external">Metasploit Unleashed</a></p>
<h2 id="Social_Engineer_Toolkits">Social Engineer Toolkits</h2><p>部分基于msf的项目，同样是git clone过来，手动配置下运行就是。依赖很简单，都是python的依赖。</p>
<p>可以来玩玩传说中的社交工程，exploit人类比exploit机器省心省力多了= =</p>
<p>更多参见<a href="http://www.social-engineer.org/framework/Social_Engineering_Framework" target="_blank" rel="external">Social Engineering Framework</a></p>
<h2 id="墙内tips">墙内tips</h2><ul>
<li><p>git clone很慢还不能断点，可以先git init然后fetch，最后checkout <code>FETCH_HEAD</code>。。。</p>
</li>
<li><p>找不到的东西就试试海盗湾(自寻)</p>
</li>
<li><p>微软的东西可以从这里找：<a href="http://www.itellyou.cn/" target="_blank" rel="external">MSDN, I tell you</a></p>
</li>
</ul>
<h2 id="参考资料">参考资料</h2><ul>
<li><a href="https://community.rapid7.com/docs/DOC-2196" target="_blank" rel="external">How To Set Up A Penetration Testing Lab</a></li>
</ul>
<p>好吧，扯淡扯完了，Happy hacking</p>

    
  </div>
</article>

</div>


  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'reverlandblog';
    
    var disqus_url = 'http://reverland.org/exploit/2013/07/22/build-up-your-own-pt-lab/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    




  </div>

  

</body>
</html>
