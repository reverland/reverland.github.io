<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/10/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2013/07/22/build-up-your-own-pt-lab/" itemprop="url">
                  建立渗透测试实验环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-07-22T00:00:00+08:00" content="2013-07-22">
              2013-07-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2013/07/22/build-up-your-own-pt-lab/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2013/07/22/build-up-your-own-pt-lab/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="用虚拟机建立Host-only靶机内网">用虚拟机建立Host-only靶机内网</h2><p><strong>警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。</strong></p>
<p>大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气其实就是个playground)。</p>
<p>对所有新手来说，一个简单的渗透目标对入门并保持兴趣非常重要，幸运的是，总有人已经做过这些事，你可以搜寻到rapid7团队配置好的充满漏洞的metasploitable系列目标机器镜像，还有UltimateLamp。但总有些事在法律上有些人不能做，你需要自己付费购买一个合法的License来安装Windows XP。如果你在下载和搜集资料上遇到问题，可以参见本文的最后部分，如果还有问题，别忘了google是个好东西。</p>
<p>另外，大致哪国法律都不会容忍人在未经许可的情况下对他人正在运营的机器和网络环境实行破坏性的渗透测试，所以，别犯傻。想试试具有破坏性的技术，自己搭建个内网玩。</p>
<h3 id="配置要求">配置要求</h3><p>有些地方写的要求很高，其实用不着太高，但起码得有个支持虚拟技术的cpu。我的是i3，用着就不错.</p>
<p>内存要求至少两G，你得经得起同时运行两三个虚拟机吧。如果宿主机内存太小，即使一个虚拟机只分配256M内存两三个虚拟机最后也能把内存撑到全满，拖得硬盘灯狂亮，图形界面狂卡。好吧，2G其实就是这种情况。但凑合能用，你无需虚拟机运行良好，只需要它在安全上脆弱不堪。</p>
<p>还有就是硬盘空间，你要放置虚拟机镜像文件，可能要放置很多资料和论文，可能会准备一大套工具集并在日后不断扩展。所以，想想硬盘还有多大，当然可以不够用了在想办法，这也不是什么必须的。</p>
<p>综上，感谢万恶的虚拟化技术，即使一个i3 cpu 2G渣内存 30G硬盘空间你也足够建立一个两三个虚拟机器的渗透测试实验室了，而不用花费不菲准备一大堆机器和网线。</p>
<h3 id="metasploitable">metasploitable</h3><p>metasploitable系列第一个镜像大概10年发布，在我的vbox下毫无问题。他的镜像是vmware制成，但vbox可以直接使用vmware的镜像，不要去转换了！</p>
<p>很幸运这个别人帮你配置好了，满是漏洞，能让你玩到无聊。不过却很方便熟悉下metasploit的使用过程。</p>
<p>metasploitable 2 大概2012年释出，悲剧的是，我的vbox无法启动，可是又懒得在渣gentoo上装vmware。无所谓了。</p>
<h3 id="Windows_XP_+_mssql_+_av_+_office_+_…">Windows XP + mssql + av + office + …</h3><p>metasploit中的有些模块，不，是很多模块是有关windows的，甚至是win上的特定软件的。如果你想试试，最好在你的实验室中安装一个xp的虚拟机。另外，个人觉得meterpreter在win下表现得比linux下厉害。</p>
<p>获取正版XP，下载安装mssql，并按照邪恶的魔法禁书《metasploit：渗透测试魔法师指南》P269配置。</p>
<p>当然，有些东西如果想试试还得有其它软件。请自行search并use然后info查看那些exploit的信息。</p>
<h3 id="网络配置">网络配置</h3><p>渗透测试实验室的核心在于几个虚拟机的网络配置。</p>
<p>首先，要保证这些漏洞百出的靶机们与互联网隔绝，省得一不小心成功把互联网上什么政府网站搞挂，然后警察叔叔就找上门了。</p>
<p>vbox可以建立host-only的内网很好的实现宿主机和虚拟机共享的局域网。</p>
<p>首先选中File-Preference-Network添加一个host-only network。默认是vboxnet0，并且dhcp是自动开启的，如果不是，请打开它(当然你也可以对每台机器设置静态地址，我觉得这挺费事，通常我只对宿主机设置静态地址)。</p>
<p>然后在我的渣gentoo中是这样，其它linux发行版大致差不多或类似，unix大致类似，windows自己想办法我不知道：</p>
<pre><code>sudo ifconfig vboxnet0 inet <span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> up
</code></pre><p>注意，以上地址自己看怎么写，这都可以在设置dhcp同样的地方设置。</p>
<h2 id="配置metasploit">配置metasploit</h2><p>然后就是在宿主机上设置metasploit，准备好你的枪。建议直接从github上git clone。</p>
<p>metasploit项目在github上的wiki有一个很完整的参考<a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment" target="_blank" rel="external">Setting Up a Metasploit Development Environment</a></p>
<p>我就说说在gentoo上的问题和为什么不选择gentoo官方源里的稳定版本。</p>
<p>首先，我好像什么依赖问题也没碰到。自己对照ubuntu的看看少什么，你需要libpcap来处理网络流量、一个完整的编译工具链，nasm，curl，wget，还有postgresql作为数据库。总之，我什么问题也没碰到。</p>
<p>然后跟着把rvm装上，完全照着wiki来就是了。</p>
<p>将metasploit项目git clone到本地(别给我说不知道怎么做)，进入到其目录。</p>
<pre><code>./msfconsole
</code></pre><p>如果提示：</p>
<pre><code>[*] Metasploit requires the <span class="keyword">Bundler </span>gem to <span class="keyword">be </span>installed
$ gem install <span class="keyword">bundler</span>
</code></pre><p>照它说得就是。</p>
<p>还有最后一个问题，对metasploit，有一个数据库来跟踪渗透测试过程非常有用。你需要自己配置数据库，默认数据库是postgre，当然你也可以选其它的。</p>
<p>参考这里，虽然是fedora的，基本原理对所有linux发行版都适用:</p>
<p><a href="https://fedoraproject.org/wiki/Metasploit_Postgres_Setup" target="_blank" rel="external">Metasploit Postgres Setup</a></p>
<p>很多不想看拉倒。关键在于创建数据库和用户，然后能在msfconsole里连上就行。</p>
<p>为了方便，你可能想让postgre开机启动。每个发行版可能都不一样吧，gentoo上这样：</p>
<pre><code>sudo rc-update <span class="built_in">set</span> postgresql-<span class="number">9.2</span> <span class="keyword">default</span>
</code></pre><p>至此，你的靶子和枪都准备好了。</p>
<h2 id="使用metasploit">使用metasploit</h2><p>metasploit提供的工具可以分为几类：</p>
<ul>
<li>auxiliary</li>
<li>exploit</li>
<li>tools<br>其它如msfencode，msfpayload</li>
</ul>
<p>不在本文讨论范围内，参考这里<a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page" target="_blank" rel="external">Metasploit Unleashed</a></p>
<h2 id="Social_Engineer_Toolkits">Social Engineer Toolkits</h2><p>部分基于msf的项目，同样是git clone过来，手动配置下运行就是。依赖很简单，都是python的依赖。</p>
<p>可以来玩玩传说中的社交工程，exploit人类比exploit机器省心省力多了= =</p>
<p>更多参见<a href="http://www.social-engineer.org/framework/Social_Engineering_Framework" target="_blank" rel="external">Social Engineering Framework</a></p>
<h2 id="墙内tips">墙内tips</h2><ul>
<li><p>git clone很慢还不能断点，可以先git init然后fetch，最后checkout <code>FETCH_HEAD</code>。。。</p>
</li>
<li><p>找不到的东西就试试海盗湾(自寻)</p>
</li>
<li><p>微软的东西可以从这里找：<a href="http://www.itellyou.cn/" target="_blank" rel="external">MSDN, I tell you</a></p>
</li>
</ul>
<h2 id="参考资料">参考资料</h2><ul>
<li><a href="https://community.rapid7.com/docs/DOC-2196" target="_blank" rel="external">How To Set Up A Penetration Testing Lab</a></li>
</ul>
<p>好吧，扯淡扯完了，Happy hacking</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/07/02/goodbye-jnu/" itemprop="url">
                  再见，江大
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-07-02T00:00:00+08:00" content="2013-07-02">
              2013-07-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/07/02/goodbye-jnu/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/07/02/goodbye-jnu/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>昨天晚上帮室友搬家后，宿舍就剩我一个人。一路从欧尚走回江大，看着熟悉而陌生的街景，听着此起彼伏的车来车往，记忆像潮水一样刹也刹不住。往昔的种种在脑海中光影交错，熟悉的城市却变得陌生。</p>
<p>依次送别同学的时候还没感觉，当昨晚面对空荡荡的楼道时，才恍然似乎明白，四年青春落幕，宴席终散。不觉悲从中来，失魂落魄。</p>
<p>时光滚滚向前，去得匆匆，了然无痕。但是斗志昂扬毫无畏惧地向前看吧，记忆永在，青春万岁!</p>
<p>Bye and thanks, Jiangnan University. My classmates and friends, I love you.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/reviews/2013/06/09/hacking-the-art-of-exploitation/" itemprop="url">
                  Hacking: the Art of Exploitation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-06-09T00:00:00+08:00" content="2013-06-09">
              2013-06-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/reviews/" itemprop="url" rel="index">
                    <span itemprop="name">reviews</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/reviews/2013/06/09/hacking-the-art-of-exploitation/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="reviews/2013/06/09/hacking-the-art-of-exploitation/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>This book’s C part is very fascinating. Along with the author, you can actually achieve a set of note take and search tools for multiuser, and an interesting game. What’s more, some linux/unix knowledge will be learned.</p>
<p>So I tried it.</p>
<p>To try these interesting things written in five years ago is not easy on my x86_64 gentoo linux. There are tons of difference and I’m always confused by what I don’t know. However, I was so happy with such interesting things after so much pains.</p>
<p>This book makes C fascinating to me! I’m so desired to be a C hacker!</p>
<p>Thanks to the author–Jon Erickson! Even too simple and fundamental, the book open the door to a interesting world for me.</p>
<hr>
<p><strong>TOC</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<h2 id="Experiment_Notes_on_A_64-bit_Machine">Experiment Notes on A 64-bit Machine</h2><h3 id="Format_for_Pointer">Format for Pointer</h3><p>pointer/address to be <code>%p</code> not <code>0x%08x</code>.</p>
<h3 id="Compile_32-bit_Programs_on_a_x86_64_Machine">Compile 32-bit Programs on a x86_64 Machine</h3><p>By default, gentoo linux amd64 will set <code>multilib</code> USE flag. You’ll have a multilib glibc and gcc. Then to compile and link a program with gcc, just add <code>-m32</code> parameter to gcc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 test.c</span><br></pre></td></tr></table></figure>
<h3 id="Built-in_Functions_in_Gcc">Built-in Functions in Gcc</h3><p>gcc actually have some functions built into it. It will use its built in version for some functions like <code>printf</code>. Even if you forget include header files, it will be compiled but give out a warning.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Work/project/hack ⮀ gcc -g -m32 -o firstprog firstprog.c</span><br><span class="line">firstprog.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">firstprog.c:<span class="number">7</span>:<span class="number">5</span>: warning: incompatible implicit declaration of built-in <span class="keyword">function</span> ‘<span class="built_in">printf</span>’ [enabled by default]</span><br></pre></td></tr></table></figure>
<h3 id="Disable_SSP">Disable SSP</h3><p>To test hacking skills like stack overflow and so on on a modern x86_64 machine. You have to cheat.To disable the stack smashing prevention(SSP) by gcc, you can simply specify a parameter <code>-fno-stack-protector</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fno-stack-protector test.c</span><br></pre></td></tr></table></figure>
<h3 id="Disable_Executable_Space_Protection">Disable Executable Space Protection</h3><p>To let the stack be executable, you have two choices:</p>
<ol>
<li>add <code>-z execstack</code> parameter to gcc when compiling.</li>
<li>Using <code>execstack</code> to set executable stack flag of ELF binaries and shared libraries</li>
</ol>
<p>Both will work, It depend on you which to choose.</p>
<h3 id="Disable_ASLR">Disable ASLR</h3><p>If you check the book carefully later, you’ll find some technics to prevent exploitation. One of them is ASLR.</p>
<p>To disable (Address space layout randomization)ASLR globally:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">0</span> &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>
<p>Or just run the binary file using <code>setarch</code>.</p>
<p>Please refer to the References and <code>man setarch</code>.</p>
<h3 id="The_virtual_Memory">The virtual Memory</h3><p>One of my observation is that if you run a 32-bit program on 64-bit system, the address in the memory will differ a lot from just 32-bit system.</p>
<p>According to my experience, the memory address ranges from about <code>0x804a014</code> to <code>0xffffdff8</code>, <code>.data</code> and <code>.bss</code> will locate at around <code>0x804axxx</code>. But the stack bottom will be at around <code>0xff7fcxxx</code>. What’s important is that environment variables will be at the bottom of memory until <code>0xffffdff8</code>. <code>0xffffdff8</code> will be the <code>filename</code> of the execute file.</p>
<p>There are some other differences from the book. One of these is the length of file change 1, the address of environment variable for shellcode will change 1 byte.</p>
<p>I don’t know why things like this, I’ll try to find more about it and ask it at StackOverflow. But that’s what I get after several tests, your machine may differ.</p>
<h3 id="About_dtors_section">About dtors section</h3><p>I find I can’t success on the exploitation about dtors. The destruction function address will be in <code>.fini_array</code> section. Note: objdump will show addresses in little endian. So address <code>0x08048473</code> will looks like that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Contents of section .fini_array:</span><br><span class="line"> <span class="number">8049</span>ef8 <span class="number">73840408</span>                             s...</span><br></pre></td></tr></table></figure>
<p>Furthermore, because of cpu’s NX feature, when you try to modify <code>.dtors</code> or <code>fini_array</code> section, you’ll just get a segfault.</p>
<h3 id="libnet-1-0_on_amd64">libnet-1.0 on amd64</h3><p>Last thing I have to mentioned is that libnet-1.0 use too much <code>u_long</code>. <code>u_long</code> will take 8 bytes on a 64-bit machine but 4 bytes on a 32-bit one.</p>
<p>You have to care about that because it will build tcp header with incorrect length of source address and destination address.</p>
<p>I don’t know how nemesis(which depends on libnet-1.0) works well on amd64 machines…</p>
<p>To compile and link with libnet-1.0 on gentoo amd64 architecture, try something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc `libnet-<span class="number">1.0</span>-config --defines` -o rst_hijack rst_hijack.c -lnet-<span class="number">1.0</span> -lpcap</span><br></pre></td></tr></table></figure>
<h3 id="Enable_IP_Forward">Enable IP Forward</h3><p>When you want to try arp sproofing or arp poisoning, enable the ip forward for the kernel:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="number">1</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>
<h3 id="drop_previledge">drop previledge</h3><p>bash version 2 will drop previlege when run with setuid. So lots of root shell will falls to normal user without <code>setresuid</code>.</p>
<h3 id="Some_other_things">Some other things</h3><p>Examine by <code>man</code> before you try the program in this book. </p>
<p>For example, in <code>update_info</code>, add <code>(void *)</code> in to avoid warning. In <code>connectback_shell.s</code> the <code>connect</code> syscall won’t save file descriptor in eax. Lots of <code>include</code> was lost in this book…</p>
<h2 id="Some_Other_Thoughts_on_This_Book">Some Other Thoughts on This Book</h2><p>Amazing！！When You first get a root shell in an exploitation, you can’t stop jumping out of the chair! The book is simple and introductory, but both interesting and insight. I really like it.</p>
<h2 id="Hacker’s_Tools">Hacker’s Tools</h2><blockquote>
<p>Man is most important, Google is the second.</p>
<p>Prof. Li Yinong</p>
</blockquote>
<p>Consult to <code>man</code> if you are stuck, then search in google(NOT BAIDU).</p>
<ul>
<li>gcc to compile</li>
<li>gdb to debug/attach, use as calculation and so on.</li>
<li>objdump to be used as a disassembler to view executable in assembly form</li>
<li>nm to list symbols in many kinds of files</li>
<li>perl for one line exploitation</li>
<li>python for one line exploitation</li>
<li>hexdump to dump binary files into hex</li>
<li>shell to facilitate with exploitation.</li>
<li>many unix tools like od/sed/awk/bc and so on may be useful.</li>
</ul>
<p>About net hack, You may like to use:</p>
<ul>
<li>libnet to inject packets</li>
<li>libpcap to capture packets</li>
<li>tcpdump to capture and show packets</li>
<li>dsniff to sniff the net and arp poison</li>
<li>netcat, wow, swiss knife</li>
<li>telnet, a good client to use</li>
<li>ettercap/nessus/metasploit and so on.</li>
</ul>
<h2 id="Some_References">Some References</h2><p>About exploitation:</p>
<ul>
<li><a href="https://crypto.stanford.edu/~blynn/rop/" target="_blank" rel="external">Return-oriented programming on 64-bit Linux</a></li>
<li><a href="http://www.exploit-db.com/papers/24085/" target="_blank" rel="external">Stack Smashing On A Modern Linux System</a></li>
<li><a href="http://www.tenouk.com/Bufferoverflowc/" target="_blank" rel="external">The Stack-based Buffer Overflow Hands-on Tutorials</a></li>
<li><a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory" target="_blank" rel="external">Anatomy of a Program in Memory</a></li>
<li><a href="http://www.tenouk.com/ModuleW.html" target="_blank" rel="external">COMPILER, ASSEMBLER, LINKER AND LOADER: A BRIEF STORY</a></li>
<li><a href="http://security.stackexchange.com/questions/20497/stack-overflows-defeating-canaries-aslr-dep-nx" target="_blank" rel="external">Discuss on stack exchange</a></li>
<li><a href="https://www.cs.umd.edu/class/fall2012/cmsc498L/materials/vuln-lab.shtml" target="_blank" rel="external">Shellcode/buffer overflow lab</a></li>
<li><a href="http://www.csee.umbc.edu/~chang/cs313.s02/stack.shtml" target="_blank" rel="external">C Function Call Conventions and the Stack</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-overflow/" target="_blank" rel="external">Linux下缓冲区溢出攻击的原理及对策(中文)</a></li>
</ul>
<p>About packet capture and injection:</p>
<ul>
<li><a href="http://networksecurity.org.ua/0596007949/toc.html" target="_blank" rel="external">Network Security Tools(chapter 10 and 11 are about libnet/libpcap)</a></li>
<li><a href="http://www.tcpdump.org/pcap.html" target="_blank" rel="external">Programming with pcap</a></li>
<li><a href="http://yuba.stanford.edu/~casado/pcap/section1.html" target="_blank" rel="external">The Sniffer’s Guide to Raw Traffic</a></li>
</ul>
<p>About arpspoofing:</p>
<ul>
<li><a href="http://www.irongeek.com/i.php?page=security/arpspoof" target="_blank" rel="external">The Basics of Arpspoofing/Arppoisoning</a></li>
</ul>
<p>About shellcode</p>
<ul>
<li><a href="http://www.vividmachines.com/shellcode/shellcode.html" target="_blank" rel="external">Shellcoding for Linux and Windows Tutorial</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/06/01/recent-summary/" itemprop="url">
                  Recent Summary
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-06-01T00:00:00+08:00" content="2013-06-01">
              2013-06-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/06/01/recent-summary/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/06/01/recent-summary/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>这里越来越不是技术博客了，越来越像博主个人的记事本而不像分享技术的地方了。</p>
<p>总之，由于身体健康的考虑和对妹子的向往等一系列原因，我坚定地决定珍爱生命，远离计算机。但对一个热衷于折腾的人这项正确伟大光明的方针就是空头支票，实践的一点也不好。</p>
<p>最初还好，天天往返于图书馆一教与寝室，一天不怎么回去。忙着看妹子，看书。看看《别逗了，费曼先生》，对费曼真是崇拜得五体投地。然而愈发的感觉到自我的平庸和碌碌无为。</p>
<h2 id="考研后的学习">考研后的学习</h2><p>最近忙着看《Hacking：the Art of Exploition》,感觉里面讲C语言的部分太好了，深浅合适，不会像C语言圣经那么假设您已经有一定深度，也不会像国内的一堆C教材把简单的语言搞得复杂到让人望而却步。作者从最最基本的程序设计思想开始讲，循序渐进地引入C的语法和概念，精巧的例子相当助于理解而且充满意趣。更重要的事，结合着一些基本的汇编讲解让人对C的理解有了更高的高度。<a href="吐槽下当初那些拿着天花乱坠术语讲解着莫名其妙的原理的VB教材，直接把我对计算机的兴趣给毁了。">^1</a>我觉得任何一本优秀的教材、一篇优秀的教程，一份优秀的文档，都具有该书作者那种平易近人，循序渐进，深浅适度并且充满着意趣和爱的风格。可惜，天朝几十年的教育风格简直就是为了毁掉人们对丰富多彩科学与艺术的热爱。</p>
<p>汇编语言我觉得到此为止，那本《Professional Assembly Language》也是一篇优秀的教程，清晰、平易、深入浅出，注重实践。当把一本书大部分汇编代码在我的Linux机器下实践后我决定不再深入研究某些章节，比如FPU计算、SSE和SSE2和SSE3，因为80%的实际情况下您只需要用到20%的知识，基本的汇编知识已经足够应付大多数场景，其它东西真心别指望记住也至今没用到过。</p>
<p>学习汇编感觉一大好处是回头看C清晰了许多，对计算机和操作系统的理解也更加深入，当然对调试也是大有裨益。基本是汇编那本书里我才学习和习惯了工具集比如objdump/gdb/gcc等等。顺便推荐下kdbg作为gdb前端。虽然我更喜欢直接用gdb。</p>
<p>以前只喜欢更加抽象的语言比如lisp和python，事实上最开始只是随手看看有关Python的书却引起了对调试器的兴趣，最后发现gdb太好玩了。现在却也很喜欢C和汇编了，它们简洁而强大，却构成了所有上层抽象的基础。</p>
<p>另外需要强调的是，实践和理论是两码事。看作者讲的时候觉得一清二楚，水到渠成。真正到了到自己的机器上实践时却困难重重。这本书有些老是一方面，但另一方面动手本来就不是这么简单的事。</p>
<p>稍微记下我碰到的一些问题，如果您能有何指教，万分感谢：</p>
<h3 id="在64位下编译32位汇编程序">在64位下编译32位汇编程序</h3><p>书中基本都是32位程序，其实差别也不大，只不过寄存器的名字变成rip，rap什么的，但为了学习方便我还是选择编译32位程序。</p>
<p>首先系统要支持32位(拥有32位库文件，比如glibc和gcc在gentoo中使用multilib的USE标记。或者archlinux添加multilib仓库并安装32位glibc和gcc)，CPU通常64位都能运行在32位兼容模式。</p>
<p>使用gas进行汇编程序编译和链接如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">as --<span class="number">32</span> -gstabs -o paramtest2.o paramtest2.s</span><br><span class="line">ld -dynamic-linker /lib/ld-linux.so.<span class="number">2</span> -melf_i386 -o paramtest2 -lc paramtest2.o</span><br></pre></td></tr></table></figure>
<p>对<code>as</code>其中 <code>--32</code> 是架构，-gstabs是要编译时保存调试符号以供将来用gdb调试时查看，<code>-o</code>后面是目标文件名。</p>
<p>对ld来说<code>-dynamic-linker</code>指定了链接的动态库位置，<code>-lc</code>后面是你要读取和连接的目标文件。如果没有使用C库函数没必要连接上，可以仅仅<code>ld -o functest4 functest4.o area.o</code>。<code>-melf_i386</code>指定了架构。</p>
<p>使用gcc编译汇编程序时可以一次完成编译和连接，我通常倾向于这种方式。注意，gcc是以<code>main</code>作为标志来编译的。这样做虽然省事，但gcc实际上做了很多你可能并不希望它去做的事，以致于用它编译和连接的程序在查看堆栈时会让你完全看不懂。gcc默认连接动态库，所以在你的汇编程序使用C标准库时用gcc会很方便。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -m32 -o paramtest3 paramtest3.s</span><br></pre></td></tr></table></figure>
<p><code>-g</code>用来保存调试符号，<code>-m32</code>用来指定使用32位模式。</p>
<h2 id="调试时一些问题">调试时一些问题</h2><p>当你尝试书中的C程序时很可能会碰到很多疑问。比如反汇编的时候发现printf变成了puts。gcc默认开启一些优化选项，并且gcc会将许多C库函数用它自己内置的函数替代。这使你无法stepinto某个库函数，也无法在库函数中设置断点。为了防止gcc这么做，你可以加上<code>-fno-builtin</code>参数[^2]。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -fno-builtin -m32 -o funcptr_example funcptr_example.c</span><br></pre></td></tr></table></figure>
<p>之后就可以在gdb中在诸如strcpy函数设置断点，并且可以step into这些库函数了。</p>
<p>但也未必，你需要安装glibc的调试文件。</p>
<p>如果gdb叫你检查/usr/lib/debug目录并且glibc中函数名称无法显示只是<code>??</code>，那么您八成是没有安装调试符号。其它linux发行版你也许只要安装调试符号就行。但gentoo中，情况稍微复杂些。在gentoo中可以添加上<code>debug</code>USE标记，但这还不够，在<code>make.conf</code>中需要添加一条特性：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/portage/make.conf |grep FEATURES</span><br><span class="line">FEATURES=<span class="string">"splitdebug"</span></span><br></pre></td></tr></table></figure>
<p>之后emerge你的glibc，然后<code>/usr/lib/debug/</code>下就有调试符号了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/lib/debug/ </span><br><span class="line">lib32  lib64  sbin  usr</span><br></pre></td></tr></table></figure>
<h2 id="缓冲区溢出">缓冲区溢出</h2><p>在实践第三章简单缓冲区溢出时发现虽然用户数据很容易覆盖，但妄图覆盖堆栈的返回地址的行为却屡屡失败(指<code>exploit_notesearch</code>程序)。我google了下，原因有以下几种：</p>
<ol>
<li><a href="http://en.wikipedia.org/wiki/Address_space_layout_randomization" target="_blank" rel="external">ALSR</a>，现代操作系统中有了更健全的保护系统来阻止黑客计算出正确的地址。该特性可以在<code>/proc/sys/kernel/randomize_va_space</code>中写入0来关闭。</li>
<li>在大多数64位系统中，可能在较新的linux内核，妄图通过另一个程序来挖掘计算程序地址的企图是不怎么可行的。两个程序(<code>exploit_notesearch</code>和<code>notesearch</code>根本不运行在同一个虚拟内存空间)。<a href="[评论部分有讨论这个，我是在另外一个地方看到，但找不到链接了](http://stackoverflow.com/questions/8696517/buffer-overflow-example-from-art-of-exploitation-book)">^4</a></li>
<li><a href="http://en.wikipedia.org/wiki/Buffer_overflow_protection" target="_blank" rel="external">Gcc的堆栈保护</a>，据说可以通过像gcc添加参数<code>-fno-stack-protector</code>来取消某些保护[^3]。但我的gcc好像就没这个参数。</li>
<li>还有一大票其它短期内你永远也搞不清的安全机制。</li>
</ol>
<p>在换32位测试无力后，我默默爬上海盗湾准备找到个古老的书籍配套livecd来动手实践下。虽然都是些过时的技术，但看上去仍然相当有趣。</p>
<p>更多有意思的讨论参见<a href="http://stackoverflow.com/questions/1851293/what-are-some-advanced-and-modern-resources-on-exploit-writing" target="_blank" rel="external">这里</a>，三年前的老讨论。哈哈，我这里有shellcoder‘s handbook. </p>
<h2 id="Coursera课程">Coursera课程</h2><p>基本上High performance scientific computing被放弃了，我已经落下将近两周。Fortran/makefile那里停下来，将来再看吧。</p>
<p>Machine Learning继续跟进，视频，作业，动手实践。不过我都压缩到两天完成一周的任务了……</p>
<h2 id="其它">其它</h2><ul>
<li>在百度贴吧Linux吧获得成就：<em>wps黑开源大喷子</em></li>
<li>偶尔在byr论坛水水，一群人投票讨论nuanyangyang是不是妹子= =</li>
<li>每天活动活动</li>
<li>下载了IDA pro免费版，看了看，确实比objdump方便强大多了……虽然没什么可比性……</li>
<li>下载并看了下Immunity debugger，虽然感觉很厉害的样子，却几乎一点不会用。后来看到《A Bug Hunter’s Diary》中作者用immunity debugger！</li>
<li>随意试了下linux下的fork尝试实现调试器启动进程的功能，不知道怎么挂住程序让它别运行……后来也没再查资料和折腾这个。</li>
</ul>
<p>其它，没什么好说的。</p>
<h2 id="FootNotes">FootNotes</h2><p>[^2]: <a href="http://stackoverflow.com/questions/15306090/cant-step-into-string-h-function-with-gdb" target="_blank" rel="external">Can’t step into string.h function</a><br>[^3]: <a href="http://stackoverflow.com/questions/13024977/the-art-of-compiler-on-buffer-overflow" target="_blank" rel="external">The Art of Compiler on Buffer Overflow</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/reviews/2013/05/16/some-books/" itemprop="url">
                  我是如何浪费生命
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-05-16T00:00:00+08:00" content="2013-05-16">
              2013-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/reviews/" itemprop="url" rel="index">
                    <span itemprop="name">reviews</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/reviews/2013/05/16/some-books/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="reviews/2013/05/16/some-books/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>毕业季，把毕设某Goldstein算法和FFT最小二乘算法实现后就扔了，借了一大堆逆向汇编调试的书。</p>
<p>我想让大家看看我是如何瞎折腾最终浪费生命一事无成的，请大家从这个反例中吸取经验教训，珍爱生命，远离折腾。</p>
<blockquote>
<p>专心赚钱和把妹，别搞些没用的。</p>
<p>中国谚语</p>
</blockquote>
<h2 id="Gray_Hat_Python">Gray Hat Python</h2><p>跳坑从一本Python灰帽子开始，因为对Python的熟悉和兴趣加上某种机缘巧合，从图书馆借来看了一阵。</p>
<p>首先是开发环境的搭建，据作者说搭建开发环境是个痛苦而无聊的过程。对新手很棘手、很消磨斗志和耐心。但对我这样已经在Linux下被虐过多少遍的人完全没感觉了，即使在windows上也轻车熟路装好Python。唯一不爽的地方在于，作者说windows下调试乐趣横生所以不考虑linux，我只好装了个虚拟机xp玩。当然，作为有个性的Linuxer，我的做法是在linux宿主机编辑文件共享给windows虚拟机用，真尼玛蛋疼。</p>
<p>接着就是些基本理论，通过这本书我第一次发现原来Python和C集成的这么好，于是把Python C API翻译了一遍……后来在《Unix设计艺术》中看作者说Python最开始设计就是为了跟C集成……</p>
<p>总之，Python强大的C外挂= =。但总有些不舒服的地方，尼玛Windows和Unix函数参数进栈顺序……</p>
<p>再往后是调试器设计的基本知识，卧槽啊，第一次了解CPU，那个看得一愣一愣的，几次差点睡着。最后看了好几遍又回头了好几遍又看了好几本其它书讲才总算知道有几个寄存器且有什么用栈是什么软硬件断点实现，现在什么平坦内存模型内存断点堆是什么还是搞不清，传说中的Intel开发者手册更是没勇气去看。</p>
<p>接着就开始在虚拟机xp上开始照着自己写调试器了，好在作者对各种Win32 API讲得清清楚楚明明白白，又在网上提供源码和各种结构定义。不然您看着满目错误的中文版就跪吧。照着网上提供的代码试了不知道多久终于把这个向pygdb致敬的调试器写出来了。</p>
<p>不过Win32 API完全给我看跪了。在byr上看有人说Linux的系统调用比windows好懂[^1]。最开始还想将这个具简单的调试器移植到linux下看看，然而，现在还什么都没看。</p>
<p>之后，慢慢看吧，还没动手，用pygdb部署软钩子，进程快照和回滚，处理非法内存操作貌似很厉害的样子……</p>
<p>再往后看到用Immudbg针对特定shellcode寻找漏洞，我觉得得回头找点其它书补补相应知识了，很难看懂作者在说什么了……于是，IDA pro</p>
<h2 id="IDA_Pro">IDA Pro</h2><p>前面讲汇编和IA-32处理器，栈及堆的基本原理可执行文件的区段指令集啥的，看得云里雾里，不知道是因为看雪翻译的问题还是我弱爆了……</p>
<p>看到PE格式和ELF格式文件格式细节完全跪了没，最终也没理解什么GOT/PLT，动态链接成员结构啥的链接加载啥的……然后就跳过了。于是后来看到《Debug Hacks》听作者讲GOT/PLT时又跪了……</p>
<p>接着看了看第一个例子，跟踪执行流。虽然下了一个IDA Pro以供调教，然而终于也没开虚拟机……我说，我还是回头看看汇编在来看例子吧……于是这本书又暂时按下。</p>
<h2 id="Debug_Hacks">Debug Hacks</h2><p>一本日本人写的书，风格清新脱俗，平易近人。看讲gdb那货直接把我迷住了，哇草啊，gdb这么好玩啊，哇草啊，比我写的那啥调试器强大多了。</p>
<p>看到byr挂站排行榜脑子一抽写了个byr挂站脚本扔到Luoyun云平台上，结果web-ssh关掉了看不到标准输出了。然后竟然在Stack Overflow上看到有人用gdb来重定向程序输出，尼玛啊，这瞬间就感觉调试器无敌了。</p>
<p>结果就是，在看到这本主要讲linux平台调试的书时顿时爱不释手，特别是前几章讲gdb的，再加上几个例子太好玩了。</p>
<p>最sb的事接着来了，参照书上写了个对NULL写入的Linux内核模块接着竟然在宿主机上加载了……卧槽，久违的kernel panic。好吧，正好复习下reisub大法，可是它没重启动，最后还是长按关机键……</p>
<p>后面讲crash倒兴致了然了，虽然在gentoo上顺手装上，却没啥动力让系统吐核……虚拟机又懒得开。</p>
<p>顺口吐槽，原来pdb这么像gdb啊……</p>
<p>不过还是好多不懂，linux下线程共享资源，看得完全跪掉了，现在也没搞明白怎么回事。</p>
<p>gdb或objdump反汇编出来的汇编代码语法是AT&amp;T的，和Intel差别还挺大，之前讲windows的IDA pro和Gray Hat Python都是Intel语法……我喜欢AT &amp; T</p>
<p>于是抛弃了几本讲MSMA和NSMA的书选择了《Professional Assembly Language》。</p>
<h2 id="Professional_Assembly_Language">Professional Assembly Language</h2><p>一本完全遵循AT&amp;T语法，在linux平台下，实用gcc/gdb/ld/as/gas/grof等工具的书啊。</p>
<p>第一个例子无压力通过，虽然不了解语法云里雾里，但之前硬件基础讲解还是很棒的，就是只是32位的，我的系统是64兼容32位，有时候要加些参数。相比而言，在这个问题上只有《Debug Hacks》做的好，64位和32位都讲得挺清楚。</p>
<p>打算接着熟悉下指令</p>
<p>再接着打算看看Linux系统调用。回头学习Linux去= =</p>
<p>以上只是打算……</p>
<h2 id="K_&amp;_R">K &amp; R</h2><p>为什么乱入了一本书，带着浓重Unix风格的C语言圣经。为了看懂那些书中的例子在调试些什么C程序，只好翻K &amp; R去了。</p>
<p>K &amp; R也许真不适合入门，但我还是想给初学者推荐(莫喷……)。</p>
<p>听说K &amp; R不符合C 99规范，暂不管它，Fortran这规范都2008了也没听说哪个编译器实现了，还有好多东西还是Fortran77。gcc不报Warning就好。</p>
<h2 id="Coursera">Coursera</h2><p>最不能理解的是，这个时候还跑去看High Performance Scientific Computing和Machine Learning。开着八线程学Fortran和Octave(matlab)。</p>
<h2 id="Summary">Summary</h2><p>大概就是这样，被我浪费掉的，这么多人都忙着旅行恋爱的享受最后青春的，我选择的，大学最后光阴。</p>
<p>大家跟我一起唱：</p>
<pre><code><span class="comment">珍爱生命，远离计算机</span>
<span class="comment">珍愛生命，遠離計算機</span>
<span class="comment">Cherish</span> <span class="comment">life</span><span class="string">,</span> <span class="comment">away</span> <span class="comment">from</span> <span class="comment">the</span> <span class="comment">computer</span>
<span class="comment">大切な命のため、コンピュータから離れてください</span>
<span class="comment">Chérir</span> <span class="comment">la</span> <span class="comment">vie</span><span class="string">,</span> <span class="comment">loin</span> <span class="comment">de</span> <span class="comment">l'ordinateur</span>
<span class="comment">Берегите</span> <span class="comment">жизнь</span><span class="string">,</span> <span class="comment">вдали</span> <span class="comment">от</span> <span class="comment">компьютера</span>
<span class="comment">Cherish</span> <span class="comment">Leben</span><span class="string">,</span> <span class="comment">weg</span> <span class="comment">vom</span> <span class="comment">Computer</span>
<span class="comment">컴퓨터에서</span> <span class="comment">멀리</span><span class="string">,</span> <span class="comment">생명을</span> <span class="comment">소중히</span>
<span class="comment">Apreciar</span> <span class="comment">la</span> <span class="comment">vida</span><span class="string">,</span> <span class="comment">lejos</span> <span class="comment">de</span> <span class="comment">la</span> <span class="comment">computadora</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="title">[</span>&gt;<span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="literal">-</span><span class="title">]</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">.</span>
</code></pre><p>人生得意须尽欢：）</p>
<p>花堪折时只须折：）</p>
<h2 id="补记">补记</h2><p>Fri 24 May 2013 07:03:04 PM CST </p>
<p>谣传要交论文，基本上是两天给弄完了，好在之前真是认真了解这个课题了，吹起牛来一气呵成。</p>
<p>快毕业了一堆事，又是转党组织关系的又是填毕业登记表，又是毕业照体检。</p>
<p>班里没有毕业旅行感觉太好了，毫无兴致。</p>
<p>毕业把妹这种事……我还是不抱希望了……</p>
<p>整日整日地沉迷在图书馆和计算机前，偶尔的偶尔一个人出去转转。</p>
<p>哈，东边小操场没什么人，太喜欢在那边跑步了，江南的夜色依旧很美。记得有次跟着一个妹子跑了半个小时，第二天直接虚掉了= =</p>
<p>这几天就看了Professional Assembly Language一本书，断断续续看到浮点计算。把书上的代码跟着打了一遍，不得不说这本书真棒。例子都是神来之笔。</p>
<p>开始看《Hacking: The Art of Exploitation》, C语言那部分的例子真是让人觉得相见恨晚，由于看过以上几本书对汇编和堆栈比较熟悉发现看着真是享受。准备把书中所有的代码打一遍，太好玩了。</p>
<p>借了本《别闹了，费曼先生》，看得五体投地，这才是真黑客，真物理学家和数学家。</p>
<p>借了本《数学大师：从芝诺到庞加莱》，不得不说多好的一本书译得真有些不好懂……</p>
<p>这两本书我想单独写读后感。</p>
<p>因为毕业季一堆事，Coursera上Machine Learning这周到现在基本没看，High performance Scientific Computing直接被落下了，上周的视频还没看完，再加上进入Fortran和makefile的课题了，总有些力不从心。</p>
<p>最后吐槽下Girl-atlas，新上传的图像不仅打上水印而且只能查看缩略图了，而且下载链接也被移除了。很不爽，不能做壁纸的小图完全没有兴致再用脚本抓了。</p>
<p>结果愤而转向其它网站开始抓图……比如<a href="http://www.motu123.com/S_Cute/" target="_blank" rel="external">Motu</a>(<strong> Maybe 18X,慎点 </strong>), 再也没有<a href="http://girl-atlas.com/" target="_blank" rel="external">girl-atlas</a>老少咸宜高清无码的品味了。无论是图像更新及时度，图像质量，网站质量，girl-atlas做的都是最棒的.</p>
<h2 id="FootNotes">FootNotes</h2><p>[^1]: Deepin 开发者lovesnow(小邪兽)在贴吧贴过如何枚举linux下进程，好厉害好厉害，以前还见过他用python来hack植物大战僵尸= =，膜拜膜拜膜拜。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/05/13/graduation-season/" itemprop="url">
                  毕业季，青春的尾巴
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-05-13T00:00:00+08:00" content="2013-05-13">
              2013-05-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/05/13/graduation-season/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/05/13/graduation-season/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>转眼又是一年的五月中旬，我都不能记起之前的三年五月是什么样，我干了什么，想些什么，爱过什么，恨过什么。</p>
<p>只是这个五月，笼罩在无所事事的清闲和对未来捉摸不定的焦虑气氛中。</p>
<h2 id="毕业论文">毕业论文</h2><p>导师说，五月末就交终稿了。</p>
<p>然而一个字也不想写。</p>
<p>下雨的某天和室友去教室写了点论文，把绪论写完又写了一堆原理。相比一群复制粘帖的同学我竟然一直能自己有的写……</p>
<p>只是Goldstein算法实践了之后再也不想做什么了。</p>
<h2 id="Coursera">Coursera</h2><p>还有就是跟Coursera上课程，总有人喜欢做些 <em>没用</em> 的事。我觉得真该找些家教兼职出去丰富下社会经验换点外快，然而，总有些残想，唉。</p>
<p>认认真真地开始跟Coursera上的machine learning课程和High Performance Scientific Computing. 后来看到Introduction to data science和一门类似营养与健康的课。</p>
<p>最后，Introduction to data science作业难度实在够呛，营养健康感觉太欧美化了。最终只跟了前两门课。结果High Performance Scientific Computing课程在讲到使用Amazon Aws云服务时我跪了，尼玛屌丝没有信用卡……</p>
<p>Machine Learning在Coursera上比较简单，略过了让人抓狂的数学推导而集中精力讲解怎么实际实现算法和解决问题，主要用matlab或octave。感觉相当顺手唉。</p>
<p>High Performance Scientific Computing则讲了些我很熟悉的IPython + numpy +scipy科学计算工具集，还讲了点linux和Python，一点git的用法。总之，太熟悉了实在没什么压力。</p>
<p>Introduction to Data Science有的video没字幕，那老师的吐字我直接就跪了，后来发现有字幕的也不怎么看得懂……后来做了Problem012之后觉得作业压力大，几门课又是毕业论文还有其它想法，还是放弃这门课了。</p>
<p>最后门营养与健康的课。没想到上来就被各种计量单位和机构名称给搞跪了。</p>
<h2 id="爬虫">爬虫</h2><p>High Performance Scientific Computing课程的视频不允许下载，这很奇怪，也不合Coursera世界上每个人都能自由获取教育的理念。所以，我找了个冠冕堂皇的理由写了个脚本把用来下相应的MP4视频和字幕。</p>
<p>看到byr挂站排行榜写了个挂站脚本，扔到了Luoyun上。</p>
<p>重新装上了selenium。有空看看Grobot。</p>
<h2 id="其它">其它</h2><p>开着虚拟机写word论文，写着写着闻到糊味了……</p>
<p>后来zy就把笔记本散热器借我了。想论文写完自己拆机。</p>
<p>在图书馆看了看《漫画SQL》，果然只有漫画看得进去。</p>
<p>发现Gdb真是强大啊，今天竟然用来重定向其它pts程序的标准输出了，这些日子又零零散散看些汇编和逆向的基本知识，感觉又误入歧途了。</p>
<p>ps:难得还打了两次网球几次乒乓球。</p>
<p>pps: 图书馆妹子真多。</p>
<p>ppps：可惜不关我什么事，万花丛中过，片叶未沾身。</p>
<p>pppps：毕业旅行……毫无兴致呢</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/04/27/a-beautiful-night-in-jnu/" itemprop="url">
                  夜色
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-04-27T00:00:00+08:00" content="2013-04-27">
              2013-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/04/27/a-beautiful-night-in-jnu/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/04/27/a-beautiful-night-in-jnu/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>晚上又一个人独享了JNU摄人心魄的绝美夜色。从操场向东远望城市灯火映红天空，一轮初生的圆月，像一枚猩红的宝石，静悄悄凝视着大地。好像用画笔把那份惊艳记录下来。</p>
<p>这样的春夜将不多， JNU剩下的每个日子都将弥足珍贵。</p>
<p>回到学校这段日子，也许将是‘空前觉后’的安逸日子。然而这安逸平静的日子却弥漫着难抑的忧伤，朦朦胧胧，好像江南氤氲的湿气一样，即使在明媚祥和的春日里，也渗透得无处不再。</p>
<p>十六号回学校，今天二十七，除了些零零碎碎的事(比如面基。。)这十一天我开了几个线程：</p>
<ul>
<li>回来在导师面前晃了下，表示我回学校了，又问了问发现毕设难度又被降了一个等级。又把那之前在家写的不堪入目的添加branch cuts的七层for循环重新调试好了，结果今天发现去包裹算法有问题，竟然会出现2 pi整周期偏差，好吧，在老师面前还吹嘘简单……<a href="好吧，就是一维相位解包裹时出现的采样率不足情况。">^1</a></li>
<li>当我看到<a href="http://girl-atlas.com" target="_blank" rel="external">girl-atlas</a>这个有魅力的网站时，第一反应是把喜欢的写真集下载下来。结果这站用的竟然是什么城通网盘，翻越教育网的代理环境下根本无法下载。然后……竟然习惯性的打开page source细细查看，然后很熟练的写起来脚本抓图……后来，就诞生了这货<a href="https://github.com/reverland/scripts/blob/master/python/girl-atlas.py" target="_blank" rel="external">girl-atlas.py</a>，用来断断续续下了2.36G的写真图片。</li>
<li>开始看图书馆里借来的《python灰帽子》,饶有兴趣地在虚拟winxp下动手用Python实现一个简单的调试器。我就不说这本书错误多多了，算是明白豆瓣评分为什么这么低，名副其实……一行一行地敲代码并且调试N遍使之通过测试真不容易。</li>
</ul>
<p>大概就这，看到了有些东西，有空想折腾：</p>
<ul>
<li>让我把零零碎碎地把js语法赶紧看完</li>
<li>verletjs - 物理仿真js库</li>
<li>flask， 对girl-atlas的图片有些想法 XD</li>
</ul>
<h2 id="FootNotes">FootNotes</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2013/04/16/interfacing-with-c/" itemprop="url">
                  C接口(译)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-04-16T00:00:00+08:00" content="2013-04-16">
              2013-04-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2013/04/16/interfacing-with-c/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2013/04/16/interfacing-with-c/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>翻译自<a href="http://scipy-lectures.github.io/advanced/interfacing_with_c/interfacing_with_c.html" target="_blank" rel="external">scipy lecture notes: Interfacing with C</a></p>
<p>作者：Valentin Haenel</p>
<p>这个章节包含许多在python代码中支持c/c++本机代码的许多不同方法， 通常这个过程叫作包裹(wrapping)。本章的目的是让您大致知道有那些技术和它们分别的优缺点是什么，于是您能够为您自己的特定需要选择何时的技术。在任何情况下，一旦您开始包裹，您几乎一定将想要查阅您所选技术各自的文档。</p>
<hr>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<h2 id="简介">简介</h2><p>本章节包含以下技术：</p>
<ul>
<li><a href="http://docs.python.org/2/c-api/" target="_blank" rel="external">Python-C-Api</a></li>
<li><a href="http://docs.python.org/2/library/ctypes.html" target="_blank" rel="external">Ctypes</a></li>
<li><a href="http://www.swig.org/" target="_blank" rel="external">SWIG(简单包裹和接口生成)</a></li>
<li><a href="http://cython.org/" target="_blank" rel="external">Cython</a></li>
</ul>
<p>这四种方法大概是最著名的，其中Cython可能是最高级且应该优先使用的。如果您想从其它角度理解包裹问题，其它方法也很重要。已经说过，虽然还有其它方法，但是理解以上基本方法，您将能评估您自己的选择看是否符合自己的需要。</p>
<p>以下标准在评估一项技术时也许有用：</p>
<ul>
<li>是否需要额外的库？</li>
<li>代码是否是自动生成的？</li>
<li>需要编译吗？</li>
<li>和Numpy数组进行交互方便吗？</li>
<li>支持C++吗？</li>
</ul>
<p>首先，您应该考虑你的用例。当用本机代码接口时，通常有两个用例：</p>
<ul>
<li>存在需要充分利用的C/C++代码，或者那些代码已经存在，或者那些代码更快。</li>
<li>Python代码慢爆了，将内循环交给本机代码处理</li>
</ul>
<p>每个技术通过包裹<code>math.h</code>中的<code>cos</code>函数实现。尽管这是微不足道的例子，它将很好的展示基本的包裹问题。因为每个技术也包括某种形式的Numpy支持，这也通过使用一个余弦函数被在某种数组上计算的例子来展示。</p>
<p>最后但重要的是两个小警告：</p>
<ul>
<li>所有这些技术都可能造成Python解释器崩溃(段错误)，这(通常)是C代码的Bug。</li>
<li>所有例子在linux上完成，也应该能在其它操作系统上实现</li>
<li>大多数例子中你需要一个C编译器</li>
</ul>
<h2 id="Python-C-Api">Python-C-Api</h2><p><a href="http://docs.python.org/2/c-api/" target="_blank" rel="external">Python-C-API</a>是标准Python解释器(就是所谓的CPython)的支柱。使用这个API可以用C或C++语言编写Python扩展。显然这些扩展模块可以凭借语言兼容性，调用任何C或C++写成的函数。</p>
<p>当使用Python-C-API时，人们通常写许多样板代码，先解析传递给函数的参数，然后构建并返回类型。</p>
<p><strong>优点</strong></p>
<ul>
<li>无需额外的库</li>
<li>许多低级的控制</li>
<li>完全可以用C++</li>
</ul>
<p><strong>劣势</strong></p>
<ul>
<li>可能需要大量工作</li>
<li>代码中的大量开销</li>
<li>必须编译</li>
<li>高额的维护代价</li>
<li>当跨Python版本时若C-Api变化没有后向兼容性</li>
</ul>
<p><strong>注意：以下Python-C-Api示例主要为了展示需要。因为大多其它技术实际上依赖这个，所以最好对它如何工作有个高层次的了解。在99%的用例中你最好使用其它技术。</strong></p>
<h3 id="示例">示例</h3><p>以下C扩展模块，让标准数学库中的<code>cos</code>函数在Python中可用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/*  Example of wrapping cos function <span class="keyword">from</span> math.h <span class="keyword">with</span> the Python-C-API. */</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;Python.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"></span><br><span class="line">/*  wrapped cosine function */</span><br><span class="line">static PyObject* cos_func(PyObject* self, PyObject* args)</span><br><span class="line">&#123;</span><br><span class="line">    double value;</span><br><span class="line">    double answer;</span><br><span class="line"></span><br><span class="line">    /*  parse the input, <span class="keyword">from</span> python float to c double */</span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">"d"</span>, &amp;value))</span><br><span class="line">        <span class="keyword">return</span> NULL;</span><br><span class="line">    /* <span class="keyword">if</span> the above function returns -<span class="number">1</span>, an appropriate Python exception will</span><br><span class="line">     * have been set, <span class="keyword">and</span> the function simply returns NULL</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    /* call cos <span class="keyword">from</span> libm */</span><br><span class="line">    answer = cos(value);</span><br><span class="line"></span><br><span class="line">    /*  construct the output <span class="keyword">from</span> cos, <span class="keyword">from</span> c double to python float */</span><br><span class="line">    <span class="keyword">return</span> Py_BuildValue(<span class="string">"f"</span>, answer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*  define functions <span class="keyword">in</span> module */</span><br><span class="line">static PyMethodDef CosMethods[] =</span><br><span class="line">&#123;</span><br><span class="line">     &#123;<span class="string">"cos_func"</span>, cos_func, METH_VARARGS, <span class="string">"evaluate the cosine"</span>&#125;,</span><br><span class="line">     &#123;NULL, NULL, <span class="number">0</span>, NULL&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* module initialization */</span><br><span class="line">PyMODINIT_FUNC</span><br><span class="line"></span><br><span class="line">initcos_module(void)</span><br><span class="line">&#123;</span><br><span class="line">     (void) Py_InitModule(<span class="string">"cos_module"</span>, CosMethods);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如您所见，所有对参数处理、返回类型和模块初始化都相当样板化。然而有些被摊销了，当扩展增长时，样板需要每个函数保留。</p>
<p>标准python构建系统<code>distutils</code>支持从<code>setup.py</code>编译C扩展，这相当方便。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the extension module</span></span><br><span class="line">cos_module = Extension(<span class="string">'cos_module'</span>, sources=[<span class="string">'cos_module.c'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># run the setup</span></span><br><span class="line">setup(ext_modules=[cos_module])</span><br></pre></td></tr></table></figure>
<p>这能被编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> ~/Work/scipy-lecture-notes/interfacing-with-c ⮀ ls</span><br><span class="line">cos_module.c  setup.py</span><br><span class="line"> ~/Work/scipy-lecture-notes/interfacing-with-c ⮀ python setup.py build_ext --inplace</span><br><span class="line">running build_ext</span><br><span class="line">building <span class="string">'cos_module'</span> extension</span><br><span class="line">x86_64-pc-linux-gnu-gcc -pthread <span class="operator">-f</span>PIC -I/usr/include/python2.<span class="number">7</span> -c cos_module.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o</span><br><span class="line">x86_64-pc-linux-gnu-gcc -pthread -shared build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o -L/usr/lib64 -lpython2.<span class="number">7</span> -o /home/lyy/Work/scipy-lecture-notes/interfacing-with-c/cos_module.so</span><br><span class="line"> ~/Work/scipy-lecture-notes/interfacing-with-c ⮀ ls</span><br><span class="line">build  cos_module.c  cos_module.so  setup.py</span><br></pre></td></tr></table></figure>
<ul>
<li><code>build_ext</code>是用来构建扩展模块的</li>
<li><code>--inplace</code>将编译好的扩展模块输出到当前文件夹</li>
</ul>
<p>文件<code>cos_module.so</code>包含编译的扩展，我们能将它加载到IPython解释器中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import cos_module</span><br><span class="line"></span><br><span class="line">In [2]: cos_module?</span><br><span class="line">Type:       module</span><br><span class="line">String Form:&lt;module 'cos_module' from 'cos_module.so'&gt;</span><br><span class="line">File:       /home/lyy/Work/scipy-lecture-notes/interfacing-with-c/cos_module.so</span><br><span class="line">Docstring:  &lt;no docstring&gt;</span><br><span class="line"></span><br><span class="line">In [3]: dir(cos_module)</span><br><span class="line">Out[3]: ['__doc__', '__file__', '__name__', '__package__', 'cos_func']</span><br><span class="line"></span><br><span class="line">In [4]: cos_module.cos_func(1.0)</span><br><span class="line">Out[4]: 0.5403023058681398</span><br><span class="line"></span><br><span class="line">In [5]: cos_module.cos_func(0.0)</span><br><span class="line">Out[5]: 1.0</span><br><span class="line"></span><br><span class="line">In [6]: cos_module.cos_func(3.14159265359)</span><br><span class="line">Out[6]: -1.0</span><br></pre></td></tr></table></figure>
<p>现在让我们看看它有多健壮：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [7]: cos_module.cos_func('foo')</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-7-11bee483665d&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 cos_module.cos_func('foo')</span><br><span class="line"></span><br><span class="line">TypeError: a float is required</span><br></pre></td></tr></table></figure>
<h3 id="Numpy支持">Numpy支持</h3><p>类似于Python-C-API,Numpu自身作为C扩展实现也有<a href="http://docs.scipy.org/doc/numpy/reference/c-api.html" target="_blank" rel="external">Numpy-C-API</a>。这个API可以在写自定的C扩展时，被用来从C创建和操作Numpy数组。参见<a href="http://scipy-lectures.github.io/advanced/interfacing_with_c/interfacing_with_c.html#id3" target="_blank" rel="external">高级Numpy</a></p>
<p>以下例子展示了如何将Numpy数组作为参数传递给函数，如何使用(老的)Numpy-C-API遍历整个Numpy数组。它仅仅将数组作为参数，运用来自<code>math.h</code>中的余弦函数，并且返回一个新的结果数组。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">/*  Example of wrapping the cos function from math.h using the Numpy-C-API. */</span><br><span class="line"></span><br><span class="line">#include &lt;Python.h&gt;</span><br><span class="line">#include &lt;numpy/arrayobject.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line"></span><br><span class="line">/*  wrapped cosine function */</span><br><span class="line">static PyObject* cos_func_np(PyObject* self, PyObject* args)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    PyArrayObject *in_array;</span><br><span class="line">    PyObject      *out_array;</span><br><span class="line">    PyArrayIterObject *in_iter;</span><br><span class="line">    PyArrayIterObject *out_iter;</span><br><span class="line"></span><br><span class="line">    /*  parse single numpy array argument */</span><br><span class="line">    if (!PyArg_ParseTuple(args, "O!", &amp;PyArray_Type, &amp;in_array))</span><br><span class="line">        return NULL;</span><br><span class="line"></span><br><span class="line">    /*  construct the output array, like the input array */</span><br><span class="line">    out_array = PyArray_NewLikeArray(in_array, NPY_ANYORDER, NULL, 0);</span><br><span class="line">    if (out_array == NULL)</span><br><span class="line">        return NULL;</span><br><span class="line"></span><br><span class="line">    /*  create the iterators */</span><br><span class="line">    /* TODO: this iterator API is deprecated since 1.6</span><br><span class="line">     *       replace in favour of the new NpyIter API */</span><br><span class="line">    in_iter  = (PyArrayIterObject *)PyArray_IterNew((PyObject*)in_array);</span><br><span class="line">    out_iter = (PyArrayIterObject *)PyArray_IterNew(out_array);</span><br><span class="line">    if (in_iter == NULL || out_iter == NULL)</span><br><span class="line">        goto fail;</span><br><span class="line"></span><br><span class="line">    /*  iterate over the arrays */</span><br><span class="line">    while (in_iter-&gt;index &lt; in_iter-&gt;size</span><br><span class="line">            &amp;&amp; out_iter-&gt;index &lt; out_iter-&gt;size) &#123;</span><br><span class="line">        /* get the datapointers */</span><br><span class="line">        double * in_dataptr = (double *)in_iter-&gt;dataptr;</span><br><span class="line">        double * out_dataptr = (double *)out_iter-&gt;dataptr;</span><br><span class="line">        /* cosine of input into output */</span><br><span class="line">        *out_dataptr = cos(*in_dataptr);</span><br><span class="line">        /* update the iterator */</span><br><span class="line">        PyArray_ITER_NEXT(in_iter);</span><br><span class="line">        PyArray_ITER_NEXT(out_iter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*  clean up and return the result */</span><br><span class="line">    Py_DECREF(in_iter);</span><br><span class="line">    Py_DECREF(out_iter);</span><br><span class="line">    Py_INCREF(out_array);</span><br><span class="line">    return out_array;</span><br><span class="line"></span><br><span class="line">    /*  in case bad things happen */</span><br><span class="line">    fail:</span><br><span class="line">        Py_XDECREF(out_array);</span><br><span class="line">        Py_XDECREF(in_iter);</span><br><span class="line">        Py_XDECREF(out_iter);</span><br><span class="line">        return NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*  define functions in module */</span><br><span class="line">static PyMethodDef CosMethods[] =</span><br><span class="line">&#123;</span><br><span class="line">     &#123;"cos_func_np", cos_func_np, METH_VARARGS,</span><br><span class="line">         "evaluate the cosine on a numpy array"&#125;,</span><br><span class="line">     &#123;NULL, NULL, 0, NULL&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">/* module initialization */</span><br><span class="line">PyMODINIT_FUNC</span><br><span class="line"></span><br><span class="line">initcos_module_np(void)</span><br><span class="line">&#123;</span><br><span class="line">     (void) Py_InitModule("cos_module_np", CosMethods);</span><br><span class="line">     /* IMPORTANT: this must be called */</span><br><span class="line">     import_array();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们仍可使用distutils编译这个。然而，我们必须通过使用<code>numpy.get_include()</code>保证包含了Numpy头文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the extension module</span></span><br><span class="line">cos_module_np = Extension(<span class="string">'cos_module_np'</span>, sources=[<span class="string">'cos_module_np.c'</span>],</span><br><span class="line">                          include_dirs=[numpy.get_include()])</span><br><span class="line"></span><br><span class="line"><span class="comment"># run the setup</span></span><br><span class="line">setup(ext_modules=[cos_module_np])</span><br></pre></td></tr></table></figure>
<p>为确信它确实能用我们做以下测试脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cos_module_np</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">2</span> * np.pi, <span class="number">0.1</span>)</span><br><span class="line">y = cos_module_np.cos_func_np(x)</span><br><span class="line">pylab.plot(x, y)</span><br><span class="line">pylab.show()</span><br></pre></td></tr></table></figure>
<p>结果将如下图</p>
<p><img src="http://scipy-lectures.github.io/_images/test_cos_module_np.png" alt="figure1"></p>
<h2 id="Ctypes">Ctypes</h2><p><a href="http://docs.python.org/2/library/ctypes.html" target="_blank" rel="external">Ctypes</a>是一个Python的外部函数库。它提供了兼容C的数据类型。并且允许调用DLL或共享库中的函数。它能够被用来将这些库用纯Python包裹。</p>
<p><strong>优势</strong></p>
<ul>
<li>Python标准库的一部分</li>
<li>不必编译</li>
<li>完全用Python包裹代码</li>
</ul>
<p><strong>劣势</strong></p>
<ul>
<li>需要将代码包裹作为共享库获得(粗略地说就是Windows中的<code>*.dll</code>、Linux下的<code>*.so</code>和Mac OSX的<code>*.dylib</code>)</li>
<li>对C++支持不好</li>
</ul>
<h3 id="示例-1">示例</h3><p>如上所述，包裹的代码是纯Python的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" Example of wrapping cos function from math.h using ctypes. """</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> ctypes.util <span class="keyword">import</span> find_library</span><br><span class="line"></span><br><span class="line"><span class="comment"># find and load the library</span></span><br><span class="line">libm = ctypes.cdll.LoadLibrary(find_library(<span class="string">'m'</span>))</span><br><span class="line"><span class="comment"># set the argument type</span></span><br><span class="line">libm.cos.argtypes = [ctypes.c_double]</span><br><span class="line"><span class="comment"># set the return type</span></span><br><span class="line">libm.cos.restype = ctypes.c_double</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cos_func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="string">''' Wrapper for cos from math.h '''</span></span><br><span class="line">    <span class="keyword">return</span> libm.cos(arg)</span><br></pre></td></tr></table></figure>
<ul>
<li>寻找和加载库可能依赖于不同的操作系统，检查<a href="http://docs.python.org/2/library/ctypes.html#loading-dynamic-link-libraries" target="_blank" rel="external">文档</a>获取细节。</li>
<li>这稍微有点虚幻，因为在系统上已经存在编译好的数学库。如果你将包裹一个在自己的库，你将不得不先编译它。这也许需要也许不需要额外的工作。</li>
</ul>
<p>我们现在如前述那样使用它：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import cos_module</span><br><span class="line"></span><br><span class="line">In [2]: cos_module?</span><br><span class="line">Type:       module</span><br><span class="line">String Form:&lt;module 'cos_module' from 'cos_module.py'&gt;</span><br><span class="line">File:       /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/ctypes/cos_module.py</span><br><span class="line">Docstring:  &lt;no docstring&gt;</span><br><span class="line"></span><br><span class="line">In [3]: dir(cos_module)</span><br><span class="line">Out[3]:</span><br><span class="line">['__builtins__',</span><br><span class="line"> '__doc__',</span><br><span class="line"> '__file__',</span><br><span class="line"> '__name__',</span><br><span class="line"> '__package__',</span><br><span class="line"> 'cos_func',</span><br><span class="line"> 'ctypes',</span><br><span class="line"> 'find_library',</span><br><span class="line"> 'libm']</span><br><span class="line"></span><br><span class="line">In [4]: cos_module.cos_func(1.0)</span><br><span class="line">Out[4]: 0.5403023058681398</span><br><span class="line"></span><br><span class="line">In [5]: cos_module.cos_func(0.0)</span><br><span class="line">Out[5]: 1.0</span><br><span class="line"></span><br><span class="line">In [6]: cos_module.cos_func(3.14159265359)</span><br><span class="line">Out[6]: -1.0</span><br></pre></td></tr></table></figure>
<p>正如之前的例子，这个代码稍微健壮一些。尽管错误信息不怎么有用，因它并没告诉我们应该是什么类型。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [7]: cos_module.cos_func('foo')</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ArgumentError                             Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-7-11bee483665d&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 cos_module.cos_func('foo')</span><br><span class="line"></span><br><span class="line">/home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/ctypes/cos_module.py in cos_func(arg)</span><br><span class="line">     12 def cos_func(arg):</span><br><span class="line">     13     ''' Wrapper for cos from math.h '''</span><br><span class="line">---&gt; 14     return libm.cos(arg)</span><br><span class="line"></span><br><span class="line">ArgumentError: argument 1: &lt;type 'exceptions.TypeError'&gt;: wrong type</span><br></pre></td></tr></table></figure>
<h3 id="Numpy支持-1">Numpy支持</h3><p>Numpy包含一些对ctypes接口的支持。特别是有导出Numpy数组作为ctypes数据类型的某一属性的支持，并且有将C数组和Numpy数组互相转化的函数。</p>
<p>更多信息参考<a href="http://www.scipy.org/Cookbook/Ctypes" target="_blank" rel="external">Numpy Cookbook</a>中相应章节和<a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.ctypes.html" target="_blank" rel="external">numpy.ndarray.ctypes</a>和<a href="http://docs.scipy.org/doc/numpy/reference/routines.ctypeslib.html" target="_blank" rel="external">numpy.ctypeslib</a>的API文档。</p>
<p>在以下例子中，让我们考虑一个库中的C函数，这个函数接受一个数组作为输入并输出一个数组，计算输入数组的正弦值并将结果存储在输出数组中。</p>
<p>这个库包含以下头文件(尽管就这个例子不严格需要，为完整性需要我们列出它)：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cos_doubles</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这个实现在C源码中如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Compute the cosine of each element in in_array, storing the result in</span><br><span class="line"> *  out_array. */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cos_doubles</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">        out_array[i] = <span class="built_in">cos</span>(in_array[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为这个库是纯C的，我们不能使用<code>distutils</code>来编译它。必须同时使用<code>make</code>和<code>gcc</code>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">m.PHONY : clean</span><br><span class="line"></span><br><span class="line">libcos_doubles.so : cos_doubles.o</span><br><span class="line">	gcc -shared -Wl,-soname,libcos_doubles.so -o libcos_doubles.so cos_doubles.o</span><br><span class="line"></span><br><span class="line">cos_doubles.o : cos_doubles.c</span><br><span class="line">	gcc -c -fPIC cos_doubles.c -o cos_doubles.o</span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	-rm -vf libcos_doubles.so cos_doubles.o cos_doubles.pyc</span><br></pre></td></tr></table></figure>
<p>我们接着可以将之编译到共享库<code>libcos_double.so</code>中(linux下):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">cos_doubles.c  cos_doubles.h  cos_doubles.py  makefile  <span class="built_in">test</span>_cos_doubles.py</span><br><span class="line">$ make</span><br><span class="line">gcc -c <span class="operator">-f</span>PIC cos_doubles.c -o cos_doubles.o</span><br><span class="line">gcc -shared -Wl,-soname,libcos_doubles.so -o libcos_doubles.so cos_doubles.o</span><br><span class="line">$ ls</span><br><span class="line">cos_doubles.c  cos_doubles.o   libcos_doubles.so*  <span class="built_in">test</span>_cos_doubles.py</span><br><span class="line">cos_doubles.h  cos_doubles.py  makefile</span><br></pre></td></tr></table></figure>
<p>接着我们能继续通过ctypes库对(某些类型)Numpy数组的直接支持包裹这个库了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" Example of wrapping a C library function that accepts a C double array as</span><br><span class="line">    input using the numpy.ctypeslib. """</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> numpy.ctypeslib <span class="keyword">as</span> npct</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_int</span><br><span class="line"></span><br><span class="line"><span class="comment"># input type for the cos_doubles function</span></span><br><span class="line"><span class="comment"># must be a double array, with single dimension that is contiguous</span></span><br><span class="line">array_1d_double = npct.ndpointer(dtype=np.double, ndim=<span class="number">1</span>, flags=<span class="string">'CONTIGUOUS'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the library, using numpy mechanisms</span></span><br><span class="line">libcd = npct.load_library(<span class="string">"libcos_doubles"</span>, <span class="string">"."</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># setup the return typs and argument types</span></span><br><span class="line">libcd.cos_doubles.restype = <span class="keyword">None</span></span><br><span class="line">libcd.cos_doubles.argtypes = [array_1d_double, array_1d_double, c_int]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cos_doubles_func</span><span class="params">(in_array, out_array)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> libcd.cos_doubles(in_array, out_array, len(in_array))</span><br></pre></td></tr></table></figure>
<ul>
<li>注意连续单维Numpy数组的固有限制，因为C函数要求这种缓冲区。[^1]</li>
<li>注意输出数组必须预先分配，例如通过<code>numpy.zeros()</code>，这个函数将写进它的缓冲区。</li>
<li>尽管<code>cos_doubles</code>函数的原始参数是<code>ARRAY, ARRAY, int</code>，最终的<code>cos_doubles_func</code>仅仅接受两个Numpy数组作为参数。</li>
</ul>
<p>像之前一样，我们相信它能够工作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line"><span class="keyword">import</span> cos_doubles</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">2</span> * np.pi, <span class="number">0.1</span>)</span><br><span class="line">y = np.empty_like(x)</span><br><span class="line"></span><br><span class="line">cos_doubles.cos_doubles_func(x, y)</span><br><span class="line">pylab.plot(x, y)</span><br><span class="line">pylab.show()</span><br></pre></td></tr></table></figure>
<p><img src="http://scipy-lectures.github.io/_images/test_cos_doubles.png" alt="test cos doubles"></p>
<h2 id="SWIG">SWIG</h2><p><a href="http://www.swig.org/" target="_blank" rel="external">SWIG</a>, 简化包裹接口生成器，是一个将不同高级编程语言包括Python链接到用C和C++写的程序上的软件开发工具。SWIG重要的功能是，它能自动为你生成包裹代码。这就开发时间来说是个优势，也可能是个负担。生成文件趋于巨大，读起来不友好，包裹过程的结果就是多个间接层，可能有点难以理解。</p>
<p><strong>注意：自动生成的C代码使用Python-C-Api。</strong></p>
<p><strong>优势</strong></p>
<ul>
<li>可以自动包裹给定头文件的整个库</li>
<li>对C++工作很好</li>
</ul>
<p><strong>劣势</strong></p>
<ul>
<li>自动生成巨大的文件</li>
<li>若出错难以调试</li>
<li>陡峭的学习曲线</li>
</ul>
<h3 id="示例-2">示例</h3><p>让我们假设我们的<code>cos</code>函数位于用C写成的<code>cos_module</code>中，源代码文件为<code>cos_module.c</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cos_func</span><span class="params">(<span class="keyword">double</span> arg)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">cos</span>(arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>头文件为<code>cos_module.h</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">double cos_func(double arg);</span><br></pre></td></tr></table></figure>
<p>我们的任务是将<code>cos_func</code>暴露给Python。为了用SWIG实现这个，我们必须写一个包含SWIG指令的接口文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  Example of wrapping cos function from math.h using SWIG. */</span></span><br><span class="line"></span><br><span class="line">%module cos_module</span><br><span class="line">%&#123;</span><br><span class="line">    <span class="comment">/* the resulting C file should be built as a python extension */</span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">define</span> SWIG_FILE_WITH_INIT</span></span><br><span class="line">    <span class="comment">/*  Includes the header in the wrapper code */</span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">include</span> <span class="string">"cos_module.h"</span></span></span><br><span class="line">%&#125;</span><br><span class="line"><span class="comment">/*  Parse the header file to generate wrappers */</span></span><br><span class="line">%include <span class="string">"cos_module.h"</span></span><br></pre></td></tr></table></figure>
<p>如您所见，需要太多代码了。在这个简单的例子中在接口文件中仅仅包含头文件就足够将函数暴露给Python。然而，SWIG允许更细粒度地包含/排除头文件中的函数，查看文档获取更多细节。</p>
<p>产生编译的包裹代码是一个两个阶段的过程：</p>
<ol>
<li>对接口文件运行swig生成文件<code>cos_module_wrap.c</code>，这是用来自动生成Python的C扩展的源代码文件。<code>cos_module.py</code>是自动生成的纯Python模块。</li>
<li>编译<code>cos_module_wrap.c</code>为<code>_cos_module.so</code>。幸运的是，<code>distutils</code>知道如何处理SWIG接口文件，所以我们的<code>setup.py</code>很简单：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"></span><br><span class="line">setup(ext_modules=[Extension(<span class="string">"_cos_module"</span>,</span><br><span class="line">      sources=[<span class="string">"cos_module.c"</span>, <span class="string">"cos_module.i"</span>])])</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> advanced/interfacing_with_c/swig</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">cos_module.c  cos_module.h  cos_module.i  setup.py</span><br><span class="line"></span><br><span class="line">$ python setup.py build_ext --inplace</span><br><span class="line">running build_ext</span><br><span class="line">building <span class="string">'_cos_module'</span> extension</span><br><span class="line">swigging cos_module.i to cos_module_wrap.c</span><br><span class="line">swig -python -o cos_module_wrap.c cos_module.i</span><br><span class="line">creating build</span><br><span class="line">creating build/temp.linux-x86_64-<span class="number">2.7</span></span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_module.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o</span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_module_wrap.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module_wrap.o</span><br><span class="line">gcc -pthread -shared build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module_wrap.o -L/home/esc/anaconda/lib -lpython2.<span class="number">7</span> -o /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/swig/_cos_module.so</span><br><span class="line"></span><br><span class="line">$ ls</span><br><span class="line">build/  cos_module.c  cos_module.h  cos_module.i  cos_module.py  _cos_module.so*  cos_module_wrap.c  setup.py</span><br></pre></td></tr></table></figure>
<p>现在我们能加载和执行<code>cos_module</code>，就好像我们之前做的：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import cos_module</span><br><span class="line"></span><br><span class="line">In [2]: cos_module?</span><br><span class="line">Type:       module</span><br><span class="line">String Form:&lt;module 'cos_module' from 'cos_module.py'&gt;</span><br><span class="line">File:       /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/swig/cos_module.py</span><br><span class="line">Docstring:  &lt;no docstring&gt;</span><br><span class="line"></span><br><span class="line">In [3]: dir(cos_module)</span><br><span class="line">Out[3]:</span><br><span class="line">['__builtins__',</span><br><span class="line"> '__doc__',</span><br><span class="line"> '__file__',</span><br><span class="line"> '__name__',</span><br><span class="line"> '__package__',</span><br><span class="line"> '_cos_module',</span><br><span class="line"> '_newclass',</span><br><span class="line"> '_object',</span><br><span class="line"> '_swig_getattr',</span><br><span class="line"> '_swig_property',</span><br><span class="line"> '_swig_repr',</span><br><span class="line"> '_swig_setattr',</span><br><span class="line"> '_swig_setattr_nondynamic',</span><br><span class="line"> 'cos_func']</span><br><span class="line"></span><br><span class="line">In [4]: cos_module.cos_func(1.0)</span><br><span class="line">Out[4]: 0.5403023058681398</span><br><span class="line"></span><br><span class="line">In [5]: cos_module.cos_func(0.0)</span><br><span class="line">Out[5]: 1.0</span><br><span class="line"></span><br><span class="line">In [6]: cos_module.cos_func(3.14159265359)</span><br><span class="line">Out[6]: -1.0</span><br></pre></td></tr></table></figure>
<p>我们再次检验健壮性，看到得到了更好的错误信息(然而，严格地说Python中没有<code>double</code>类型)：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [7]: cos_module.cos_func('foo')</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-7-11bee483665d&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 cos_module.cos_func('foo')</span><br><span class="line"></span><br><span class="line">TypeError: in method 'cos_func', argument 1 of type 'double'</span><br></pre></td></tr></table></figure>
<h3 id="Numpy支持-2">Numpy支持</h3><p>numpy通过<code>numpy.i</code>文件提供了<a href="http://docs.scipy.org/doc/numpy/reference/swig.html" target="_blank" rel="external">对SWIG的支持</a>。这个接口文件定义了各种所谓的类型映射(typemaps)来转换Numpy数组和C数组。在下面的例子中我们将简略地看看这种类型映射在实际中如何起作用。</p>
<p>我们使用在ctypes例子中相同的<code>cos_doubles</code>函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cos_doubles</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"></span><br><span class="line">/*  Compute the cosine of each element <span class="keyword">in</span> in_array, storing the result <span class="keyword">in</span></span><br><span class="line"> *  out_array. */</span><br><span class="line">void cos_doubles(double * in_array, double * out_array, int size)&#123;</span><br><span class="line">    int i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">        out_array[i] = cos(in_array[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用SWIG接口文件将它包裹为<code>cos_doubles_func</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  Example of wrapping a C function that takes a C double array as input using</span><br><span class="line"> *  numpy typemaps for SWIG. */</span></span><br><span class="line"></span><br><span class="line">%module cos_doubles</span><br><span class="line">%&#123;</span><br><span class="line">    <span class="comment">/* the resulting C file should be built as a python extension */</span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">define</span> SWIG_FILE_WITH_INIT</span></span><br><span class="line">    <span class="comment">/*  Includes the header in the wrapper code */</span></span><br><span class="line">    <span class="preprocessor">#<span class="keyword">include</span> <span class="string">"cos_doubles.h"</span></span></span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  include the numpy typemaps */</span></span><br><span class="line">%include <span class="string">"numpy.i"</span></span><br><span class="line"><span class="comment">/*  need this for correct module initialization */</span></span><br><span class="line">%init %&#123;</span><br><span class="line">    import_array();</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  typemaps for the two arrays, the second will be modified in-place */</span></span><br><span class="line">%apply (<span class="keyword">double</span>* IN_ARRAY1, <span class="keyword">int</span> DIM1) &#123;(<span class="keyword">double</span> * in_array, <span class="keyword">int</span> size_in)&#125;</span><br><span class="line">%apply (<span class="keyword">double</span>* INPLACE_ARRAY1, <span class="keyword">int</span> DIM1) &#123;(<span class="keyword">double</span> * out_array, <span class="keyword">int</span> size_out)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Wrapper for cos_doubles that massages the types */</span></span><br><span class="line">%<span class="keyword">inline</span> %&#123;</span><br><span class="line">    <span class="comment">/*  takes as input two numpy arrays */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cos_doubles_func</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">int</span> size_in, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size_out)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*  calls the original funcion, providing only the size of the first */</span></span><br><span class="line">        cos_doubles(in_array, out_array, size_in);</span><br><span class="line">    &#125;</span><br><span class="line">%&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>为了使用Numpy类型映射，需要<code>numpy.i</code>文件。</li>
<li>观察<code>import_array()</code>的调用，我们已经在Numpy-C-Api的例子中见到过。</li>
<li>因为类型映射仅仅支持参数<code>ARRAY, SIZE</code>我们需要包裹<code>cos_doubles</code>为<code>cos_doubles_func</code>，该函数接受两个数组包含各自大小作为输入。</li>
<li>相对于简单SWIG的例子，我们不需要包含<code>cos_doubles.h</code>头文件，因为我们通过<code>cos_doubles_func</code>暴露这个功能，我们没有其它东西想暴露给Python。</li>
</ul>
<p>然后，如前述用distutils包裹它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line">setup(ext_modules=[Extension(<span class="string">"_cos_doubles"</span>,</span><br><span class="line">      sources=[<span class="string">"cos_doubles.c"</span>, <span class="string">"cos_doubles.i"</span>],</span><br><span class="line">      include_dirs=[numpy.get_include()])])</span><br></pre></td></tr></table></figure>
<p>显然，我们需要<code>include_dirs</code>指定位置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">cos_doubles.c  cos_doubles.h  cos_doubles.i  numpy.i  setup.py  <span class="built_in">test</span>_cos_doubles.py</span><br><span class="line">$ python setup.py build_ext -i</span><br><span class="line">running build_ext</span><br><span class="line">building <span class="string">'_cos_doubles'</span> extension</span><br><span class="line">swigging cos_doubles.i to cos_doubles_wrap.c</span><br><span class="line">swig -python -o cos_doubles_wrap.c cos_doubles.i</span><br><span class="line">cos_doubles.i:<span class="number">24</span>: Warning(<span class="number">490</span>): Fragment <span class="string">'NumPy_Backward_Compatibility'</span> not found.</span><br><span class="line">cos_doubles.i:<span class="number">24</span>: Warning(<span class="number">490</span>): Fragment <span class="string">'NumPy_Backward_Compatibility'</span> not found.</span><br><span class="line">cos_doubles.i:<span class="number">24</span>: Warning(<span class="number">490</span>): Fragment <span class="string">'NumPy_Backward_Compatibility'</span> not found.</span><br><span class="line">creating build</span><br><span class="line">creating build/temp.linux-x86_64-<span class="number">2.7</span></span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_doubles.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles.o</span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_doubles_wrap.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles_wrap.o</span><br><span class="line">In file included from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/ndarraytypes.h:<span class="number">1722</span>,</span><br><span class="line">                 from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/ndarrayobject.h:<span class="number">17</span>,</span><br><span class="line">                 from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/arrayobject.h:<span class="number">15</span>,</span><br><span class="line">                 from cos_doubles_wrap.c:<span class="number">2706</span>:</span><br><span class="line">/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/npy_deprecated_api.h:<span class="number">11</span>:<span class="number">2</span>: warning: <span class="comment">#warning "Using deprecated NumPy API, disable it by #defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION"</span></span><br><span class="line">gcc -pthread -shared build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles.o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles_wrap.o -L/home/esc/anaconda/lib -lpython2.<span class="number">7</span> -o /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/swig_numpy/_cos_doubles.so</span><br><span class="line">$ ls</span><br><span class="line">build/         cos_doubles.h  cos_doubles.py    cos_doubles_wrap.c  setup.py</span><br><span class="line">cos_doubles.c  cos_doubles.i  _cos_doubles.so*  numpy.i             <span class="built_in">test</span>_cos_doubles.py</span><br></pre></td></tr></table></figure>
<p>接着，确信它起作用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line"><span class="keyword">import</span> cos_doubles</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">2</span> * np.pi, <span class="number">0.1</span>)</span><br><span class="line">y = np.empty_like(x)</span><br><span class="line"></span><br><span class="line">cos_doubles.cos_doubles_func(x, y)</span><br><span class="line">pylab.plot(x, y)</span><br><span class="line">pylab.show()</span><br></pre></td></tr></table></figure>
<p><img src="http://scipy-lectures.github.io/_images/test_cos_doubles1.png" alt="test_cos_doubles1"></p>
<h2 id="Cython">Cython</h2><p>Cython不仅使用来写C扩展的Python样子的语言，而且是这个语言的一个高级编译器。Cython语言是Python的超集，包含额外的结构允许你调用C函数，将变量和类属性解释为C类型。在这个意义上可以叫它Python的一个类型。</p>
<p>除了这些几本的包裹原生代码的用例，Cython支持一个额外的用例，即交互优化。基本上是，从纯Python代码脚本出发逐步向代码瓶颈增加Cython类型来优化那些真正值得优化的代码。</p>
<p>在这个意义上它和SWIG非常相似，因为C代码可以自动生成，但某种意义上它也相当类似与ctypes，因为它包裹代码可以(几乎可以)用Python写成。</p>
<p>尽管其它自动生成代码方案会很难调试(例如SWIG)，Cython带有一个GNU调试器的扩展，能帮助调试Python，Cython和C代码。</p>
<p><strong>注意：自动生成的C代码使用了Python-C-Api。</strong></p>
<p><strong>优势</strong></p>
<ul>
<li>类Python的语言来写C扩展</li>
<li>自动生成代码</li>
<li>支持增量优化</li>
<li>包含一个GNU调试器扩展</li>
<li>支持C++(自从0.13版本)</li>
</ul>
<p><strong>劣势</strong></p>
<ul>
<li>必须编译</li>
<li>需要额外的库(但仅仅在编译时，这个问题可以通过传递一个生成的C文件克服)</li>
</ul>
<h3 id="示例-3">示例</h3><p>我们<code>cos_module</code>的主要的Cython代码包含在文件<code>cos_module.pyx</code>中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" Example of wrapping cos function from math.h using Cython. """</span></span><br><span class="line"></span><br><span class="line">cdef extern <span class="keyword">from</span> <span class="string">"math.h"</span>:</span><br><span class="line">    double cos(double arg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cos_func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> cos(arg)</span><br></pre></td></tr></table></figure>
<p>注意额外的关键字像<code>cdef</code>和<code>extern</code>。<code>cos_func</code>紧接着是纯Python。</p>
<p>我们再次使用标准<code>distutils</code>模块，但是这次我们需要一些来自<code>Cython.Distutils</code>额外的片段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">from</span> Cython.Distutils <span class="keyword">import</span> build_ext</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    cmdclass=&#123;<span class="string">'build_ext'</span>: build_ext&#125;,</span><br><span class="line">    ext_modules=[Extension(<span class="string">"cos_module"</span>, [<span class="string">"cos_module.pyx"</span>])]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>编译它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> advanced/interfacing_with_c/cython</span><br><span class="line">$ ls</span><br><span class="line">cos_module.pyx  setup.py</span><br><span class="line">$ python setup.py build_ext --inplace</span><br><span class="line">running build_ext</span><br><span class="line">cythoning cos_module.pyx to cos_module.c</span><br><span class="line">building <span class="string">'cos_module'</span> extension</span><br><span class="line">creating build</span><br><span class="line">creating build/temp.linux-x86_64-<span class="number">2.7</span></span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_module.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o</span><br><span class="line">gcc -pthread -shared build/temp.linux-x86_64-<span class="number">2.7</span>/cos_module.o -L/home/esc/anaconda/lib -lpython2.<span class="number">7</span> -o /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/cython/cos_module.so</span><br><span class="line">$ ls</span><br><span class="line">build/  cos_module.c  cos_module.pyx  cos_module.so*  setup.py</span><br></pre></td></tr></table></figure>
<p>然后运行它：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import cos_module</span><br><span class="line"></span><br><span class="line">In [2]: cos_module?</span><br><span class="line">Type:       module</span><br><span class="line">String Form:&lt;module 'cos_module' from 'cos_module.so'&gt;</span><br><span class="line">File:       /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/cython/cos_module.so</span><br><span class="line">Docstring:  &lt;no docstring&gt;</span><br><span class="line"></span><br><span class="line">In [3]: dir(cos_module)</span><br><span class="line">Out[3]:</span><br><span class="line">['__builtins__',</span><br><span class="line"> '__doc__',</span><br><span class="line"> '__file__',</span><br><span class="line"> '__name__',</span><br><span class="line"> '__package__',</span><br><span class="line"> '__test__',</span><br><span class="line"> 'cos_func']</span><br><span class="line"></span><br><span class="line">In [4]: cos_module.cos_func(1.0)</span><br><span class="line">Out[4]: 0.5403023058681398</span><br><span class="line"></span><br><span class="line">In [5]: cos_module.cos_func(0.0)</span><br><span class="line">Out[5]: 1.0</span><br><span class="line"></span><br><span class="line">In [6]: cos_module.cos_func(3.14159265359)</span><br><span class="line">Out[6]: -1.0</span><br></pre></td></tr></table></figure>
<p>接着，测试健壮性，可以看到我们获得了很棒的错误信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [7]: cos_module.cos_func('foo')</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-7-11bee483665d&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 cos_module.cos_func('foo')</span><br><span class="line"></span><br><span class="line">/home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/cython/cos_module.so in cos_module.cos_func (cos_module.c:506)()</span><br><span class="line"></span><br><span class="line">TypeError: a float is required</span><br></pre></td></tr></table></figure>
<p>另外，值得注意的是Cython带有完整的C数学库声明，将之上代码简化为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" Simpler example of wrapping cos function from math.h using Cython. """</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> libc.math cimport cos</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cos_func</span><span class="params">(arg)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> cos(arg)</span><br></pre></td></tr></table></figure>
<p>在这个例子中<code>cimport</code>声明被用来import<code>cos</code>函数。</p>
<h3 id="Numpy支持-3">Numpy支持</h3><p>Cython通过<code>numpy.pyx</code>文件支持Numpy，这允许你将Numpy数组类型添加到Cython代码。例如将<code>i</code>指定为<code>int</code>类型，将变量<code>a</code>指定为<code>numpy.ndarray</code>并给定<code>dtype</code>。某些优化像边界检查也支持。参看<a href="http://docs.cython.org/src/tutorial/numpy.html" target="_blank" rel="external">Cython文档</a>的相关章节。万一你想将Numpy数组作为C数组传递给你的Cython包裹的C代码，<a href="http://wiki.cython.org/tutorials/NumpyPointerToC" target="_blank" rel="external">Cython维基</a>中有一个章节。</p>
<p>在以下例子中，我们将展示如何如何使用Cython包裹熟悉的<code>cos_doubles</code>函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cos_doubles</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Compute the cosine of each element in in_array, storing the result in</span><br><span class="line"> *  out_array. */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cos_doubles</span><span class="params">(<span class="keyword">double</span> * in_array, <span class="keyword">double</span> * out_array, <span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;size;i++)&#123;</span><br><span class="line">        out_array[i] = <span class="built_in">cos</span>(in_array[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该函数使用以下Cython代码被包裹为<code>cos_doubles_func</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" Example of wrapping a C function that takes C double arrays as input using</span><br><span class="line">    the Numpy declarations from Cython """</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import both numpy and the Cython declarations for numpy</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">cimport numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># if you want to use the Numpy-C-API from Cython</span></span><br><span class="line"><span class="comment"># (not strictly necessary for this example)</span></span><br><span class="line">np.import_array()</span><br><span class="line"></span><br><span class="line"><span class="comment"># cdefine the signature of our c function</span></span><br><span class="line">cdef extern <span class="keyword">from</span> <span class="string">"cos_doubles.h"</span>:</span><br><span class="line">    void cos_doubles (double * in_array, double * out_array, int size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># create the wrapper code, with numpy type annotations</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cos_doubles_func</span><span class="params">(np.ndarray[double, ndim=<span class="number">1</span>, mode=<span class="string">"c"</span>] in_array not None,</span><br><span class="line">                     np.ndarray[double, ndim=<span class="number">1</span>, mode=<span class="string">"c"</span>] out_array not None)</span>:</span></span><br><span class="line">    cos_doubles(&lt;double*&gt; np.PyArray_DATA(in_array),</span><br><span class="line">                &lt;double*&gt; np.PyArray_DATA(out_array),</span><br><span class="line">                in_array.shape[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>可以使用<code>distutils</code>编译：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">from</span> Cython.Distutils <span class="keyword">import</span> build_ext</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    cmdclass=&#123;<span class="string">'build_ext'</span>: build_ext&#125;,</span><br><span class="line">    ext_modules=[Extension(<span class="string">"cos_doubles"</span>,</span><br><span class="line">                 sources=[<span class="string">"_cos_doubles.pyx"</span>, <span class="string">"cos_doubles.c"</span>],</span><br><span class="line">                 include_dirs=[numpy.get_include()])],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>如上编译Numpy的例子，我们需要<code>include_dirs</code>选项。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">cos_doubles.c  cos_doubles.h  _cos_doubles.pyx  setup.py  <span class="built_in">test</span>_cos_doubles.py</span><br><span class="line">$ python setup.py build_ext -i</span><br><span class="line">running build_ext</span><br><span class="line">cythoning _cos_doubles.pyx to _cos_doubles.c</span><br><span class="line">building <span class="string">'cos_doubles'</span> extension</span><br><span class="line">creating build</span><br><span class="line">creating build/temp.linux-x86_64-<span class="number">2.7</span></span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c _cos_doubles.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/_cos_doubles.o</span><br><span class="line">In file included from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/ndarraytypes.h:<span class="number">1722</span>,</span><br><span class="line">                 from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/ndarrayobject.h:<span class="number">17</span>,</span><br><span class="line">                 from /home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/arrayobject.h:<span class="number">15</span>,</span><br><span class="line">                 from _cos_doubles.c:<span class="number">253</span>:</span><br><span class="line">/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/npy_deprecated_api.h:<span class="number">11</span>:<span class="number">2</span>: warning: <span class="comment">#warning "Using deprecated NumPy API, disable it by #defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION"</span></span><br><span class="line">/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include/numpy/__ufunc_api.h:<span class="number">236</span>: warning: ‘_import_umath’ defined but not used</span><br><span class="line">gcc -pthread -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes <span class="operator">-f</span>PIC -I/home/esc/anaconda/lib/python2.<span class="number">7</span>/site-packages/numpy/core/include -I/home/esc/anaconda/include/python2.<span class="number">7</span> -c cos_doubles.c -o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles.o</span><br><span class="line">gcc -pthread -shared build/temp.linux-x86_64-<span class="number">2.7</span>/_cos_doubles.o build/temp.linux-x86_64-<span class="number">2.7</span>/cos_doubles.o -L/home/esc/anaconda/lib -lpython2.<span class="number">7</span> -o /home/esc/git-working/scipy-lecture-notes/advanced/interfacing_with_c/cython_numpy/cos_doubles.so</span><br><span class="line">$ ls</span><br><span class="line">build/  _cos_doubles.c  cos_doubles.c  cos_doubles.h  _cos_doubles.pyx  cos_doubles.so*  setup.py  <span class="built_in">test</span>_cos_doubles.py</span><br></pre></td></tr></table></figure>
<p>如前述确保它能起作用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pylab</span><br><span class="line"><span class="keyword">import</span> cos_doubles</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">2</span> * np.pi, <span class="number">0.1</span>)</span><br><span class="line">y = np.empty_like(x)</span><br><span class="line"></span><br><span class="line">cos_doubles.cos_doubles_func(x, y)</span><br><span class="line">pylab.plot(x, y)</span><br><span class="line">pylab.show()</span><br></pre></td></tr></table></figure>
<p><img src="http://scipy-lectures.github.io/_images/test_cos_doubles2.png" alt="test_cos_doubles2"></p>
<h2 id="总结">总结</h2><p>这个章节中四种不同和本地代码接口技术被呈现在您面前。这个表格简要的总结了这些技术的某些方面。</p>
<p>x     |Part of CPython     |Compiled     |Autogenerated     |Numpy Support<br>|:——|:—-|:—–|:—–|:—-|<br>Python-C-Api     |True     |True     |False     |True |<br>Ctypes         |True     |False     |False     |True |<br>Swig         |False     |True     |True     |True |<br>Cython         |False     |True     |True     |True | </p>
<p>相比所有技术中，Cython是最现代最高级的了。特别是，通过向Python代码中添加类型增量优化代码的能力是独一无二的。</p>
<h2 id="更多阅读和参考">更多阅读和参考</h2><ul>
<li><a href="http://gael-varoquaux.info/blog/?p=157" target="_blank" rel="external">Gaël Varoquaux的关于避免复制数据的博文</a>对于如何聪明的处理内存管理提供了一些深刻的见解。如果你曾经碰到过大数据集的问题，这是一个可以激发灵感的参考。</li>
</ul>
<h2 id="练习">练习</h2><p>因这是一个全新的章节，这些练习更可视为是接下来看什么的指针。所以选择您最感兴趣的那个。如果你对此有更多好的想法，请联系我们！</p>
<ol>
<li>下载每个练习的源码并在你的机器上编译运行。</li>
<li>对每个例子做小的修改确信它能起作用。(像将<code>cos</code>改成<code>sin</code>)</li>
<li><p>大多数例子，特别是涉及Numpy的例子可能仍然对错误输入很脆弱、并且返回模糊的消息。寻找使这些例子出问题的方法，指出问题是什么并且设计潜在的解决方案。这有一些提示：</p>
<ol>
<li>数值溢出</li>
<li>输入输出数组长度不同</li>
<li>多维数组</li>
<li>空数组</li>
<li>非<code>double</code>型数组</li>
</ol>
</li>
<li><p>使用IPython中的magic<code>%timeit</code>来测量不同方案的执行时间。</p>
</li>
</ol>
<h3 id="Python-C-Api-1">Python-C-Api</h3><ol>
<li>更改Numpy的例子让函数接受两个输入参数，第二个参数是预分配的输出数组，让它像其它Numpy例子。</li>
<li>更改例子让函数仅仅接受一个输入数组并且原地修改。</li>
<li>尝试使用<a href="http://docs.scipy.org/doc/numpy/reference/c-api.iterator.html" target="_blank" rel="external">Numpy迭代协议</a>修正例子，如果你设法获取了一个工作的解决方案，请在github上发布一个拉取请求(pull-request)。</li>
<li>你也许注意到了，Numpy-C-API例子是唯一不包裹<code>cos_double</code>但是直接将<code>cos</code>应用到Numpy数组的元素的Numpy例子。这相对于其它技术有什么优势？</li>
<li>你能仅仅使用NJumpy-C-API包裹<code>cos_doubles</code>吗？你可能需要确保数组是正确的类型，并且在内存中一维连续。</li>
</ol>
<h3 id="Ctypes-1">Ctypes</h3><ol>
<li>更改像<code>cos_double_func</code>的Numpy例子为你处理预分配，使之更像Numpy-C-Api例子。</li>
</ol>
<h3 id="SWIG-1">SWIG</h3><ol>
<li>查看SWIG自动生成的代码，你能理解多少？</li>
<li>更改Numpy的例子像<code>cos_double_func</code>处理预分配，让它更像Numpy-C-API的例子。</li>
<li>更改C函数<code>cos_doubles</code>让它返回一个分配的数组。你能用SWIG类型映射包裹它？如果不能，为何不行？有没有特定条件的变通方案。(提示：你知道输出数组的大小，所以可能从返回的<code>double *</code>构建一个Numpy数组。)</li>
</ol>
<h3 id="Cython-1">Cython</h3><ol>
<li>查看Cython自动生成的代码。仔细看看Cython插入的一些注释。你看到了什么？</li>
<li>查看Cython文档的章节<a href="http://docs.cython.org/src/tutorial/numpy.html" target="_blank" rel="external">Working with Numpy</a>去学习使用Numpy如何增量优化纯python代码。</li>
<li>更改Numpy例子比如<code>cos_doubles_func</code>处理预分配，使之更像Numpy-C-Api例子。</li>
</ol>
<h2 id="FootNotes">FootNotes</h2><p>[^1]:我不懂，还没看Advanced Numpy部分</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/04/12/hello-bupt/" itemprop="url">
                  Hello, A Dream towards BUPT
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-04-12T00:00:00+08:00" content="2013-04-12">
              2013-04-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/04/12/hello-bupt/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/04/12/hello-bupt/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>不要相信我说了什么，我所说的 <em>未必</em> 是事实，你也 <em>未必</em> 能理解成事实。</p>
<p>总之，经历过回头看就自知了。</p>
<blockquote>
<p>莫听穿林打叶声，何妨吟啸且徐行。竹杖芒鞋轻胜马，谁怕，一蓑烟雨任平生。</p>
<p>料峭春风吹酒醒，微冷，山头斜照却相迎。回首向来萧瑟处，归去，也无风雨也无晴。</p>
<p>苏轼，定风波</p>
</blockquote>
<hr>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<h2 id="初试">初试</h2><p>我不记得为什么会做出这些选择，如果非要找个理由。正如Steve Jobs2005年在斯坦福大学演讲时所说的，I follow my heart.</p>
<h3 id="缘起">缘起</h3><p>因为那本叫《Debian标准教程》的书作者曾是byr linux版版主？</p>
<p>看过一本讲TeX的书的作者提到了byr？</p>
<p>然后我来到了byr linux版……</p>
<p>然后接到母亲的电话说可以考北邮，北邮的光学好……我说好啊……</p>
<p>然后准备选通信原理作为专业课，因为我想跨考通信。</p>
<p>买了本书，看了两个月不知道什么玩意……</p>
<p>论坛上有人说，喜欢编程考信安吧，考804信号与系统简单。复试无所谓，大家都不会。</p>
<p>然后不知道为什么我就做了这辈子可能都无法理解的选择……我好像喜欢的不是编程……</p>
<h3 id="复习">复习</h3><p>八月初说准备考研吧。买本新东方乱序版单词，结果背了一半不到……然后，没有然后了，忘干净了。</p>
<p>开始准备复习高数，李永乐全书还是从学长那要的去年的。这么断续看了一个月，被虐得不轻。好像题目就没有会做且做对的。最后我只看例题了……</p>
<p>专业课一两个月看完了，于是扔掉了……</p>
<p>买本政治吧，大纲解析真贵。我觉得应该最后一个月再看吧，没想到最后根本就没看……</p>
<p>风中劲草买的较早吧，不去自习每天就看看劲草，在寝室读着玩。进度慢爆，拖拖拉拉，同学都复习两遍三遍了我第一遍都没。</p>
<p>打酱油一样的自习，早上八九点起，十一点回，下午三点多去，五点回，晚上不去……一路游击，占个毛线座。</p>
<p>好不容易刻苦了两天，然后生病了。紧接着一个半月书都没碰，天天自己逛公园和看电影去了。</p>
<p>最后只二十来天，想想数学真题看看吧，全书我就看了看例题。历年真题，基本上没答对几道，基本上不是出错就是根本不会……</p>
<p>最后两周，忽然想起貌似英语还没看……把早就买了的真题黄皮书以一天50-180页的速度看完……然后花大概七天背了背附送的单词书，不过貌似没啥用。</p>
<h3 id="考试">考试</h3><p>运气很好分到个有空调教室，还不靠门。并不是所有人运气都这么好，没空调分阴面的同学在无锡湿冷湿冷的冬天冻爆了。</p>
<p>考前晚上还忙着为恶搞百度百科P图。一副三心二意的模样，考前一周竟然还忙着折腾scipy……</p>
<p>考政治那天晚上漫天大雪，想到要考完试了高兴异常。我又到公园转了一圈才去自习，没怎么看就回寝室，读了十分之一十八大报告就跪了，胡总真不容易。</p>
<p>晚上睡觉时楼上吵得要死，很烦的想带上耳塞等会去掉，结果一戴上睡着了……</p>
<p>第二天下雪了，政治做得没什么特殊感觉，有点冷。</p>
<p>英语，基本都不会，一路瞎蒙，作文划的一塌糊涂。</p>
<p>第二天兴奋的不知两点三点才睡着，想着要结束了就高兴。</p>
<p>上午数学做得史无前例的顺，做完了看还有半个多小时，又翻翻看看，忽然发现有误解的地方，胡乱一改然后就收卷了。然后听旁边同学说数学难……</p>
<p>专业课前半小时后半小时净听监考老师blabla个没完没了，然后简单的会做难得一点看不懂。感觉有的题还是错的。</p>
<p>亢奋的情绪持续了第二天一天，晚上又是两三点才睡着。高兴过头了。</p>
<p>复试完第一件事竟然是装gentoo……太TM屌丝了……</p>
<h2 id="复试">复试</h2><p>十一号报到十号坐高铁滚到北京，可是奢侈了一把。承蒙同学收留，住在了北科。复试这几天爽爆了，日行二三十公里……北科距北邮40分钟步程(我的走路速度就和慢跑差不多了……)一天至少也得往来一趟。在北邮瞎转一圈，好在北邮小到能从南门看到北门西门看到东门，没觉得太累。第二天又去中科院那边找同学，一路问一路走饶了一大圈又爽了一把，晚上又和同学逛到九点多……但谢谢他(她)们肯花时间招待我，陪我瞎转，很温暖的北京之旅啊。明天打算去北大和清华混吃求陪去，然后哈哈，亦庄。</p>
<h3 id="体检">体检</h3><p>早上sb了动作慢了一步，同寝的国防生们早冲出去跑操去了。结果面对北科大宿舍新装的伟大门禁我就sb了……等到一会有收垃圾的开了个侧门我终于溜出宿舍了……</p>
<p>结果就是，本打算6点多去校医院排队体检，结果七点才离开北科，又花了四十分钟到北邮校医院。倒是远远看到一长对一路排到教三。然后竟然好多排队不拿表……</p>
<p>拿表，填好，听说可以先体检后缴费就四处找人少的地方。结果后来就sb了，差点没测完……</p>
<p>建议是早去先胸透视力然后抽血，男外别去太晚，其它好像都特快。不然就没人给您体检了……说到男外科我要扯扯，人说北邮校医院有一大绝技——切包皮。我感觉男外那男医生净督促大家切包皮了。</p>
<h3 id="笔试">笔试</h3><p>唯一印象深刻的是我爸发短信说去年要带2b铅笔，让我带上。我根本就不知道，差点悲剧掉。</p>
<p>据说信安的笔试是浮云，我也无心准备。看了看计网，两天内忘光。看看c语言，忘得更快，好歹毕设还和C有些关系。准备看概率论，最后一个字没看……</p>
<p>笔试一个小时，五选三，90道选择题，都是涂答题卡。只要熟悉都不难。</p>
<p>官方说明复试挺重要，由导师自主划线，决定复试人员。但没看到有任何人因为笔试挂掉。</p>
<p>反正没啥好担心的，把复习的时间省下来做其它有意义的事吧。</p>
<p>唯一突然的是，笔试结束后留下来填张表，关于考研成绩，本科专业，是否服从分配，认同团队文化，最早什么时候能来，是否同意调剂到专硕等问题。钮老师还提醒了下复试要带上缴费后打印的报名表，成绩单和简历和刚发的复试表。</p>
<h3 id="面试">面试</h3><p>面试下午一点半开始，我成绩单简历报名表什么都没打，还放在北科。于是花了四十分钟又从北邮回到北科。半路接到辅导员电话，说查不到入党时间，要问之前负责的C老师，老师听说我在帝都复试，很和善的祝愿我了，瞬间感觉很温暖……回到北科进不去寝室，躺在操场的长椅上看国防生训练，然后就睡着了……</p>
<p>醒来想起入党时间还不知道，打电话问C老师，结果基本是被骂了一遍，呼呼拉拉又打了几通电话，最后老师说，好吧，下午四点半之后打给我吧。结果下午复试时收到老师短信告诉我是几号，真假不知，不过觉得不会坑我，我也不在乎，总之，谢谢C老师。</p>
<p>摸摸兜里就六七块钱了，在北科随便吃了顿饭。然后终于能回寝室了，打印好东西直接又花了四十分钟回到北邮，好在gxy之前带我在北邮逛了一圈，没问几个人就找到新科研楼12层了。</p>
<p>到上面发现我是第二个……qq群里问心是第一个，他进去我就在外面跟一起等待的人扯淡开玩笑。然后我就进去了。</p>
<p>不是什么群面，单独面试感觉挺好。对面一溜五六个老师，我对面坐下。</p>
<p>挺囧的面试……开始让一分钟英文自我介绍，题材随意。我讲了几句看没人听。于是说老师不会的单词用中文行么。老师说算了，你别说了……</p>
<p>然后就开始问我的特长，对什么感兴趣，哪方面研究深入。看我简历说熟悉linux，问我什么是驱动？我完全没明白老师想问什么，很坦然说不知道。出去才想到好像是问我驱动做了什么……也许老师感觉他问了个linux很基本的问题，我都不会，一定在瞎忽悠吧。</p>
<p>发的文章怎么回事，做了多少事，是不是第一作者。项目中你做了多少做了什么……</p>
<p>兴趣点太多，简历写得跳跃度太大。被直接看出来我是很冲动型的人了。不过说我什么坚持不太久我就不高兴了，单linux用这么久了都（好吧，快两年而已）。</p>
<p>问问我成绩怎样，班级排名怎样。班里考研的情况怎样。</p>
<p>问了问我用没用过gcc，用linux能不用gcc？又问用没用过gdb，怎么用，我随口说用过，是的，怎么用gdb调试python我知道，但从来没用gdb调试过c,我说在python中用过(翻译scipy lecture notes时学的)……但老师肯定不知道我的意思……总之，交流能力当时sb了。</p>
<p>然后扯到毕设，好像我扯过去的……扯扯貌似大家没怎么明白，就没怎么问。</p>
<p>问了问为什么选信安，好吧，我就是选信安而已，没啥理由。面对这神回答，老师很无语，我也很无语……</p>
<p>问了我觉得自己有啥优缺点。我说那动手能力和学习能力算有点吧，缺点，有点胆小吧。老师说我面了这么多学生没感觉你胆小，我说我心理有准备。又问问有没其它缺点，我想想说脾气不太好吧，老师说和同学关系不好？我说没有啊，只是有时候感觉太关注自己忽视别人了……</p>
<p>又问如果碰到分到不喜欢的工作会不会很别扭，你这看上去太冲动型了。我说老师您说得对，但我也没啥不感兴趣的，两年半总坚持的了。又说毕竟这个年龄想多看看多学学多折腾折腾，老师点点头，也不知道啥意思。</p>
<p>问我有啥不顺心的事吧，我实在想不到学校有啥，结果就问家里，结果我说了什么来着最后老师竟然来句对不起，我妹的我sb的回了句没事……</p>
<p>问了我到底对啥比较感兴趣，我说数学和计算机吧，渗透性比较强，我也喜欢各种各样交叉的东西，比如说信安。这时候说也有可能让你写文档，我说，好啊，老师您看简历，我很喜欢写东西啊，像我用的archlinux的社区维基上我就写了和翻译了很多东西啊。</p>
<p>被诘难是否没做出什么东西，我说老师您看简历上，做了很多小玩意，虽然不是啥特别好的东西。好歹是我一点一点查资料尝试错误，一点一点实现的。</p>
<p>然后走得时候老师们都很和善，然后我很sb的溜走了，出门被一群人围上了，怎么你这么久，好吧，我感觉就一会的事。</p>
<p>然后……想起来包忘里头了，手里还拿着不知道谁的笔……得，一边跟别人闲扯复试很简单，淡定加油或者开玩笑，一边等下一位出来。下一个出来时很猥琐地进去把包拿走笔放下了……我不知道老师怎么想……这孩子太sb了……</p>
<p>好了，这就是我的研究生复试面试了。sb的人生不需要解释,猥琐的举止无需掩饰……</p>
<h3 id="政面">政面</h3><p>一早赶去没什么人，老师看看表填好没，随便问问个人信息性格政治倾向一类的。很快。</p>
<h2 id="总结">总结</h2><ul>
<li>首先，做什么都要有信心吧。不要总是消极自我暗示，要积极自我欺骗。</li>
<li>多活动活动，劳逸结合，效率比时间重要。时间是像手中的沙子，抓得越紧，从指缝间流失的越快。</li>
<li>考研没什么重要的，身康体健，亲友健在，才是最重要的。</li>
<li><p>别跟大师比较，人比人，比死人。仅仅如一首禅诗：</p>
<blockquote>
<p>To follow the path:（沿着这样一条道路：） look to the master,（寻找大师，） follow the master,（跟随大师，） walk with the master,（与大师通行，） see through the master,（洞察大师，） become the master.（成为大师。）</p>
</blockquote>
</li>
<li><p>尽人事，听天命。不要胆怯，如果你真的在乎。</p>
</li>
<li>拿得起，放的下。敢赌敢输，天下之大，何处无容身之地。</li>
<li>福兮祸之所倚,祸兮福之所伏。</li>
</ul>
<h2 id="致谢">致谢</h2><ul>
<li>我的亲人：我不在乎上不上研，只在乎你们。</li>
<li>北邮人考研专版：很棒的地方。</li>
<li>同学及朋友：谢谢鼓励，谢谢复试时的款待、收留和帮助。</li>
<li>老师：从未曾为难过我</li>
</ul>
<p>总之，很高兴，某件事又结束了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/phase-unwrapping/2013/04/07/2-d-phase-unwrapping-path-following/" itemprop="url">
                  二维相位去包裹：路径积分法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-04-07T00:00:00+08:00" content="2013-04-07">
              2013-04-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/phase-unwrapping/" itemprop="url" rel="index">
                    <span itemprop="name">phase-unwrapping</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/phase-unwrapping/2013/04/07/2-d-phase-unwrapping-path-following/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="phase-unwrapping/2013/04/07/2-d-phase-unwrapping-path-following/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="二维相位去包裹：路径积分法">二维相位去包裹：路径积分法</h1><p>本文介绍几种基于路径积分的二维相位展开方法。这只是个预告，表示这几天没有闲着。</p>
<p>##为什么二维相位展开会发生问题？</p>
<h3 id="Itoh’s算法的二维扩展">Itoh’s算法的二维扩展</h3><p>Itoh’s一维相位展开算法很容易扩展到二维。</p>
<p>我们可以先对第一列进行解包裹，然后在此基础上对每行进行解包裹，整个相位图像就都能被解包裹了。</p>
<p>我把扩展的itoh’s算法函数写在util中并导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> axes3d</span><br></pre></td></tr></table></figure>
<p>获取实验相位函数。我随便选的，应该没问题吧……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">X, Y, Z = axes3d.get_test_data(<span class="number">0.05</span>)</span><br><span class="line">Z_origin = Z.copy()</span><br><span class="line">plt.figsize(<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">121</span>)</span><br><span class="line">plt.title(<span class="string">"origin phase"</span>)</span><br><span class="line">plt.imshow(Z, cmap=<span class="string">'gray'</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">colorbar(shrink=<span class="number">.40</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">122</span>)</span><br><span class="line">plt.title(<span class="string">"wraped phase"</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">Z = wrap(Z)</span><br><span class="line">plt.imshow(Z, cmap=<span class="string">'gray'</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.40</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://raw.github.com/reverland/phase-unwrapping-notes/master/image/2-d-itoh.jpg" alt="原始相位和包裹相位"></p>
<p>紧接着用itoh的方法解包裹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Z = raster_unwrap2(Z)</span><br><span class="line"></span><br><span class="line">plt.figsize(<span class="number">10</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">121</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">plt.title(<span class="string">"unwraped phase"</span>)</span><br><span class="line">plt.imshow(Z, cmap=<span class="string">'gray'</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.40</span>)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">122</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">plt.title(<span class="string">"erro map"</span>)</span><br><span class="line">plt.imshow(Z - Z_origin, cmap=<span class="string">'gray'</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.40</span>, ticks=<span class="keyword">None</span>)</span><br><span class="line">np.all(np.abs((Z - Z_origin) &lt; <span class="number">1e-8</span>))</span><br></pre></td></tr></table></figure>
<p><img src="http://raw.github.com/reverland/phase-unwrapping-notes/master/image/raster-unwrap.jpg" alt="解包裹相位和误差图"></p>
<p>正如我们所见，这算法效果很好。但是如果数据点出了点问题的话……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Z = wrap(Z)</span><br><span class="line"></span><br><span class="line">x = np.random.randint(<span class="number">0</span>,<span class="number">120</span>,<span class="number">100</span>)</span><br><span class="line">y = np.random.randint(<span class="number">0</span>,<span class="number">120</span>,<span class="number">100</span>)</span><br><span class="line">Z[x,y] = random.random() * <span class="number">3</span></span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">131</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">plt.title(<span class="string">"noisy wraped phase"</span>)</span><br><span class="line">plt.imshow(Z, cmap=<span class="string">'gray'</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.25</span>)</span><br><span class="line"></span><br><span class="line">Z = raster_unwrap2(Z)</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">132</span>)</span><br><span class="line">plt.title(<span class="string">"noisy unwraped phase"</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">plt.imshow(Z, cmap=<span class="string">'gray'</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.25</span>)</span><br><span class="line"></span><br><span class="line">np.all((Z == Z_origin))</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">133</span>)</span><br><span class="line">plt.imshow(Z-Z_origin, cmap=<span class="string">'gray'</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_axis_off()</span><br><span class="line">plt.title(<span class="string">"error map"</span>)</span><br><span class="line">colorbar(shrink=<span class="number">.25</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://raw.github.com/reverland/phase-unwrapping-notes/master/image/raster-unwrap-noise.jpg" alt="带噪音情况"></p>
<p>我加了一些随机噪声，结果就悲剧了。查看误差图给我们了一些启示。在某些出问题的点同一行又边全都出了问题。这种解包裹误差不断扩大并形成一条线的现象，<em>似乎</em> 叫做 <em>拉线</em> 现象(我瞎说的，只是有文献提到过拉线现象，也可能就是这个吧……)。</p>
<p>如果我们对Itoh算法换一种方式扩展。先对第一行解包裹，再在此基础上对各个列解包裹。如果没有有问题的点。结果和第一种扩展方式一样。这给我们个启示，我们可以在任意方向进行相位去包裹，但只要碰到出问题的点都会在之后的积分路径中出现问题。</p>
<p>如果要解包裹出正确的相位，必须绕过这些奇点(有问题的点)。</p>
<p>事实上，相位解包裹领域借用了高等数学和复变函数分析里的理论和观点，并最终形成了相位解包裹问题的留数定理。</p>
<h3 id="相位去包裹留数定理">相位去包裹留数定理</h3><p>要想解包裹与路径无关，必须有：</p>
<p>$$\oint \nabla \varphi(r) \cdot dr = 2\pi \times \text{(sum of enclosed residue charges)}$$</p>
<p>在数字图像中，最小的环路是2X2大小的四个像素，如下图所示。通过计算$\sum_{i=1}^4\Delta_i$是否为零，为零则无留数，否则此区域内有正或负留数。实际上，这些有问题的点留数通常不会为0。</p>
<p><img src="http://raw.github.com/reverland/phase-unwrapping-notes/master/image/residue.png" alt="留数计算示意"></p>
<p>为了在任意方向上能进行正确的解包裹，必须想办法使环路内的留数和为0,让积分路径(也是解包裹的路径)绕过这些留数不为0的奇点。</p>
<p>之后所提到的，我所看到的一些路径积分方法。都是通过尽量在可靠的地方进行相位展开(即积分),想办法绕开可能造成问题的点，或平衡这些造成问题的点。</p>
<p>之后做好准备看看那些大牛们发展出的各种路径积分算法吧。我已经佩服的五体投地了。这复杂程度已经让个人Keep it simple， stupid的人生哲学彻底崩坏。各路人马的算法涉及大量数学理论、信号处理理论(mask、noise filter、quality map)、图形形态学操作(开闭操作、连通性判断)、图论(分支切割算法)、最小生成树……完全看跪了……如果你准备动手实践，为了提高时间和空间效率，还有涉及可能是算法设计的东西吧[^1]。</p>
<h2 id="几种路径积分算法">几种路径积分算法</h2><h3 id="Goldstein_分支切割(branch_cut)算法">Goldstein 分支切割(branch cut)算法</h3><p>该算法旨在用最短的路径平衡正负留数，设置解包裹时的障碍，使解包裹路径能按照正确的方向进行。总体上说，该算法相当高效，很容易查看效果。但跟质量图没关系，很容易错误的放置障碍，导致错误的积分路径。</p>
<h3 id="质量引导(quality-guided)算法">质量引导(quality-guided)算法</h3><p>先积分质量高的地方，后积分质量低的地方，这基本能保证解包裹路径的正确。这个算法和留数没关系，所以不能保证不出错。但如果有个非常好的质量图，结果相当棒。另外，效率也不错。</p>
<h3 id="掩码分支(mask)算法">掩码分支(mask)算法</h3><p>前两种算法的杂交，通过某种方法沿着质量最低的地方扩展mask，最后解包裹时绕过这些mask。同上方法，没有好的质量图就别去试。</p>
<h3 id="flynn最小断点算法">flynn最小断点算法</h3><p>很直观的算法。就是把不连续的部分通过增加整数倍个$2\pi$变得连续，虽然说起来没这么简单。该算法用了个生成树，效果很好，还可以用质量图获得更好的效果……</p>
<h2 id="Off-Topic">Off-Topic</h2><p>相位去包裹笔记放在<a href="https://github.com/reverland/phase-unwrapping-notes" target="_blank" rel="external">这里</a>。</p>
<h2 id="Footnotes">Footnotes</h2><p>[^1]:在 <em>Data Analysis with Open Source Tools</em> 一书中推荐过 <em>一本书叫如何设计算法</em> ，应该值得一看。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">175</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">61</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.suzibin.cn/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://zhangwenli.com/blog" target="_blank">Ovilia</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://simmer-jun.github.io" target="_blank">Simmer</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/10/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
