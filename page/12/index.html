<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/12/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2013/02/05/visualize-the-friendship-of-renren/" itemprop="url">
                  Python小练习：可视化人人好友关系
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-02-05T00:00:00+08:00" content="2013-02-05">
              2013-02-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2013/02/05/visualize-the-friendship-of-renren/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2013/02/05/visualize-the-friendship-of-renren/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="可视化人人好友关系">可视化人人好友关系</h1><hr>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<p>受<a href="http://cos.name/2011/04/exploring-renren-social-network/" target="_blank" rel="external">R分析人人网好友推荐系统</a>和<a href="http://blog.csdn.net/lkkang/article/details/7362888" target="_blank" rel="external">用python进行人人好友分析</a>启发，完全用python的模块和方式实现了一遍，结果搞得好像一点也不Pythonic，倒好像有点继承了之前在lisp下养成的函数式风格……</p>
<p>作为菜鸟深知代码写得不怎么样，写在这里，希望没什么基础的人都能体会到其中我所感受到的乐趣<em>Happy hacking</em>，也欢迎各路高手大牛不吝赐教。</p>
<p>完整代码见<a href="https://github.com/reverland/scripts/blob/master/python/renren.py" target="_blank" rel="external">github/reverland/scripts/renren.py</a></p>
<h2 id="必要条件">必要条件</h2><p><strong>For Reader:</strong></p>
<p>读者需要有一定python基础，如果没有，不妨花半个小时看看<a href="">Python简明教程</a>。</p>
<p><strong>For Computer:</strong></p>
<p>我在gentoo linux下完成所有的编写测试，也推荐想尝试的朋友选择linux环境。不过只是推荐，python作为著名的跨平台语言，其代码可以没什么差别的运行在各个平台上，但你需要以下一些必备的东西：</p>
<ul>
<li>python 2.7 也许2.5也行，cookielib之前好像不在标准库中，而python3中则有改动。</li>
<li>networkx 一个分析，操作，绘制网络的python模块。</li>
<li>matplotlib 经常用来绘图的python模块</li>
</ul>
<p>怎么安装请自行参照官方网站说明。对后两个模块，建议使用pip安装，这货就相当于个包管理器(一条命令完成搜索下载安装所有操作并自动处理所有依赖)。</p>
<p>最后，还有可选的开发环境：ipython，该程序提供一个功能强大的交互环境，很方便做测试调试探索各种 <em>一次性</em> 工作。</p>
<h2 id="我们要做些什么">我们要做些什么</h2><p>从人人网上抓取好友，绘制好友之间的关系图，还可以供进一步分析(貌似没什么好分析的)。</p>
<p>为了实现这点我们需要做到以下几个工作：</p>
<ul>
<li>模拟登录[^1]</li>
<li>提取数据以合适数据结构保存</li>
<li>制作图像并绘制</li>
</ul>
<h3 id="模拟登录">模拟登录</h3><p>人人的模拟登录还是比较简单的。模拟登录最困难的部分就是对要登录网站登录过程的分析。通常办法是通过抓包，用wireshark总有种杀鸡用牛刀的感觉，而且当你像作者一样天天用socks代理时会发现什么也抓不到……所以IE/Chrome/Firefox的开发工具可能更合适。这里用firebug，你可以在火狐扩展中心找到并安装它。</p>
<p><img src="http://fmn.rrfmn.com/fmn058/20130207/1135/large_ljoh_1281000032cc125c.jpg" alt="人人登录分析"></p>
<p>然后在抓包过程中找到用户名<a href="在CSDN事发之后人人停止明文传送密码，可以在js文件中发现密码经过加密。以后有空再研究。">^2</a>和登录时请求的服务器。</p>
<p>不过，之前有很多人已经分析过人人的登录过程(一般不会要求验证码，除非登录过于频繁)。你所必须要做的基本上只有两件事：</p>
<ul>
<li>将用户名和密码POST到服务器</li>
<li>处理cookie</li>
</ul>
<p>模拟登录的工具使用python的标准库中的<code>urllib</code>,<code>urllib2</code>和<code>cookielib</code>即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> cookielib</span><br></pre></td></tr></table></figure>
<p>如果对这三个标准库不熟悉，建议花时间看看下面两篇教程。不过也许无所谓，代码可以自己解释自己:p。</p>
<ul>
<li><a href="http://www.voidspace.org.uk/python/articles/urllib2.shtml" target="_blank" rel="external">urllib2 the missing manual</a></li>
<li><a href="http://www.voidspace.org.uk/python/articles/cookielib.shtml" target="_blank" rel="external">cookielib</a></li>
</ul>
<p>当浏览器使用POST方法请求服务器时，它将参数经过编码附加到url后传递过去:</p>
<pre><code><span class="string">http:</span><span class="comment">//www.renren.com/ajaxLogin/login&amp;email=username&amp;password=blablabla</span>
</code></pre><p>登录成功后，还要获取人人中用来作为用户唯一标识额uid(打开人人主页注意url就看到了)并返回，以供将来使用。将来所有的抓取都通过独一无二的uid而非可能重名的姓名。</p>
<p>使用正则抓去uid</p>
<pre><code><span class="preprocessor"><span class="keyword">import</span> re</span>
</code></pre><p>我们先写登录函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    <span class="string">"""log in and return uid"""</span></span><br><span class="line">    logpage = <span class="string">"http://www.renren.com/ajaxLogin/login"</span></span><br><span class="line">    data = &#123;<span class="string">'email'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line">    login_data = urllib.urlencode(data)</span><br><span class="line">    cj = cookielib.CookieJar()</span><br><span class="line">    opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj))</span><br><span class="line">    urllib2.install_opener(opener)</span><br><span class="line">    res = opener.open(logpage, login_data)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Login now ..."</span></span><br><span class="line">    html = res.read()</span><br><span class="line">    <span class="comment">#print html</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get uid</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Getting user id of you now"</span></span><br><span class="line">    res = urllib2.urlopen(<span class="string">"http://www.renren.com/home"</span>)</span><br><span class="line">    html = res.read()</span><br><span class="line">    <span class="comment"># print html</span></span><br><span class="line">    uid = re.search(<span class="string">"'ruid':'(\d+)'"</span>, html).group(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># print uid</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Login and got uid successfully"</span></span><br><span class="line">    <span class="keyword">return</span> uid</span><br></pre></td></tr></table></figure>
<p>不妨在ipython中先测试下。</p>
<h3 id="抓取数据">抓取数据</h3><p>每个人的好友都可以从页面<code>http://friend.renren.com/GetFriendList.do?curpage=0&amp;id=uid</code>获取，虽然人人已经改版，但这个页面还能用。其中curpage参数的值是页码，id参数的值是拟抓取对象的用户ID。通过循环抓取所有好友并以用户id为键姓名为值保存为字典。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getfriends</span><span class="params">(uid)</span>:</span></span><br><span class="line">    <span class="string">"""Get the uid's friends and return the dict with uid as key,name as value."""</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Get %s 's friend list"</span> % str(uid)</span><br><span class="line">    pagenum = <span class="number">0</span></span><br><span class="line">    dict1 = &#123;&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        targetpage = <span class="string">"http://friend.renren.com/GetFriendList.do?curpage="</span> + str(pagenum) + <span class="string">"&amp;id="</span> + str(uid)</span><br><span class="line">        res = urllib2.urlopen(targetpage)</span><br><span class="line">        html = res.read()</span><br><span class="line"></span><br><span class="line">        pattern = <span class="string">'&lt;a href="http://www\.renren\.com/profile\.do\?id=(\d+)"&gt;&lt;img src="[\S]*" alt="[\S]*[\s]\((.*)\)" /&gt;'</span></span><br><span class="line"></span><br><span class="line">        m = re.findall(pattern, html)</span><br><span class="line">        <span class="comment">#print len(m)</span></span><br><span class="line">        <span class="keyword">if</span> len(m) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(m)):</span><br><span class="line">            no = m[i][<span class="number">0</span>]</span><br><span class="line">            uname = m[i][<span class="number">1</span>]</span><br><span class="line">            <span class="comment">#print uname, no</span></span><br><span class="line">            dict1[no] = uname</span><br><span class="line">        pagenum += <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Got %s 's friends list successfully."</span> % str(uid)</span><br><span class="line">    <span class="keyword">return</span> dict1</span><br></pre></td></tr></table></figure>
<p>我们再写个获取好友关系字典的函数，为了避免我们每次为了获取字典都要登录抓取。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdict</span><span class="params">(uid)</span>:</span></span><br><span class="line">    <span class="string">"""cache dict of uid in the disk."""</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(str(uid) + <span class="string">'.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            dict_uid = p.load(f)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">with</span> open(str(uid) + <span class="string">'.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            p.dump(getfriends(uid), f)</span><br><span class="line">        dict_uid = getdict(uid)</span><br><span class="line">    <span class="keyword">return</span> dict_uid</span><br></pre></td></tr></table></figure>
<p>我们还需要一个用来判断两个人关系的函数，来判断我们好友之间的关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getrelations</span><span class="params">(uid1, uid2)</span>:</span></span><br><span class="line">    <span class="string">"""receive two user id, If they are friends, return 1, otherwise 0."""</span></span><br><span class="line">    dict_uid1 = getdict(uid1)</span><br><span class="line">    <span class="keyword">if</span> uid2 <span class="keyword">in</span> dict_uid1:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<h3 id="绘制图像">绘制图像</h3><p>利用以上函数判断好友关系并通过networkx创建一个相应的网络。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getgraph</span><span class="params">(username, password)</span>:</span></span><br><span class="line">    <span class="string">"""Get the Graph Object and return it.</span><br><span class="line">    You must specify a Chinese font such as `SimHei` in ~/.matplotlib/matplotlibrc"""</span></span><br><span class="line">    uid = login(username, password)</span><br><span class="line">    dict_root = getdict(uid)  <span class="comment"># Get root tree</span></span><br><span class="line"></span><br><span class="line">    G = nx.Graph()  <span class="comment"># Create a Graph object</span></span><br><span class="line">    <span class="keyword">for</span> uid1, uname1 <span class="keyword">in</span> dict_root.items():</span><br><span class="line">        <span class="comment"># Encode Chinese characters for matplotlib **IMPORTANT**</span></span><br><span class="line">        <span class="comment"># if you want to draw Chinese labels,</span></span><br><span class="line">        uname1 = unicode(uname1, <span class="string">'utf8'</span>)</span><br><span class="line">        G.add_node(uname1)</span><br><span class="line">        <span class="keyword">for</span> uid2, uname2 <span class="keyword">in</span> dict_root.items():</span><br><span class="line">            uname2 = unicode(uname2, <span class="string">'utf8'</span>)</span><br><span class="line">            <span class="comment"># Not necessary for networkx</span></span><br><span class="line">            <span class="keyword">if</span> uid2 == uid1:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> getrelations(uid1, uid2):</span><br><span class="line">                G.add_edge(uname1, uname2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> G</span><br></pre></td></tr></table></figure>
<p>最后是绘图函数，有很多控制图像输出的参数，可能多次调整才会得到想要的图像。在matplotlib画出的图像在窗口中也可以放大缩小选取适当范围。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">draw_graph</span><span class="params">(username, password, filename=<span class="string">'graph.txt'</span>, label_flag=True, remove_isolated=True, different_size=True, iso_level=<span class="number">10</span>, node_size=<span class="number">40</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Reading data from file and draw the graph.If not exists, create the file and re-scratch data from net"""</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Generating graph..."</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            G = p.load(f)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        G = getgraph(username, password)</span><br><span class="line">        <span class="keyword">with</span> open(filename, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            p.dump(G, f)</span><br><span class="line">    <span class="comment">#nx.draw(G)</span></span><br><span class="line">    <span class="comment"># Judge whether remove the isolated point from graph</span></span><br><span class="line">    <span class="keyword">if</span> remove_isolated <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">        H = nx.empty_graph()</span><br><span class="line">        <span class="keyword">for</span> SG <span class="keyword">in</span> nx.connected_component_subgraphs(G):</span><br><span class="line">            <span class="keyword">if</span> SG.number_of_nodes() &gt; iso_level:</span><br><span class="line">                H = nx.union(SG, H)</span><br><span class="line">        G = H</span><br><span class="line">    <span class="comment"># Ajust graph for better presentation</span></span><br><span class="line">    <span class="keyword">if</span> different_size <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">        L = nx.degree(G)</span><br><span class="line">        G.dot_size = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> L.items():</span><br><span class="line">            G.dot_size[k] = v</span><br><span class="line">        node_size = [G.dot_size[v] * <span class="number">10</span> <span class="keyword">for</span> v <span class="keyword">in</span> G]</span><br><span class="line">    pos = nx.spring_layout(G, iterations=<span class="number">50</span>)</span><br><span class="line">    nx.draw_networkx_edges(G, pos, alpha=<span class="number">0.2</span>)</span><br><span class="line">    nx.draw_networkx_nodes(G, pos, node_size=node_size, node_color=<span class="string">'r'</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">    <span class="comment"># Judge whether shows label</span></span><br><span class="line">    <span class="keyword">if</span> label_flag <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">        nx.draw_networkx_labels(G, pos, alpha=<span class="number">0.5</span>)</span><br><span class="line">    <span class="comment">#nx.draw_graphviz(G)</span></span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> G</span><br></pre></td></tr></table></figure>
<p>把以上函数写进一个文件比如说renren.py，在ipython中导入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">1</span>]: <span class="keyword">from</span> renren <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">In[<span class="number">2</span>]: username = yourusername</span><br><span class="line"></span><br><span class="line">In[<span class="number">3</span>]: password = yourpassword</span><br><span class="line"></span><br><span class="line">In[<span class="number">4</span>]: draw_graph(username, password)</span><br></pre></td></tr></table></figure>
<p><img src="http://fmn.xnpic.com/fmn057/20130207/1135/large_C753_44f6000032d8125d.jpg" alt="模糊化生成的好友关系图"></p>
<h2 id="总结">总结</h2><p>通过图像你会发现。这些绘图软件的算法相当不错的，你会发现很明显的聚类，这一片是大学同学、这片是小学初中同学，旁边与之联系紧密的是高中同学，这一片孤立的是网友等等。</p>
<p>也许你还会发现你的某些好友竟然相互认识。</p>
<p>抓取下来的数据还可以留待其它研究</p>
<p><img src="http://fmn.rrfmn.com/fmn059/20130207/1135/large_HiaW_1161000032c9125c.jpg" alt="又是横竖坐标都没的渣图"></p>
<p>你也许会发现有的好友和你的共同好友多得超乎他人，也许发现共同好友分布比较均匀</p>
<p>就这么多这么简单。</p>
<p>希望你也能体会到这个乐趣横生的过程，对我来说，探索和学习的过程是相当意趣盎然的，折腾出来还相当有成就感呢。</p>
<h2 id="What’s_more">What’s more</h2><p>如果你想让matplotlib显示中文，你需要修改matplotlibrc更改字体。但有一种更通用的办法可以不用修改配置文件。自行google。</p>
<p>ps:这回开高亮了，没感觉和不高亮有啥大区别。感觉还是vim中的高亮漂亮啊，哪天不用pygments直接用vim converto html = =</p>
<h2 id="FootNotes">FootNotes</h2><p>[^1]:从来没用过api，搞不懂人人api，试着创建个应用Post过去结果认证失败，也没打算申请应用……总之不会搞= =</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2013/01/28/visualize-your-shell-history/" itemprop="url">
                  Visualize your shell history
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-01-28T00:00:00+08:00" content="2013-01-28">
              2013-01-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2013/01/28/visualize-your-shell-history/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2013/01/28/visualize-your-shell-history/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Visualize_Shell_History">Visualize Shell History</h1><p>注：代码写得很烂，不过感觉挺好玩所以写在这里。欢迎各路大牛指教。完整代码见<a href="https://github.com/reverland/scripts/blob/master/python/tagcloud.py" target="_blank" rel="external">github/reverland/scripts/tagcloud.py</a></p>
<p>曾经在linux用户中流行这么一个命令</p>
<pre><code>~ ⮀ history | awk '<span class="tuple">{<span class="variable">CMD</span>[$<span class="number">2</span>]++;count++;}</span> <span class="variable">END</span> <span class="tuple">{ for (a in <span class="variable">CMD</span> )print <span class="variable">CMD</span>[ a ]<span class="string">" "</span> <span class="variable">CMD</span>[ a ]/count*<span class="number">100</span> <span class="string">"% "</span> a }</span>' | grep -v <span class="string">"./"</span> | column -c3 -s <span class="string">" "</span> -t |sort -nr | nl | head -n20 
    <span class="number">1</span>  <span class="number">852</span>  <span class="number">24.3012</span><span class="comment">%    sudo</span>
    <span class="number">2</span>  <span class="number">376</span>  <span class="number">10.7245</span><span class="comment">%    pacman</span>
    <span class="number">3</span>  <span class="number">163</span>  <span class="number">4.64917</span><span class="comment">%    vim</span>
    <span class="number">4</span>  <span class="number">133</span>  <span class="number">3.7935</span><span class="comment">%     tsocks</span>
    <span class="number">5</span>  <span class="number">101</span>  <span class="number">2.88078</span><span class="comment">%    cd</span>
    <span class="number">6</span>  <span class="number">95</span>   <span class="number">2.70964</span><span class="comment">%    kill</span>
    <span class="number">7</span>  <span class="number">88</span>   <span class="number">2.50998</span><span class="comment">%    eix</span>
    <span class="number">8</span>  <span class="number">70</span>   <span class="number">1.99658</span><span class="comment">%    python2</span>
    <span class="number">9</span>  <span class="number">70</span>   <span class="number">1.99658</span><span class="comment">%    emerge</span>
    <span class="number">10</span>  <span class="number">69</span>   <span class="number">1.96805</span><span class="comment">%    ls</span>
    <span class="number">11</span>  <span class="number">63</span>   <span class="number">1.79692</span><span class="comment">%    git</span>
    <span class="number">12</span>  <span class="number">54</span>   <span class="number">1.54022</span><span class="comment">%    gcc</span>
    <span class="number">13</span>  <span class="number">51</span>   <span class="number">1.45465</span><span class="comment">%    pip2</span>
    <span class="number">14</span>  <span class="number">39</span>   <span class="number">1.11238</span><span class="comment">%    python</span>
    <span class="number">15</span>  <span class="number">37</span>   <span class="number">1.05533</span><span class="comment">%    pip</span>
    <span class="number">16</span>  <span class="number">37</span>   <span class="number">1.05533</span><span class="comment">%    nmap</span>
    <span class="number">17</span>  <span class="number">35</span>   <span class="number">0.998289</span><span class="comment">%   su</span>
    <span class="number">18</span>  <span class="number">32</span>   <span class="number">0.912721</span><span class="comment">%   xrandr</span>
    <span class="number">19</span>  <span class="number">31</span>   <span class="number">0.884199</span><span class="comment">%   rvm</span>
    <span class="number">20</span>  <span class="number">27</span>   <span class="number">0.770108</span><span class="comment">%   ssh</span>
</code></pre><p>多cool的一个命令……我完全看不懂awk啥的……几天前看<a href="http://book.douban.com/subject/4606883/" target="_blank" rel="external">The practice of computing using python</a>，上面讲到简单的文本处理和标签云，便想到把shell history用<a href="http://zh.wikipedia.org/wiki/%E6%A0%87%E7%AD%BE%E4%BA%91" target="_blank" rel="external">标签云</a>的方式可视化出来。就是这样，我啥也不会。</p>
<p>先把shell历史定向到一个文件中吧，或者把zsh_history啥复制下</p>
<pre><code><span class="built_in">history</span> &gt; hist.txt
</code></pre><p>然后如何可视化呢？抱着有需求先搜寻有没有开源实现的想法找到了<a href="https://pypi.python.org/pypi/pytagcloud" target="_blank" rel="external">pytagcloud</a>，稍加调整，生成的标签云相当漂亮：</p>
<iframe src="https://skydrive.live.com/embed?cid=6328070E636BA49B&resid=6328070E636BA49B%21120&authkey=AGJEuW9irdMRN9o" width="318" height="162" frameborder="0" scrolling="no"></iframe>

<p>oops!好大两个“异常词”，这么说一看我就是sudo党了，而且是经常滚的arch党……</p>
<p>为了看清更多细节，反映更多客观事实把这两个词去掉</p>
<iframe src="https://skydrive.live.com/embed?cid=6328070E636BA49B&resid=6328070E636BA49B%21121&authkey=AOLuu-QJ8tQGBv8" width="319" height="256" frameborder="0" scrolling="no"></iframe>

<p>看上去好多了………</p>
<p>pytagcloud还提供生成html数据的函数，你可以在线看看效果：</p>
<p><a href="https://www.atizo.com/docs/labs/cloud.html" target="_blank" rel="external">Demo</a></p>
<h2 id="自己动手">自己动手</h2><p>其实自己实现类似的效果很简单，获得更明晰的理解和灵活性。</p>
<p>先给出以下要用的控制大小的参数，后面将直接用到它们。你可能需要多次调整来探索适合自己的数值，事实上，为了生成不同文本的标签云我试过了几十次。</p>
<pre><code>boxsize = <span class="number">600</span>
basescale = <span class="number">10</span>
fontScale = <span class="number">0.5</span>
omitnumber = <span class="number">5</span>
omitlen = <span class="number">0</span>
</code></pre><h3 id="文本处理">文本处理</h3><p>我们刚才保存的hits文件是这样的：</p>
<pre><code><span class="number">2480</span>  pacman -Ss synap
<span class="number">2481</span>  sudo pacman -S synaptiks
<span class="number">2482</span>  synaptiks
<span class="number">2483</span>  pypy
<span class="number">2484</span>  vim pypy.py
<span class="number">2485</span>  pypy pypy.py
<span class="number">2486</span>  pip2 freeze
<span class="number">2487</span>  pip2 freeze|grep flask
<span class="number">2488</span>  pip2 install Flask
<span class="number">2489</span>  pip2 install --upgrade Flask 
</code></pre><p>显然我们只要每行第二个词就行,这个任务很简单，我选择先将所有命令合并成一个大字符串，因为最开始我是直接用pytagcloud来生成标签云的，而它的示例代码用的是整个字符串：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">cmd2string</span><span class="params">(filename)</span>:</span>
    <span class="string">'''accept the filename and return the string of cmd'''</span>
    chist = []

    <span class="comment"># Open the file and store the history in chist</span>
    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> f:
        chist = f.readlines()
        <span class="comment"># print chist</span>

    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(chist)):
        chist[i] = chist[i].split()
        chist[i] = chist[i][<span class="number">1</span>]
    ss = <span class="string">''</span>
    <span class="keyword">for</span> w <span class="keyword">in</span> chist:
        <span class="keyword">if</span> w != <span class="string">'sudo'</span> <span class="keyword">and</span> w != <span class="string">'pacman'</span>:
            ss = ss + <span class="string">' '</span> + w

    <span class="keyword">return</span> ss
</code></pre><p>接着将字符串转换成字典，单词为键，出现次数为值：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">string2dict</span><span class="params">(string, dic)</span>:</span>
    <span class="string">"""split a string into a dict record its frequent"""</span>
    wl = string.split()
    <span class="keyword">for</span> w <span class="keyword">in</span> wl:
        <span class="keyword">if</span> w == <span class="string">'\n'</span>:  <span class="comment"># 因为后来我看到中文分词结果中有\n...</span>
            <span class="keyword">continue</span>
        <span class="keyword">if</span> w <span class="keyword">not</span> <span class="keyword">in</span> dic:
            dic[w] = <span class="number">1</span>
        <span class="keyword">else</span>:
            dic[w] += <span class="number">1</span>
    <span class="keyword">return</span> dic
</code></pre><p>接下来的两个函数来自之前我提到的那本书，稍微改动下让它在firefox18下正常显示，并且稍作美化，更改为随机的字体色彩和黑色背景。</p>
<p>这两个函数的含义是不言自明的，必要的html/css知识是需要的。[^1]</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">makeHTMLbox</span><span class="params">(body, width)</span>:</span>
    <span class="string">"""takes one long string of words and a width(px) then put them in an HTML box"""</span>
    boxStr = <span class="string">"""&lt;div style=\"width: %spx;background-color: rgb(0, 0, 0);border: 1px grey solid;text-align: center; overflow: hidden;\"&gt;%s&lt;/div&gt;
    """</span>
    <span class="keyword">return</span> boxStr % (str(width), body)


<span class="function"><span class="keyword">def</span> <span class="title">makeHTMLword</span><span class="params">(body, fontsize)</span>:</span>
    <span class="string">"""take words and fontsize, and create an HTML word in that fontsize."""</span>
    <span class="comment">#num = str(random.randint(0,255))</span>
    <span class="comment"># return random color for every tags</span>
    color = <span class="string">'rgb(%s, %s, %s)'</span> % (str(random.randint(<span class="number">0</span>, <span class="number">255</span>)), str(random.randint(<span class="number">0</span>, <span class="number">255</span>)), str(random.randint(<span class="number">0</span>, <span class="number">255</span>)))
    <span class="comment"># get the html data</span>
    wordStr = <span class="string">'&lt;span style=\"font-size:%spx;color:%s;float:left;\"&gt;%s&lt;/span&gt;'</span>
    <span class="keyword">return</span> wordStr % (str(fontsize), color, body)
</code></pre><p>Now, it’s time to get the proper html files of the tag cloud!</p>
<pre><code><span class="comment"># get the html data first</span>
wd = {}
s = cmd2string(filename)
wd = string2dict(s, wd)
vkl = [(k, v) <span class="keyword">for</span> k, v <span class="operator">in</span> wd.<span class="keyword">items</span>() <span class="keyword">if</span> v &gt;= omitnumber <span class="operator">and</span> <span class="built_in">len</span>(k) &gt; omitlen]  <span class="comment"># kick off less used cmd</span>
<span class="keyword">words</span> = <span class="string">""</span>
<span class="keyword">for</span> w, c <span class="operator">in</span> vkl:
    <span class="keyword">words</span> += makeHTMLword(w, int(c * fontScale + basescale))   
html = makeHTMLbox(<span class="keyword">words</span>, boxsize)
<span class="comment"># dump it to a file</span>
<span class="operator">with</span> <span class="built_in">open</span>(filename.<span class="built_in">split</span>(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + <span class="string">'html'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:
    f.<span class="built_in">write</span>(html)
</code></pre><p>将以上内容写到一个文件中，命名为比如说<code>tagcloud.py</code>：</p>
<pre><code>python2 tagcloud.py hist.txt # <span class="escape">`i</span>mport sys<span class="escape">` </span><span class="literal">and</span> let filename = sys.argv[<span class="number">1</span>]
# <span class="literal">or</span> <span class="escape">`r</span>un tagcloud.py hist.txt<span class="escape">` </span>in ipython
</code></pre><p>看看效果吧：</p>
<div style="width: 600px;background-color: rgb(0, 0, 0);border: 1px grey solid;text-align: center; overflow: hidden;"><span style="font-size:12px;color:rgb(157, 185, 91);float:left;">genkernel</span><span style="font-size:13px;color:rgb(47, 174, 156);float:left;">systemctl</span><span style="font-size:13px;color:rgb(50, 68, 207);float:left;">nengo-cl</span><span style="font-size:13px;color:rgb(244, 119, 153);float:left;">./nengo</span><span style="font-size:76px;color:rgb(189, 223, 103);float:left;">tsocks</span><span style="font-size:15px;color:rgb(254, 134, 2);float:left;">axel</span><span style="font-size:13px;color:rgb(86, 82, 82);float:left;">namcap</span><span style="font-size:14px;color:rgb(44, 200, 12);float:left;">pidgin</span><span style="font-size:14px;color:rgb(46, 241, 79);float:left;">groups</span><span style="font-size:43px;color:rgb(41, 172, 34);float:left;">emerge</span><span style="font-size:14px;color:rgb(219, 50, 80);float:left;">firefox</span><span style="font-size:28px;color:rgb(141, 140, 48);float:left;">nmap</span><span style="font-size:88px;color:rgb(195, 252, 141);float:left;">vim</span><span style="font-size:13px;color:rgb(68, 185, 195);float:left;">/opt/nengo/nengo</span><span style="font-size:21px;color:rgb(146, 43, 253);float:left;">cat</span><span style="font-size:16px;color:rgb(154, 147, 54);float:left;">mv</span><span style="font-size:12px;color:rgb(105, 87, 82);float:left;">history</span><span style="font-size:17px;color:rgb(198, 155, 32);float:left;">nengo</span><span style="font-size:13px;color:rgb(194, 243, 111);float:left;">tar</span><span style="font-size:37px;color:rgb(191, 59, 151);float:left;">gcc</span><span style="font-size:13px;color:rgb(214, 77, 202);float:left;">dmesg|egrep</span><span style="font-size:16px;color:rgb(56, 165, 96);float:left;">man</span><span style="font-size:25px;color:rgb(137, 242, 6);float:left;">su</span><span style="font-size:18px;color:rgb(238, 10, 236);float:left;">ping</span><span style="font-size:23px;color:rgb(44, 133, 59);float:left;">makepkg</span><span style="font-size:43px;color:rgb(22, 204, 248);float:left;">ls</span><span style="font-size:23px;color:rgb(164, 107, 69);float:left;">python</span><span style="font-size:17px;color:rgb(114, 87, 130);float:left;">rake</span><span style="font-size:23px;color:rgb(206, 138, 57);float:left;">rm</span><span style="font-size:14px;color:rgb(16, 55, 18);float:left;">pkgfile</span><span style="font-size:12px;color:rgb(239, 229, 219);float:left;">netstat</span><span style="font-size:21px;color:rgb(27, 170, 206);float:left;">echo</span><span style="font-size:17px;color:rgb(50, 165, 243);float:left;">top</span><span style="font-size:16px;color:rgb(182, 34, 151);float:left;">mkdir</span><span style="font-size:13px;color:rgb(246, 169, 70);float:left;">john</span><span style="font-size:13px;color:rgb(103, 30, 25);float:left;">gvim</span><span style="font-size:35px;color:rgb(167, 105, 68);float:left;">pip2</span><span style="font-size:26px;color:rgb(231, 222, 102);float:left;">xrandr</span><span style="font-size:13px;color:rgb(82, 157, 232);float:left;">df</span><span style="font-size:23px;color:rgb(70, 31, 93);float:left;">ssh</span><span style="font-size:14px;color:rgb(77, 154, 73);float:left;">gem</span><span style="font-size:15px;color:rgb(34, 232, 18);float:left;">ipython2</span><span style="font-size:17px;color:rgb(230, 153, 244);float:left;">ipython</span><span style="font-size:13px;color:rgb(240, 48, 167);float:left;">modprobe</span><span style="font-size:14px;color:rgb(43, 73, 98);float:left;">you-get</span><span style="font-size:12px;color:rgb(188, 24, 231);float:left;">kdesu</span><span style="font-size:16px;color:rgb(2, 30, 128);float:left;">chmod</span><span style="font-size:58px;color:rgb(37, 249, 167);float:left;">cd</span><span style="font-size:17px;color:rgb(96, 69, 4);float:left;">cp</span><span style="font-size:18px;color:rgb(155, 55, 181);float:left;">ps</span><span style="font-size:12px;color:rgb(45, 131, 163);float:left;">lsmod</span><span style="font-size:49px;color:rgb(87, 209, 248);float:left;">eix</span><span style="font-size:13px;color:rgb(18, 193, 122);float:left;">md5sum</span><span style="font-size:19px;color:rgb(201, 58, 250);float:left;">vi</span><span style="font-size:17px;color:rgb(114, 154, 154);float:left;">make</span><span style="font-size:14px;color:rgb(142, 246, 82);float:left;">pactree</span><span style="font-size:12px;color:rgb(40, 105, 146);float:left;">fc-list|grep</span><span style="font-size:17px;color:rgb(246, 194, 111);float:left;">gdb</span><span style="font-size:57px;color:rgb(213, 212, 240);float:left;">kill</span><span style="font-size:16px;color:rgb(198, 103, 145);float:left;">source</span><span style="font-size:12px;color:rgb(200, 159, 50);float:left;">lspci</span><span style="font-size:13px;color:rgb(13, 128, 209);float:left;">jekyll</span><span style="font-size:45px;color:rgb(126, 189, 196);float:left;">python2</span><span style="font-size:19px;color:rgb(81, 102, 178);float:left;">export</span><span style="font-size:12px;color:rgb(216, 10, 195);float:left;">wkhtmltopdf</span><span style="font-size:13px;color:rgb(161, 23, 66);float:left;">loginctl</span><span style="font-size:13px;color:rgb(145, 190, 40);float:left;">katawa-shoujo</span><span style="font-size:13px;color:rgb(103, 215, 104);float:left;">pkill</span><span style="font-size:41px;color:rgb(23, 167, 23);float:left;">git</span><span style="font-size:15px;color:rgb(183, 200, 162);float:left;">eselect</span><span style="font-size:13px;color:rgb(211, 20, 113);float:left;">debug-flv</span><span style="font-size:25px;color:rgb(191, 7, 240);float:left;">rvm</span><span style="font-size:28px;color:rgb(126, 195, 148);float:left;">pip</span><span style="font-size:12px;color:rgb(67, 129, 6);float:left;">equery</span></div>


<p>相当棒不是么？[^2]</p>
<h3 id="十八大报告标签云">十八大报告标签云</h3><p>为了深刻领会党的十八大大会精神<a href="中文分词的结果，非人为干扰处理。">^3</a>，我做了下我党的十八大报告标签云：</p>
<p>先从网上找到总书记的十八大报告全文，保存为<code>shibada.txt</code>:</p>
<p>中文分词有个相当不错的python库<a href="https://github.com/fxsjy/jieba" target="_blank" rel="external">jieba</a></p>
<p>将单词保存到一个字典中</p>
<pre><code>import jieba

<span class="operator">with</span> <span class="built_in">open</span>(<span class="string">'shibada.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:
    s = f.<span class="built_in">read</span>()
wg = jieba.cut(s, cut_all=True)
wd = {}
<span class="keyword">for</span> w <span class="operator">in</span> wg:
    <span class="keyword">if</span> w <span class="operator">not</span> <span class="operator">in</span> wd:
        wd[w] = <span class="number">1</span>
    <span class="keyword">else</span>:
        wd[w] += <span class="number">1</span>
</code></pre><p>生成html数据：</p>
<pre><code><span class="keyword">for</span> w, c <span class="operator">in</span> vkl:
        <span class="keyword">words</span> += makeHTMLword(w, int(c * fontScale + basescale))   
html = makeHTMLbox(<span class="keyword">words</span>, boxsize)
htmlzh = unicode.encode(html,<span class="string">'UTF-8'</span>)  <span class="comment"># Important！</span>
<span class="comment"># dump it to a file</span>
<span class="operator">with</span> <span class="built_in">open</span>(filename.<span class="built_in">split</span>(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + <span class="string">'html'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:
    f.<span class="built_in">write</span>(htmlzh)
</code></pre><div style="width: 600px;background-color: rgb(0, 0, 0);border: 1px grey solid;text-align: center; overflow: hidden;"><span style="font-size:1px;color:rgb(47, 29, 172);float:left;">金融机构</span><span style="font-size:1px;color:rgb(114, 124, 132);float:left;">个人账户</span><span style="font-size:19px;color:rgb(147, 143, 128);float:left;">体制改革</span><span style="font-size:6px;color:rgb(108, 19, 158);float:left;">全党全国</span><span style="font-size:1px;color:rgb(214, 166, 200);float:left;">举世公认</span><span style="font-size:1px;color:rgb(193, 103, 222);float:left;">学前教育</span><span style="font-size:1px;color:rgb(38, 96, 145);float:left;">贸易组织</span><span style="font-size:1px;color:rgb(7, 241, 181);float:left;">管理网络</span><span style="font-size:1px;color:rgb(18, 92, 203);float:left;">精神食粮</span><span style="font-size:1px;color:rgb(151, 152, 208);float:left;">党外人士</span><span style="font-size:1px;color:rgb(122, 196, 198);float:left;">政企分开</span><span style="font-size:2px;color:rgb(89, 60, 233);float:left;">推进改革</span><span style="font-size:3px;color:rgb(249, 34, 116);float:left;">人民满意</span><span style="font-size:1px;color:rgb(95, 20, 196);float:left;">科学素养</span><span style="font-size:1px;color:rgb(9, 161, 232);float:left;">行动指南</span><span style="font-size:1px;color:rgb(200, 212, 11);float:left;">创建活动</span><span style="font-size:2px;color:rgb(67, 98, 22);float:left;">保护环境</span><span style="font-size:1px;color:rgb(237, 130, 132);float:left;">对外贸易</span><span style="font-size:2px;color:rgb(221, 60, 57);float:left;">党员干部</span><span style="font-size:7px;color:rgb(102, 196, 150);float:left;">充分发挥</span><span style="font-size:1px;color:rgb(124, 48, 22);float:left;">中小城市</span><span style="font-size:1px;color:rgb(209, 87, 184);float:left;">利用效率</span><span style="font-size:1px;color:rgb(16, 6, 222);float:left;">高度重视</span><span style="font-size:1px;color:rgb(80, 186, 194);float:left;">立于不败之地</span><span style="font-size:1px;color:rgb(122, 233, 232);float:left;">香港特别行政区</span><span style="font-size:1px;color:rgb(44, 22, 159);float:left;">资源整合</span><span style="font-size:1px;color:rgb(224, 232, 128);float:left;">社会制度</span><span style="font-size:1px;color:rgb(121, 96, 141);float:left;">科教兴国</span><span style="font-size:3px;color:rgb(58, 42, 1);float:left;">建立健全</span><span style="font-size:1px;color:rgb(218, 230, 44);float:left;">群众体育</span><span style="font-size:4px;color:rgb(220, 78, 146);float:left;">基本路线</span><span style="font-size:1px;color:rgb(226, 6, 169);float:left;">核心作用</span><span style="font-size:1px;color:rgb(131, 78, 122);float:left;">劳有所得</span><span style="font-size:1px;color:rgb(229, 77, 129);float:left;">腐败现象</span><span style="font-size:2px;color:rgb(77, 144, 9);float:left;">充满活力</span><span style="font-size:2px;color:rgb(147, 71, 2);float:left;">强权政治</span><span style="font-size:1px;color:rgb(35, 78, 105);float:left;">检察机关</span><span style="font-size:2px;color:rgb(251, 248, 67);float:left;">人大代表</span><span style="font-size:1px;color:rgb(18, 206, 62);float:left;">医药卫生</span><span style="font-size:1px;color:rgb(142, 48, 117);float:left;">居民消费</span><span style="font-size:1px;color:rgb(50, 197, 137);float:left;">各个环节</span><span style="font-size:1px;color:rgb(89, 154, 207);float:left;">坚持真理</span><span style="font-size:5px;color:rgb(148, 107, 251);float:left;">政治协商</span><span style="font-size:1px;color:rgb(234, 136, 151);float:left;">德智体美</span><span style="font-size:4px;color:rgb(145, 233, 145);float:left;">理想信念</span><span style="font-size:2px;color:rgb(234, 188, 99);float:left;">战略思想</span><span style="font-size:1px;color:rgb(96, 107, 51);float:left;">伸张正义</span><span style="font-size:1px;color:rgb(245, 42, 75);float:left;">组织协调</span><span style="font-size:1px;color:rgb(115, 24, 55);float:left;">思想道德</span><span style="font-size:8px;color:rgb(124, 170, 160);float:left;">两岸关系</span><span style="font-size:1px;color:rgb(104, 105, 77);float:left;">跨国公司</span><span style="font-size:1px;color:rgb(1, 241, 105);float:left;">腐败问题</span><span style="font-size:3px;color:rgb(237, 102, 92);float:left;">宏伟目标</span><span style="font-size:2px;color:rgb(110, 18, 237);float:left;">发展壮大</span><span style="font-size:1px;color:rgb(1, 83, 130);float:left;">不断扩大</span><span style="font-size:2px;color:rgb(11, 176, 0);float:left;">党风廉政</span><span style="font-size:4px;color:rgb(133, 98, 191);float:left;">共同富裕</span><span style="font-size:1px;color:rgb(83, 167, 151);float:left;">穷兵黩武</span><span style="font-size:2px;color:rgb(62, 169, 170);float:left;">根本宗旨</span><span style="font-size:1px;color:rgb(59, 5, 168);float:left;">管理科学</span><span style="font-size:1px;color:rgb(94, 65, 75);float:left;">急难险重</span><span style="font-size:1px;color:rgb(100, 205, 112);float:left;">医疗保障</span><span style="font-size:2px;color:rgb(129, 75, 117);float:left;">官僚主义</span><span style="font-size:2px;color:rgb(152, 203, 65);float:left;">严峻考验</span><span style="font-size:1px;color:rgb(45, 240, 43);float:left;">教师队伍</span><span style="font-size:1px;color:rgb(187, 250, 174);float:left;">保持稳定</span><span style="font-size:4px;color:rgb(146, 23, 138);float:left;">医疗卫生</span><span style="font-size:2px;color:rgb(104, 206, 13);float:left;">独立自主</span><span style="font-size:1px;color:rgb(155, 56, 114);float:left;">重大突破</span><span style="font-size:2px;color:rgb(222, 19, 160);float:left;">持久和平</span><span style="font-size:1px;color:rgb(70, 237, 20);float:left;">提高效益</span><span style="font-size:1px;color:rgb(1, 156, 36);float:left;">年龄结构</span><span style="font-size:1px;color:rgb(243, 69, 118);float:left;">合情合理</span><span style="font-size:1px;color:rgb(85, 227, 198);float:left;">妥善处置</span><span style="font-size:4px;color:rgb(7, 204, 47);float:left;">团结奋斗</span><span style="font-size:2px;color:rgb(103, 35, 104);float:left;">联系群众</span><span style="font-size:1px;color:rgb(102, 89, 216);float:left;">产业政策</span><span style="font-size:3px;color:rgb(122, 152, 159);float:left;">保险制度</span><span style="font-size:1px;color:rgb(220, 78, 245);float:left;">指导思想</span><span style="font-size:1px;color:rgb(86, 47, 154);float:left;">文化素质</span><span style="font-size:1px;color:rgb(165, 93, 84);float:left;">贫穷落后</span><span style="font-size:2px;color:rgb(103, 100, 111);float:left;">党员队伍</span><span style="font-size:1px;color:rgb(66, 183, 248);float:left;">依法行政</span><span style="font-size:1px;color:rgb(234, 254, 29);float:left;">睦邻友好</span><span style="font-size:9px;color:rgb(104, 36, 184);float:left;">各族人民</span><span style="font-size:1px;color:rgb(247, 201, 237);float:left;">巨大成就</span><span style="font-size:2px;color:rgb(68, 198, 231);float:left;">明显增强</span><span style="font-size:1px;color:rgb(184, 16, 109);float:left;">公共安全</span><span style="font-size:1px;color:rgb(93, 68, 73);float:left;">农民收入</span><span style="font-size:1px;color:rgb(48, 96, 188);float:left;">巩固国防</span><span style="font-size:1px;color:rgb(55, 117, 12);float:left;">恐怖主义</span><span style="font-size:1px;color:rgb(148, 168, 59);float:left;">主义精神</span><span style="font-size:1px;color:rgb(33, 244, 123);float:left;">主义教育</span><span style="font-size:3px;color:rgb(43, 116, 157);float:left;">执政为民</span><span style="font-size:1px;color:rgb(255, 114, 73);float:left;">机构编制</span><span style="font-size:1px;color:rgb(111, 100, 233);float:left;">妄自菲薄</span><span style="font-size:1px;color:rgb(108, 28, 220);float:left;">澳人治澳</span><span style="font-size:1px;color:rgb(137, 175, 127);float:left;">同舟共济</span><span style="font-size:1px;color:rgb(201, 3, 162);float:left;">群众反映</span><span style="font-size:1px;color:rgb(225, 124, 63);float:left;">基础产业</span><span style="font-size:1px;color:rgb(248, 246, 166);float:left;">经贸关系</span><span style="font-size:2px;color:rgb(78, 117, 2);float:left;">军事力量</span><span style="font-size:2px;color:rgb(48, 78, 64);float:left;">周边国家</span><span style="font-size:7px;color:rgb(100, 16, 84);float:left;">发展中国家</span><span style="font-size:4px;color:rgb(151, 81, 204);float:left;">综合国力</span><span style="font-size:2px;color:rgb(95, 192, 238);float:left;">求真务实</span><span style="font-size:1px;color:rgb(126, 135, 169);float:left;">批评和自</span><span style="font-size:2px;color:rgb(255, 150, 131);float:left;">社会效益</span><span style="font-size:4px;color:rgb(171, 103, 63);float:left;">民主监督</span><span style="font-size:4px;color:rgb(92, 1, 9);float:left;">马克思列</span><span style="font-size:1px;color:rgb(78, 200, 11);float:left;">安全事故</span><span style="font-size:7px;color:rgb(37, 245, 200);float:left;">事业单位</span><span style="font-size:2px;color:rgb(162, 42, 38);float:left;">建设工程</span><span style="font-size:19px;color:rgb(158, 54, 240);float:left;">改革开放</span><span style="font-size:1px;color:rgb(181, 31, 95);float:left;">土地增值</span><span style="font-size:3px;color:rgb(234, 78, 143);float:left;">解放思想</span><span style="font-size:4px;color:rgb(62, 227, 44);float:left;">产业结构</span><span style="font-size:1px;color:rgb(158, 182, 132);float:left;">违反纪律</span><span style="font-size:1px;color:rgb(28, 57, 207);float:left;">千辛万苦</span><span style="font-size:1px;color:rgb(109, 37, 106);float:left;">激励机制</span><span style="font-size:6px;color:rgb(96, 159, 75);float:left;">全面提高</span><span style="font-size:2px;color:rgb(166, 97, 32);float:left;">领导班子</span><span style="font-size:6px;color:rgb(98, 132, 71);float:left;">初级阶段</span><span style="font-size:1px;color:rgb(170, 79, 97);float:left;">出色完成</span><span style="font-size:1px;color:rgb(234, 160, 47);float:left;">自由贸易</span><span style="font-size:1px;color:rgb(131, 133, 12);float:left;">本质属性</span><span style="font-size:2px;color:rgb(175, 113, 223);float:left;">道德素质</span><span style="font-size:1px;color:rgb(97, 43, 104);float:left;">市场主体</span><span style="font-size:1px;color:rgb(224, 112, 123);float:left;">任人唯贤</span><span style="font-size:9px;color:rgb(108, 29, 191);float:left;">理论体系</span><span style="font-size:1px;color:rgb(41, 224, 12);float:left;">科学决策</span><span style="font-size:1px;color:rgb(173, 253, 198);float:left;">妇女儿童</span><span style="font-size:1px;color:rgb(43, 18, 88);float:left;">公立医院</span><span style="font-size:1px;color:rgb(172, 151, 206);float:left;">节能降耗</span><span style="font-size:1px;color:rgb(14, 201, 205);float:left;">人口老龄化</span><span style="font-size:1px;color:rgb(92, 163, 131);float:left;">贫困地区</span><span style="font-size:1px;color:rgb(82, 242, 6);float:left;">警钟长鸣</span><span style="font-size:1px;color:rgb(244, 249, 161);float:left;">坚定信心</span><span style="font-size:1px;color:rgb(89, 75, 68);float:left;">民主集中制</span><span style="font-size:3px;color:rgb(237, 64, 133);float:left;">创新能力</span><span style="font-size:1px;color:rgb(186, 239, 201);float:left;">日益增长</span><span style="font-size:2px;color:rgb(6, 95, 166);float:left;">时代特征</span><span style="font-size:7px;color:rgb(95, 46, 47);float:left;">经济体制</span><span style="font-size:2px;color:rgb(97, 124, 178);float:left;">国民经济</span><span style="font-size:1px;color:rgb(240, 92, 52);float:left;">气候变化</span><span style="font-size:3px;color:rgb(8, 245, 157);float:left;">教育引导</span><span style="font-size:1px;color:rgb(242, 39, 118);float:left;">成绩显著</span><span style="font-size:2px;color:rgb(205, 243, 202);float:left;">明显改善</span><span style="font-size:1px;color:rgb(233, 87, 146);float:left;">严惩不贷</span><span style="font-size:2px;color:rgb(187, 56, 23);float:left;">根本任务</span><span style="font-size:1px;color:rgb(238, 44, 124);float:left;">级计算机</span><span style="font-size:1px;color:rgb(62, 100, 15);float:left;">才尽其用</span><span style="font-size:7px;color:rgb(114, 213, 29);float:left;">党的建设</span><span style="font-size:1px;color:rgb(234, 145, 113);float:left;">法制建设</span><span style="font-size:5px;color:rgb(43, 79, 229);float:left;">党和人民</span><span style="font-size:4px;color:rgb(202, 59, 107);float:left;">基本国策</span><span style="font-size:5px;color:rgb(166, 198, 144);float:left;">基础设施</span><span style="font-size:1px;color:rgb(184, 71, 80);float:left;">严重困难</span><span style="font-size:2px;color:rgb(246, 133, 10);float:left;">预防为主</span><span style="font-size:1px;color:rgb(197, 120, 199);float:left;">基本原理</span><span style="font-size:3px;color:rgb(38, 41, 255);float:left;">养老保险</span><span style="font-size:1px;color:rgb(36, 62, 237);float:left;">面向世界</span><span style="font-size:1px;color:rgb(246, 16, 141);float:left;">国有经济</span><span style="font-size:1px;color:rgb(152, 159, 212);float:left;">政令畅通</span><span style="font-size:1px;color:rgb(187, 159, 102);float:left;">爱国卫生</span><span style="font-size:1px;color:rgb(51, 194, 58);float:left;">一律平等</span><span style="font-size:3px;color:rgb(4, 91, 162);float:left;">国际竞争</span><span style="font-size:2px;color:rgb(170, 25, 175);float:left;">社会保险</span><span style="font-size:1px;color:rgb(218, 135, 66);float:left;">自由贸易区</span><span style="font-size:1px;color:rgb(152, 241, 116);float:left;">腐败体系</span><span style="font-size:1px;color:rgb(152, 244, 146);float:left;">荣辱与共</span><span style="font-size:1px;color:rgb(244, 16, 96);float:left;">中型企业</span><span style="font-size:2px;color:rgb(60, 30, 151);float:left;">年轻干部</span><span style="font-size:1px;color:rgb(181, 44, 69);float:left;">互联互通</span><span style="font-size:1px;color:rgb(201, 170, 236);float:left;">五湖四海</span><span style="font-size:2px;color:rgb(155, 119, 144);float:left;">优秀人才</span><span style="font-size:4px;color:rgb(129, 215, 72);float:left;">伟大旗帜</span><span style="font-size:1px;color:rgb(129, 226, 157);float:left;">政策措施</span><span style="font-size:2px;color:rgb(71, 137, 154);float:left;">国家机关</span><span style="font-size:2px;color:rgb(213, 123, 57);float:left;">人人平等</span><span style="font-size:15px;color:rgb(193, 241, 84);float:left;">社会保障</span><span style="font-size:2px;color:rgb(139, 167, 98);float:left;">共同愿望</span><span style="font-size:2px;color:rgb(205, 25, 58);float:left;">始终不渝</span><span style="font-size:2px;color:rgb(102, 235, 72);float:left;">妥善处理</span><span style="font-size:5px;color:rgb(141, 108, 227);float:left;">深化改革</span><span style="font-size:3px;color:rgb(112, 208, 178);float:left;">综合治理</span><span style="font-size:3px;color:rgb(34, 117, 122);float:left;">祖国统一</span><span style="font-size:1px;color:rgb(136, 11, 236);float:left;">国际形势</span><span style="font-size:1px;color:rgb(255, 190, 201);float:left;">勇于创新</span><span style="font-size:1px;color:rgb(140, 94, 13);float:left;">现代农业</span><span style="font-size:1px;color:rgb(231, 6, 166);float:left;">勤俭节约</span><span style="font-size:3px;color:rgb(243, 208, 95);float:left;">民主党派</span><span style="font-size:1px;color:rgb(86, 216, 234);float:left;">统筹规划</span><span style="font-size:1px;color:rgb(128, 45, 220);float:left;">稳步前进</span><span style="font-size:6px;color:rgb(219, 226, 236);float:left;">价值体系</span><span style="font-size:1px;color:rgb(253, 158, 17);float:left;">群众意见</span><span style="font-size:2px;color:rgb(184, 172, 179);float:left;">中华文化</span><span style="font-size:1px;color:rgb(35, 185, 110);float:left;">长期实践</span><span style="font-size:1px;color:rgb(210, 4, 126);float:left;">集体主义</span><span style="font-size:1px;color:rgb(101, 97, 189);float:left;">山清水秀</span><span style="font-size:1px;color:rgb(161, 232, 236);float:left;">任务艰巨</span><span style="font-size:5px;color:rgb(16, 109, 20);float:left;">党的领导</span><span style="font-size:1px;color:rgb(107, 83, 218);float:left;">澳门特别行政区</span><span style="font-size:1px;color:rgb(44, 76, 4);float:left;">常住人口</span><span style="font-size:2px;color:rgb(174, 234, 4);float:left;">发展党员</span><span style="font-size:2px;color:rgb(106, 143, 69);float:left;">亿万人民</span><span style="font-size:1px;color:rgb(246, 221, 162);float:left;">团结互助</span><span style="font-size:2px;color:rgb(24, 34, 137);float:left;">人力资源</span><span style="font-size:1px;color:rgb(226, 83, 162);float:left;">矿产资源</span><span style="font-size:1px;color:rgb(237, 65, 141);float:left;">百花齐放</span><span style="font-size:1px;color:rgb(109, 136, 252);float:left;">引咎辞职</span><span style="font-size:7px;color:rgb(10, 151, 182);float:left;">中国共产党</span><span style="font-size:1px;color:rgb(176, 225, 161);float:left;">工作人员</span><span style="font-size:2px;color:rgb(205, 68, 63);float:left;">物质基础</span><span style="font-size:1px;color:rgb(190, 182, 8);float:left;">收入水平</span><span style="font-size:1px;color:rgb(217, 150, 126);float:left;">东北地区</span><span style="font-size:1px;color:rgb(115, 88, 160);float:left;">革命军人</span><span style="font-size:1px;color:rgb(41, 174, 93);float:left;">诉诸武力</span><span style="font-size:1px;color:rgb(89, 3, 249);float:left;">服务设施</span><span style="font-size:4px;color:rgb(167, 172, 160);float:left;">统一战线</span><span style="font-size:1px;color:rgb(44, 48, 166);float:left;">严格执法</span><span style="font-size:1px;color:rgb(124, 215, 165);float:left;">执法必严</span><span style="font-size:1px;color:rgb(100, 66, 21);float:left;">主要矛盾</span><span style="font-size:2px;color:rgb(145, 36, 39);float:left;">上层建筑</span><span style="font-size:4px;color:rgb(159, 135, 243);float:left;">分配制度</span><span style="font-size:1px;color:rgb(31, 55, 33);float:left;">优良传统</span><span style="font-size:1px;color:rgb(107, 255, 248);float:left;">结构调整</span><span style="font-size:2px;color:rgb(151, 83, 145);float:left;">全党同志</span><span style="font-size:1px;color:rgb(223, 26, 221);float:left;">退休干部</span><span style="font-size:1px;color:rgb(13, 34, 148);float:left;">政府职能</span><span style="font-size:1px;color:rgb(162, 165, 98);float:left;">百家争鸣</span><span style="font-size:1px;color:rgb(226, 186, 80);float:left;">波澜壮阔</span><span style="font-size:1px;color:rgb(211, 57, 73);float:left;">服务大局</span><span style="font-size:2px;color:rgb(131, 163, 116);float:left;">社会治安</span><span style="font-size:7px;color:rgb(208, 238, 160);float:left;">公平正义</span><span style="font-size:1px;color:rgb(87, 143, 21);float:left;">坚强有力</span><span style="font-size:1px;color:rgb(75, 123, 133);float:left;">不失时机</span><span style="font-size:2px;color:rgb(192, 64, 186);float:left;">坚持不懈</span><span style="font-size:3px;color:rgb(246, 129, 197);float:left;">公共卫生</span><span style="font-size:1px;color:rgb(113, 94, 159);float:left;">根本保证</span><span style="font-size:2px;color:rgb(37, 33, 51);float:left;">金融危机</span><span style="font-size:1px;color:rgb(112, 176, 86);float:left;">充分调动</span><span style="font-size:1px;color:rgb(39, 0, 239);float:left;">五项原则</span><span style="font-size:3px;color:rgb(194, 53, 86);float:left;">与时俱进</span><span style="font-size:3px;color:rgb(89, 78, 39);float:left;">非公有制</span><span style="font-size:2px;color:rgb(145, 22, 61);float:left;">食品药品</span><span style="font-size:1px;color:rgb(128, 188, 41);float:left;">党政领导</span><span style="font-size:3px;color:rgb(36, 254, 67);float:left;">面向未来</span><span style="font-size:1px;color:rgb(38, 37, 140);float:left;">高新技术</span><span style="font-size:2px;color:rgb(50, 174, 156);float:left;">民族团结</span><span style="font-size:6px;color:rgb(18, 24, 64);float:left;">民主制度</span><span style="font-size:1px;color:rgb(232, 55, 45);float:left;">素质教育</span><span style="font-size:2px;color:rgb(180, 39, 240);float:left;">繁荣富强</span><span style="font-size:1px;color:rgb(247, 172, 172);float:left;">恶化趋势</span><span style="font-size:19px;color:rgb(125, 39, 253);float:left;">小康社会</span><span style="font-size:2px;color:rgb(207, 49, 173);float:left;">义务教育</span><span style="font-size:1px;color:rgb(182, 37, 255);float:left;">以言代法</span><span style="font-size:1px;color:rgb(159, 187, 113);float:left;">争取和平</span><span style="font-size:1px;color:rgb(20, 70, 63);float:left;">社会福利</span><span style="font-size:1px;color:rgb(48, 172, 31);float:left;">技术创新</span><span style="font-size:1px;color:rgb(161, 222, 196);float:left;">常抓不懈</span><span style="font-size:1px;color:rgb(171, 51, 2);float:left;">经济总量</span><span style="font-size:1px;color:rgb(109, 72, 102);float:left;">和平时期</span><span style="font-size:1px;color:rgb(109, 40, 190);float:left;">服务水平</span><span style="font-size:1px;color:rgb(152, 183, 211);float:left;">扎扎实实</span><span style="font-size:1px;color:rgb(163, 33, 229);float:left;">前所未有</span><span style="font-size:1px;color:rgb(28, 192, 0);float:left;">下有对策</span><span style="font-size:1px;color:rgb(50, 95, 220);float:left;">优秀干部</span><span style="font-size:1px;color:rgb(160, 11, 62);float:left;">法定程序</span><span style="font-size:2px;color:rgb(235, 255, 35);float:left;">民主决策</span><span style="font-size:1px;color:rgb(4, 162, 152);float:left;">伟大胜利</span><span style="font-size:1px;color:rgb(122, 3, 141);float:left;">安居乐业</span><span style="font-size:1px;color:rgb(113, 151, 226);float:left;">各界人士</span><span style="font-size:1px;color:rgb(133, 108, 133);float:left;">公共财政</span><span style="font-size:2px;color:rgb(81, 158, 242);float:left;">共同奋斗</span><span style="font-size:1px;color:rgb(81, 111, 43);float:left;">空间结构</span><span style="font-size:1px;color:rgb(189, 5, 32);float:left;">纪检监察</span><span style="font-size:1px;color:rgb(36, 66, 122);float:left;">差额选举</span><span style="font-size:1px;color:rgb(167, 230, 14);float:left;">血脉相连</span><span style="font-size:1px;color:rgb(212, 154, 28);float:left;">城乡规划</span><span style="font-size:1px;color:rgb(124, 14, 187);float:left;">首创精神</span><span style="font-size:1px;color:rgb(102, 213, 245);float:left;">管理机制</span><span style="font-size:1px;color:rgb(37, 24, 13);float:left;">简政放权</span><span style="font-size:1px;color:rgb(2, 122, 181);float:left;">身心健康</span><span style="font-size:1px;color:rgb(87, 163, 74);float:left;">社会安定</span><span style="font-size:1px;color:rgb(208, 12, 227);float:left;">各尽所能</span><span style="font-size:1px;color:rgb(240, 182, 55);float:left;">家庭财产</span><span style="font-size:1px;color:rgb(178, 128, 236);float:left;">路线教育</span><span style="font-size:7px;color:rgb(11, 213, 160);float:left;">代表大会</span><span style="font-size:3px;color:rgb(175, 162, 49);float:left;">少数民族</span><span style="font-size:1px;color:rgb(249, 113, 82);float:left;">政权机关</span><span style="font-size:1px;color:rgb(144, 97, 56);float:left;">紧密结合</span><span style="font-size:1px;color:rgb(97, 228, 45);float:left;">人口素质</span><span style="font-size:1px;color:rgb(104, 228, 190);float:left;">热点问题</span><span style="font-size:1px;color:rgb(38, 251, 93);float:left;">一心一意</span><span style="font-size:1px;color:rgb(79, 247, 123);float:left;">违法犯罪</span><span style="font-size:2px;color:rgb(234, 94, 188);float:left;">大力发展</span><span style="font-size:6px;color:rgb(140, 0, 163);float:left;">贯彻落实</span><span style="font-size:2px;color:rgb(154, 94, 13);float:left;">人与自然</span><span style="font-size:1px;color:rgb(95, 200, 236);float:left;">十分艰巨</span><span style="font-size:1px;color:rgb(243, 121, 252);float:left;">教育资源</span><span style="font-size:1px;color:rgb(176, 66, 231);float:left;">感天动地</span><span style="font-size:1px;color:rgb(177, 47, 106);float:left;">水土流失</span><span style="font-size:1px;color:rgb(161, 37, 38);float:left;">谦虚谨慎</span><span style="font-size:1px;color:rgb(212, 243, 185);float:left;">信息技术</span><span style="font-size:2px;color:rgb(103, 223, 245);float:left;">形式主义</span><span style="font-size:11px;color:rgb(250, 89, 200);float:left;">公共服务</span><span style="font-size:1px;color:rgb(180, 53, 234);float:left;">海洋权益</span><span style="font-size:1px;color:rgb(240, 21, 150);float:left;">能源安全</span><span style="font-size:1px;color:rgb(58, 224, 168);float:left;">舆论监督</span><span style="font-size:1px;color:rgb(27, 64, 83);float:left;">集体经济</span><span style="font-size:1px;color:rgb(251, 186, 217);float:left;">意识形态</span><span style="font-size:1px;color:rgb(127, 57, 151);float:left;">考核办法</span><span style="font-size:2px;color:rgb(154, 230, 230);float:left;">决策程序</span><span style="font-size:2px;color:rgb(36, 46, 231);float:left;">正反两方</span><span style="font-size:1px;color:rgb(163, 179, 153);float:left;">时代精神</span><span style="font-size:1px;color:rgb(123, 79, 225);float:left;">内政外交</span><span style="font-size:2px;color:rgb(22, 41, 181);float:left;">廉政建设</span><span style="font-size:1px;color:rgb(30, 117, 60);float:left;">进一步提高</span><span style="font-size:2px;color:rgb(230, 122, 174);float:left;">严格执行</span><span style="font-size:1px;color:rgb(219, 153, 61);float:left;">武器装备</span><span style="font-size:3px;color:rgb(217, 66, 18);float:left;">历史使命</span><span style="font-size:1px;color:rgb(86, 186, 38);float:left;">经济命脉</span><span style="font-size:4px;color:rgb(48, 186, 26);float:left;">列宁主义</span><span style="font-size:2px;color:rgb(163, 189, 79);float:left;">总体布局</span><span style="font-size:1px;color:rgb(193, 196, 247);float:left;">子孙后代</span><span style="font-size:1px;color:rgb(65, 110, 63);float:left;">精神实质</span><span style="font-size:1px;color:rgb(119, 101, 239);float:left;">历史进程</span><span style="font-size:1px;color:rgb(35, 254, 168);float:left;">革命先烈</span><span style="font-size:1px;color:rgb(241, 177, 175);float:left;">社会变革</span><span style="font-size:1px;color:rgb(28, 58, 247);float:left;">和平解决</span><span style="font-size:2px;color:rgb(153, 54, 215);float:left;">创先争优</span><span style="font-size:1px;color:rgb(213, 109, 24);float:left;">积极支持</span><span style="font-size:1px;color:rgb(138, 49, 216);float:left;">再生能源</span><span style="font-size:1px;color:rgb(24, 26, 26);float:left;">从根本上</span><span style="font-size:2px;color:rgb(53, 179, 121);float:left;">自我教育</span><span style="font-size:1px;color:rgb(224, 106, 203);float:left;">教书育人</span><span style="font-size:1px;color:rgb(252, 226, 254);float:left;">坚定信念</span><span style="font-size:1px;color:rgb(103, 197, 126);float:left;">无党派人士</span><span style="font-size:3px;color:rgb(210, 197, 187);float:left;">人民代表</span><span style="font-size:1px;color:rgb(155, 107, 146);float:left;">品德教育</span><span style="font-size:2px;color:rgb(176, 25, 156);float:left;">优先发展</span><span style="font-size:1px;color:rgb(159, 87, 224);float:left;">劳动生产率</span><span style="font-size:1px;color:rgb(68, 146, 100);float:left;">规模经营</span><span style="font-size:5px;color:rgb(224, 216, 229);float:left;">以人为本</span><span style="font-size:1px;color:rgb(204, 63, 210);float:left;">领土完整</span><span style="font-size:4px;color:rgb(158, 138, 26);float:left;">基层组织</span><span style="font-size:1px;color:rgb(212, 59, 151);float:left;">立党为公</span><span style="font-size:1px;color:rgb(144, 127, 134);float:left;">自然灾害</span><span style="font-size:1px;color:rgb(70, 100, 101);float:left;">一如既往</span><span style="font-size:8px;color:rgb(189, 124, 17);float:left;">坚定不移</span><span style="font-size:1px;color:rgb(209, 97, 71);float:left;">改旗易帜</span><span style="font-size:3px;color:rgb(232, 98, 105);float:left;">国家主权</span><span style="font-size:1px;color:rgb(44, 118, 124);float:left;">领导职务</span><span style="font-size:1px;color:rgb(11, 76, 115);float:left;">加强监督</span><span style="font-size:1px;color:rgb(171, 232, 84);float:left;">公益事业</span><span style="font-size:1px;color:rgb(127, 211, 7);float:left;">医疗保险</span><span style="font-size:3px;color:rgb(61, 213, 150);float:left;">生产总值</span><span style="font-size:1px;color:rgb(220, 245, 52);float:left;">海外侨胞</span><span style="font-size:1px;color:rgb(213, 34, 42);float:left;">积极向上</span><span style="font-size:1px;color:rgb(197, 24, 100);float:left;">经营机制</span><span style="font-size:4px;color:rgb(174, 235, 39);float:left;">艰苦奋斗</span><span style="font-size:1px;color:rgb(205, 217, 75);float:left;">重中之重</span><span style="font-size:1px;color:rgb(78, 244, 169);float:left;">有用之才</span><span style="font-size:1px;color:rgb(237, 97, 228);float:left;">新闻出版</span><span style="font-size:1px;color:rgb(83, 220, 16);float:left;">民主评议</span><span style="font-size:1px;color:rgb(79, 120, 250);float:left;">不良风气</span><span style="font-size:1px;color:rgb(186, 220, 212);float:left;">社区卫生</span><span style="font-size:1px;color:rgb(201, 186, 148);float:left;">军事训练</span><span style="font-size:4px;color:rgb(215, 18, 96);float:left;">台湾同胞</span><span style="font-size:2px;color:rgb(122, 93, 89);float:left;">可持续性</span><span style="font-size:2px;color:rgb(60, 4, 210);float:left;">多种形式</span><span style="font-size:2px;color:rgb(180, 168, 192);float:left;">丰富多彩</span><span style="font-size:1px;color:rgb(206, 218, 150);float:left;">必然选择</span><span style="font-size:1px;color:rgb(96, 44, 193);float:left;">自然生态</span><span style="font-size:1px;color:rgb(44, 136, 187);float:left;">防御能力</span><span style="font-size:2px;color:rgb(145, 106, 173);float:left;">经济基础</span><span style="font-size:2px;color:rgb(227, 35, 196);float:left;">重大成就</span><span style="font-size:1px;color:rgb(255, 124, 80);float:left;">和睦相处</span><span style="font-size:1px;color:rgb(143, 138, 207);float:left;">人口比例</span><span style="font-size:1px;color:rgb(106, 204, 40);float:left;">民族特色</span><span style="font-size:3px;color:rgb(93, 212, 71);float:left;">努力实现</span><span style="font-size:1px;color:rgb(174, 130, 7);float:left;">科学研究</span><span style="font-size:1px;color:rgb(118, 1, 2);float:left;">全面实施</span><span style="font-size:1px;color:rgb(109, 195, 253);float:left;">正当权益</span><span style="font-size:1px;color:rgb(27, 142, 44);float:left;">组织生活</span><span style="font-size:1px;color:rgb(17, 51, 124);float:left;">十国集团</span><span style="font-size:1px;color:rgb(216, 116, 174);float:left;">承包经营</span><span style="font-size:2px;color:rgb(45, 116, 108);float:left;">国防建设</span><span style="font-size:1px;color:rgb(249, 57, 148);float:left;">合法收入</span><span style="font-size:4px;color:rgb(79, 28, 210);float:left;">文化产业</span><span style="font-size:4px;color:rgb(16, 61, 150);float:left;">明显提高</span><span style="font-size:1px;color:rgb(60, 111, 105);float:left;">武装警察</span><span style="font-size:2px;color:rgb(213, 96, 253);float:left;">知识分子</span><span style="font-size:1px;color:rgb(108, 168, 111);float:left;">相信群众</span><span style="font-size:1px;color:rgb(147, 237, 142);float:left;">扶贫开发</span><span style="font-size:1px;color:rgb(118, 104, 91);float:left;">社会阶层</span><span style="font-size:1px;color:rgb(132, 141, 220);float:left;">妥善解决</span><span style="font-size:1px;color:rgb(134, 106, 97);float:left;">自我批评</span><span style="font-size:1px;color:rgb(170, 250, 230);float:left;">金融体系</span><span style="font-size:1px;color:rgb(127, 99, 85);float:left;">不断丰富</span><span style="font-size:1px;color:rgb(140, 225, 66);float:left;">取长补短</span><span style="font-size:1px;color:rgb(199, 220, 176);float:left;">劳动所得</span><span style="font-size:1px;color:rgb(14, 106, 109);float:left;">全国代表大会</span><span style="font-size:1px;color:rgb(164, 131, 15);float:left;">一府两院</span><span style="font-size:1px;color:rgb(138, 247, 214);float:left;">脱离群众</span><span style="font-size:1px;color:rgb(243, 53, 135);float:left;">分配比例</span><span style="font-size:1px;color:rgb(253, 207, 104);float:left;">提高质量</span><span style="font-size:1px;color:rgb(67, 65, 126);float:left;">工作力度</span><span style="font-size:1px;color:rgb(13, 22, 92);float:left;">惩治腐败</span><span style="font-size:1px;color:rgb(13, 175, 188);float:left;">美好世界</span><span style="font-size:5px;color:rgb(176, 169, 36);float:left;">始终保持</span><span style="font-size:1px;color:rgb(174, 180, 66);float:left;">工人阶级</span><span style="font-size:3px;color:rgb(27, 210, 124);float:left;">城乡居民</span><span style="font-size:1px;color:rgb(125, 98, 179);float:left;">高度一致</span><span style="font-size:1px;color:rgb(39, 103, 155);float:left;">社会公德</span><span style="font-size:1px;color:rgb(180, 221, 244);float:left;">技术产业</span><span style="font-size:1px;color:rgb(172, 135, 194);float:left;">金融监管</span><span style="font-size:2px;color:rgb(23, 181, 140);float:left;">政治文明</span><span style="font-size:1px;color:rgb(43, 129, 88);float:left;">国际争端</span><span style="font-size:1px;color:rgb(29, 245, 247);float:left;">党纪国法</span><span style="font-size:1px;color:rgb(24, 17, 130);float:left;">遵守纪律</span><span style="font-size:3px;color:rgb(154, 223, 234);float:left;">宏观调控</span><span style="font-size:1px;color:rgb(221, 113, 124);float:left;">产权保护</span><span style="font-size:2px;color:rgb(209, 147, 119);float:left;">组成部分</span><span style="font-size:8px;color:rgb(14, 238, 136);float:left;">深入开展</span><span style="font-size:2px;color:rgb(239, 215, 92);float:left;">生态效益</span><span style="font-size:1px;color:rgb(61, 53, 122);float:left;">广大青年</span><span style="font-size:1px;color:rgb(95, 26, 246);float:left;">老有所养</span><span style="font-size:1px;color:rgb(32, 187, 116);float:left;">戒骄戒躁</span><span style="font-size:1px;color:rgb(75, 176, 55);float:left;">弱肉强食</span><span style="font-size:2px;color:rgb(100, 202, 224);float:left;">团结合作</span><span style="font-size:1px;color:rgb(101, 27, 26);float:left;">超级计算机</span><span style="font-size:1px;color:rgb(88, 0, 78);float:left;">消化吸收</span><span style="font-size:1px;color:rgb(53, 39, 148);float:left;">和衷共济</span><span style="font-size:1px;color:rgb(201, 237, 9);float:left;">行政长官</span><span style="font-size:1px;color:rgb(207, 67, 219);float:left;">有利条件</span><span style="font-size:1px;color:rgb(107, 125, 228);float:left;">兢兢业业</span><span style="font-size:1px;color:rgb(159, 133, 63);float:left;">精神力量</span><span style="font-size:1px;color:rgb(98, 1, 203);float:left;">攻坚克难</span><span style="font-size:1px;color:rgb(254, 253, 91);float:left;">在思想上</span><span style="font-size:2px;color:rgb(112, 229, 50);float:left;">长治久安</span><span style="font-size:1px;color:rgb(6, 181, 160);float:left;">人人有责</span><span style="font-size:1px;color:rgb(53, 196, 163);float:left;">文化交流</span><span style="font-size:1px;color:rgb(175, 70, 126);float:left;">职业道德</span><span style="font-size:1px;color:rgb(69, 12, 235);float:left;">同心同德</span><span style="font-size:4px;color:rgb(1, 123, 87);float:left;">对外开放</span><span style="font-size:2px;color:rgb(202, 67, 1);float:left;">国民收入</span><span style="font-size:1px;color:rgb(214, 1, 135);float:left;">关键在于</span><span style="font-size:1px;color:rgb(230, 49, 82);float:left;">加以解决</span><span style="font-size:1px;color:rgb(191, 85, 149);float:left;">教育方针</span><span style="font-size:1px;color:rgb(106, 242, 129);float:left;">国有资本</span><span style="font-size:1px;color:rgb(80, 169, 108);float:left;">不断加强</span><span style="font-size:2px;color:rgb(137, 80, 240);float:left;">宏观经济</span><span style="font-size:2px;color:rgb(202, 85, 58);float:left;">不可逆转</span><span style="font-size:1px;color:rgb(220, 158, 227);float:left;">审判机关</span><span style="font-size:1px;color:rgb(20, 65, 0);float:left;">生命财产</span><span style="font-size:1px;color:rgb(225, 251, 62);float:left;">万众一心</span><span style="font-size:1px;color:rgb(32, 143, 226);float:left;">千方百计</span><span style="font-size:1px;color:rgb(67, 235, 82);float:left;">生产关系</span><span style="font-size:3px;color:rgb(81, 58, 193);float:left;">广泛开展</span><span style="font-size:3px;color:rgb(164, 102, 37);float:left;">干部队伍</span><span style="font-size:1px;color:rgb(254, 38, 29);float:left;">矢志不渝</span><span style="font-size:2px;color:rgb(70, 159, 90);float:left;">国有企业</span><span style="font-size:1px;color:rgb(53, 68, 147);float:left;">内忧外患</span><span style="font-size:2px;color:rgb(115, 244, 36);float:left;">公民道德</span><span style="font-size:1px;color:rgb(29, 14, 226);float:left;">高度自治权</span><span style="font-size:1px;color:rgb(92, 150, 36);float:left;">面向基层</span><span style="font-size:1px;color:rgb(35, 42, 17);float:left;">友好往来</span><span style="font-size:5px;color:rgb(134, 179, 123);float:left;">合法权益</span><span style="font-size:1px;color:rgb(252, 158, 255);float:left;">功能定位</span><span style="font-size:1px;color:rgb(68, 2, 135);float:left;">没有特权</span><span style="font-size:1px;color:rgb(129, 250, 126);float:left;">战略方针</span><span style="font-size:1px;color:rgb(202, 125, 198);float:left;">网络空间</span><span style="font-size:1px;color:rgb(246, 255, 149);float:left;">能进能出</span><span style="font-size:1px;color:rgb(204, 150, 100);float:left;">人民调解</span><span style="font-size:162px;color:rgb(89, 79, 216);float:left;">社会主义</span><span style="font-size:2px;color:rgb(132, 50, 104);float:left;">伟大工程</span><span style="font-size:1px;color:rgb(223, 66, 202);float:left;">议事规则</span><span style="font-size:1px;color:rgb(62, 85, 161);float:left;">外交政策</span><span style="font-size:4px;color:rgb(48, 149, 193);float:left;">三个代表</span><span style="font-size:3px;color:rgb(22, 175, 184);float:left;">人才培养</span><span style="font-size:6px;color:rgb(111, 54, 63);float:left;">居民收入</span><span style="font-size:1px;color:rgb(82, 214, 20);float:left;">伟大事业</span><span style="font-size:3px;color:rgb(247, 65, 41);float:left;">集中统一</span><span style="font-size:2px;color:rgb(74, 169, 233);float:left;">中央政府</span><span style="font-size:2px;color:rgb(40, 164, 160);float:left;">军事战略</span><span style="font-size:2px;color:rgb(11, 247, 28);float:left;">科技进步</span><span style="font-size:1px;color:rgb(230, 72, 123);float:left;">新民主主义</span><span style="font-size:1px;color:rgb(124, 133, 62);float:left;">埋头苦干</span><span style="font-size:1px;color:rgb(6, 16, 41);float:left;">德才兼备</span><span style="font-size:1px;color:rgb(194, 21, 149);float:left;">特殊教育</span><span style="font-size:1px;color:rgb(39, 138, 13);float:left;">产品质量</span><span style="font-size:1px;color:rgb(15, 175, 227);float:left;">居安思危</span><span style="font-size:4px;color:rgb(181, 92, 114);float:left;">马克思列宁主义</span><span style="font-size:2px;color:rgb(6, 23, 45);float:left;">民主协商</span><span style="font-size:2px;color:rgb(24, 190, 70);float:left;">精神文明</span><span style="font-size:1px;color:rgb(6, 21, 144);float:left;">福利制度</span><span style="font-size:1px;color:rgb(243, 21, 189);float:left;">正确方向</span><span style="font-size:1px;color:rgb(184, 25, 63);float:left;">步调一致</span><span style="font-size:1px;color:rgb(208, 216, 105);float:left;">爱国人士</span><span style="font-size:1px;color:rgb(242, 143, 193);float:left;">信息系统</span><span style="font-size:1px;color:rgb(39, 194, 50);float:left;">徇私枉法</span><span style="font-size:3px;color:rgb(19, 168, 161);float:left;">绝不允许</span><span style="font-size:2px;color:rgb(32, 95, 89);float:left;">长效机制</span><span style="font-size:1px;color:rgb(57, 144, 68);float:left;">低收入者</span><span style="font-size:1px;color:rgb(144, 17, 66);float:left;">充满希望</span><span style="font-size:1px;color:rgb(121, 65, 95);float:left;">港人治港</span><span style="font-size:1px;color:rgb(16, 209, 87);float:left;">特殊人群</span><span style="font-size:3px;color:rgb(199, 254, 246);float:left;">正确处理</span><span style="font-size:1px;color:rgb(36, 37, 73);float:left;">慈善事业</span><span style="font-size:1px;color:rgb(58, 173, 4);float:left;">北京奥运</span><span style="font-size:1px;color:rgb(51, 220, 156);float:left;">工资制度</span><span style="font-size:1px;color:rgb(80, 84, 0);float:left;">发达国家</span><span style="font-size:1px;color:rgb(95, 231, 95);float:left;">参政议政</span><span style="font-size:4px;color:rgb(44, 162, 217);float:left;">党的基本</span><span style="font-size:1px;color:rgb(203, 166, 136);float:left;">民主选举</span><span style="font-size:1px;color:rgb(57, 86, 130);float:left;">妄自尊大</span><span style="font-size:1px;color:rgb(184, 169, 216);float:left;">积极主动</span><span style="font-size:2px;color:rgb(231, 56, 160);float:left;">政治立场</span><span style="font-size:2px;color:rgb(21, 29, 10);float:left;">全面落实</span><span style="font-size:3px;color:rgb(123, 11, 130);float:left;">方针政策</span><span style="font-size:1px;color:rgb(204, 120, 125);float:left;">市场规律</span><span style="font-size:1px;color:rgb(172, 218, 33);float:left;">严峻形势</span><span style="font-size:4px;color:rgb(47, 215, 33);float:left;">毫不动摇</span><span style="font-size:1px;color:rgb(104, 47, 133);float:left;">经济效益</span><span style="font-size:4px;color:rgb(85, 158, 229);float:left;">节约资源</span><span style="font-size:1px;color:rgb(236, 80, 64);float:left;">科学知识</span><span style="font-size:1px;color:rgb(238, 61, 102);float:left;">尊重人才</span><span style="font-size:1px;color:rgb(243, 6, 56);float:left;">突出位置</span><span style="font-size:1px;color:rgb(145, 137, 98);float:left;">群众利益</span><span style="font-size:1px;color:rgb(81, 34, 61);float:left;">和平共处</span><span style="font-size:3px;color:rgb(234, 184, 79);float:left;">人民团体</span><span style="font-size:1px;color:rgb(170, 92, 87);float:left;">认真总结</span><span style="font-size:1px;color:rgb(125, 199, 186);float:left;">环境污染</span><span style="font-size:1px;color:rgb(224, 185, 137);float:left;">力量对比</span><span style="font-size:2px;color:rgb(217, 246, 81);float:left;">路线方针</span><span style="font-size:1px;color:rgb(33, 228, 38);float:left;">中共中央</span><span style="font-size:1px;color:rgb(195, 39, 33);float:left;">统筹兼顾</span><span style="font-size:1px;color:rgb(1, 19, 231);float:left;">法制宣传</span><span style="font-size:8px;color:rgb(251, 51, 202);float:left;">马克思主义</span><span style="font-size:2px;color:rgb(101, 166, 64);float:left;">霸权主义</span><span style="font-size:1px;color:rgb(134, 82, 175);float:left;">新民主主义革命</span><span style="font-size:1px;color:rgb(71, 19, 63);float:left;">有令不行</span><span style="font-size:1px;color:rgb(193, 123, 72);float:left;">有禁不止</span><span style="font-size:1px;color:rgb(3, 4, 25);float:left;">地方党委</span><span style="font-size:2px;color:rgb(73, 218, 144);float:left;">基本纲领</span><span style="font-size:1px;color:rgb(66, 157, 162);float:left;">后备力量</span><span style="font-size:1px;color:rgb(105, 214, 175);float:left;">安全监管</span><span style="font-size:1px;color:rgb(167, 186, 236);float:left;">正确认识</span><span style="font-size:1px;color:rgb(68, 5, 169);float:left;">集中精力</span><span style="font-size:1px;color:rgb(87, 129, 216);float:left;">新民主主</span><span style="font-size:1px;color:rgb(163, 229, 33);float:left;">党和政府</span><span style="font-size:2px;color:rgb(131, 100, 237);float:left;">选拔干部</span><span style="font-size:1px;color:rgb(104, 79, 142);float:left;">公正司法</span><span style="font-size:1px;color:rgb(36, 105, 30);float:left;">文学艺术</span><span style="font-size:1px;color:rgb(236, 138, 75);float:left;">管理体系</span><span style="font-size:1px;color:rgb(137, 193, 253);float:left;">自我表现</span><span style="font-size:1px;color:rgb(104, 147, 11);float:left;">全心全意</span><span style="font-size:4px;color:rgb(95, 127, 41);float:left;">邓小平理论</span><span style="font-size:4px;color:rgb(200, 175, 216);float:left;">一国两制</span><span style="font-size:1px;color:rgb(255, 148, 207);float:left;">环境友好</span><span style="font-size:1px;color:rgb(126, 209, 156);float:left;">当今世界</span><span style="font-size:1px;color:rgb(112, 11, 61);float:left;">第十七届</span><span style="font-size:1px;color:rgb(227, 196, 69);float:left;">合理配置</span><span style="font-size:1px;color:rgb(167, 218, 210);float:left;">收益分配</span><span style="font-size:3px;color:rgb(109, 129, 74);float:left;">奋发有为</span><span style="font-size:7px;color:rgb(5, 244, 78);float:left;">管理体制</span><span style="font-size:1px;color:rgb(106, 54, 66);float:left;">集中体现</span><span style="font-size:3px;color:rgb(139, 87, 10);float:left;">领导核心</span><span style="font-size:1px;color:rgb(176, 236, 171);float:left;">大是大非</span><span style="font-size:2px;color:rgb(172, 78, 1);float:left;">管理制度</span><span style="font-size:1px;color:rgb(2, 116, 129);float:left;">民间团体</span><span style="font-size:1px;color:rgb(40, 35, 105);float:left;">退役军人</span><span style="font-size:2px;color:rgb(24, 223, 251);float:left;">社会科学</span><span style="font-size:1px;color:rgb(155, 243, 93);float:left;">化解矛盾</span><span style="font-size:1px;color:rgb(193, 236, 245);float:left;">生活空间</span><span style="font-size:3px;color:rgb(56, 111, 42);float:left;">国际事务</span><span style="font-size:1px;color:rgb(248, 181, 106);float:left;">调整机制</span><span style="font-size:4px;color:rgb(123, 83, 218);float:left;">当家作主</span><span style="font-size:1px;color:rgb(222, 144, 51);float:left;">贴近生活</span><span style="font-size:10px;color:rgb(242, 21, 223);float:left;">服务体系</span><span style="font-size:1px;color:rgb(183, 126, 39);float:left;">积贫积弱</span><span style="font-size:1px;color:rgb(28, 158, 140);float:left;">军民团结</span><span style="font-size:1px;color:rgb(57, 35, 133);float:left;">人民军队</span><span style="font-size:1px;color:rgb(134, 7, 175);float:left;">信息网络</span><span style="font-size:2px;color:rgb(1, 39, 92);float:left;">五位一体</span><span style="font-size:1px;color:rgb(18, 11, 204);float:left;">病有所医</span><span style="font-size:1px;color:rgb(191, 116, 193);float:left;">战略规划</span><span style="font-size:1px;color:rgb(141, 237, 228);float:left;">中央委员会</span><span style="font-size:3px;color:rgb(100, 213, 120);float:left;">生产能力</span><span style="font-size:4px;color:rgb(17, 49, 212);float:left;">和谐社会</span><span style="font-size:3px;color:rgb(185, 22, 228);float:left;">根本利益</span><span style="font-size:1px;color:rgb(115, 123, 20);float:left;">衣食住行</span><span style="font-size:1px;color:rgb(55, 234, 156);float:left;">商业模式</span><span style="font-size:1px;color:rgb(29, 245, 10);float:left;">清醒认识</span><span style="font-size:1px;color:rgb(221, 104, 196);float:left;">实事求是</span><span style="font-size:1px;color:rgb(39, 36, 215);float:left;">男女平等</span><span style="font-size:1px;color:rgb(98, 27, 226);float:left;">能源消耗</span><span style="font-size:1px;color:rgb(238, 127, 3);float:left;">科学合理</span><span style="font-size:1px;color:rgb(203, 49, 134);float:left;">按劳分配</span><span style="font-size:3px;color:rgb(69, 104, 211);float:left;">依靠人民</span><span style="font-size:3px;color:rgb(59, 60, 91);float:left;">切身利益</span><span style="font-size:1px;color:rgb(166, 160, 67);float:left;">紧紧抓住</span><span style="font-size:1px;color:rgb(69, 50, 3);float:left;">共同努力</span><span style="font-size:1px;color:rgb(209, 243, 96);float:left;">违法必究</span><span style="font-size:2px;color:rgb(8, 236, 62);float:left;">整体实力</span><span style="font-size:1px;color:rgb(153, 166, 155);float:left;">中央委员</span><span style="font-size:1px;color:rgb(13, 253, 2);float:left;">水利建设</span><span style="font-size:3px;color:rgb(241, 18, 33);float:left;">生态系统</span><span style="font-size:1px;color:rgb(232, 114, 222);float:left;">优化结构</span><span style="font-size:1px;color:rgb(83, 233, 28);float:left;">相互交织</span><span style="font-size:1px;color:rgb(30, 190, 239);float:left;">实际行动</span><span style="font-size:1px;color:rgb(209, 1, 193);float:left;">总揽全局</span><span style="font-size:1px;color:rgb(165, 73, 202);float:left;">税收制度</span><span style="font-size:1px;color:rgb(107, 197, 222);float:left;">提高素质</span><span style="font-size:3px;color:rgb(0, 53, 213);float:left;">人事制度</span><span style="font-size:1px;color:rgb(149, 2, 206);float:left;">市场竞争</span><span style="font-size:1px;color:rgb(91, 172, 120);float:left;">明确提出</span><span style="font-size:2px;color:rgb(247, 215, 7);float:left;">积极开展</span><span style="font-size:1px;color:rgb(179, 42, 196);float:left;">决不允许</span><span style="font-size:5px;color:rgb(0, 44, 68);float:left;">依法治国</span><span style="font-size:1px;color:rgb(93, 235, 98);float:left;">干涉主义</span><span style="font-size:1px;color:rgb(183, 87, 134);float:left;">共同理想</span><span style="font-size:1px;color:rgb(111, 245, 24);float:left;">敌对势力</span><span style="font-size:1px;color:rgb(208, 224, 25);float:left;">非法收入</span><span style="font-size:3px;color:rgb(107, 106, 178);float:left;">中华儿女</span><span style="font-size:1px;color:rgb(245, 213, 80);float:left;">局部战争</span><span style="font-size:2px;color:rgb(172, 234, 57);float:left;">干部人事</span><span style="font-size:1px;color:rgb(214, 60, 8);float:left;">奢侈浪费</span><span style="font-size:1px;color:rgb(209, 64, 13);float:left;">突发事件</span><span style="font-size:10px;color:rgb(172, 49, 93);float:left;">经济社会</span><span style="font-size:1px;color:rgb(240, 12, 216);float:left;">组织体制</span><span style="font-size:7px;color:rgb(133, 246, 132);float:left;">保障体系</span><span style="font-size:1px;color:rgb(255, 54, 218);float:left;">切实有效</span><span style="font-size:1px;color:rgb(227, 28, 150);float:left;">行政区划</span><span style="font-size:1px;color:rgb(60, 163, 86);float:left;">奋勇前进</span><span style="font-size:1px;color:rgb(247, 252, 135);float:left;">伙伴关系</span><span style="font-size:1px;color:rgb(247, 126, 72);float:left;">流动人口</span><span style="font-size:1px;color:rgb(82, 74, 209);float:left;">国防科技</span><span style="font-size:1px;color:rgb(233, 236, 87);float:left;">开发利用</span><span style="font-size:1px;color:rgb(17, 238, 34);float:left;">公共事务</span><span style="font-size:1px;color:rgb(38, 117, 245);float:left;">外部环境</span><span style="font-size:1px;color:rgb(3, 112, 135);float:left;">职工代表</span><span style="font-size:19px;color:rgb(47, 51, 161);float:left;">中华民族</span><span style="font-size:2px;color:rgb(202, 160, 95);float:left;">坚实基础</span><span style="font-size:1px;color:rgb(68, 46, 126);float:left;">清正廉洁</span><span style="font-size:2px;color:rgb(145, 240, 120);float:left;">保障制度</span><span style="font-size:1px;color:rgb(64, 232, 242);float:left;">前进方向</span><span style="font-size:4px;color:rgb(66, 168, 109);float:left;">反腐倡廉</span><span style="font-size:1px;color:rgb(65, 34, 5);float:left;">充分证明</span><span style="font-size:1px;color:rgb(63, 173, 53);float:left;">人均收入</span><span style="font-size:1px;color:rgb(221, 175, 223);float:left;">经验教训</span><span style="font-size:1px;color:rgb(40, 82, 115);float:left;">根本途径</span><span style="font-size:1px;color:rgb(209, 14, 15);float:left;">不败之地</span><span style="font-size:1px;color:rgb(93, 65, 132);float:left;">依靠群众</span><span style="font-size:1px;color:rgb(89, 254, 117);float:left;">现实意义</span><span style="font-size:2px;color:rgb(97, 161, 188);float:left;">积极参与</span><span style="font-size:4px;color:rgb(166, 201, 199);float:left;">共同利益</span><span style="font-size:1px;color:rgb(102, 67, 30);float:left;">杰出贡献</span><span style="font-size:1px;color:rgb(237, 158, 244);float:left;">上有政策</span><span style="font-size:1px;color:rgb(253, 96, 106);float:left;">民主集中</span><span style="font-size:1px;color:rgb(240, 249, 188);float:left;">互相监督</span><span style="font-size:1px;color:rgb(231, 206, 203);float:left;">群众路线</span><span style="font-size:1px;color:rgb(173, 184, 179);float:left;">职业技能</span><span style="font-size:1px;color:rgb(126, 111, 222);float:left;">共产主义</span><span style="font-size:6px;color:rgb(112, 208, 229);float:left;">和平统一</span><span style="font-size:4px;color:rgb(154, 250, 182);float:left;">新形势下</span><span style="font-size:3px;color:rgb(114, 95, 114);float:left;">九十多年</span><span style="font-size:2px;color:rgb(223, 24, 179);float:left;">十分复杂</span><span style="font-size:6px;color:rgb(94, 24, 251);float:left;">党和国家</span><span style="font-size:1px;color:rgb(24, 145, 166);float:left;">是非曲直</span><span style="font-size:1px;color:rgb(183, 198, 248);float:left;">关键环节</span><span style="font-size:2px;color:rgb(230, 70, 242);float:left;">统一大业</span><span style="font-size:1px;color:rgb(96, 26, 155);float:left;">产品价格</span><span style="font-size:1px;color:rgb(123, 155, 217);float:left;">仁人志士</span><span style="font-size:1px;color:rgb(31, 178, 23);float:left;">精神家园</span><span style="font-size:3px;color:rgb(143, 165, 122);float:left;">领导集体</span><span style="font-size:1px;color:rgb(121, 239, 167);float:left;">突如其来</span><span style="font-size:2px;color:rgb(110, 55, 168);float:left;">新兴产业</span><span style="font-size:6px;color:rgb(253, 52, 167);float:left;">重大进展</span><span style="font-size:2px;color:rgb(71, 209, 14);float:left;">自我完善</span><span style="font-size:1px;color:rgb(105, 154, 210);float:left;">犯罪活动</span><span style="font-size:1px;color:rgb(179, 108, 9);float:left;">一以贯之</span><span style="font-size:1px;color:rgb(237, 187, 167);float:left;">风云变幻</span><span style="font-size:1px;color:rgb(76, 224, 244);float:left;">勇于进取</span><span style="font-size:1px;color:rgb(122, 122, 8);float:left;">全面实现</span><span style="font-size:1px;color:rgb(231, 148, 7);float:left;">资源节约型</span><span style="font-size:1px;color:rgb(185, 105, 152);float:left;">忧患意识</span><span style="font-size:1px;color:rgb(94, 152, 142);float:left;">高速铁路</span><span style="font-size:1px;color:rgb(0, 144, 213);float:left;">信息安全</span><span style="font-size:1px;color:rgb(131, 88, 74);float:left;">内部矛盾</span><span style="font-size:1px;color:rgb(104, 151, 62);float:left;">青年工人</span><span style="font-size:1px;color:rgb(55, 35, 242);float:left;">户籍制度</span><span style="font-size:1px;color:rgb(217, 37, 174);float:left;">深入人心</span><span style="font-size:1px;color:rgb(31, 113, 103);float:left;">逐步完善</span><span style="font-size:2px;color:rgb(156, 109, 162);float:left;">广大党员</span><span style="font-size:1px;color:rgb(248, 216, 252);float:left;">问政于民</span><span style="font-size:1px;color:rgb(226, 185, 45);float:left;">二氧化碳</span><span style="font-size:6px;color:rgb(186, 247, 83);float:left;">政治体制</span><span style="font-size:1px;color:rgb(151, 209, 81);float:left;">社会风尚</span><span style="font-size:1px;color:rgb(220, 205, 8);float:left;">五千多年</span><span style="font-size:1px;color:rgb(57, 125, 245);float:left;">传统产业</span><span style="font-size:1px;color:rgb(249, 142, 248);float:left;">三十多年</span><span style="font-size:1px;color:rgb(88, 6, 193);float:left;">廉政文化</span><span style="font-size:1px;color:rgb(253, 251, 123);float:left;">模范作用</span><span style="font-size:1px;color:rgb(185, 206, 24);float:left;">民主主义</span><span style="font-size:1px;color:rgb(142, 244, 202);float:left;">有法必依</span><span style="font-size:1px;color:rgb(209, 191, 193);float:left;">自我管理</span><span style="font-size:1px;color:rgb(63, 181, 1);float:left;">损害赔偿</span><span style="font-size:1px;color:rgb(38, 192, 229);float:left;">幸福美好</span><span style="font-size:1px;color:rgb(170, 179, 144);float:left;">坚决贯彻</span><span style="font-size:1px;color:rgb(43, 25, 13);float:left;">时代特色</span><span style="font-size:2px;color:rgb(221, 18, 133);float:left;">国际金融</span><span style="font-size:1px;color:rgb(3, 234, 162);float:left;">严格控制</span><span style="font-size:2px;color:rgb(229, 107, 83);float:left;">自觉遵守</span><span style="font-size:1px;color:rgb(78, 136, 222);float:left;">文明执法</span><span style="font-size:1px;color:rgb(34, 130, 31);float:left;">建言献策</span><span style="font-size:1px;color:rgb(201, 92, 48);float:left;">财政收入</span><span style="font-size:1px;color:rgb(3, 196, 0);float:left;">基本保障</span><span style="font-size:2px;color:rgb(177, 158, 119);float:left;">拒腐防变</span><span style="font-size:3px;color:rgb(69, 244, 249);float:left;">永无止境</span><span style="font-size:2px;color:rgb(143, 55, 7);float:left;">宣传教育</span><span style="font-size:1px;color:rgb(152, 160, 154);float:left;">健康成长</span><span style="font-size:4px;color:rgb(25, 220, 74);float:left;">民主权利</span><span style="font-size:1px;color:rgb(225, 171, 22);float:left;">卫生事件</span><span style="font-size:1px;color:rgb(184, 183, 216);float:left;">聚精会神</span><span style="font-size:1px;color:rgb(203, 255, 40);float:left;">党政干部</span><span style="font-size:1px;color:rgb(158, 31, 225);float:left;">计划生育</span><span style="font-size:1px;color:rgb(174, 154, 150);float:left;">重大胜利</span><span style="font-size:1px;color:rgb(46, 187, 125);float:left;">长期共存</span><span style="font-size:1px;color:rgb(83, 112, 8);float:left;">生活富裕</span><span style="font-size:1px;color:rgb(185, 27, 36);float:left;">循序渐进</span><span style="font-size:1px;color:rgb(32, 54, 251);float:left;">求同存异</span><span style="font-size:9px;color:rgb(154, 187, 62);float:left;">主义理论</span><span style="font-size:1px;color:rgb(253, 236, 178);float:left;">分配机制</span><span style="font-size:1px;color:rgb(86, 12, 164);float:left;">增强党性</span><span style="font-size:3px;color:rgb(178, 8, 218);float:left;">成效显著</span><span style="font-size:2px;color:rgb(66, 233, 218);float:left;">粮食安全</span><span style="font-size:1px;color:rgb(42, 155, 112);float:left;">民主法制</span><span style="font-size:1px;color:rgb(214, 24, 22);float:left;">立于不败</span><span style="font-size:1px;color:rgb(249, 251, 8);float:left;">软弱涣散</span><span style="font-size:1px;color:rgb(234, 219, 200);float:left;">大案要案</span><span style="font-size:2px;color:rgb(199, 169, 114);float:left;">优势互补</span><span style="font-size:1px;color:rgb(209, 19, 253);float:left;">教育领域</span><span style="font-size:1px;color:rgb(105, 58, 49);float:left;">保护主义</span><span style="font-size:1px;color:rgb(167, 190, 30);float:left;">民族之林</span><span style="font-size:2px;color:rgb(188, 45, 192);float:left;">基本国情</span><span style="font-size:1px;color:rgb(219, 202, 72);float:left;">奋发进取</span><span style="font-size:1px;color:rgb(19, 15, 229);float:left;">世界贸易组织</span><span style="font-size:1px;color:rgb(216, 163, 241);float:left;">肝胆相照</span><span style="font-size:2px;color:rgb(47, 75, 129);float:left;">多党合作</span><span style="font-size:4px;color:rgb(127, 134, 91);float:left;">毛泽东思想</span><span style="font-size:2px;color:rgb(24, 214, 50);float:left;">行使权力</span><span style="font-size:1px;color:rgb(217, 0, 197);float:left;">前沿技术</span><span style="font-size:1px;color:rgb(103, 141, 83);float:left;">不懈努力</span><span style="font-size:1px;color:rgb(229, 169, 100);float:left;">海洋资源</span><span style="font-size:1px;color:rgb(17, 113, 93);float:left;">投机钻营者</span><span style="font-size:2px;color:rgb(218, 54, 0);float:left;">知识产权</span><span style="font-size:1px;color:rgb(7, 82, 119);float:left;">友好合作</span><span style="font-size:1px;color:rgb(17, 104, 187);float:left;">人才资源</span><span style="font-size:1px;color:rgb(22, 18, 181);float:left;">顽强拼搏</span><span style="font-size:1px;color:rgb(126, 183, 110);float:left;">人类文明</span><span style="font-size:1px;color:rgb(183, 52, 232);float:left;">利益冲突</span><span style="font-size:1px;color:rgb(25, 27, 81);float:left;">物质文明</span><span style="font-size:1px;color:rgb(118, 161, 116);float:left;">科学规范</span><span style="font-size:1px;color:rgb(59, 63, 54);float:left;">良好环境</span><span style="font-size:1px;color:rgb(28, 55, 71);float:left;">社区服务</span><span style="font-size:1px;color:rgb(123, 135, 76);float:left;">尊重知识</span><span style="font-size:1px;color:rgb(247, 218, 211);float:left;">第十八次</span><span style="font-size:1px;color:rgb(36, 195, 21);float:left;">市场调节</span><span style="font-size:2px;color:rgb(188, 164, 83);float:left;">民族区域</span><span style="font-size:1px;color:rgb(50, 86, 136);float:left;">思想观念</span><span style="font-size:6px;color:rgb(214, 41, 81);float:left;">市场经济</span><span style="font-size:2px;color:rgb(136, 68, 72);float:left;">公共资源</span><span style="font-size:1px;color:rgb(36, 197, 97);float:left;">大有作为</span><span style="font-size:1px;color:rgb(223, 141, 38);float:left;">赔偿制度</span><span style="font-size:1px;color:rgb(115, 12, 186);float:left;">从严治党</span><span style="font-size:2px;color:rgb(59, 129, 234);float:left;">爱国主义</span><span style="font-size:1px;color:rgb(171, 181, 32);float:left;">作出贡献</span><span style="font-size:1px;color:rgb(168, 24, 251);float:left;">科技体制</span><span style="font-size:1px;color:rgb(217, 169, 218);float:left;">合理安排</span><span style="font-size:1px;color:rgb(11, 19, 159);float:left;">基本方针</span><span style="font-size:1px;color:rgb(3, 189, 96);float:left;">规模宏大</span><span style="font-size:1px;color:rgb(114, 141, 88);float:left;">放在首位</span><span style="font-size:1px;color:rgb(83, 77, 165);float:left;">扫黄打非</span><span style="font-size:1px;color:rgb(216, 233, 151);float:left;">人民政协</span><span style="font-size:1px;color:rgb(46, 126, 84);float:left;">积极响应</span><span style="font-size:1px;color:rgb(160, 164, 85);float:left;">高级干部</span><span style="font-size:1px;color:rgb(117, 218, 191);float:left;">艰苦卓绝</span><span style="font-size:1px;color:rgb(174, 228, 240);float:left;">传统美德</span><span style="font-size:1px;color:rgb(181, 172, 168);float:left;">资源管理</span><span style="font-size:1px;color:rgb(191, 97, 152);float:left;">精神支柱</span><span style="font-size:1px;color:rgb(227, 94, 194);float:left;">金融体制</span><span style="font-size:2px;color:rgb(75, 173, 226);float:left;">劳动报酬</span><span style="font-size:1px;color:rgb(203, 220, 64);float:left;">精神状态</span><span style="font-size:1px;color:rgb(239, 24, 98);float:left;">标本兼治</span><span style="font-size:1px;color:rgb(68, 150, 41);float:left;">利用外资</span><span style="font-size:1px;color:rgb(26, 212, 21);float:left;">边疆地区</span><span style="font-size:1px;color:rgb(181, 183, 83);float:left;">语言文字</span><span style="font-size:1px;color:rgb(224, 104, 202);float:left;">终身教育</span><span style="font-size:2px;color:rgb(133, 187, 108);float:left;">爱国统一战线</span><span style="font-size:1px;color:rgb(241, 234, 117);float:left;">服务网络</span><span style="font-size:3px;color:rgb(94, 92, 229);float:left;">党的纪律</span><span style="font-size:1px;color:rgb(207, 181, 96);float:left;">资源配置</span><span style="font-size:1px;color:rgb(77, 108, 219);float:left;">各得其所</span><span style="font-size:1px;color:rgb(35, 225, 13);float:left;">充分体现</span><span style="font-size:1px;color:rgb(221, 93, 130);float:left;">阔步前进</span><span style="font-size:3px;color:rgb(12, 173, 23);float:left;">人民代表大会</span><span style="font-size:1px;color:rgb(40, 103, 69);float:left;">生产方式</span><span style="font-size:1px;color:rgb(18, 124, 208);float:left;">开展批评</span><span style="font-size:1px;color:rgb(177, 238, 176);float:left;">安置工作</span><span style="font-size:1px;color:rgb(48, 206, 165);float:left;">扩大内需</span><span style="font-size:1px;color:rgb(157, 154, 225);float:left;">必由之路</span><span style="font-size:1px;color:rgb(101, 85, 140);float:left;">国际局势</span><span style="font-size:1px;color:rgb(242, 28, 56);float:left;">此时此刻</span><span style="font-size:6px;color:rgb(228, 83, 157);float:left;">共产党人</span><span style="font-size:1px;color:rgb(13, 39, 60);float:left;">合理布局</span><span style="font-size:9px;color:rgb(117, 46, 141);float:left;">生态环境</span><span style="font-size:5px;color:rgb(120, 109, 254);float:left;">环境保护</span><span style="font-size:1px;color:rgb(250, 101, 139);float:left;">发展前景</span><span style="font-size:1px;color:rgb(32, 48, 168);float:left;">网络安全</span><span style="font-size:1px;color:rgb(126, 148, 199);float:left;">亡党亡国</span><span style="font-size:1px;color:rgb(78, 250, 201);float:left;">政法队伍</span><span style="font-size:3px;color:rgb(137, 245, 113);float:left;">人才队伍</span><span style="font-size:1px;color:rgb(125, 85, 255);float:left;">健身运动</span></div>

<p>嗯……深刻领会了十八大精神<a href="其实就中文分词结果来说，中国特色社会、社会主义先进文化、社会主义民主政治这类名词都会分开，结果就是社会主义出现次数相当频繁，也充分体现了我们国家的特性和党的属性。">^4</a>。</p>
<h2 id="What’s_more">What’s more</h2><p>可以将标签云移植到博客上。</p>
<h2 id="Footnotes">Footnotes</h2><p>[^1]:抱歉……我忘记python怎么将长行划分了<code>\</code> or <code>\\</code>?<br>[^2]:emerge 乱入……</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/reviews/2013/01/26/data-analysis-with-open-source-tools/" itemprop="url">
                  Data Analysis with Open Source Tools
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-01-26T00:00:00+08:00" content="2013-01-26">
              2013-01-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/reviews/" itemprop="url" rel="index">
                    <span itemprop="name">reviews</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/reviews/2013/01/26/data-analysis-with-open-source-tools/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="reviews/2013/01/26/data-analysis-with-open-source-tools/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="基于开源工具的数据分析">基于开源工具的数据分析</h1><p><img src="" alt="书的图片"></p>
<p>这是书评，不仅仅是书评。事实上，这本书我还没看完。考研之前大概两个月时偶然在图书馆外文图书阴暗的角落发现了这本书，然后考研复习平常上课都被我扔了，连续一周徜徉在数学和计算机的世界里。再往后？大概到十四还是十五章被迫准备研究生入学考试去，直到现在还没拾起来。</p>
<p>后来在一楼看到有中文图书，感觉翻译的不错，起码比我自己理解的好。就换了本中文的带回家来看。</p>
<p>废话很多？不是么？好吧这篇书评和书的内容没什么大的关联，满篇只因为我又想 <em>胡扯</em> 了。</p>
<p>Amazon上对这本书的评价：Very Insight。Too insight 以致于我真想跑跑题。</p>
<h2 id="系统与文化">系统与文化</h2><p>从书上的一个故事说起。作者建议数据分析工作人员和科学家用Unix系统工作，为此专门举了个例子：</p>
<blockquote>
<p>True story: I needed to send a file containing several millions of keys to a coworker.(The company did not work on Unix.) Since the file was too large to fit safely into an email message, I posted it to a web server on my desktop and sent my coworker the link. (I dutifully had provided the file with the extension .txt, so that he would be able to open it.) Five minutes later, he calls me back: “I can’t open that”—“What do you mean?”—“Well, I click the link, but ScrapPaper [the default text editor for small text files on this particular system] dies because the file is too big.” This coworker was not inept (in fact, he was quite good at his primary job), but he displayed the particular  non-problem-solving attitude that develops in predefined work environments: “Link, click.” It did not even occur to him to think of something else to try. That’s a problem!</p>
</blockquote>
<p>就在昨天，看到<a href="http://cnlox.is-programmer.com/posts/37276.html" target="_blank" rel="external">行者无疆</a>上对百度的公司的风格很是一顿猛批：其为员工预装的系统还是十年前的windows XP，天天用着盗版SecureCRT和Office软件工作。问题是：<em>This matters？</em></p>
<p>我觉得重要！关键在习惯和文化上！</p>
<p>看看作者如何谈论：</p>
<blockquote>
<p>Unix was developed for precisely this kind of ad hoc programming with files<br>and data, and it continues to provide the most liberating environment for such work.<br>Unix (and its variants, including Linux and Mac OS X) has some obvious technical<br>advantages, but its most important property in the present context is that it encourages<br>you to devise solutions. It does not try (or pretend) to do the job for you, but it goes out of<br>its way to give you tools that you might find handy—without prescribing how or for<br>what you use them. In contrast, other operating systems tend to encourage you to stay<br>within the boundaries of certain familiar activity patterns—which does not encourage<br>the development of your problem-solving abilities (or, more importantly, your<br>problem-solving attitudes).</p>
</blockquote>
<p>关键就在这里，Unix系统 <em>encourages you to devise solutions</em>， 它不尝试为你做完所有事，但是它竭尽所能为你提供各种各样的工具和选择，而不是规定使用的方式和用途。而其它操作系统往往鼓励你留在习惯的活动模式范围内——毫不鼓励你提高解决问题的能力，更重要的是，<em>解决问题的态度!</em></p>
<p>这也就是为什么，Linux、Mac OS和BSD这些Unix系统被称作黑客<a href="这里黑客采用古典的黑客定义，指那些热衷于探索和解决各种问题的人。">^1</a>的操作系统，而Windows一直饱受诟病，在geek的群体中备受歧视。</p>
<p>从开始接触Linux到现在不到一年半，按理说作为一个noob没什么评头论足的资格，但这一年半却是改变我人生轨迹的一年半，我想分享出来自己的想法和折腾。也为了印证为何我也这么说这么想。</p>
<h2 id="从自己说起">从自己说起</h2><p>一年半时间，世界和自我完全变了。</p>
<p>折腾的苦与乐，爱与恨，交织纷繁。</p>
<p>也许当初真的太闲了才会一脚踏进这个无底洞，不过，who cares。就说说这个系统和文化如何影响、塑造了我。</p>
<p>故事从SAS开始，一款统计软件。当时数学建模用着盗版的SAS，老师说，这个正版太贵，我们买不起。</p>
<p>问题是有多贵？我开始上百度<a href="现在我怎么可能去用百度，google对太多人是别无选择的，就算墙掉、封掉，也得想办法去上。">^2</a>找答案，听说的答案是：一年几十万。</p>
<p>The price shocked me，从来没想过一个软件会这么贵。缘分就在这里，看到有人在推荐R(A powerful statistics environment)作为替代。这是我第一次听说开源，也是我折腾的开始，踏入新天地的开端。</p>
<p>没体会过的人永远不会理解我为什么说新天地，也不会理解这有什么好感慨的。</p>
<p>我从来没想过将来去从事什么计算机相关的工作，从来。从来觉得数学这东西一无是处，都是空谈。从来觉得世界分工很多事情自己都不该去接触去学习。从来以为世界就是自己身边这么大。从来觉得一生这么混混就过去了。</p>
<p>但一年半后我再也不这样想了。依然迷茫，然而有信心。</p>
<p>这一年半我觉得做了许多让自己骄傲的事，最起码没有虚度。虽然在别人眼里我碌碌无为，甚至一无是处。我依然相信、我的所有努力和折腾不会白费。就像Jobs当在Stanford演讲所说[^3]。</p>
<p>一分耕耘、一分收获。</p>
<h3 id="为什么会折腾？和系统有关系吗？">为什么会折腾？和系统有关系吗？</h3><p>有！文化。有些环境不鼓励探索和设计解决问题，而是鼓励你混日子。</p>
<p>关于开源社区的文化，我想说几条：</p>
<h4 id="热情">热情</h4><p>大多数人都只因热爱。开源社区是充满热情与爱的社区，开源本身就是个奇迹。你会想到有人无偿将自己的劳动成果贡献出来让所有人都能自由获取和使用吗？然而不光有人做，还有一群人做。他们把技术、心得分享出来，让每个想学习的人都平等的接触他们。他们花费宝贵时间写出组织良好充满热情的文档、教程，录制视频，他们花费宝贵的时间本地化各种应用，在IRC和论坛等地热情帮助他人。他们也做出各种各样的艺术品。</p>
<h4 id="分享">分享</h4><p>开源社区的分享氛围真是太好了。我为什么倾向于使用Python，因为它本身就是依靠开源发展壮大起来，深受开源文化陶冶的语言。来自各个领域、各个地区的爱好者们开发了各种各样的库分享出来让每个人都能自由获取，以致于很多事情用Python太简单了。数以万计的开源软件使用者在互联网上分享、反馈、改进他们喜欢的东西。这种文化也构成了互联网的分享基础。</p>
<h4 id="好奇心">好奇心</h4><p>正如本书作者在前言中所说：</p>
<p><em>All You need is just CURIOSITY！</em> </p>
<p>开源社区给了每个人自由平等接触学习的机会，你所需要的仅仅是好奇心。从接触linux开始，我在上面折腾过各种数学软件R、octave、scilab、ipython(其实这不是……)、各种风格和特色语言[^4]、自己学习图像处理的基础知识和使用图像处理软件(如果时间很多就去学blender)[^5]、自己学习字体排版的理论折腾LaTeX、自己试着零基础折腾各种动静态网站、在虚拟机上装好各种linux/windows系统然后连着玩……虽然没学到什么或者学过也忘了或者不深入，但学到的是解决问题的态度和能力，这才是我觉得最重要的。时光飞逝，一切都会过时变化，重要的是面对问题的态度和解决问题的能力。</p>
<p>开源的文化改变了我的思想、行动，开阔了我的眼界，我觉得这对每个人都是有益的。剩下的，就是你愿不愿意付出“代价”来改变自己了。</p>
<p>开放的社区欢迎任何人投入其中、分享、学习、进步，接触和尝试各个领域，你也许对计算机知之甚少，对数学一窍不通，但行业的鸿沟真的这么明显吗？<em>难而不会、会而不难</em>，你会找到很多开放的社区有热情的人分享的资料文章、看到清晰热情的文档、在论坛IRC等获得热心的帮助。</p>
<p>不妨试试，你会爱上这种文化。</p>
<p>最后顺便说下，开源社区创造了很多很棒的东西，越是重要的东西越默默无闻，然而不可或缺。</p>
<h2 id="Footnotes">Footnotes</h2><p>[^3]:Follow U heart.<br>[^4]:其实很少，我认真学的第一门语言是common lisp。<br>[^5]:有兴趣的同学可以去看看Tears of Steel，这是blender、gimp、Inkscape等开源多媒体软件制作的。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/2013/01/13/moving-to-gentoo/" itemprop="url">
                  Hello, Gentoo
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-01-13T00:00:00+08:00" content="2013-01-13">
              2013-01-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/linux/2013/01/13/moving-to-gentoo/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="linux/2013/01/13/moving-to-gentoo/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>警告：<em>渣行文</em>，就是想到什么扯什么……散漫不羁，漫无主题。</p>
<p>注：你也许可以把这篇极水的流水帐当作 <em>Tentative Instruction for gentoo on Samsung R429</em> 不过我写这篇文章的目的在于自我警戒与警戒他人，一次gentoo安装让本屌丝sb本质暴露无疑，诸位看官引以为戒。</p>
<h1 id="机器信息">机器信息</h1><p>Cpu信息,这就是传说中的<em>i3</em> XD</p>
<pre><code>⚡ root@gentoo ⮀ ~ ⮀ lscpu 
Architecture:          x86_64
CPU <span class="function"><span class="title">op-mode</span><span class="params">(s)</span></span>:        <span class="number">32</span>-bit, <span class="number">64</span>-bit
Byte Order:            Little Endian
<span class="function"><span class="title">CPU</span><span class="params">(s)</span></span>:                <span class="number">4</span>
On-line <span class="function"><span class="title">CPU</span><span class="params">(s)</span></span> list:   <span class="number">0</span>-<span class="number">3</span>
<span class="function"><span class="title">Thread</span><span class="params">(s)</span></span> per core:    <span class="number">2</span>
<span class="function"><span class="title">Core</span><span class="params">(s)</span></span> per socket:    <span class="number">2</span>
<span class="function"><span class="title">Socket</span><span class="params">(s)</span></span>:             <span class="number">1</span>
Vendor ID:             GenuineIntel
CPU family:            <span class="number">6</span>
Model:                 <span class="number">37</span>
Stepping:              <span class="number">2</span>
CPU MHz:               <span class="number">2266.000</span>
BogoMIPS:              <span class="number">4521.96</span>
Virtualization:        VT-x
L1d cache:             <span class="number">32</span>K
L1i cache:             <span class="number">32</span>K
L2 cache:              <span class="number">256</span>K
L3 cache:              <span class="number">3072</span>K
</code></pre><p>硬件：</p>
<pre><code>⚡ root<span class="comment">@gentoo ⮀ ~ ⮀ lspci</span>
<span class="number">00</span>:<span class="number">00</span>.<span class="number">0</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor DRAM Controller (<span class="keyword">rev </span><span class="number">12</span>)
<span class="number">00</span>:<span class="number">01</span>.<span class="number">0</span> PCI <span class="keyword">bridge: </span>Intel Corporation Core Processor PCI Express x16 Root Port (<span class="keyword">rev </span><span class="number">12</span>)
<span class="number">00</span>:<span class="number">1</span>a.<span class="number">0</span> USB controller: Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset USB2 Enhanced Host Controller (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>b.<span class="number">0</span> Audio device: Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset High Definition Audio (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>c.<span class="number">0</span> PCI <span class="keyword">bridge: </span>Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset PCI Express Root Port <span class="number">1</span> (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>c.<span class="number">2</span> PCI <span class="keyword">bridge: </span>Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset PCI Express Root Port <span class="number">3</span> (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>c.<span class="number">3</span> PCI <span class="keyword">bridge: </span>Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset PCI Express Root Port <span class="number">4</span> (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>d.<span class="number">0</span> USB controller: Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset USB2 Enhanced Host Controller (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>e.<span class="number">0</span> PCI <span class="keyword">bridge: </span>Intel Corporation <span class="number">82801</span> Mobile PCI <span class="keyword">Bridge </span>(<span class="keyword">rev </span>a6)
<span class="number">00</span>:<span class="number">1</span>f.<span class="number">0</span> ISA <span class="keyword">bridge: </span>Intel Corporation Mobile <span class="number">5</span> Series Chipset LPC Interface Controller (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>f.<span class="number">2</span> SATA controller: Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset <span class="number">4</span> port SATA AHCI Controller (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">00</span>:<span class="number">1</span>f.<span class="number">3</span> SMBus: Intel Corporation <span class="number">5</span> Series/<span class="number">3400</span> Series Chipset SMBus Controller (<span class="keyword">rev </span><span class="number">06</span>)
<span class="number">02</span>:<span class="number">00</span>.<span class="number">0</span> VGA compatible controller: NVIDIA Corporation GT218 [GeForce <span class="number">310</span>M] (<span class="keyword">rev </span><span class="literal">a2</span>)
<span class="number">02</span>:<span class="number">00</span>.<span class="number">1</span> Audio device: NVIDIA Corporation High Definition Audio Controller (<span class="keyword">rev </span><span class="literal">a1</span>)
<span class="number">03</span>:<span class="number">00</span>.<span class="number">0</span> Network controller: Atheros Communications Inc. AR9285 Wireless Network Adapter (PCI-Express) (<span class="keyword">rev </span><span class="number">01</span>)
<span class="number">07</span>:<span class="number">00</span>.<span class="number">0</span> Ethernet controller: <span class="keyword">Marvell </span>Technology Group Ltd. Yukon Optima <span class="number">88</span>E8059 [PCIe Gigabit Ethernet Controller with AVB] (<span class="keyword">rev </span><span class="number">11</span>)
<span class="number">3</span>f:<span class="number">00</span>.<span class="number">0</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor QuickPath Architecture Generic Non-core Registers (<span class="keyword">rev </span><span class="number">02</span>)
<span class="number">3</span>f:<span class="number">00</span>.<span class="number">1</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor QuickPath Architecture System <span class="keyword">Address </span>Decoder (<span class="keyword">rev </span><span class="number">02</span>)
<span class="number">3</span>f:<span class="number">02</span>.<span class="number">0</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor QPI Link <span class="number">0</span> (<span class="keyword">rev </span><span class="number">02</span>)
<span class="number">3</span>f:<span class="number">02</span>.<span class="number">1</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor QPI Physical <span class="number">0</span> (<span class="keyword">rev </span><span class="number">02</span>)
<span class="number">3</span>f:<span class="number">02</span>.<span class="number">2</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor Reserved (<span class="keyword">rev </span><span class="number">02</span>)
<span class="number">3</span>f:<span class="number">02</span>.<span class="number">3</span> Host <span class="keyword">bridge: </span>Intel Corporation Core Processor Reserved (<span class="keyword">rev </span><span class="number">02</span>)
</code></pre><h2 id=":s/arch/gentoo/gc">:s/arch/gentoo/gc</h2><p>2013年一月十三日，开始装gentoo。依照<a href="http://www.gentoo.org/doc/en/altinstall.xml" target="_blank" rel="external">The Gentoo Linux alternative installation method HOWTO</a>从BT5 R3的liveusb来chroot过去部署的stage3。一年多linux使用的结果是，chroot轻车熟路，archwiki中chroot那章还是我翻译的呢，不过……渣翻译。</p>
<p>没什么理由，甚至对arch相当满意。然后就顺手给<code>/</code>和<code>/boot</code>干掉了……单独分区天然优势，不用折腾什么lvm就能大胆的乱搞……</p>
<pre><code>Device Boot      Start         End      Blocks   Id  System
/dev/sda1   *          <span class="number">63</span>      <span class="number">208844</span>      <span class="number">104391</span>   <span class="number">83</span>  Linux
/dev/sda2          <span class="number">208845</span>     <span class="number">4417874</span>     <span class="number">2104515</span>   <span class="number">82</span>  Linux swap / Solaris
/dev/sda3         <span class="number">4417875</span>    <span class="number">65866499</span>    <span class="number">30724312</span>+  <span class="number">83</span>  Linux
/dev/sda4        <span class="number">65866500</span>   <span class="number">625137344</span>   <span class="number">279635422</span>+  <span class="number">83</span>  Linux
</code></pre><h2 id="引导">引导</h2><p>这是这次安装和配置gentoo时犯的第一次sb……</p>
<p>当时内核编译好。手册上的示例是grub和lilo做引导，而我习惯syslinux。素来以尊重用户选择为指引的gentoo在手册上就是没提及半点syslinux，而在arch下的操作又不一样。于是找到gentoo的syslinux的wiki。按wiki步骤写了自己的<code>extlinux.conf</code>:</p>
<pre><code>TIMEOUT 30
ONTIMEOUT gentoo

UI vesamenu.c32
MENU TITLE <span class="keyword">Boot</span>

<span class="keyword">LABEL</span> gentoo
MENU <span class="keyword">LABEL</span> Gentoo Linux
KERNEL /<span class="keyword">boot</span>/kernel-genkernel-x86_64-3.6.11-gentoo
<span class="keyword">APPEND</span> initrd=/<span class="keyword">boot</span>/initramfs-genkernel-x86_64-3.6.11-gentoo root=/dev/sda3 acpi_osi=Linux acpi_backlight=vendor
</code></pre><p>然后重启……无法载入root，进入某个rescue shell内，什么神shell什么命令都没用。</p>
<p>冷关机chroot，查找资料改以上配置文件n次，重装extlinux又n次，重启n次，依然无解。然后忽然发现……extlinux的配置文件是<code>extlinux.conf</code>,而不像syslinux，pxelinux和isolinux那样都是<code>.cfg</code>，瞬间知道自己sb了……</p>
<h2 id="图形界面">图形界面</h2><p>然后还算顺利吧，开源驱动编译了好久，emerge不会用，我是什么都：</p>
<pre><code>emerge <span class="comment">--autounmask-write foo</span>
<span class="built_in">dispatch</span>-conf
u
emerge foo
</code></pre><p>奇葩的是我想到什么emerge什么……于是搞了好久都没有图形界面用……</p>
<p>搞了个xterm+luit+telnet上听雨……发现字体显示不全……和听雨技术blabla的用英语开始版聊，然后十大了……囧</p>
<p>为了能一边上网水贴吧，一边编译系统。第二天回到BT5的liveusb环境中去了，又把自己喜欢的东西先emerge出来了……图形界面还没起来把gimp和vlc就编译好了……</p>
<p>等开源驱动装好，kdebase-startkde装好之后，重liveusb环境重启，擦……奇葩的分辨率……然后又开始查怎么调分辨率。</p>
<p>然后从开源到闭源，发现闭源不能调亮度，再加上没有kms很不爽，又转到开源。对这款机器来说，估计nvidia-bl驱动你也可以调亮度，不过我没试过。我只是把闭源驱动生成的xorg.conf改了改扔给了开源驱动<a href="这个配置文件触摸板不能单击，要改什么，反正我后来用synaptiks设置了。">^3</a>：</p>
<pre><code> ⚡ root@gentoo ⮀ ~ ⮀ cat /etc/X11/xorg.conf 
<span class="preprocessor"># nvidia-xconfig: X configuration file generated by nvidia-xconfig</span>
<span class="preprocessor"># nvidia-xconfig:  version <span class="number">304.64</span>  (buildmeister@swio-display-x86-rhel47-<span class="number">12</span>)  Tue Oct <span class="number">30</span> <span class="number">12</span>:<span class="number">04</span>:<span class="number">46</span> PDT <span class="number">2012</span></span>


Section <span class="string">"ServerLayout"</span>
    Identifier     <span class="string">"Layout0"</span>
    Screen      <span class="number">0</span>  <span class="string">"Screen0"</span> <span class="number">0</span> <span class="number">0</span>
    InputDevice    <span class="string">"Keyboard0"</span> <span class="string">"CoreKeyboard"</span>
    InputDevice    <span class="string">"Mouse0"</span> <span class="string">"CorePointer"</span>
EndSection

Section <span class="string">"Files"</span>
EndSection

Section <span class="string">"InputDevice"</span>

    <span class="preprocessor"># generated from data in <span class="string">"/etc/conf.d/gpm"</span></span>
    Identifier     <span class="string">"Mouse0"</span>
    Driver         <span class="string">"mouse"</span>
    Option         <span class="string">"Protocol"</span>
    Option         <span class="string">"Device"</span> <span class="string">"/dev/input/mice"</span>
    Option         <span class="string">"Emulate3Buttons"</span> <span class="string">"no"</span>
    Option         <span class="string">"ZAxisMapping"</span> <span class="string">"4 5"</span>
EndSection

Section <span class="string">"InputDevice"</span>

    <span class="preprocessor"># generated from default</span>
    Identifier     <span class="string">"Keyboard0"</span>
    Driver         <span class="string">"kbd"</span>
EndSection

Section <span class="string">"Monitor"</span>
    Identifier     <span class="string">"Monitor0"</span>
    Modeline <span class="string">"1368x768_60.00"</span>   <span class="number">85.25</span>  <span class="number">1368</span> <span class="number">1440</span> <span class="number">1576</span> <span class="number">1784</span>  <span class="number">768</span> <span class="number">771</span> <span class="number">781</span> <span class="number">798</span> -hsync +vsync
    Option         <span class="string">"DPMS"</span>
    Option         <span class="string">"PreferredMode"</span>  <span class="string">"1368x768_60.00"</span>
EndSection

Section <span class="string">"Device"</span>
    Identifier     <span class="string">"Device0"</span>
    Driver         <span class="string">"nouveau"</span>
    Option         <span class="string">"NoLogo"</span> <span class="string">"true"</span>
    Option         <span class="string">"RegistryDwords"</span> <span class="string">"EnableBrightnessControl=1"</span>
    VendorName     <span class="string">"NVIDIA Corporation"</span>
EndSection

Section <span class="string">"Screen"</span>
    Identifier     <span class="string">"Screen0"</span>
    Device         <span class="string">"Device0"</span>
    Monitor        <span class="string">"Monitor0"</span>
    DefaultDepth    <span class="number">24</span>
    SubSection     <span class="string">"Display"</span>
        Modes      <span class="string">"1366x768"</span>
        Depth       <span class="number">24</span>
    EndSubSection
EndSection
</code></pre><p>想知道modeline怎么写的？请<code>man cvt</code>。</p>
<p>总之，这么一搞，开源驱动有这款机器的分辨率了。</p>
<p>这部分最后补充下我犯的<em>第二次sb</em>，chroot过去忘了date到正确的时间，结果早上开始emerge kdebase-startkde 晚上发现它还在等着在多少多少秒之后的未来某时开始编译……于是水了一天贴吧发现什么都没干。</p>
<h2 id="后安装时代">后安装时代</h2><p>第三次sb在于，妄图打造一个纯正的无gtk环境，</p>
<ul>
<li>把gvim的gtk参数去掉了，靠……对着wx的gvim渣界面我还奇怪怎么这么难看。</li>
<li>把fcitx的gtk参数去掉了，然后奇怪firefox中怎么输入不了……</li>
<li>最后吧，选择kde环境我觉得本身就挺sb……bug要不要多了点……当你想要美化kde环境下不堪入目的gtk程序而选择安装Oxygen-gtk后，却发现Oxygen-gtk的widget出现不了时你可以参看参看<a href="https://forum.kde.org/viewtopic.php?f=66&amp;t=91301" target="_blank" rel="external">这里</a>。一般情况下，你如果碰到这个问题，说明你要么是升级kde，要么是家目录有一堆以前的配置。</li>
</ul>
<h2 id="引导出错？">引导出错？</h2><p>从W城到X城，十个小时的火车，又犯了一次sb。以为早上六点到X城，半夜两点乘务员把我叫起来说到站了，迷迷糊糊的出站四野一片大雾。晕头转向地走进KFC打开电脑等天亮……草……启动不了了。然后我chroot重编译内核检查硬盘内存一直搞到没电。</p>
<p>等到回家，忽然想起光驱里放了个没用的光盘……</p>
<h2 id="Home">Home</h2><p>回家开始拨号联网，怀念arch下Networkmanager无往不利，按wiki编译设置好。先是发现没无线网络，然后dsl拨号连不上。</p>
<p>这是第几次sb来着……查找N多资料，编译N次内核，n次networkmanager，甚至试了试wicd，最后发现用户名写错了……卧槽啊……</p>
<p>无线内核也是个大坑，gentoo安装手册上说：</p>
<blockquote>
<p>Be aware though, as genkernel compiles a kernel that supports almost all hardware, this compilation will take quite a while to finish! </p>
</blockquote>
<p>还说：</p>
<blockquote>
<p>This means that when you use genkernel to build your kernel, your system will generally detect all your hardware at boot-time, just like our Installation CD does.</p>
</blockquote>
<p>于是我sb的以为会生成个和ubuntu或arch一样的通用内核，实际上竟然不完全是。<a href="问题在于，我是chroot环境过去的，而BT5启动时并没能很好的探测硬件，比如每次启动BT5时间都不对。genkernel貌似需要启动时探测的信息。后来在贴吧看到，都是lspci看硬件然后直接把硬件+gentoo上google搜的……">^1</a>不知道是chroot原因还是什么，RTC支持没有编译(hwclock),无线网卡驱动没有编译(ath9k)，如果你要用vbox，这个支持也要编译上(iommu)。</p>
<p>我觉得最sb的在于，我以为genkernel会自动读取当前目录的配置……各位看官引以为戒，使用软件前认真看手册，不要<em>自以为是</em>。</p>
<p>好了最后没什么了，一个libreoffice编译了五个小时，添加了gentoo-zh和sunrise的overlay。装上了katawa-shoujo，64位gentoo跑32位程序全无压力，连pulse-audio都不用就有声音(arch下为了发出声音必然的依赖)……</p>
<p>然后……就是开虚拟机写毕业设计开题报告的事了。囧……</p>
<h2 id="附录">附录</h2><h3 id="附录一——截图秀">附录一——截图秀</h3><p>这是秀gvim和gentoo的logo：</p>
<p><img src="http://fmn.rrimg.com/fmn061/20130118/2335/original_YQIC_17da0000045a1191.jpg" alt="秀gvim的powerline"></p>
<p>秀zsh的powerline</p>
<p><img src="http://fmn.xnpic.com/fmn057/20130118/2340/original_KSFt_2596000000361191.jpg" alt="yakuake and zsh powerline"></p>
<p>这是秀oxygen主题，金属光泽和性感的阴影。</p>
<p><img src="http://fmn.rrimg.com/fmn060/20130118/2340/original_hO3c_3601000002281190.jpg" alt="日用无碍"></p>
<h3 id="附录二——工作清单">附录二——工作清单</h3><p>终于可以使用中文了。截止</p>
<p>Sun 13 Jan 2013 12:52:51 AM CST</p>
<p>已完成的工作</p>
<p>[X] vlc</p>
<p>[X] gimp</p>
<p>[X] luit/telnet 上听雨</p>
<p>[X] w3m</p>
<p>[X] nouveau</p>
<p>[X] zsh</p>
<p>[X] wqy-zenhei wqy-microhei</p>
<p>[X] ipython pip （python2）</p>
<p>[X] firefox-bin18</p>
<p>[X] startkde(去除bluez，我没有蓝牙适配器)</p>
<p>[X] ppp，dhcpcd</p>
<p>[X] 通用内核</p>
<p>[X] syslinux</p>
<p>[X] 较低版本的fcitx</p>
<p>[X] layman添加gentoo-zh, 安装git和subversion。</p>
<p>[X] xinit</p>
<p>还有些问题：<em>Mon 14 Jan 2013 12:27:09 AM CST修正</em></p>
<p>[X] 分辨率低，不能设置为1366x768,换闭源驱动可解决</p>
<p>[C] gentoo的stageball难道给我装了一堆开发工具？sandbox pyshell pycrust pyalamode？</p>
<p>[X] gvim显示好难看，而且输入法不能起作用，gtk选项</p>
<p>[X] oxygen还要单独安装么？bug，重编译解决</p>
<p>[X] 缺少声卡驱动？还是alsa？声音调节。alsa</p>
<p>[X] 触摸板不起作用。synaptics</p>
<p>[X] 亮度无法调节（kde电源管理工具,and powermanage）开源可以闭源不行,acpid acpi Option依然无力[^4]</p>
<p>[X] dolphin，okular，gwenview等常用工具没装</p>
<p>[X] sudo sudoer文件写法</p>
<p>[X]用户组处理</p>
<p>[]摄像头</p>
<p>[X]如果开源驱动，开启kms</p>
<p>[C]change to nvidiabl</p>
<p>Others:</p>
<p>[X] kdm</p>
<p>[X] vbox安装、配置</p>
<p>[X] 重新编译firefox18,而不是bin</p>
<p>[X] oh-my-zsh 换上有非常漂亮powerline的agnoster主题，上图</p>
<p>[C] overlay 更换现有输入法？<em>注意ICU</em>，暂时不更改了</p>
<p>[X] 片轮少女<a href="悲了个摧的，不能读取我以前的存档……">^2</a></p>
<p>[X] 是否换闭源驱动 是 logo去掉</p>
<p>[X] virtualenv，pip</p>
<p>[C] gcc暂时不升级</p>
<p>幸运的是，家目录没有变动。所有的用户配置都在，如vim，kde，甚至rvm都能正常使用。</p>
<p>Mon 14 Jan 2013 12:30:54 AM CST</p>
<p>除此之外我还做了什么：</p>
<p>[O]恼人的zsh下sudo自动补全。sudo没解决（把配置复制给root了都没用）</p>
<p>[X]精简内核,被genkernel坑了，原来它不会自动读配置</p>
<p>[X]latex编译,ctex字体配置</p>
<p>[X]无线网内核支持编译ath9k</p>
<p>[X]Networkmanager的dsl拨号无法使用</p>
<p>[X]unzip,unrar,zip(natspec标记)</p>
<p>[X]hwclock 内核RTC支持</p>
<p>Sun 03 Mar 2013 11:47:18 AM CST</p>
<p>[X]重新配置内核，添加摄像头支持</p>
<h3 id="附录三——经验教训">附录三——经验教训</h3><ul>
<li>sb一样上来emerge vim…openbox+xterm听雨都显示不了汉字.So,先打造个可以上网的环境再说</li>
<li>chroot是个不错的选择,但不仅要挂载proc等[参见alternative’],还要date…</li>
<li>emerge使用,portage的理解,use 标记 the heart of gentoo.</li>
<li>显卡驱动是个蛋疼的事</li>
<li>firefox编译时直接卡爆，不过最后还是编译好了</li>
<li>gvim和fcitx要加上gtk选项，不然gvim就一个默认的wx界面，fcitx无法在gtk程序中使用</li>
<li>非系统级python模块使用virtualenv+pip</li>
</ul>
<h2 id="Footnotes">Footnotes</h2><p>[^4]: 后来发现acpi没用，powerdevil就够用了。另为唤醒后亮度失控的问题找到解决方法了arch的wiki，在内核启动行加上<code>acpi_osi=Linux acpi_backlight=vendor</code></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2013/01/06/summary-and-prospect-in-2012/" itemprop="url">
                  总结和展望之2012
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2013-01-06T00:00:00+08:00" content="2013-01-06">
              2013-01-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2013/01/06/summary-and-prospect-in-2012/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2013/01/06/summary-and-prospect-in-2012/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><em>警告：以下内容建议别看，保护好节操和三观</em></p>
<blockquote>
<p>The way a crow</p>
<p>Shook down on me </p>
<p>The dust of snow </p>
<p>From a hemlock tree </p>
<p>Has given my heart </p>
<p>A change of mood </p>
<p>And saved some part </p>
<p>Of a day I had rued.</p>
</blockquote>
<p>  两天前在吴都路景观道上一个人走着，飘落的大雪和忽然鸣叫的乌鸦，那时那刻的情境与即将考研结束的欣喜心情，这首诗好像水到渠成似的被忆起，美丽的诗句长久地回荡在心中。</p>
<p>  即将从大雪滚蛋的欣喜与对景物朋友的怀念感伤，即将了却一段心事的轻松与名对不可知的未来的紧张，对舍我其谁的自信与琢磨不清无法战胜的自卑，欲闯荡天涯的决心与对家人的眷恋与羁绊，万千情愫，在万籁俱静的夜里，在惨惨淡淡的昏黄路灯下如满天飞雪一般交织，模糊，空灵而渺远。感觉好像要融化在无边无尽的夜中，失去自我与世界的界限。</p>
<hr>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<hr>
<h2 id="总结2012">总结2012</h2><h3 id="概述">概述</h3><ul>
<li>一年时间，试着更懂自己，试着追寻自己都不知道的梦。凄凄惨惨一个人的折腾。</li>
<li>半年时间，在家的时间只有半个月，家是永远不能忘却之痛，不能隔断的羁绊。</li>
<li>四个月时间，准备考研去帝都一所从未去过，之前从没想过的大学。只因为，莫名其妙的上了byr的linux版。</li>
</ul>
<p>这一年，在考研与工作的矛盾，折腾实践与看书学习的矛盾，无限折腾与身体保养与锻炼之间的矛盾、极端反娱乐和身处娱乐大环境的矛盾、实践过程积累的自信和面对前途无力的自卑之间的矛盾、趋独和谋求与他人合作之间的矛盾，本专业渐进转型和彻底决绝地跨专业的矛盾的运动中不断前进上升。每个阶段主要矛盾都不同，而每个矛盾在不同的历史阶段作用和影响也不同。</p>
<p>这一年，是积极进步的一年，是不断学习与自我完善的一年，是不断促进自我与世界和谐的一年，是不断思索求生存谋发展的一年，也是充满曲折道路，探索光明前途的一年。这是一路蹒跚前进充满着血的教训的一年，然而我还没挂！！这是积累了我终生受用的宝贵经验的一年。</p>
<h3 id="我做了什么">我做了什么</h3><p>带着些许的狂热开源精神进入2012,继续进行漫无目的的折腾。</p>
<h4 id="网站">网站</h4><p>一月二十八号看到<a href="http://www.seainsight.me/" target="_blank" rel="external">Phoenix</a>在ubuntu中文论坛教怎么申请免费域名免费空间建立一个wordpress空间。然后在家折腾了一晚上，建立了我的第一个wordpress网站。建立个人分享网站的愿望几个月前就深植心中了，漫无目的的尝试了n次。这是第一次成功实践。但免费网站空间非常之慢。</p>
<p>不久之后又看到<a href="http://wiki.ktmud.com/tips/vim/vimwiki-guide.html" target="_blank" rel="external">丘迟的维基世界</a>，又搜到好几个vimwiki建立的个人网站，然后抱着试试看的心理试了下<a href="http://www.ruchee.com" target="_blank" rel="external">ruchee</a>的css，接着开始深入用vimwiki建站。</p>
<p>vimwiki建立的静态站点开始放在免费空间上,现在还在<a href="http://reverland.cu.cc/" target="_blank" rel="external">http://reverland.cu.cc/</a>,后来改版后放在github上，最后迁移到bitbucket<a href="http://reverland.bitbucket.org/" target="_blank" rel="external">reverland.bitbucket.org</a>。在这里赫然列着我自己都懒得去看的从二月某日到四月某日每天的日记，无边的折腾笔记。</p>
<p>其实丘迟的网站很早就看到了，一直不知道他在讲什么，只感觉很牛逼……随着实践-认识-再实践-再认识，我才不断理解和能动地改造出符合自己实际需求相结合的个人网站。</p>
<p>直到某日又看到<a href="http://www.soimort.com" target="_blank" rel="external">soimort</a>天花乱坠的jekyll网站，我一激动就<a href="http://reverland.org/web/2012/04/13/How-I-built-this-blog/">迁移到jekyll了</a>。</p>
<p>其实jekyll和Octopress在2011年就听说了，可是一直懒得迁移。当时什么也看不懂，折腾失败……</p>
<p>之后大半年，除了tk域名连个邮件提醒都没的被收回，从<a href="http://www.seainsight,me" target="_blank" rel="external">Phoenix</a>入手域名外，一直稳定维护jekyll网站。</p>
<p>忘记什么时候了，懒得折腾前端页面啥的，看到<a href="http://blog.skydark.info/" target="_blank" rel="external">skydark</a>非常漂亮功能全面的博客，直接 <em>剽窃</em> 来了，然后换了个twitter bootstrap的主题。</p>
<p>之后偶尔零星收到有关评论和感谢信都是很开心的。</p>
<h4 id="翻译">翻译</h4><ul>
<li><p>断断续续的<a href="https://wiki.archlinux.org/index.php/Special:Contributions/Reverland" target="_blank" rel="external">archlinux wiki的翻译</a></p>
</li>
<li><p><a href="http://sympy.org/zh/index.html" target="_blank" rel="external">sympy的网页翻译</a></p>
</li>
<li>一些其它的翻译就在<a href="http://reverland.org/">个人网站</a>上，主要是Scipy lecture notes和其它有关科学计算模块的一些翻译。</li>
</ul>
<h4 id="计算机语言">计算机语言</h4><ul>
<li><p>perl和R，在新的一年到来前就忘得一干二净。</p>
</li>
<li><p>偶尔用用bash</p>
</li>
<li><p>LaTeX，如果这算语言的吧，珍爱生命，远离排版。2012年除了写了几次作业再没用过，即使用也是用模板。还尝试了一次lyx。</p>
</li>
<li><p>Common Lisp，受<a href="http://liutos.github.com" target="_blank" rel="external">liutos</a>热情影响，掉进这个大坑了，然后把<a href="http://landoflisp.com/" target="_blank" rel="external">land of lisp</a>看完了,看完的第一本原版书。读书笔记<a href="http://reverland.org/lisp/2012/07/09/land-of-lisp/">点此</a></p>
</li>
<li><p>html和css，折腾网站你不得不学的东西。</p>
</li>
<li><p>Python，最熟悉的语言了，模块和库太方便了，相比lisp而言。看了一阵《python与科学计算》。</p>
</li>
<li><p>cpp，大学的酱油课，差点挂掉。</p>
</li>
<li><p>一点点scheme，纯粹之美。</p>
</li>
</ul>
<h4 id="数学">数学</h4><ul>
<li><p>高数的复习，打下坚实数学基础</p>
</li>
<li><p><a href="http://book.douban.com/subject/6524001/" target="_blank" rel="external">基于开源工具的数据分析</a>。某次去图书馆不小心看到了，然后什么考研直接被我扔掉了。不过后来才看到有中文版。江南大学图书馆有本影印版，现在还在我手里，有本中文版，不知道有人借走了没。</p>
</li>
<li><p>一些数学建模时的东西、机器学习算法、概率论与数理统计知识。</p>
</li>
</ul>
<h4 id="图像处理">图像处理</h4><p>看了部分gimp手册和在翻译<a href="http://scipy-lectures.github.com/" target="_blank" rel="external">scipy-lecture-notes</a>时积累了些色彩理论和图像处理方面的基础。然后随便折腾了些。</p>
<h4 id="考研复习">考研复习</h4><p>专业课信号与系统，感觉学了不少东西，纯数学。</p>
<p>政治学习，现在说话办事满脑子马克思主义观点立场方法，一讲话一套一套的……</p>
<p>打好了数学基础</p>
<h4 id="创新项目">创新项目</h4><p>几天前论文发了，算是彻底的结束了。趁着学习实践了好多东西，还用了半年的免费网络。总结<a href="http://reverland.org/life/2012/09/20/">见此</a>。</p>
<h4 id="其它">其它</h4><p>大学混了一年，对这屌地方提不起一点兴趣，甚至感觉碍手碍脚。不过学校很多方面就是好啊。混得最后的课差点挂掉。</p>
<p>严重的独立倾向，疏于与同学朋友交流联系，共同学习和进步。</p>
<p>学会了一边唱最炫民族风一边马步舞 和 八九十套广播体操。</p>
<p>无边无尽的水论坛和贴吧，byr，baidu linux吧，archlinux吧是我的常驻。话说byr上我的发帖都上千了,贴吧不到一年9级……</p>
<p><strong>其它，如果还有什么特别重要的？</strong></p>
<hr>
<h2 id="展望2013">展望2013</h2><p>一些事情和要注意的地方。</p>
<h3 id="三件事">三件事</h3><h4 id="毕设">毕设</h4><ul>
<li>早上去毕业设计导师那里把题目定了下来。导师没有为难我，最后完全选了一个图像处理的彻底跨专业的毕业设计。算是遂心如愿了，反正我希望能做点什么并学到很多。</li>
</ul>
<h4 id="工作">工作</h4><ul>
<li>之前感觉跨专业找工作无望，悲情之下无奈考研。后来看到知乎发在豆瓣python小组的招聘，瞬间就想找工作了……不过过了几天知乎的工作要求又改了。但起码，让我觉得，至少找个实习全无压力。即使研究生考试无望，也想过完年到北京找实习。( <em>最好</em> 年前准备)。</li>
</ul>
<h4 id="考研">考研</h4><ul>
<li>复试科目，概率论与数理统计、计算机网络、C语言还有个什么反正都要看，无论考得上考不上。</li>
</ul>
<h3 id="一些基本原则和观点">一些基本原则和观点</h3><p>尊重客观规律，理论联系实际，一切以时间、地点、条件为转移，具体问题具体分析。</p>
<p>坚持以人为本，始终把他人满意不满意，他人高兴不高兴，他人的想法和可能采取的行动放在考虑的第一位，把人的因素放在第一位。</p>
<p>身体第一，这是一切折腾与妥协的根本底线，不容置疑。</p>
<p>时间宝贵，道路是曲折的，前途是光明的。</p>
<p>团结一切可以团结的力量。</p>
<h4 id="基本矛盾">基本矛盾</h4><p>要正确处理好理想与现实之间的矛盾：</p>
<ul>
<li>无限折腾的欲望和有限的时间之间的矛盾</li>
<li>极端反娱乐与娱乐环境之间的矛盾</li>
<li>无限折腾与适度休息之间的矛盾</li>
<li>不健康生活方式与锻炼和维护自身健康之间的矛盾</li>
<li>漂泊闯荡和家庭羁绊之间的矛盾</li>
</ul>
<p>Mon 07 Jan 2013 08:08:27 PM CST<br><strong>By Reverland</strong></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2012/12/02/python/" itemprop="url">
                  python小练习：网络视频下载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2012-12-02T00:00:00+08:00" content="2012-12-02">
              2012-12-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2012/12/02/python/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2012/12/02/python/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="python小练习：网络视频下载">python小练习：网络视频下载</h1><p>互联网上有很多视频网站，提供大量视频。可是大多都要求你使用它提供的专有软件才能下载，或者根本没提供下载的地方。在linux下怎么办？总是有办法的。浏览器扩展,<a href="https://github.com/soimort/you-get/tree/master/you_get" target="_blank" rel="external">you-get</a>，直接从硕鼠解析出地址自己下载……</p>
<p>这不是重点，重点是：自己动手玩一玩。</p>
<ul>
<li>顺便学习下几个python标准库：<code>urllib</code>、<code>urllib2</code>、<code>re</code>。</li>
<li>初步学习http报头知识<br>Extra bonus:</li>
<li>flv文件结构</li>
</ul>
<p>都是随便看看。</p>
<h2 id="下载视频">下载视频</h2><p>简单起见，直接从<a href="http://www.flvcd.com/index.htm" target="_blank" rel="external">硕鼠</a>抓取地址。</p>
<p>首先我们随便找一个视频地址，比如来自sina的<a href="http://video.sina.com.cn/v/b/56925622-2257301331.html" target="_blank" rel="external">憨豆特工</a>。我们把地址用硕鼠解析出来看看：</p>
<p><img src="http://fmn.rrfmn.com/fmn058/20121202/2100/original_jaVP_5b4d00008fb1125d.jpg" alt="硕鼠"></p>
<p>哇哦，一个电影被分成15个文件了。</p>
<p>我们接下来要做的就是抓取这十五个视频的地址并把他们下载下来。</p>
<p>也许，用正则是个不错的办法。查看该页面源码，可以找到这样的内容：</p>
<pre><code><span class="variable">&lt;input type="hidden" name="inf" value="&lt;R&gt;</span>憨豆特工
<span class="variable">&lt;T&gt;</span>0
<span class="variable">&lt;F&gt;</span>http://video.sina.com.cn/v/b/56925622-2257301331.html
<span class="variable">&lt;QX&gt;</span>normal
<span class="variable">&lt;$&gt;</span>
<span class="variable">&lt;N&gt;</span>憨豆特工-0001
<span class="variable">&lt;P&gt;</span>新浪网
<span class="variable">&lt;U&gt;</span>http://edge.v.iask.com/56926940.hlv?KID=sina,viask&amp;Expires=1354550400&amp;ssig=0G8Acouy32
<span class="variable">&lt;X&gt;</span>0001
<span class="variable">&lt;C&gt;</span>aHR0cDovL3YuaWFzay5jb20vdl9wbGF5LnBocD92aWQ9NTY5MjU2MjItMjI1NzMwMTMzMSZyPXZpZGVvLnNpbmEuY29tLmNu
<span class="variable">&lt;EXPLODEID&gt;</span>1
<span class="variable">&lt;&amp;&gt;</span>
<span class="variable">&lt;$&gt;</span>
<span class="variable">&lt;N&gt;</span>憨豆特工-0002
<span class="variable">&lt;P&gt;</span>新浪网
<span class="variable">&lt;U&gt;</span>http://edge.v.iask.com/56921791.hlv?KID=sina,viask&amp;Expires=1354550400&amp;ssig=aDBPWf%2B2YH
<span class="variable">&lt;X&gt;</span>0001
<span class="variable">&lt;C&gt;</span>aHR0cDovL3YuaWFzay5jb20vdl9wbGF5LnBocD92aWQ9NTY5MjU2MjItMjI1NzMwMTMzMSZyPXZpZGVvLnNpbmEuY29tLmNu
<span class="variable">&lt;EXPLODEID&gt;</span>2
<span class="variable">&lt;&amp;&gt;</span>
<span class="variable">&lt;$&gt;</span>
<span class="variable">&lt;N&gt;</span>憨豆特工-0003
<span class="variable">&lt;P&gt;</span>新浪网
......
</code></pre><p>显然，<code>&lt;N&gt;</code>后面是片名而<code>&lt;U&gt;</code>后面是地址。</p>
<p>另外，我们观察一下硕鼠当前页面的url地址。</p>
<pre><code><span class="keyword">http</span>://www.flvcd.com/parse.php?kw=http<span class="number">%3</span>A<span class="number">%2</span>F<span class="number">%2</span>Fvideo.sina.com.cn<span class="number">%2</span>Fv<span class="number">%2</span>Fb<span class="number">%2</span>F56925622-2257301331.html
</code></pre><p>显然，kw参数后面是之前sina视频页面地址，只不过已经经过转码处理。</p>
<p>至此，足够我们用python来完成这一切了。</p>
<p>打开ipython：</p>
<pre><code>In <span class="attr_selector">[1]</span><span class="value">: import urllib

In [<span class="number">2</span>]: import urllib2

In [<span class="number">3</span>]: videourl = <span class="string">'http://video.sina.com.cn/v/b/56925622-2257301331.html'</span> 

In [<span class="number">4</span>]: url = <span class="string">'http://www.flvcd.com/parse.php?kw='</span> + urllib.<span class="function">quote</span>(videourl)

In [<span class="number">5</span>]: req = urllib2.<span class="function">Request</span>(url);</span>

In <span class="attr_selector">[6]</span><span class="value">: req.<span class="function">add_header</span>(<span class="string">'host'</span>, <span class="string">'www.flvcd.com'</span>);</span>

In <span class="attr_selector">[7]</span><span class="value">: res = urllib2.<span class="function">urlopen</span>(req)

In [<span class="number">8</span>]: html = res.<span class="function">read</span>()

In [<span class="number">9</span>]: print <span class="function">unicode</span>(html,<span class="string">'gbk'</span>) # 注意硕鼠的页面编码是charset=GB2312</span>
</code></pre><p>至此，我们完成了从硕鼠读取整个网页的操作。并把读取的内容保存在html中。</p>
<p>接下来开始抓地址，根据之前的观察，很容易通过正则表达式完成：</p>
<pre><code>In [<span class="number">13</span>]: import re

In [<span class="number">14</span>]: pattern = re.<span class="function"><span class="title">compile</span><span class="params">(<span class="string">'&lt;input\s+type="hidden"\s+name="inf"\s+value="([^"]+)'</span>)</span></span>

In [<span class="number">15</span>]: match = pattern.<span class="function"><span class="title">search</span><span class="params">(html)</span></span>

In [<span class="number">16</span>]: urls = match.<span class="function"><span class="title">group</span><span class="params">(<span class="number">1</span>)</span></span>

In [<span class="number">17</span>]: urls = <span class="function"><span class="title">unicode</span><span class="params">(urls, <span class="string">'gbk'</span>)</span></span>

In [<span class="number">18</span>]: urlpattern = re.<span class="function"><span class="title">compile</span><span class="params">(<span class="string">'&lt;[NU]&gt;(.+)'</span>)</span></span>

In [<span class="number">19</span>]: result = urlpattern.<span class="function"><span class="title">findall</span><span class="params">(urls)</span></span>
</code></pre><p>至此，<code>&lt;N&gt;</code>和<code>&lt;U&gt;</code>后面的文件名和地址都被以列表的形式保存在result中了。我们可以遍历它来完成下载：</p>
<p>先简单处理下，以文件名-地址成对保存：</p>
<pre><code><span class="type">In</span> [<span class="number">28</span>]: data = [<span class="literal">result</span>[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="type">range</span>(<span class="number">0</span>, len(<span class="literal">result</span>), <span class="number">2</span>)]
</code></pre><p>然后遍历下载：</p>
<pre><code><span class="name">In</span> [<span class="number">32</span>]: <span class="atom">for</span> <span class="atom">k</span>, <span class="atom">v</span> <span class="atom">in</span> <span class="atom">enumerate</span>(<span class="atom">data</span>):                   
    <span class="atom">print</span> <span class="string">'  &gt;downloading Block %.2d ...'</span> <span class="comment">% (k+1,) </span>
    <span class="atom">urllib</span>.<span class="atom">urlretrieve</span>(<span class="atom">v</span>[<span class="number">1</span>], <span class="atom">v</span>[<span class="number">0</span>] + <span class="string">'.flv'</span>) 
    <span class="atom">print</span> <span class="string">'  downloaded Block.%.2d completely&lt;'</span> <span class="comment">% (k+1,)</span>
</code></pre><p>然后？等着……目前的下载器相当简陋，木有进度条，木有断点……</p>
<p>之后就是合并flv的问题了。</p>
<h2 id="合并flv文件">合并flv文件</h2><p>简单起见，直接用这里<a href="https://github.com/soimort/you-get/blob/master/you_get/processor/join_flv.py" target="_blank" rel="external">join_flv.py</a>来完成。</p>
<pre><code>python2 join_flv<span class="class">.py</span> -o out<span class="class">.flv</span> flv1<span class="class">.flv</span> flv2<span class="class">.flv</span> ...
</code></pre><p>如果你想深入了解flv文件结构，参考further reading部分和flv文件<a href="http://download.macromedia.com/f4v/video_file_format_spec_v10_1.pdf" target="_blank" rel="external">规范</a>。</p>
<p><img src="http://fmn.rrimg.com/fmn062/20121203/1830/original_yzzH_5943000093b01191.jpg" alt="flash-data"></p>
<h2 id="Practice">Practice</h2><p>抓取这里的视频。并按名称保存他们:</p>
<ul>
<li><a href="https://class.coursera.org/ml/lecture/preview" target="_blank" rel="external">https://class.coursera.org/ml/lecture/preview</a></li>
<li><a href="http://v.163.com/special/opencourse/machinelearning.html" target="_blank" rel="external">http://v.163.com/special/opencourse/machinelearning.html</a></li>
</ul>
<p>作为正则和urllib、urllib2的练习。</p>
<h2 id="Further_Reading">Further Reading</h2><ul>
<li><a href="http://www.cnblogs.com/-Wind/archive/2012/01/30/dov.html" target="_blank" rel="external">在线视频下载(Using Python / Bash / C / Reguar Expressions)</a></li>
<li><a href="https://www.oschina.net/code/snippet_107925_16025" target="_blank" rel="external">flv文件详解</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_48f93b530100eyoe.html" target="_blank" rel="external">FLV文件格式解析</a></li>
<li><a href="https://github.com/soimort/you-get/blob/master/you_get/processor/join_flv.py" target="_blank" rel="external">you-get</a></li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2012/11/19/flask/" itemprop="url">
                  Flask驱动的静态站点生成器(译)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2012-11-19T00:00:00+08:00" content="2012-11-19">
              2012-11-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2012/11/19/flask/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2012/11/19/flask/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>翻译自：<a href="https://nicolas.perriault.net/code/2012/dead-easy-yet-powerful-static-website-generator-with-flask/" target="_blank" rel="external">Dead easy yet powerful static website generator with Flask</a></p>
<p>纯意译……以下是正文，和jekyll很像的感觉，哈？34行代码完成一个静态站点生成器。</p>
<hr>
<p>我想将我的在线身份统合到一个单独的托管地方很久了，因此有了你现在浏览的这个网站。我也寻找一个静态网站架构有段时间了，尝试了许多但一个也不中意。这真令人沮丧。</p>
<p>然后遇到<a href="https://twitter.com/#!/mitsuhiko/statuses/166570613295689728" target="_blank" rel="external">Armin Ronacher的这个tweet</a>：</p>
<blockquote class="twitter-tweet tw-align-center"><br>    <p>Frozen-Flask is really, really useful. Should have used that earlier.</p>&mdash; Armin Ronacher (@mitsuhiko) <a href="https://twitter.com/mitsuhiko/status/166570613295689728" data-datetime="2012-02-06T17:15:03+00:00" target="_blank" rel="external">February 6, 2012</a><br></blockquote>

<p><a href="http://lucumr.pocoo.org/" target="_blank" rel="external">Armin</a>是<a href="http://flask.pocoo.org/" target="_blank" rel="external">Flask</a>这个Python微框架的作者，我喜欢flask的简洁。所以这个tweet一个机灵，我便开始探索<a href="http://packages.python.org/Frozen-Flask/" target="_blank" rel="external">Frozen-Flask</a>的玩法。</p>
<p>Frozen-Flask将Flask应用<em>冻结</em>成静态文件，这样你能够高速而无痛地部署它们。再佐以<a href="http://packages.python.org/Flask-FlatPages/" target="_blank" rel="external">Flask-FlatPages</a>，你获得了完美的生成静态站点工具集，这个站点将有所以你使用框架能得到的特性。</p>
<ul>
<li>酷的urls和简单的路径管理</li>
<li>强大的模板</li>
<li>本地动态服务</li>
<li>静态版本管理</li>
</ul>
<h2 id="第一轮：项目搭建">第一轮：项目搭建</h2><p>在新文件夹中创建个新的<a href="http://pypi.python.org/pypi/virtualenv" target="_blank" rel="external">virtualenv</a>，使用<a href="http://pypi.python.org/pypi/pip" target="_blank" rel="external">pip</a>安装必要的包：</p>
<pre><code><span class="variable">$ </span>mkdir sample_project &amp;&amp; cd !<span class="variable">$
</span><span class="variable">$ </span>mkvirtualenv --no-site-packages <span class="string">`pwd`</span>/env
<span class="variable">$ </span>source env/bin/activate
<span class="variable">$ </span>pip install <span class="constant">Flask</span> <span class="constant">Frozen</span>-<span class="constant">Flask</span> <span class="constant">Flask</span>-<span class="constant">FlatPages</span>
</code></pre><p>写我们第一个版本的<code>sitebuilder.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run(port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>运行它;你应该看到类似：</p>
<pre><code><span class="variable">$ </span>python sitebuilder.py 
 * <span class="constant">Running</span> on <span class="symbol">http:</span>/<span class="regexp">/127.0.0.1:8000/</span> 
 * <span class="constant">Restarting</span> <span class="keyword">with</span> reloader
</code></pre><p>用浏览器打开<em><a href="http://:127.0.0.1:8000" target="_blank" rel="external">http://:127.0.0.1:8000</a></em>看是否正常。</p>
<h2 id="又一轮：添加纯文本页面">又一轮：添加纯文本页面</h2><p><a href="http://packages.python.org/Flask-FlatPages/" target="_blank" rel="external">Flask-FlatPages</a>为你的Flask应用提供一套页面。相对动态页面从关系数据库构建，静态页面是从纯文本文件构建。</p>
<p>在你的项目跟文件夹下创建一个<code>pages/</code>目录，新建一个<code>hello-wolrd.md</code>扔进去：</p>
<p>$ mkdir pages<br>$ vi pages/hello-world.md</p>
<p><code>hello-world.md</code>文件：</p>
<pre><code><span class="attribute">title</span>: <span class="string">Hello World</span>
<span class="attribute">date</span>: <span class="string">2012-03-04</span>

<span class="gherkin"><span class="keyword">*</span><span class="keyword">*</span>Hello World<span class="keyword">*</span><span class="keyword">*</span>, from a <span class="keyword">*</span>page<span class="keyword">*</span>!</span>
</code></pre><p>如你所见你可以在页面内容中写入<a href="/404">Markdown</a>。所以让我们重新写我们的应用来为通过文件名为任何纯文本提供服务。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_flatpages <span class="keyword">import</span> FlatPages</span><br><span class="line"></span><br><span class="line">DEBUG = <span class="keyword">True</span></span><br><span class="line">FLATPAGES_AUTO_RELOAD = DEBUG</span><br><span class="line">FLATPAGES_EXTENSION = <span class="string">'.md'</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(__name__)</span><br><span class="line">pages = FlatPages(app)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/&lt;path:path&gt;/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span><span class="params">(path)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> pages.get_or_404(path).html</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>现在访问<code>http://127.0.0.1:8000/hello-world/</code>将呈现渲染后的纯文本。注意通过page对象获得html属性markdown源码被转换成html。</p>
<h2 id="又一轮：添加模板">又一轮：添加模板</h2><p>flask使用<a href="http://jinja.pocoo.org/docs/" target="_blank" rel="external">jinja2</a>模板引擎，让我们创建一些模板来装饰页面。首先在项目根目录下创建一个<code>templates</code>文件夹：</p>
<pre><code><span class="variable">$ </span>mkdir templates
</code></pre><p>在<code>templates/base.html</code>中创建基本布局：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>My site<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">h1</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"&#123;&#123; url_for("</span><span class="value">index")</span> &#125;&#125;"&gt;</span>My site<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="title">p</span>&gt;</span>Default content to be displayed<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">&#123;% endblock content %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意<code>url_for()</code>这个模板函数，这是我们使用Flask和Jinjia2生成url的方式。</p>
<p>现在用<code>page.html</code>模板来填充页面内容的布局：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="title">h2</span>&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% endblock content %&#125;</span><br></pre></td></tr></table></figure>
<p>我们的应用现在应该是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_flatpages <span class="keyword">import</span> FlatPages</span><br><span class="line"></span><br><span class="line">DEBUG = <span class="keyword">True</span></span><br><span class="line">FLATPAGES_AUTO_RELOAD = DEBUG</span><br><span class="line">FLATPAGES_EXTENSION = <span class="string">'.md'</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(__name__)</span><br><span class="line">pages = FlatPages(app)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/&lt;path:path&gt;/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span><span class="params">(path)</span>:</span></span><br><span class="line">    page = pages.get_or_404(path)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'page.html'</span>, page=page)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>见鬼，我们刚刚做了什么？</p>
<ul>
<li>创建了一个应用的模板;一个通用布局(base.html)和一个页面模板(page.html)</li>
<li>我们使用<code>render_template</code>函数对页面用页面模板装饰。</li>
<li>页面模板扩展基本模板来避免在每个页面都复制粘帖相同的内容。</li>
</ul>
<h2 id="又一轮：在主页呈现页面列表">又一轮：在主页呈现页面列表</h2><p>现在我们的主页弱爆了。我们让它列出所有存在的页面。</p>
<p>创建一个<code>templates/index.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="title">h2</span>&gt;</span>List of stuff<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">    &#123;% for page in pages %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"&#123;&#123; url_for("</span><span class="value">page",</span> <span class="attribute">path</span>=<span class="value">page.path)</span> &#125;&#125;"&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span>&gt;</span>No stuff.<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">&#123;% endblock content %&#125;</span><br></pre></td></tr></table></figure>
<p>随意地创建更多纯文本页面，就像我们创建<code>hello-world.md</code>一样，将文件保存在<code>pages/</code>目录下，使用<code>.md</code>扩展名。</p>
<p>我们应用中的<code>index()</code>路径现在应该这样：</p>
<p>重载主页，页面列表将呈现。真他妈简单。</p>
<h2 id="又一轮：给页面添加元数据">又一轮：给页面添加元数据</h2><p>Flask-FlatPages允许像我们创建和<code>hello-world.md</code>的标题和日期一样添加元数据，并且通过<code>page.meta</code>来存取它们，获得看上去蠢蠢的python字典。真令人吃惊，不是吗？</p>
<p>让我们假设想要给页面添加标签，我们的<code>hello-world.md</code>将变成：</p>
<pre><code><span class="attribute">title</span>: <span class="string">Hello World</span>
<span class="attribute">date</span>: <span class="string">2012-03-04</span>
<span class="attribute">tags</span>: <span class="string">[general, awesome, stuff]</span>

<span class="gherkin"><span class="keyword">*</span><span class="keyword">*</span>Hello World<span class="keyword">*</span><span class="keyword">*</span>, from a <span class="keyword">*</span>page<span class="keyword">*</span>!</span>
</code></pre><p>元数据用<a href="http://yaml.org/" target="_blank" rel="external">YAML</a>描述，因此你能够使用字符串、布尔、整数、浮点、列表、甚至字典，它们将转换成Python相应的内在等价物。</p>
<p>我们将使用两个包含共享部分的不同的模板来列出普通页面和标签页面，<code>index.html</code>现在应该是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="title">h2</span>&gt;</span>List of stuff<span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line">    &#123;% with pages=pages  %&#125;</span><br><span class="line">        &#123;% include "_list.html" %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line">&#123;% endblock content %&#125;</span><br></pre></td></tr></table></figure>
<p>创建<code>tag.html</code>模板，它将用来呈现标签页面列表：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "base.html" %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="title">h2</span>&gt;</span>List of stuff tagged <span class="tag">&lt;<span class="title">em</span>&gt;</span>&#123;&#123; tag &#125;&#125;<span class="tag">&lt;/<span class="title">em</span>&gt;</span><span class="tag">&lt;/<span class="title">h2</span>&gt;</span></span><br><span class="line">    &#123;% with pages=pages  %&#125;</span><br><span class="line">        &#123;% include "_list.html" %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line">&#123;% endblock content %&#125;</span><br></pre></td></tr></table></figure>
<p>新建的<code>_list.html</code>模板应该包含：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">&#123;% for page in pages %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"&#123;&#123; url_for("</span><span class="value">page",</span> <span class="attribute">path</span>=<span class="value">page.path)</span> &#125;&#125;"&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">    &#123;% if page.meta.tags|length %&#125;</span><br><span class="line">        | Tagged:</span><br><span class="line">        &#123;% for page_tag in page.meta.tags %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"&#123;&#123; url_for("</span><span class="value">tag",</span> <span class="attribute">tag</span>=<span class="value">page_tag)</span> &#125;&#125;"&gt;</span>&#123;&#123; page_tag &#125;&#125;<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="title">li</span>&gt;</span>No page.<span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>向应用中添加新的tag路径，使用新的<code>tag.html</code>模板：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="decorator">@app.route('/tag/&lt;string:tag&gt;/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(tag)</span>:</span></span><br><span class="line">    tagged = [p <span class="keyword">for</span> p <span class="keyword">in</span> pages <span class="keyword">if</span> tag <span class="keyword">in</span> p.meta.get(<span class="string">'tags'</span>, [])]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'tag.html'</span>, pages=tagged, tag=tag)</span><br></pre></td></tr></table></figure>
<p>注：若你之前不喜欢python的<a href="http://www.network-theory.co.uk/docs/pytut/ListComprehensions.html" target="_blank" rel="external">列表推导式</a>，现在你会了。</p>
<h2 id="又一轮：生成静态页面">又一轮：生成静态页面</h2><p>好的，现在我们只要有一个动态网站，为存储在文件系统上的纯文本页面提供服务：废话。但是我们当然不是Flask应用而是一堆静态文件，省去了任何应用服务器。</p>
<p>来进入Frozen-Flask。它的使用真他妈简单：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"><span class="keyword">from</span> flask_flatpages <span class="keyword">import</span> FlatPages</span><br><span class="line"><span class="keyword">from</span> flask_frozen <span class="keyword">import</span> Freezer</span><br><span class="line"></span><br><span class="line">DEBUG = <span class="keyword">True</span></span><br><span class="line">FLATPAGES_AUTO_RELOAD = DEBUG</span><br><span class="line">FLATPAGES_EXTENSION = <span class="string">'.md'</span></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(__name__)</span><br><span class="line">pages = FlatPages(app)</span><br><span class="line">freezer = Freezer(app)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, pages=pages)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/tag/&lt;string:tag&gt;/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tag</span><span class="params">(tag)</span>:</span></span><br><span class="line">    tagged = [p <span class="keyword">for</span> p <span class="keyword">in</span> pages <span class="keyword">if</span> tag <span class="keyword">in</span> p.meta.get(<span class="string">'tags'</span>, [])]</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'tag.html'</span>, pages=tagged, tag=tag)</span><br><span class="line"></span><br><span class="line"><span class="decorator">@app.route('/&lt;path:path&gt;/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span><span class="params">(path)</span>:</span></span><br><span class="line">    page = pages.get_or_404(path)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'page.html'</span>, page=page)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">and</span> sys.argv[<span class="number">1</span>] == <span class="string">"build"</span>:</span><br><span class="line">        freezer.freeze()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        app.run(port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>
<p>然后运行：</p>
<pre><code>$ python sitebuilder<span class="class">.py</span> build
</code></pre><p>打开构建文件夹键入如下命令：</p>
<pre><code>$ tree
.
├── hello-world
│   └── index<span class="class">.html</span>
├── index<span class="class">.html</span>
└── tag
    ├── awesome
    │   └── index<span class="class">.html</span>
    ├── general
    │   └── index<span class="class">.html</span>
    └── stuff
        └── index<span class="class">.html</span>

<span class="number">5</span> directories, <span class="number">5</span> files
</code></pre><h2 id="想法：吓坏了">想法：吓坏了</h2><p>你现在能部署<code>build</code>目录下的任何文件到任何能托管静态文件的地方了，而你仅仅用34行Python代码就完成了……不错吧？</p>
<p>当然，现在的版本弱爆了，你能一点一点的为它添加各种特性了。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2012/11/12/numpyscipy/" itemprop="url">
                  使用Numpy和Scipy处理图像
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2012-11-12T00:00:00+08:00" content="2012-11-12">
              2012-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2012/11/12/numpyscipy/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2012/11/12/numpyscipy/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Image_manipulation_and_processing_using_Numpy_and_Scipy">Image manipulation and processing using Numpy and Scipy</h1><p>翻译自：<a href="http://scipy-lectures.github.com/advanced/image_processing/index.html" target="_blank" rel="external">http://scipy-lectures.github.com/advanced/image_processing/index.html</a></p>
<p>作者：Emmanuelle Gouillart, Gaël Varoquaux</p>
<pre><code>图像 = <span class="number">2</span>-D 数值数组

(或者 <span class="number">3</span>-D: CT, MRI, <span class="number">2</span>D + 时间; <span class="number">4</span>-D, ...)

这里 图像 == Numpy数组 np.<span class="built_in">array</span>
</code></pre><p>这个教程中使用的工具：</p>
<ul>
<li>numpy：基本数组操作</li>
<li><p>scipy：<code>scipy.ndimage</code>子模块致力于图像处理(n维图像)。参见<a href="http://docs.scipy.org/doc/scipy/reference/tutorial/ndimage.html" target="_blank" rel="external">http://docs.scipy.org/doc/scipy/reference/tutorial/ndimage.html</a></p>
<pre><code><span class="keyword">from</span> scipy <span class="keyword">import</span> ndimage
</code></pre></li>
<li><p>一些例子用到了使用np.array的特殊的工具箱：</p>
<ul>
<li><a href="http://scikits-image.org/" target="_blank" rel="external">Scikit Image</a></li>
<li><a href="http://scikit-learn.org/" target="_blank" rel="external">scikit-learn</a></li>
</ul>
</li>
</ul>
<p>图像中的常见问题有：</p>
<ul>
<li>输入/输出，呈现图像</li>
<li>基本操作：裁剪、翻转、旋转……</li>
<li>图像滤镜：消噪，锐化</li>
<li>图像分割：不同对应对象的像素标记</li>
</ul>
<p>更有力和完整的模块：</p>
<ul>
<li><a href="http://opencv.willowgarage.com/documentation/python/cookbook.html" target="_blank" rel="external">OpenCV</a> (Python绑定)</li>
<li><a href="http://www.cellprofiler.org/" target="_blank" rel="external">CellProfiler</a></li>
<li><a href="http://www.itk.org/" target="_blank" rel="external">ITK</a>,Python绑定</li>
<li>更多……</li>
</ul>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<h2 id="打开和读写图像文件">打开和读写图像文件</h2><p>将一个数组写入文件：</p>
<pre><code><span class="keyword">In</span> [1]: from scipy import misc

<span class="keyword">In</span> [2]: <span class="keyword">l</span> = misc.lena()

<span class="keyword">In</span> [3]: misc.imsave('lena.png', <span class="keyword">l</span>)  # uses the Image module (PIL)

<span class="keyword">In</span> [4]: import pylab <span class="keyword">as</span> <span class="keyword">pl</span>

<span class="keyword">In</span> [5]: <span class="keyword">pl</span>.imshow(<span class="keyword">l</span>)
<span class="keyword">Out</span>[5]: &lt;matplotlib.image.AxesImage at 0x4118110&gt;
</code></pre><p>从一个图像文件创建数组：</p>
<pre><code>In [<span class="number">7</span>]: lena = misc.<span class="function"><span class="title">imread</span><span class="params">(<span class="string">'lena.png'</span>)</span></span>

In [<span class="number">8</span>]: <span class="function"><span class="title">type</span><span class="params">(lena)</span></span>
Out[<span class="number">8</span>]: numpy<span class="class">.ndarray</span>

In [<span class="number">9</span>]: lena<span class="class">.shape</span>, lena<span class="class">.dtype</span>
Out[<span class="number">9</span>]: ((<span class="number">512</span>, <span class="number">512</span>), <span class="function"><span class="title">dtype</span><span class="params">(<span class="string">'uint8'</span>)</span></span>)
</code></pre><p>8位图像(0-255)的dtype是uint8</p>
<p>打开一个raw文件(相机， 3-D图像)</p>
<pre><code><span class="keyword">In</span> [<span class="number">10</span>]: l.tofile(<span class="string">'lena.raw'</span>)  # 创建一个raw文件

<span class="keyword">In</span> [<span class="number">14</span>]: lena_from_raw = np.fromfile(<span class="string">'lena.raw'</span>, dtype=np.int64)

<span class="keyword">In</span> [<span class="number">15</span>]: lena_from_raw.shape
<span class="keyword">Out</span>[<span class="number">15</span>]: (<span class="number">262144</span>,)

<span class="keyword">In</span> [<span class="number">16</span>]: lena_from_raw.shape = (<span class="number">512</span>, <span class="number">512</span>)

<span class="keyword">In</span> [<span class="number">17</span>]: import os

<span class="keyword">In</span> [<span class="number">18</span>]: os.<span class="keyword">remove</span>(<span class="string">'lena.raw'</span>)
</code></pre><p>需要知道图像的shape和dtype(如何区分隔数据字节)</p>
<p>对于大数据，使用<code>np.memmap</code>进行内存映射：</p>
<pre><code>In [<span class="number">21</span>]: lena_memmap = np.<span class="function"><span class="title">memmap</span><span class="params">(<span class="string">'lena.raw'</span>, dtype=np.int64, shape=(<span class="number">512</span>,<span class="number">512</span>)</span></span>)
</code></pre><p>(数据从文件读取，而不是载入内存)</p>
<p>处理一个列表的图像文件：</p>
<pre><code>In [<span class="number">22</span>]: <span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> <span class="function"><span class="title">range</span><span class="params">(<span class="number">10</span>)</span></span>:
   ....:     im = np<span class="class">.random</span><span class="class">.random_integers</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">10000</span>).<span class="function"><span class="title">reshape</span><span class="params">((<span class="number">100</span>, <span class="number">100</span>)</span></span>)
   ....:     misc.<span class="function"><span class="title">imsave</span><span class="params">(<span class="string">'random_%02d.png'</span> % i, im)</span></span>
   ....:     

In [<span class="number">23</span>]: from glob import glob

In [<span class="number">24</span>]: filelist = <span class="function"><span class="title">glob</span><span class="params">(<span class="string">'random*.png'</span>)</span></span>

In [<span class="number">25</span>]: filelist.<span class="function"><span class="title">sort</span><span class="params">()</span></span>
</code></pre><h2 id="呈现图像">呈现图像</h2><p>使用<code>matplotlib</code>和<code>imshow</code>将图像呈现在matplotlib图像(figure)中：</p>
<pre><code>In [<span class="number">29</span>]: l = misc.<span class="function"><span class="title">lena</span><span class="params">()</span></span>

In [<span class="number">30</span>]: import matplotlib<span class="class">.pyplot</span> as plt

In [<span class="number">31</span>]: plt.<span class="function"><span class="title">imshow</span><span class="params">(l, cmap=plt.cm.gray)</span></span>
Out[<span class="number">31</span>]: &lt;matplotlib<span class="class">.image</span><span class="class">.AxesImage</span> at <span class="number">0</span>x4964990&gt;
</code></pre><p>通过设置最大最小之增加对比：</p>
<pre><code><span class="keyword">In</span> [<span class="number">33</span>]: plt.imshow(l, cmap=plt.cm.gray, vmin=<span class="number">30</span>, vmax=<span class="number">200</span>)
<span class="keyword">Out</span>[<span class="number">33</span>]: &lt;matplotlib.image.AxesImage <span class="preprocessor">at</span> <span class="number">0x50cb790</span>&gt;

<span class="keyword">In</span> [<span class="number">34</span>]: plt.axis(<span class="string">'off'</span>)  # 移除axes和ticks
<span class="keyword">Out</span>[<span class="number">34</span>]: (-<span class="number">0.5</span>, <span class="number">511.5</span>, <span class="number">511.5</span>, -<span class="number">0.5</span>)
</code></pre><p>绘制等高线：<a href="占位">^1</a></p>
<pre><code>ln[<span class="number">7</span>]: plt.contour(l, [<span class="number">60</span>, <span class="number">211</span>])
</code></pre><p>更好地观察强度变化，使用<code>interpolate=‘nearest’</code>：</p>
<pre><code>In [<span class="number">7</span>]: plt.<span class="function"><span class="title">imshow</span><span class="params">(l[<span class="number">200</span>:<span class="number">220</span>, <span class="number">200</span>:<span class="number">220</span>], cmap=plt.cm.gray)</span></span>
Out[<span class="number">7</span>]: &lt;matplotlib<span class="class">.image</span><span class="class">.AxesImage</span> at <span class="number">0</span>x3bbe610&gt;

In [<span class="number">8</span>]: plt.<span class="function"><span class="title">imshow</span><span class="params">(l[<span class="number">200</span>:<span class="number">220</span>, <span class="number">200</span>:<span class="number">220</span>], cmap=plt.cm.gray, interpolation=<span class="string">'nearest'</span>)</span></span>
Out[<span class="number">8</span>]: &lt;matplotlib<span class="class">.image</span><span class="class">.AxesImage</span> at <span class="number">0</span>x3ed3250&gt;
</code></pre><p>其它包有时使用图形工具箱来可视化(GTK，Qt)：[^2]</p>
<pre><code>In [<span class="number">9</span>]: import skimage<span class="class">.io</span> as im_io

In [<span class="number">21</span>]: im_io.<span class="function"><span class="title">use_plugin</span><span class="params">(<span class="string">'gtk'</span>, <span class="string">'imshow'</span>)</span></span>

In [<span class="number">22</span>]: im_io.<span class="function"><span class="title">imshow</span><span class="params">(l)</span></span>
</code></pre><p><strong>3-D可视化：Mayavi</strong></p>
<p>参见<a href="http://scipy-lectures.github.com/advanced/3d_plotting/index.html#mayavi-label" target="_blank" rel="external">可用Mayavi进行3-D绘图</a>和<a href="http://scipy-lectures.github.com/advanced/3d_plotting/3d_plotting_functions.html#mayavi-voldata-label" target="_blank" rel="external">体积数据</a></p>
<ul>
<li>图形平面工具</li>
<li>等值面</li>
<li>……</li>
</ul>
<h2 id="基本操作">基本操作</h2><p>图像是数组：使用整个<code>numpy</code>机理。</p>
<p><img src="http://scipy-lectures.github.com/_images/axis_convention.png" alt="basic"></p>
<pre><code>&gt;&gt;&gt; lena = misc.lena()
&gt;&gt;&gt; lena[<span class="number">0</span>, <span class="number">40</span>]
<span class="number">166</span>
&gt;&gt;&gt; <span class="preprocessor"># Slicing</span>
&gt;&gt;&gt; lena[<span class="number">10</span>:<span class="number">13</span>, <span class="number">20</span>:<span class="number">23</span>]
<span class="built_in">array</span>([[<span class="number">158</span>, <span class="number">156</span>, <span class="number">157</span>],
[<span class="number">157</span>, <span class="number">155</span>, <span class="number">155</span>],
[<span class="number">157</span>, <span class="number">157</span>, <span class="number">158</span>]])
&gt;&gt;&gt; lena[<span class="number">100</span>:<span class="number">120</span>] = <span class="number">255</span>
&gt;&gt;&gt;
&gt;&gt;&gt; lx, ly = lena.shape
&gt;&gt;&gt; X, Y = np.ogrid[<span class="number">0</span>:lx, <span class="number">0</span>:ly]
&gt;&gt;&gt; mask = (X - lx/<span class="number">2</span>)**<span class="number">2</span> + (Y - ly/<span class="number">2</span>)**<span class="number">2</span> &gt; lx*ly/<span class="number">4</span>
&gt;&gt;&gt; <span class="preprocessor"># Masks</span>
&gt;&gt;&gt; lena[mask] = <span class="number">0</span>
&gt;&gt;&gt; <span class="preprocessor"># Fancy indexing</span>
&gt;&gt;&gt; lena[range(<span class="number">400</span>), range(<span class="number">400</span>)] = <span class="number">255</span>
</code></pre><h3 id="统计信息">统计信息</h3><pre><code>&gt;&gt;&gt; lena = scipy.<span class="function"><span class="title">lena</span><span class="params">()</span></span>
&gt;&gt;&gt; lena.<span class="function"><span class="title">mean</span><span class="params">()</span></span>
<span class="number">124.04678344726562</span>
&gt;&gt;&gt; lena.<span class="function"><span class="title">max</span><span class="params">()</span></span>, lena.<span class="function"><span class="title">min</span><span class="params">()</span></span>
(<span class="number">245</span>, <span class="number">25</span>)
</code></pre><p><code>np.histogram</code></p>
<h3 id="几何转换">几何转换</h3><pre><code><span class="prompt">&gt;&gt;</span>&gt; lena = scipy.lena()
<span class="prompt">&gt;&gt;</span>&gt; lx, ly = lena.shape
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># Cropping</span>
<span class="prompt">&gt;&gt;</span>&gt; crop_lena = lena[lx/<span class="number">4</span><span class="symbol">:-lx/</span><span class="number">4</span>, ly/<span class="number">4</span><span class="symbol">:-ly/</span><span class="number">4</span>]
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># up &lt;-&gt; down flip</span>
<span class="prompt">&gt;&gt;</span>&gt; flip_ud_lena = np.flipud(lena)
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># rotation</span>
<span class="prompt">&gt;&gt;</span>&gt; rotate_lena = ndimage.rotate(lena, <span class="number">45</span>)
<span class="prompt">&gt;&gt;</span>&gt; rotate_lena_noreshape = ndimage.rotate(lena, <span class="number">45</span>, reshape=<span class="constant">False</span>)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_geom_lena_1.png" alt="Geometrical transformations"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_geom_lena.html#example-plot-geom-lena-py" target="_blank" rel="external">示例源码</a></p>
<h2 id="图像滤镜">图像滤镜</h2><p><strong>局部滤镜</strong>：用相邻像素值的函数替代当前像素的值。</p>
<p>相邻：方形(指定大小)，圆形， 或者更多复杂的<em>结构元素</em>。</p>
<h3 id="模糊/平滑">模糊/平滑</h3><p><code>scipy.ndimage</code>中的<em>高斯滤镜</em>：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; from scipy import misc
<span class="prompt">&gt;&gt;</span>&gt; from scipy import ndimage
<span class="prompt">&gt;&gt;</span>&gt; lena = misc.lena()
<span class="prompt">&gt;&gt;</span>&gt; blurred_lena = ndimage.gaussian_filter(lena, sigma=<span class="number">3</span>)
<span class="prompt">&gt;&gt;</span>&gt; very_blurred = ndimage.gaussian_filter(lena, sigma=<span class="number">5</span>)
</code></pre><p><em>均匀滤镜</em></p>
<pre><code>&gt;&gt;&gt; local_mean = ndimage.<span class="function"><span class="title">uniform_filter</span><span class="params">(lena, size=<span class="number">11</span>)</span></span>
</code></pre><p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_blur.html#example-plot-blur-py" target="_blank" rel="external">示例源码</a></p>
<h3 id="锐化">锐化</h3><p>锐化模糊图像：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; from scipy import misc
<span class="prompt">&gt;&gt;</span>&gt; lena = misc.lena()
<span class="prompt">&gt;&gt;</span>&gt; blurred_l = ndimage.gaussian_filter(lena, <span class="number">3</span>)
</code></pre><p>通过增加拉普拉斯近似增加边缘权重：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; filter_blurred_l = ndimage.gaussian_filter(blurred_l, <span class="number">1</span>)
<span class="prompt">&gt;&gt;</span>&gt; alpha = <span class="number">30</span>
<span class="prompt">&gt;&gt;</span>&gt; sharpened = blurred_l + alpha * (blurred_l - filter_blurred_l)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_sharpen_1.png" alt="sharpen"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_sharpen.html#example-plot-sharpen-py" target="_blank" rel="external">示例源码</a></p>
<h3 id="消噪">消噪</h3><p>向lena增加噪声：</p>
<pre><code>&gt;&gt;&gt; from scipy import misc
&gt;&gt;&gt; l = misc.<span class="function"><span class="title">lena</span><span class="params">()</span></span>
&gt;&gt;&gt; l = l[<span class="number">230</span>:<span class="number">310</span>, <span class="number">210</span>:<span class="number">350</span>]
&gt;&gt;&gt; noisy = l + <span class="number">0.4</span>*l.<span class="function"><span class="title">std</span><span class="params">()</span></span>*np<span class="class">.random</span><span class="class">.random</span>(l.shape)
</code></pre><p><em>高斯滤镜</em>平滑掉噪声……还有边缘：</p>
<pre><code>&gt;&gt;&gt; gauss_denoised = ndimage.<span class="function"><span class="title">gaussian_filter</span><span class="params">(noisy, <span class="number">2</span>)</span></span>
</code></pre><p>大多局部线性各向同性滤镜都模糊图像(<code>ndimage.uniform_filter</code>)</p>
<p><em>中值滤镜</em>更好地保留边缘：</p>
<pre><code>&gt;&gt;&gt; med_denoised = ndimage.<span class="function"><span class="title">median_filter</span><span class="params">(noisy, <span class="number">3</span>)</span></span>
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_lena_denoise_1.png" alt="guassian&amp;median"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_lena_denoise.html#example-plot-lena-denoise-py" target="_blank" rel="external">示例源码</a></p>
<p>中值滤镜：对直边界效果更好(低曲率)：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; im = np.zeros((<span class="number">20</span>, <span class="number">20</span>))
<span class="prompt">&gt;&gt;</span>&gt; im[<span class="number">5</span><span class="symbol">:-</span><span class="number">5</span>, <span class="number">5</span><span class="symbol">:-</span><span class="number">5</span>] = <span class="number">1</span>
<span class="prompt">&gt;&gt;</span>&gt; im = ndimage.distance_transform_bf(im)
<span class="prompt">&gt;&gt;</span>&gt; im_noise = im + <span class="number">0</span>.<span class="number">2</span>*np.random.randn(*im.shape)
<span class="prompt">&gt;&gt;</span>&gt; im_med = ndimage.median_filter(im_noise, <span class="number">3</span>)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_denoising_1.png" alt="median"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_denoising.html#example-plot-denoising-py" target="_blank" rel="external">示例源码</a></p>
<p>其它排序滤波器：<code>ndimage.maximum_filter</code>,<code>ndimage.percentile_filter</code></p>
<p>其它局部非线性滤波器：维纳滤波器(<code>scipy.signal.wiener</code>)等</p>
<p><strong>非局部滤波器</strong></p>
<p><em>总变差(TV)</em>消噪。找到新的图像让图像的总变差(正态L1梯度的积分)变得最小，当接近测量图像时：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># from skimage.filter import tv_denoise</span>
<span class="prompt">&gt;&gt;</span>&gt; from tv_denoise import tv_denoise
<span class="prompt">&gt;&gt;</span>&gt; tv_denoised = tv_denoise(noisy, weight=<span class="number">10</span>)
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># More denoising (to the expense of fidelity to data)</span>
<span class="prompt">&gt;&gt;</span>&gt; tv_denoised = tv_denoise(noisy, weight=<span class="number">50</span>)
</code></pre><p>总变差滤镜<code>tv_denoise</code>可以从<code>skimage</code>中获得，(文档:<a href="http://scikit-image.org/docs/dev/api/skimage.filter.html#denoise-tv" target="_blank" rel="external">http://scikit-image.org/docs/dev/api/skimage.filter.html#denoise-tv</a>)，但是为了方便我们在这个教程中作为一个<em>单独模块</em>导入。</p>
<p><img src="http://scipy-lectures.github.com/_images/plot_lena_tv_denoise_1.png" alt="tv"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_lena_tv_denoise.html#example-plot-lena-tv-denoise-py" target="_blank" rel="external">示例源码</a></p>
<h3 id="数学形态学">数学形态学</h3><p>参见：<a href="http://en.wikipedia.org/wiki/Mathematical_morphology" target="_blank" rel="external">http://en.wikipedia.org/wiki/Mathematical_morphology</a></p>
<p><em>结构元素</em>：</p>
<pre><code>&gt;&gt;&gt; el = ndimage.generate_binary_structure(<span class="number">2</span>, <span class="number">1</span>)
&gt;&gt;&gt; el
<span class="keyword">array</span>([[<span class="keyword">False</span>,  <span class="keyword">True</span>, <span class="keyword">False</span>],
       [ <span class="keyword">True</span>,  <span class="keyword">True</span>,  <span class="keyword">True</span>],
       [<span class="keyword">False</span>,  <span class="keyword">True</span>, <span class="keyword">False</span>]], dtype=<span class="keyword">bool</span>)
&gt;&gt;&gt; el.astype(np.<span class="keyword">int</span>)
<span class="keyword">array</span>([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],
       [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],
       [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]])
</code></pre><p><em>腐蚀</em> = 最小化滤镜。用结构元素覆盖的像素的最小值替代一个像素值：</p>
<pre><code>&gt;&gt;&gt; a = np.zeros((7,7), dtype=np.int)
&gt;&gt;&gt; a<span class="comment">[1:6, 2:5]</span> = 1
&gt;&gt;&gt; a
array(<span class="comment">[<span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 1, 1, 1, 0, 0]</span>,
       <span class="comment">[0, 0, 1, 1, 1, 0, 0]</span>,
       <span class="comment">[0, 0, 1, 1, 1, 0, 0]</span>,
       <span class="comment">[0, 0, 1, 1, 1, 0, 0]</span>,
       <span class="comment">[0, 0, 1, 1, 1, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>]</span>)
&gt;&gt;&gt; ndimage.binary_erosion(a).astype(a.dtype)
array(<span class="comment">[<span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 1, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 1, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 1, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>]</span>)
&gt;&gt;&gt; #Erosion removes objects smaller than the structure
&gt;&gt;&gt; ndimage.binary_erosion(a, structure=np.ones((5,5))).astype(a.dtype)
array(<span class="comment">[<span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>,
       <span class="comment">[0, 0, 0, 0, 0, 0, 0]</span>]</span>)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/morpho_mat.png" alt="erosion"></p>
<p><em>膨胀</em>：最大化滤镜:</p>
<pre><code>&gt;&gt;&gt; <span class="tag">a</span> = np.<span class="function"><span class="title">zeros</span><span class="params">((<span class="number">5</span>, <span class="number">5</span>)</span></span>)
&gt;&gt;&gt; <span class="tag">a</span>[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1</span>
&gt;&gt;&gt; <span class="tag">a</span>
array([[ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">1</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.]])
&gt;&gt;&gt; ndimage.<span class="function"><span class="title">binary_dilation</span><span class="params">(a)</span></span>.<span class="function"><span class="title">astype</span><span class="params">(a.dtype)</span></span>
array([[ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">1</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">1</span>.,  <span class="number">1</span>.,  <span class="number">1</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">1</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.],
       [ <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.,  <span class="number">0</span>.]])
</code></pre><p>对灰度值图像也有效：</p>
<pre><code>&gt;&gt;&gt; np<span class="class">.random</span><span class="class">.seed</span>(<span class="number">2</span>)
&gt;&gt;&gt; x, y = (<span class="number">63</span>*np<span class="class">.random</span><span class="class">.random</span>((<span class="number">2</span>, <span class="number">8</span>))).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>
&gt;&gt;&gt; im[x, y] = np.<span class="function"><span class="title">arange</span><span class="params">(<span class="number">8</span>)</span></span>

&gt;&gt;&gt; bigger_points = ndimage.<span class="function"><span class="title">grey_dilation</span><span class="params">(im, size=(<span class="number">5</span>, <span class="number">5</span>)</span></span>, structure=np.<span class="function"><span class="title">ones</span><span class="params">((<span class="number">5</span>, <span class="number">5</span>)</span></span>))

&gt;&gt;&gt; square = np.<span class="function"><span class="title">zeros</span><span class="params">((<span class="number">16</span>, <span class="number">16</span>)</span></span>)
&gt;&gt;&gt; square[<span class="number">4</span>:-<span class="number">4</span>, <span class="number">4</span>:-<span class="number">4</span>] = <span class="number">1</span>
&gt;&gt;&gt; dist = ndimage.<span class="function"><span class="title">distance_transform_bf</span><span class="params">(square)</span></span>
&gt;&gt;&gt; dilate_dist = ndimage.<span class="function"><span class="title">grey_dilation</span><span class="params">(dist, size=(<span class="number">3</span>, <span class="number">3</span>)</span></span>, \
...         structure=np.<span class="function"><span class="title">ones</span><span class="params">((<span class="number">3</span>, <span class="number">3</span>)</span></span>))
</code></pre><p><img src="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_greyscale_dilation.html" alt="gray-delation"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_greyscale_dilation.html#example-plot-greyscale-dilation-py" target="_blank" rel="external">示例源码</a></p>
<p><em>开操作</em>：腐蚀+膨胀：</p>
<p><em>应用</em>：移除噪声</p>
<pre><code>&gt;&gt;&gt; square = np.<span class="function"><span class="title">zeros</span><span class="params">((<span class="number">32</span>, <span class="number">32</span>)</span></span>)
&gt;&gt;&gt; square[<span class="number">10</span>:-<span class="number">10</span>, <span class="number">10</span>:-<span class="number">10</span>] = <span class="number">1</span>
&gt;&gt;&gt; np<span class="class">.random</span><span class="class">.seed</span>(<span class="number">2</span>)
&gt;&gt;&gt; x, y = (<span class="number">32</span>*np<span class="class">.random</span><span class="class">.random</span>((<span class="number">2</span>, <span class="number">20</span>))).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>
&gt;&gt;&gt; square[x, y] = <span class="number">1</span>

&gt;&gt;&gt; open_square = ndimage.<span class="function"><span class="title">binary_opening</span><span class="params">(square)</span></span>

&gt;&gt;&gt; eroded_square = ndimage.<span class="function"><span class="title">binary_erosion</span><span class="params">(square)</span></span>
&gt;&gt;&gt; reconstruction = ndimage.<span class="function"><span class="title">binary_propagation</span><span class="params">(eroded_square, mask=square)</span></span>
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_propagation_1.png" alt="application"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_propagation.html#example-plot-propagation-py" target="_blank" rel="external">示例源码</a></p>
<p><em>闭操作</em>：膨胀+腐蚀</p>
<p>许多其它数学分形：击中(hit)和击不中(miss)变换，tophat等等。</p>
<h2 id="特征提取">特征提取</h2><h3 id="边缘检测">边缘检测</h3><p>合成数据：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; im = np.zeros((<span class="number">256</span>, <span class="number">256</span>))
<span class="prompt">&gt;&gt;</span>&gt; im[<span class="number">64</span><span class="symbol">:-</span><span class="number">64</span>, <span class="number">64</span><span class="symbol">:-</span><span class="number">64</span>] = <span class="number">1</span>
<span class="prompt">&gt;&gt;</span>&gt;
&gt;&gt;&gt; im = ndimage.rotate(im, <span class="number">15</span>, mode=<span class="string">'constant'</span>)
<span class="prompt">&gt;&gt;</span>&gt; im = ndimage.gaussian_filter(im, <span class="number">8</span>)
</code></pre><p>使用<em>梯度操作(Sobel)</em>来找到搞强度的变化：</p>
<pre><code>&gt;&gt;&gt; sx = ndimage.<span class="function"><span class="title">sobel</span><span class="params">(im, axis=<span class="number">0</span>, mode=<span class="string">'constant'</span>)</span></span>
&gt;&gt;&gt; sy = ndimage.<span class="function"><span class="title">sobel</span><span class="params">(im, axis=<span class="number">1</span>, mode=<span class="string">'constant'</span>)</span></span>
&gt;&gt;&gt; sob = np.<span class="function"><span class="title">hypot</span><span class="params">(sx, sy)</span></span>
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_find_edges_1.png" alt="sob"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_find_edges.html#example-plot-find-edges-py" target="_blank" rel="external">示例源码</a></p>
<p><em>canny滤镜</em></p>
<p>Canny滤镜可以从<code>skimage</code>中获取(<a href="http://scikit-image.org/docs/dev/api/skimage.filter.html#canny" target="_blank" rel="external">文档</a>)，但是为了方便我们在这个教程中作为一个<em>单独模块</em>导入：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; <span class="comment">#from skimage.filter import canny</span>
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment">#or use module shipped with tutorial</span>
<span class="prompt">&gt;&gt;</span>&gt; im += <span class="number">0</span>.<span class="number">1</span>*np.random.random(im.shape)
<span class="prompt">&gt;&gt;</span>&gt; edges = canny(im, <span class="number">1</span>, <span class="number">0</span>.<span class="number">4</span>, <span class="number">0</span>.<span class="number">2</span>) <span class="comment"># not enough smoothing</span>
<span class="prompt">&gt;&gt;</span>&gt; edges = canny(im, <span class="number">3</span>, <span class="number">0</span>.<span class="number">3</span>, <span class="number">0</span>.<span class="number">2</span>) <span class="comment"># better parameters</span>
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_canny_1.png" alt="edge"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_canny.html#example-plot-canny-py" target="_blank" rel="external">示例源码</a></p>
<p>需要调整几个参数……过度拟合的风险</p>
<h3 id="分割">分割</h3><ul>
<li><p>基于<em>直方图</em>的分割(没有空间信息)</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; n = <span class="number">10</span>
<span class="prompt">&gt;&gt;</span>&gt; l = <span class="number">256</span>
<span class="prompt">&gt;&gt;</span>&gt; im = np.zeros((l, l))
<span class="prompt">&gt;&gt;</span>&gt; np.random.seed(<span class="number">1</span>)
<span class="prompt">&gt;&gt;</span>&gt; points = l*np.random.random((<span class="number">2</span>, n**<span class="number">2</span>))
<span class="prompt">&gt;&gt;</span>&gt; im[(points[<span class="number">0</span>]).astype(np.int), (points[<span class="number">1</span>]).astype(np.int)] = <span class="number">1</span>
<span class="prompt">&gt;&gt;</span>&gt; im = ndimage.gaussian_filter(im, sigma=l/(<span class="number">4</span>.*n))

<span class="prompt">&gt;&gt;</span>&gt; mask = (im &gt; im.mean()).astype(np.float)
<span class="prompt">&gt;&gt;</span>&gt; mask += <span class="number">0</span>.<span class="number">1</span> * im
<span class="prompt">&gt;&gt;</span>&gt; img = mask + <span class="number">0</span>.<span class="number">2</span>*np.random.randn(*mask.shape)

<span class="prompt">&gt;&gt;</span>&gt; hist, bin_edges = np.histogram(img, bins=<span class="number">60</span>)
<span class="prompt">&gt;&gt;</span>&gt; bin_centers = <span class="number">0</span>.<span class="number">5</span>*(bin_edges[<span class="symbol">:-</span><span class="number">1</span>] + bin_edges[<span class="number">1</span><span class="symbol">:</span>])

<span class="prompt">&gt;&gt;</span>&gt; binary_img = img &gt; <span class="number">0</span>.<span class="number">5</span>
</code></pre></li>
</ul>
<p><img src="http://scipy-lectures.github.com/_images/plot_histo_segmentation_1.png" alt="segmente"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_histo_segmentation.html#example-plot-histo-segmentation-py" target="_blank" rel="external">示例源码</a></p>
<p>自动阈值：使用高斯混合模型：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; mask = (im &gt; im.mean()).astype(np.float)
<span class="prompt">&gt;&gt;</span>&gt; mask += <span class="number">0</span>.<span class="number">1</span> * im
<span class="prompt">&gt;&gt;</span>&gt; img = mask + <span class="number">0</span>.<span class="number">3</span>*np.random.randn(*mask.shape)

<span class="prompt">&gt;&gt;</span>&gt; from sklearn.mixture import <span class="constant">GMM</span>
<span class="prompt">&gt;&gt;</span>&gt; classif = <span class="constant">GMM</span>(n_components=<span class="number">2</span>)
<span class="prompt">&gt;&gt;</span>&gt; classif.fit(img.reshape((img.size, <span class="number">1</span>))) 
<span class="constant">GMM</span>(...)

<span class="prompt">&gt;&gt;</span>&gt; classif.means<span class="number">_</span>
array([[ <span class="number">0</span>.<span class="number">9353155</span> ],
       [-<span class="number">0</span>.<span class="number">02</span>966039]])
<span class="prompt">&gt;&gt;</span>&gt; np.sqrt(classif.covars<span class="number">_</span>).ravel()
array([ <span class="number">0</span>.<span class="number">35074631</span>,  <span class="number">0</span>.<span class="number">28225327</span>])
<span class="prompt">&gt;&gt;</span>&gt; classif.weights<span class="number">_</span>
array([ <span class="number">0</span>.<span class="number">40989799</span>,  <span class="number">0</span>.<span class="number">59010201</span>])
<span class="prompt">&gt;&gt;</span>&gt; threshold = np.mean(classif.means<span class="number">_</span>)
<span class="prompt">&gt;&gt;</span>&gt; binary_img = img &gt; threshold
</code></pre><p><img src="http://scipy-lectures.github.com/_images/image_GMM.png" alt="gauss-mixture"></p>
<p>使用数学形态学来清理结果：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># Remove small white regions</span>
<span class="prompt">&gt;&gt;</span>&gt; open_img = ndimage.binary_opening(binary_img)
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># Remove small black hole</span>
<span class="prompt">&gt;&gt;</span>&gt; close_img = ndimage.binary_closing(open_img)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_clean_morpho_1.png" alt="cleanup"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_clean_morpho.html#example-plot-clean-morpho-py" target="_blank" rel="external">示例源码</a></p>
<p><strong>练习</strong></p>
<p>参看重建(reconstruction)操作(腐蚀+传播(propagation))产生比开/闭操作更好的结果：</p>
<pre><code>&gt;&gt;&gt; eroded_img = ndimage.<span class="function"><span class="title">binary_erosion</span><span class="params">(binary_img)</span></span>
&gt;&gt;&gt; reconstruct_img = ndimage.<span class="function"><span class="title">binary_propagation</span><span class="params">(eroded_img, mask=binary_img)</span></span>
&gt;&gt;&gt; tmp = np.<span class="function"><span class="title">logical_not</span><span class="params">(reconstruct_img)</span></span>
&gt;&gt;&gt; eroded_tmp = ndimage.<span class="function"><span class="title">binary_erosion</span><span class="params">(tmp)</span></span>
&gt;&gt;&gt; reconstruct_final = np.<span class="function"><span class="title">logical_not</span><span class="params">(ndimage.binary_propagation(eroded_tmp, mask=tmp)</span></span>)
&gt;&gt;&gt; np.<span class="function"><span class="title">abs</span><span class="params">(mask - close_img)</span></span>.<span class="function"><span class="title">mean</span><span class="params">()</span></span>
<span class="number">0.014678955078125</span>
&gt;&gt;&gt; np.<span class="function"><span class="title">abs</span><span class="params">(mask - reconstruct_final)</span></span>.<span class="function"><span class="title">mean</span><span class="params">()</span></span>
<span class="number">0.0042572021484375</span>
</code></pre><p><strong>练习</strong></p>
<p>检查首次消噪步骤(中值滤波，总变差)如何更改直方图，并且查看是否基于直方图的分割更加精准了。</p>
<ul>
<li><p><em>基于图像</em>的分割：使用空间信息</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; from sklearn.feature_extraction import image
<span class="prompt">&gt;&gt;</span>&gt; from sklearn.cluster import spectral_clustering

<span class="prompt">&gt;&gt;</span>&gt; l = <span class="number">100</span>
<span class="prompt">&gt;&gt;</span>&gt; x, y = np.indices((l, l))

<span class="prompt">&gt;&gt;</span>&gt; center1 = (<span class="number">28</span>, <span class="number">24</span>)
<span class="prompt">&gt;&gt;</span>&gt; center2 = (<span class="number">40</span>, <span class="number">50</span>)
<span class="prompt">&gt;&gt;</span>&gt; center3 = (<span class="number">67</span>, <span class="number">58</span>)
<span class="prompt">&gt;&gt;</span>&gt; center4 = (<span class="number">24</span>, <span class="number">70</span>)
<span class="prompt">&gt;&gt;</span>&gt; radius1, radius2, radius3, radius4 = <span class="number">16</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">14</span>

<span class="prompt">&gt;&gt;</span>&gt; circle1 = (x - center1[<span class="number">0</span>])**<span class="number">2</span> + (y - center1[<span class="number">1</span>])**<span class="number">2</span> &lt; radius1**<span class="number">2</span>
<span class="prompt">&gt;&gt;</span>&gt; circle2 = (x - center2[<span class="number">0</span>])**<span class="number">2</span> + (y - center2[<span class="number">1</span>])**<span class="number">2</span> &lt; radius2**<span class="number">2</span>
<span class="prompt">&gt;&gt;</span>&gt; circle3 = (x - center3[<span class="number">0</span>])**<span class="number">2</span> + (y - center3[<span class="number">1</span>])**<span class="number">2</span> &lt; radius3**<span class="number">2</span>
<span class="prompt">&gt;&gt;</span>&gt; circle4 = (x - center4[<span class="number">0</span>])**<span class="number">2</span> + (y - center4[<span class="number">1</span>])**<span class="number">2</span> &lt; radius4**<span class="number">2</span>

<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># 4 circles</span>
<span class="prompt">&gt;&gt;</span>&gt; img = circle1 + circle2 + circle3 + circle4
<span class="prompt">&gt;&gt;</span>&gt; mask = img.astype(bool)
<span class="prompt">&gt;&gt;</span>&gt; img = img.astype(float)

<span class="prompt">&gt;&gt;</span>&gt; img += <span class="number">1</span> + <span class="number">0</span>.<span class="number">2</span>*np.random.randn(*img.shape)
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># Convert the image into a graph with the value of the gradient on</span>
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># the edges.</span>
<span class="prompt">&gt;&gt;</span>&gt; graph = image.img_to_graph(img, mask=mask)

<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># Take a decreasing function of the gradient: we take it weakly</span>
<span class="prompt">&gt;&gt;</span>&gt; <span class="comment"># dependant from the gradient the segmentation is close to a voronoi</span>
<span class="prompt">&gt;&gt;</span>&gt; graph.data = np.exp(-graph.data/graph.data.std())

<span class="prompt">&gt;&gt;</span>&gt; labels = spectral_clustering(graph, k=<span class="number">4</span>, mode=<span class="string">'arpack'</span>)
<span class="prompt">&gt;&gt;</span>&gt; label_im = -np.ones(mask.shape)
<span class="prompt">&gt;&gt;</span>&gt; label_im[mask] = labels
</code></pre></li>
</ul>
<p><img src="http://scipy-lectures.github.com/_images/image_spectral_clustering.png" alt="graph-base"></p>
<hr>
<h2 id="测量对象属性：ndimage-measurements">测量对象属性：ndimage.measurements</h2><p>合成数据：</p>
<pre><code>&gt;&gt;&gt; n = <span class="number">10</span>
&gt;&gt;&gt; l = <span class="number">256</span>
&gt;&gt;&gt; im = np.<span class="function"><span class="title">zeros</span><span class="params">((l, l)</span></span>)
&gt;&gt;&gt; points = l*np<span class="class">.random</span><span class="class">.random</span>((<span class="number">2</span>, n**<span class="number">2</span>))
&gt;&gt;&gt; im[(points[<span class="number">0</span>]).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>, (points[<span class="number">1</span>]).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>] = <span class="number">1</span>
&gt;&gt;&gt; im = ndimage.<span class="function"><span class="title">gaussian_filter</span><span class="params">(im, sigma=l/(<span class="number">4</span>.*n)</span></span>)
&gt;&gt;&gt; <span class="attribute">mask</span> = im &gt; im.<span class="function"><span class="title">mean</span><span class="params">()</span></span>
</code></pre><ul>
<li><p><em>连接成分分析</em></p>
<p>  标记连接成分：<code>ndimage.label</code></p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; label_im, nb_labels = ndimage.label(mask)
<span class="prompt">&gt;&gt;</span>&gt; nb_labels <span class="comment"># how many regions?</span>
<span class="number">23</span>
<span class="prompt">&gt;&gt;</span>&gt; plt.imshow(label_im)        
&lt;matplotlib.image.<span class="constant">AxesImage</span> object at ...&gt;
</code></pre></li>
</ul>
<p><img src="http://scipy-lectures.github.com/_images/plot_synthetic_data_1.png" alt="label"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_synthetic_data.html#example-plot-synthetic-data-py" target="_blank" rel="external">示例源码</a></p>
<p>计算每个区域的尺寸，均值等等：</p>
<pre><code>&gt;&gt;&gt; sizes = ndimage.<span class="function"><span class="title">sum</span><span class="params">(mask, label_im, range(nb_labels + <span class="number">1</span>)</span></span>)
&gt;&gt;&gt; mean_vals = ndimage.<span class="function"><span class="title">sum</span><span class="params">(im, label_im, range(<span class="number">1</span>, nb_labels + <span class="number">1</span>)</span></span>)
</code></pre><p>计算小的连接成分：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; mask_size = sizes &lt; <span class="number">1000</span>
<span class="prompt">&gt;&gt;</span>&gt; remove_pixel = mask_size[label_im]
<span class="prompt">&gt;&gt;</span>&gt; remove_pixel.shape
(<span class="number">256</span>, <span class="number">256</span>)
<span class="prompt">&gt;&gt;</span>&gt; label_im[remove_pixel] = <span class="number">0</span>
<span class="prompt">&gt;&gt;</span>&gt; plt.imshow(label_im)        
&lt;matplotlib.image.<span class="constant">AxesImage</span> object at ...&gt;
</code></pre><p>现在使用<code>np.searchsorted</code>重新分配标签：</p>
<pre><code>&gt;&gt;&gt; labels = np.<span class="function"><span class="title">unique</span><span class="params">(label_im)</span></span>
&gt;&gt;&gt; label_im = np.<span class="function"><span class="title">searchsorted</span><span class="params">(labels, label_im)</span></span>
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_measure_data_1.png" alt="reassign"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_measure_data.html#example-plot-measure-data-py" target="_blank" rel="external">示例源码</a></p>
<p>找到关注的封闭对象区域：<a href="根据以上操作剩下的区域选择区域，因为是随机生成可能结果不通，label_im==4未必留下来了。">^3</a></p>
<pre><code>&gt;&gt;&gt; slice_x, slice_y = ndimage.<span class="function"><span class="title">find_objects</span><span class="params">(label_im==<span class="number">4</span>)</span></span>[<span class="number">0</span>]
&gt;&gt;&gt; roi = im[slice_x, slice_y]
&gt;&gt;&gt; plt.<span class="function"><span class="title">imshow</span><span class="params">(roi)</span></span>     
&lt;matplotlib<span class="class">.image</span><span class="class">.AxesImage</span> <span class="tag">object</span> at ...&gt;
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_find_object_1.png" alt="find"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_find_object.html#example-plot-find-object-py" target="_blank" rel="external">示例源码</a></p>
<p>其它空间测量：<code>ndiamge.center_of_mass</code>,<code>ndimage.maximum_position</code>等等。</p>
<p>可以在分割应用限制范围之外使用。</p>
<p>示例：块平均(block mean)：</p>
<pre><code>m scipy import misc
<span class="prompt">&gt;&gt;</span>&gt; l = misc.lena()
<span class="prompt">&gt;&gt;</span>&gt; sx, sy = l.shape
<span class="prompt">&gt;&gt;</span>&gt; <span class="constant">X</span>, <span class="constant">Y</span> = np.ogrid[<span class="number">0</span><span class="symbol">:sx</span>, <span class="number">0</span><span class="symbol">:sy</span>]
<span class="prompt">&gt;&gt;</span>&gt; regions = sy/<span class="number">6</span> * (<span class="constant">X</span>/<span class="number">4</span>) + <span class="constant">Y</span>/<span class="number">6</span>  <span class="comment"># note that we use broadcasting</span>
<span class="prompt">&gt;&gt;</span>&gt; block_mean = ndimage.mean(l, labels=regions, index=np.arange(<span class="number">1</span>,
...     regions.max() +<span class="number">1</span>))
<span class="prompt">&gt;&gt;</span>&gt; block_mean.shape = (sx/<span class="number">4</span>, sy/<span class="number">6</span>)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_block_mean_1.png" alt="block mean"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_block_mean.html#example-plot-block-mean-py" target="_blank" rel="external">示例源码</a></p>
<p>当区域不是正则的<a href="[正则空间](https://en.wikipedia.org/wiki/Regular_space)">^4</a>块状时，使用stride技巧更有效(<a href="http://scipy-lectures.github.com/advanced/advanced_numpy/index.html#stride-manipulation-label" target="_blank" rel="external">示例：fake dimensions with strides</a>)</p>
<p>非正则空间(Non-regular-spaced)区块：径向平均：</p>
<pre><code><span class="prompt">&gt;&gt;</span>&gt; sx, sy = l.shape
<span class="prompt">&gt;&gt;</span>&gt; <span class="constant">X</span>, <span class="constant">Y</span> = np.ogrid[<span class="number">0</span><span class="symbol">:sx</span>, <span class="number">0</span><span class="symbol">:sy</span>]
<span class="prompt">&gt;&gt;</span>&gt; r = np.hypot(<span class="constant">X</span> - sx/<span class="number">2</span>, <span class="constant">Y</span> - sy/<span class="number">2</span>)
<span class="prompt">&gt;&gt;</span>&gt; rbin = (<span class="number">20</span>* r/r.max()).astype(np.int)
<span class="prompt">&gt;&gt;</span>&gt; radial_mean = ndimage.mean(l, labels=rbin, index=np.arange(<span class="number">1</span>, rbin.max() +<span class="number">1</span>))
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_radial_mean_1.png" alt="radial"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_radial_mean.html#example-plot-radial-mean-py" target="_blank" rel="external">示例源码</a></p>
<ul>
<li><em>其它测量</em></li>
</ul>
<p>相关函数，傅里叶/小波谱等。</p>
<p>一个使用数学形态学的例子：<em>粒度</em>(<a href="http://en.wikipedia.org/wiki/Granulometry_%28morphology%29" target="_blank" rel="external">http://en.wikipedia.org/wiki/Granulometry_%28morphology%29</a>)</p>
<pre><code>&gt;&gt;&gt; def <span class="function"><span class="title">disk_structure</span><span class="params">(n)</span></span>:
...     struct = np.<span class="function"><span class="title">zeros</span><span class="params">((<span class="number">2</span> * n + <span class="number">1</span>, <span class="number">2</span> * n + <span class="number">1</span>)</span></span>)
...     x, y = np.<span class="function"><span class="title">indices</span><span class="params">((<span class="number">2</span> * n + <span class="number">1</span>, <span class="number">2</span> * n + <span class="number">1</span>)</span></span>)
...     <span class="attribute">mask</span> = (x - n)**<span class="number">2</span> + (y - n)**<span class="number">2</span> &lt;= n**<span class="number">2</span>
...     struct[<span class="attribute">mask</span>] = <span class="number">1</span>
...     return struct.<span class="function"><span class="title">astype</span><span class="params">(np.bool)</span></span>
...
&gt;&gt;&gt;
&gt;&gt;&gt; def <span class="function"><span class="title">granulometry</span><span class="params">(data, sizes=None)</span></span>:
...     s = <span class="function"><span class="title">max</span><span class="params">(data.shape)</span></span>
...     <span class="keyword">if</span> sizes == None:
...         sizes = <span class="function"><span class="title">range</span><span class="params">(<span class="number">1</span>, s/<span class="number">2</span>, <span class="number">2</span>)</span></span>
...     granulo = [ndimage.binary_opening(data, \
...         structure=<span class="function"><span class="title">disk_structure</span><span class="params">(n)</span></span>).<span class="function"><span class="title">sum</span><span class="params">()</span></span> <span class="keyword">for</span> n <span class="keyword">in</span> sizes]
...     return granulo
...
&gt;&gt;&gt;
&gt;&gt;&gt; np<span class="class">.random</span><span class="class">.seed</span>(<span class="number">1</span>)
&gt;&gt;&gt; n = <span class="number">10</span>
&gt;&gt;&gt; l = <span class="number">256</span>
&gt;&gt;&gt; im = np.<span class="function"><span class="title">zeros</span><span class="params">((l, l)</span></span>)
&gt;&gt;&gt; points = l*np<span class="class">.random</span><span class="class">.random</span>((<span class="number">2</span>, n**<span class="number">2</span>))
&gt;&gt;&gt; im[(points[<span class="number">0</span>]).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>, (points[<span class="number">1</span>]).<span class="function"><span class="title">astype</span><span class="params">(np.int)</span></span>] = <span class="number">1</span>
&gt;&gt;&gt; im = ndimage.<span class="function"><span class="title">gaussian_filter</span><span class="params">(im, sigma=l/(<span class="number">4</span>.*n)</span></span>)
&gt;&gt;&gt;
&gt;&gt;&gt; <span class="attribute">mask</span> = im &gt; im.<span class="function"><span class="title">mean</span><span class="params">()</span></span>
&gt;&gt;&gt;
&gt;&gt;&gt; granulo = <span class="function"><span class="title">granulometry</span><span class="params">(mask, sizes=np.arange(<span class="number">2</span>, <span class="number">19</span>, <span class="number">4</span>)</span></span>)
</code></pre><p><img src="http://scipy-lectures.github.com/_images/plot_granulo_1.png" alt="granulometry"></p>
<p><a href="http://scipy-lectures.github.com/advanced/image_processing/auto_examples/plot_granulo.html#example-plot-granulo-py" target="_blank" rel="external">示例源码</a></p>
<h2 id="Footnotes">Footnotes</h2><p>[^2]:ValueError: can not convert int64 to uint8.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2012/10/31/python/" itemprop="url">
                  调试代码(Python)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2012-10-31T00:00:00+08:00" content="2012-10-31">
              2012-10-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2012/10/31/python/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2012/10/31/python/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="调试代码">调试代码</h1><p>翻译自：<a href="http://scipy-lectures.github.com/advanced/debugging/index.html" target="_blank" rel="external">http://scipy-lectures.github.com/advanced/debugging/index.html</a></p>
<p>作者：Gaël Varoquaux</p>
<p>本教程探索工具，以更好地理解你的编程基础：调试，找到并修复错误。</p>
<p>这并不特定适合Python科学计算社区，但是我们采取的策略量身定制。</p>
<p><strong>先决条件</strong></p>
<ul>
<li>Numpy</li>
<li>IPython</li>
<li>nosetests (<a href="http://readthedocs.org/docs/nose/en/latest/" target="_blank" rel="external">http://readthedocs.org/docs/nose/en/latest/</a>)</li>
<li>line_profiler (<a href="http://packages.python.org/line_profiler/" target="_blank" rel="external">http://packages.python.org/line_profiler/</a>)</li>
<li>pyflakes (<a href="http://pypi.python.org/pypi/pyflakes" target="_blank" rel="external">http://pypi.python.org/pypi/pyflakes</a>)</li>
<li>gdb 用于C调试部分</li>
</ul>
<p><strong>目录</strong></p>
<ul>
<li>toc<br>{: toc}</li>
</ul>
<h2 id="避免错误">避免错误</h2><h3 id="避免麻烦最佳编码法">避免麻烦最佳编码法</h3><ul>
<li>我们都写有bug的代码。接受它，解决它。</li>
<li>写程序时，在心里测试和调试。</li>
<li>Keep it Simple, Stupid(KISS).<ul>
<li>可能有效的最简单方法</li>
</ul>
</li>
<li>Don‘t Repeat Yourself (DRY).<ul>
<li>每个知识都必须有个单独、明确、在一个系统中的正式表示</li>
<li>常量、算法，等等。</li>
</ul>
</li>
<li>尝试限制你的代码间的相互关系(松耦合)</li>
<li>赋予你的变量、函数和模块有意义的名字(不是数学名称)</li>
</ul>
<h3 id="pyflakes:快速静态分析">pyflakes:快速静态分析</h3><p>这些是几个Python中的静态分析工具：<a href="http://www.logilab.org/857" target="_blank" rel="external">pylint</a>、<a href="http://pychecker.sourceforge.net/" target="_blank" rel="external">pychecker</a>和<a href="http://pypi.python.org/pypi/pyflakes" target="_blank" rel="external">pyflakes</a>。这里我们重点放在pyflakes上，这是最简单的工具。</p>
<ul>
<li><em>快速，简单</em></li>
<li>探测语法错误，漏掉的导入，名称的拼写错误。</li>
</ul>
<p>高度推荐在你的编辑器中集成pyflakes，它<em>确实产生巨大生产力</em>。</p>
<h4 id="在当前编辑文件运行pyflakes">在当前编辑文件运行pyflakes</h4><p>你可以绑定一个键来在当前缓冲区运行pyflakes。</p>
<ul>
<li><p>kate中 菜单：<code>设置 -&gt; 配置kate</code></p>
<ul>
<li>在插件中勾选’外部工具’<a href="我是没找到">^1</a></li>
<li><p>在外部工具中，添加<code>pyflakes</code>:</p>
<pre><code>kdialog --title <span class="string">"pyflakes <span class="variable">%filename</span>"</span> --msgbox <span class="string">"<span class="variable">$(</span>pyflakes <span class="variable">%filename</span>)"</span>
</code></pre></li>
</ul>
</li>
<li><p>在TextMate中<br>菜单：TextMate -&gt; 首选项 -&gt; 高级 -&gt; Shell变量，添加一个shell变量：</p>
<pre><code>TM_PYCHECKER=<span class="regexp">/Library/</span>Frameworks<span class="regexp">/Python.framework/</span>Versions<span class="regexp">/Current/</span>bin<span class="regexp">/pyflakes</span>
</code></pre><p>  然后<code>Ctrl-Shift-V</code>被绑定到pyflakes报告上。</p>
</li>
<li><p>在<em>Vim</em>中，在你的vimrc中(将F5绑定到pyflakes上)：</p>
<pre><code>autocmd <span class="constant">FileType </span>python let &amp;mp = <span class="string">'echo "*** running % ***" ; pyflakes %'</span>
autocmd <span class="constant">FileType </span>tex,mp,rst,python imap &lt;<span class="constant">Esc&gt;</span>[<span class="number">15</span>~ &lt;<span class="constant">C-O&gt;</span><span class="symbol">:make!^M</span>
autocmd <span class="constant">FileType </span>tex,mp,rst,python map  &lt;<span class="constant">Esc&gt;</span>[<span class="number">15</span>~ <span class="symbol">:make!^M</span>
autocmd <span class="constant">FileType </span>tex,mp,rst,python set autowrite]]    
</code></pre></li>
<li><p>在emacs中，在你的.emacs中(绑定F5到pyflakes)：</p>
<pre><code><span class="list">(<span class="keyword">defun</span> pyflakes-thisfile <span class="list">()</span> <span class="list">(<span class="keyword">interactive</span>)</span>
   <span class="list">(<span class="keyword"><span class="built_in">compile</span></span> <span class="list">(<span class="keyword"><span class="built_in">format</span></span> <span class="string">"pyflakes %s"</span> <span class="list">(<span class="keyword">buffer-file-name</span>)</span>)</span>)</span>
)</span>

<span class="list">(<span class="keyword">define-minor-mode</span> pyflakes-mode
    <span class="string">"Toggle pyflakes mode.
    With no argument, this command toggles the mode.
    Non-null prefix argument turns on the mode.
    Null prefix argument turns off the mode."</span>
    <span class="comment">;; The initial value.</span>
    <span class="literal">nil</span>
    <span class="comment">;; The indicator for the mode line.</span>
    <span class="string">" Pyflakes"</span>
    <span class="comment">;; The minor mode bindings.</span>
    '<span class="list">( <span class="list">(<span class="collection">[f5]</span> . pyflakes-thisfile)</span> )</span>
)</span>

<span class="list">(<span class="keyword">add-hook</span> 'python-mode-hook <span class="list">(<span class="keyword">lambda</span> <span class="list">()</span> <span class="list">(<span class="keyword">pyflakes-mode</span> t)</span>)</span>)</span>
</code></pre></li>
</ul>
<h4 id="一个在线拼写检查集成">一个在线拼写检查集成</h4><ul>
<li>在vim中使用vim.pyflakes插件：<ol>
<li>从<a href="http://www.vim.org/scripts/script.php?script_id=2441" target="_blank" rel="external">http://www.vim.org/scripts/script.php?script_id=2441</a>下载zip文件<a href="关于插件的安装，我更倾向于pathogen">^2</a></li>
<li>将文件解压到<code>.vim/ftplugin/python</code></li>
<li>确定你的vimrc中有’filetype plugin indent on’</li>
</ol>
</li>
<li><p>在emacs中在flymake模式中使用pyflakes，文档在<a href="http://www.plope.com/Members/chrism/flymake-mode" target="_blank" rel="external">http://www.plope.com/Members/chrism/flymake-mode</a>:添加以下内容到你的.emacs文件：</p>
<pre><code><span class="list">(<span class="keyword"><span class="built_in">when</span></span> <span class="list">(<span class="keyword"><span class="built_in">load</span></span> <span class="string">"flymake"</span> t)</span>
        <span class="list">(<span class="keyword">defun</span> flymake-pyflakes-init <span class="list">()</span>
        <span class="list">(<span class="keyword"><span class="built_in">let*</span></span> <span class="list">(<span class="list">(<span class="keyword">temp-file</span> <span class="list">(<span class="keyword">flymake-init-create-temp-buffer-copy</span>
                            <span class="variable">'flymake-create-temp-inplace</span>)</span>)</span>
            <span class="list">(<span class="keyword">local-file</span> <span class="list">(<span class="keyword">file-relative-name</span>
                        temp-file
                        <span class="list">(<span class="keyword">file-name-directory</span> buffer-file-name)</span>)</span>)</span>)</span>
            <span class="list">(<span class="keyword"><span class="built_in">list</span></span> <span class="string">"pyflakes"</span> <span class="list">(<span class="keyword"><span class="built_in">list</span></span> local-file)</span>)</span>)</span>)</span>

        <span class="list">(<span class="keyword">add-to-list</span> <span class="variable">'flymake-allowed-file-name-masks</span>
                '<span class="list">(<span class="string">"\\.py\\'"</span> flymake-pyflakes-init)</span>)</span>)</span>

<span class="list">(<span class="keyword">add-hook</span> <span class="variable">'find-file-hook</span> <span class="variable">'flymake-find-file-hook</span>)</span>
</code></pre></li>
</ul>
<h2 id="调试工作流">调试工作流</h2><p>你确实有个并不微不足道的bug，这时调试策略就关键了。这没有银色子弹。然而，策略有帮助：</p>
<blockquote>
<p>对调试一个给定的问题，最受欢迎的情况是当问题被隔离成少量几行的代码，在框架和应用之外，伴随的更改-运行-失败循环</p>
</blockquote>
<ol>
<li>让出错可靠。找到一个测试实例让代码每次都出错(fail)</li>
<li>分解并且克服。一旦你有了一个失败测试实例，隔绝出错代码 。<ul>
<li>哪个模块</li>
<li>哪个函数</li>
<li>哪行代码<br>= &gt; 隔离小块可再生错误：测试样例。</li>
</ul>
</li>
<li>一次更改一样东西，并且重新运行错误测试样例</li>
<li>使用调试器来理解哪里出错了</li>
<li>记笔记，保持耐心。这将花很久。</li>
</ol>
<p><strong>注意：</strong>一旦你已经完成这个过程：严格隔离一片再生bug的代码并使用这片代码修复它，向你的测试套件中添加相应的代码。</p>
<h2 id="使用Python调试器">使用Python调试器</h2><p>Python调试器，<code>pdb</code>：<a href="http://docs.python.org/library/pdb.html" target="_blank" rel="external">http://docs.python.org/library/pdb.html</a>，允许你交互地检查你的代码。</p>
<p>具体来说它允许你：</p>
<ul>
<li>查看源代码</li>
<li>向上或向下查看调用堆栈</li>
<li>检查变量值</li>
<li>更改变量值</li>
<li>设置断点</li>
</ul>
<p><strong>print</strong></p>
<p>是的，print确实可以作为一个调试工具。然而在运行时检查的话，使用调试器通常更有效率。</p>
<h3 id="调用调试器">调用调试器</h3><p>开启调试器的方法：</p>
<ol>
<li>尸检(post-mortem)，在模块错误后开启调试器</li>
<li>用调试器运行模块</li>
<li>在模块中调用调试器</li>
</ol>
<h4 id="尸检">尸检</h4><p><strong>情形：</strong>你使用ipython并且你获得一个回溯(traceback)。</p>
<p>现在让我们调试文件<a href="http://scipy-lectures.github.com/_downloads/index_error.py" target="_blank" rel="external">index_error.py</a>。当运行它时，一个<code>IndexError</code>被引发。键入<code>%debug</code>将进入调试器：</p>
<pre><code>In [1]: %run index_error.py
<span class="comment">---------------------------------------------------------------------------</span>
IndexError                                Traceback (most recent <span class="operator"><span class="keyword">call</span> <span class="keyword">last</span>)
/usr/lib/python2<span class="number">.7</span>/site-packages/IPython/utils/py3compat.py <span class="keyword">in</span> execfile(fname, *<span class="keyword">where</span>)
    <span class="number">176</span>             <span class="keyword">else</span>:
    <span class="number">177</span>                 filename = fname
<span class="comment">--&gt; 178             __builtin__.execfile(filename, *where)</span>

/home/lyy/index_error.py <span class="keyword">in</span> &lt;<span class="keyword">module</span>&gt;()
      <span class="number">6</span> 
      <span class="number">7</span> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
<span class="comment">----&gt; 8     index_error()</span>
      <span class="number">9</span> 

/home/lyy/index_error.py <span class="keyword">in</span> index_error()
      <span class="number">3</span> <span class="keyword">def</span> index_error():
      <span class="number">4</span>     lst = <span class="keyword">list</span>(<span class="string">'foobar'</span>)
<span class="comment">----&gt; 5     print lst[len(lst)]</span>
      <span class="number">6</span> 
      <span class="number">7</span> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:

IndexError: <span class="keyword">list</span> <span class="keyword">index</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="keyword">range</span>

<span class="keyword">In</span> [<span class="number">2</span>]: %debug
&gt; /home/lyy/index_error.py(<span class="number">5</span>)index_error()
      <span class="number">4</span>     lst = <span class="keyword">list</span>(<span class="string">'foobar'</span>)
<span class="comment">----&gt; 5     print lst[len(lst)]</span>
      <span class="number">6</span> 

ipdb&gt; <span class="keyword">list</span>
      <span class="number">1</span> <span class="string">"""Small snippet to raise an IndexError."""</span>
      <span class="number">2</span> 
      <span class="number">3</span> <span class="keyword">def</span> index_error():
      <span class="number">4</span>     lst = <span class="keyword">list</span>(<span class="string">'foobar'</span>)
<span class="comment">----&gt; 5     print lst[len(lst)]</span>
      <span class="number">6</span> 
      <span class="number">7</span> <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
      <span class="number">8</span>     index_error()
      <span class="number">9</span> 

ipdb&gt; <span class="keyword">len</span>(lst)
<span class="number">6</span>
ipdb&gt; print lst[<span class="keyword">len</span>(lst)-<span class="number">1</span>]
r
ipdb&gt; quit

<span class="keyword">In</span> [<span class="number">3</span>]: </span>
</code></pre><p><strong>在IPython之外尸检<a href="这词……">^3</a>调试</strong></p>
<p>在一些情形下你无法使用IPython，例如调试一个想要从命令行调用的脚本。这中情况下，你可以使用<code>python -m pdb script.py</code>来调用脚本：</p>
<pre><code>lyy@<span class="keyword">arch</span> ~ % python2 -<span class="keyword">m</span> pdb index_error.py
&gt; /home/lyy/index_error.py(1)&lt;module&gt;()
-&gt; <span class="string">""</span><span class="string">"Small snippet to raise an IndexError."</span><span class="string">""</span>
(Pdb) <span class="keyword">continue</span>
Traceback (most recent call last):
  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/pdb.py"</span>, <span class="keyword">line</span> 1314, <span class="keyword">in</span> main
    pdb._runscript(mainpyfile)
  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/pdb.py"</span>, <span class="keyword">line</span> 1233, <span class="keyword">in</span> _runscript
    self.<span class="keyword">run</span>(statement)
  <span class="keyword">File</span> <span class="string">"/usr/lib/python2.7/bdb.py"</span>, <span class="keyword">line</span> 387, <span class="keyword">in</span> <span class="keyword">run</span>
    exec cmd <span class="keyword">in</span> globals, locals
  <span class="keyword">File</span> <span class="string">"&lt;string&gt;"</span>, <span class="keyword">line</span> 1, <span class="keyword">in</span> &lt;module&gt;
  <span class="keyword">File</span> <span class="string">"index_error.py"</span>, <span class="keyword">line</span> 1, <span class="keyword">in</span> &lt;module&gt;
    <span class="string">""</span><span class="string">"Small snippet to raise an IndexError."</span><span class="string">""</span>
  <span class="keyword">File</span> <span class="string">"index_error.py"</span>, <span class="keyword">line</span> 5, <span class="keyword">in</span> index_error
    <span class="keyword">print</span> lst[len(lst)]
IndexError: <span class="keyword">list</span> index <span class="keyword">out</span> of <span class="keyword">range</span>
Uncaught exception. Entering <span class="keyword">post</span> mortem debugging
Running 'cont' or 'step' will restart the <span class="keyword">program</span>
&gt; /home/lyy/index_error.py(5)index_error()
-&gt; <span class="keyword">print</span> lst[len(lst)]
(Pdb) <span class="keyword">print</span> lst[len(lst)]
<span class="comment">*** IndexError: list index out of range</span>
</code></pre><h4 id="单步执行">单步执行</h4><p><strong>情形：</strong>你相信在模块中存在一个bug但不确定在哪里。</p>
<p>例如我们尝试调试<a href="http://scipy-lectures.github.com/_downloads/wiener_filtering.py" target="_blank" rel="external">wiener_filtering.py</a>。确实代码运行了，但是滤波效果并不好。</p>
<ul>
<li><p>用调试器运行脚本：</p>
<pre><code>In [1]: %run -d wiener_filtering.py
<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> Blank or comment
<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> Blank or comment
<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span> Blank or comment
Breakpoint 1 at /home/lyy/wiener_filtering.py:4
NOTE: Enter 'c' at the ipdb&gt;  prompt to start your script.
&gt; <span class="variable">&lt;string&gt;</span>(1)<span class="variable">&lt;module&gt;</span>()
</code></pre></li>
<li><p>进入<a href="http://scipy-lectures.github.com/_downloads/wiener_filtering.py" target="_blank" rel="external">wiener_filtering.py</a>并且在34行设置断点：</p>
<pre><code>ipdb&gt; n
&gt; /home/lyy/wiener_filtering.py(<span class="number">4</span>)&lt;module&gt;()
      <span class="number">3</span> 
<span class="number">1</span>---&gt; <span class="number">4</span> import numpy as np
      <span class="number">5</span> import scipy as sp

ipdb&gt; b <span class="number">34</span>
Breakpoint <span class="number">2</span> at /home/lyy/wiener_filtering.py:<span class="number">34</span>
</code></pre></li>
<li><p>用<code>c(out(inue))</code>继续执行到下一个断点:</p>
<pre><code>ipdb&gt; <span class="keyword">c</span>
&gt; /home/lyy/wiener_filtering.<span class="keyword">py</span>(<span class="number">34</span>)iterated_wiener()
     <span class="number">33</span>     <span class="string">""</span><span class="string">"
</span><span class="number">2</span>--&gt; <span class="number">34</span>     noisy_img = noisy_img
     <span class="number">35</span>     denoised_img = local_mean(noisy_img, size=size)
</code></pre></li>
<li><p>用<code>n(ext)</code>和<code>s(tep)</code>回到代码：<code>next</code>跳到当前执行文本的下一个语句，而<code>step</code>将穿越执行文本，也就是，可以深入探索函数调用：<a href="区别在于step停在函数调用，next立即执行函数调用">^4</a></p>
<pre><code>ipdb&gt; s
&gt; /home/lyy/wiener_filtering.<span class="function"><span class="title">py</span><span class="params">(<span class="number">35</span>)</span><span class="title">iterated_wiener</span><span class="params">()</span></span>
<span class="number">2</span>    <span class="number">34</span>     noisy_img = noisy_img
---&gt; <span class="number">35</span>     denoised_img = <span class="function"><span class="title">local_mean</span><span class="params">(noisy_img, size=size)</span></span>
     <span class="number">36</span>     l_var = <span class="function"><span class="title">local_var</span><span class="params">(noisy_img, size=size)</span></span>

ipdb&gt; n
&gt; /home/lyy/wiener_filtering.<span class="function"><span class="title">py</span><span class="params">(<span class="number">36</span>)</span><span class="title">iterated_wiener</span><span class="params">()</span></span>
     <span class="number">35</span>     denoised_img = <span class="function"><span class="title">local_mean</span><span class="params">(noisy_img, size=size)</span></span>
---&gt; <span class="number">36</span>     l_var = <span class="function"><span class="title">local_var</span><span class="params">(noisy_img, size=size)</span></span>
     <span class="number">37</span>     <span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> <span class="function"><span class="title">range</span><span class="params">(<span class="number">3</span>)</span></span>:
</code></pre></li>
<li><p>执行几行然后探索局部变量：</p>
<pre><code>ipdb&gt; n
&gt; /home/lyy/wiener_filtering.<span class="function"><span class="title">py</span><span class="params">(<span class="number">37</span>)</span><span class="title">iterated_wiener</span><span class="params">()</span></span>
     <span class="number">36</span>     l_var = <span class="function"><span class="title">local_var</span><span class="params">(noisy_img, size=size)</span></span>
---&gt; <span class="number">37</span>     <span class="keyword">for</span> <span class="tag">i</span> <span class="keyword">in</span> <span class="function"><span class="title">range</span><span class="params">(<span class="number">3</span>)</span></span>:
     <span class="number">38</span>         res = noisy_img - denoised_img

ipdb&gt; print l_var
[[<span class="number">5868</span> <span class="number">5379</span> <span class="number">5316</span> ..., <span class="number">5071</span> <span class="number">4799</span> <span class="number">5149</span>]
 [<span class="number">5013</span>  <span class="number">363</span>  <span class="number">437</span> ...,  <span class="number">346</span>  <span class="number">262</span> <span class="number">4355</span>]
 [<span class="number">5379</span>  <span class="number">410</span>  <span class="number">344</span> ...,  <span class="number">392</span>  <span class="number">604</span> <span class="number">3377</span>]
 ..., 
 [ <span class="number">435</span>  <span class="number">362</span>  <span class="number">308</span> ...,  <span class="number">275</span>  <span class="number">198</span> <span class="number">1632</span>]
 [ <span class="number">548</span>  <span class="number">392</span>  <span class="number">290</span> ...,  <span class="number">248</span>  <span class="number">263</span> <span class="number">1653</span>]
 [ <span class="number">466</span>  <span class="number">789</span>  <span class="number">736</span> ..., <span class="number">1835</span> <span class="number">1725</span> <span class="number">1940</span>]]
ipdb&gt; print l_var.<span class="function"><span class="title">min</span><span class="params">()</span></span>
<span class="number">0</span>
</code></pre></li>
</ul>
<p>Oh,亲爱的，除了整数什么也没有，还有0变动。这就是我们的bug所在，我们在做整数算术。</p>
<p><strong>引发数值错误例外</strong></p>
<p>当我们运行<a href="http://scipy-lectures.github.com/_downloads/wiener_filtering.py" target="_blank" rel="external">wiener_filtering.py</a>文件时，以下警告被引发(raise)：</p>
<pre><code>In [<span class="number">1</span>]: %run wiener_filtering.py
wiener_filtering.py:<span class="number">40</span>: RuntimeWarning: <span class="built_in">divide</span> <span class="keyword">by</span> <span class="constant">zero</span> encountered <span class="operator">in</span> <span class="built_in">divide</span>
  noise_level = (<span class="number">1</span> - noise/l_var )
</code></pre><p>我们可以将这些警告转化为例外(exception)，这让我们能对它们尸检调试，并且迅速找到我们的问题：</p>
<pre><code><span class="name">In</span> [<span class="number">2</span>]: <span class="atom">np</span>.<span class="atom">seterr</span>(<span class="atom">all</span>=<span class="string">'raise'</span>)
<span class="name">Out</span>[<span class="number">2</span>]: {<span class="string">'divide'</span>: <span class="string">'warn'</span>, <span class="string">'invalid'</span>: <span class="string">'warn'</span>, <span class="string">'over'</span>: <span class="string">'warn'</span>, <span class="string">'under'</span>: <span class="string">'ignore'</span>}
</code></pre><h4 id="其它开始调试的方法">其它开始调试的方法</h4><ul>
<li><p><strong>引发一个例外作为”可怜的”断点</strong></p>
<p>如果你发现几下行号设置断点很无聊，你可以简单地在你想要检查的地方引发一个例外，使用ipython的<code>%debug</code>。注意在这种情况下你不能step和continue执行。</p>
</li>
<li><p>使用nosetests调试测试失败</p>
<p>你可以运行<code>nosetests --pdb</code>对例外(exception)尸检调试，并且<code>nosetests --pdb-failure</code>使用调试器来检查测试失败。</p>
<p>另外，你可以通过安装nose插件<a href="http://pypi.python.org/pypi/ipdbplugin" target="_blank" rel="external">ipdbplugin</a>，在nose中使用IPython调试接口。你可以传递<code>--ipdb</code>和<code>--ipdb-failure</code>选项给nosetests。</p>
</li>
<li><p>显式调用调试器</p>
<p>  在你想要调试的地方放入以下一行：</p>
<pre><code><span class="preprocessor"><span class="keyword">import</span> pdb;</span> pdb.set_trace()
</code></pre></li>
</ul>
<font color="red">警告：当运行<code>nosetests</code>时，输出被捕捉，并且因此似乎调试器不工作了。只要加上<code>-s</code>标志运行nosetests</font>

<p><strong>图形化调试器</strong></p>
<p>为了单步执行和检查变量，你也许觉得用图形化的调试器如<a href="http://winpdb.org/" target="_blank" rel="external">winpdb</a>更加方便。</p>
<p>另外，<a href="http://pypi.python.org/pypi/pudb" target="_blank" rel="external">pudb</a>是一个很棒的半图形化调试器，它在终端里有一个文字用户界面。</p>
<h3 id="调试器命令和交互">调试器命令和交互</h3><table>
<thead>
<tr>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>l(list)</td>
<td>列出当前运行的代码</td>
</tr>
<tr>
<td>u(p)</td>
<td>上一个调用堆栈</td>
</tr>
<tr>
<td>d(own)</td>
<td>下一个调用堆栈</td>
</tr>
<tr>
<td>n(ext)</td>
<td>执行下一行(不到新的函数)</td>
</tr>
<tr>
<td>s(tep)</td>
<td>执行下一个语句(到新的函数)</td>
</tr>
<tr>
<td>bt</td>
<td>打印调用堆栈</td>
</tr>
<tr>
<td>a</td>
<td>打印局部变量</td>
</tr>
<tr>
<td>!command</td>
<td>执行特定的<em>Python</em>命令(相对于pdb命令)</td>
</tr>
</tbody>
</table>
<p><strong>警告：Debugger 命令不是Python代码</strong></p>
<p>你不能想当然的命名一个变量。例如，例如，如果在其中，你不能在当前情形下覆盖用同名变量:<em>当在调试器中敲代码时，使用不同的名字而不是你的局部变量</em>。</p>
<h2 id="使用gdb调试段错误">使用gdb调试段错误</h2><p>如果你有一个段错误，你不能通过pdb调试它，因为它会让Python解释器在进入调试器之前崩溃。同样，如果你在Python中嵌入的C代码有bug，pdb也没用。对这种情况我们使用在linux上可用的gnu调试器<a href="http://www.gnu.org/s/gdb/" target="_blank" rel="external">gdb</a>。</p>
<p>在我们用gdb之前，让我们向它添加一些Python特有的工具。对此我们向我们的<em>gdbinit</em>添加一些宏。宏优化的选择依赖于你的Python版本和gdb版本。我已经在<a href="http://scipy-lectures.github.com/_downloads/gdbinit" target="_blank" rel="external">gdbinit</a>里添加了一个简化的版本，但是请自由地阅读<a href="http://wiki.python.org/moin/DebuggingWithGdb" target="_blank" rel="external">DebuggingWithGdb</a>。</p>
<p>为用gdb调试脚本<a href="http://scipy-lectures.github.com/_downloads/segfault.py" target="_blank" rel="external">segfault.py</a>，我们可以在gdb中如下运行：</p>
<pre><code>$ gdb python
...
(gdb) run segfault.py
Starting program: /usr/bin/python segfault.py
[Thread debugging <span class="keyword">using</span> libthread_db enabled]

Program received signal SIGSEGV, Segmentation fault.
_strided_byte_copy (dst=<span class="number">0x8537478</span> <span class="string">"\360\343G"</span>, outstrides=<span class="number">4</span>, src=
    <span class="number">0x86c0690</span> &lt;Address <span class="number">0x86c0690</span> out of bounds&gt;, instrides=<span class="number">32</span>, N=<span class="number">3</span>,
    elsize=<span class="number">4</span>)
        at numpy/core/src/multiarray/ctors.c:<span class="number">365</span>
<span class="number">365</span>            _FAST_MOVE(Int32);
(gdb)
</code></pre><p>我们得到一个段错误，并且gdb事后在C级别的堆栈中(不是python调用堆栈)捕捉到了它。我们可以使用使用gdb的命令调试C调用堆栈：</p>
<pre><code>(gdb) up
<span class="preprocessor">#<span class="number">1</span>  <span class="number">0x004af4f5</span> in _copy_from_same_shape (dest=&lt;value optimized out&gt;,</span>
    src=&lt;value optimized out&gt;, myfunc=<span class="number">0x496780</span> &lt;_strided_byte_copy&gt;,
    swap=<span class="number">0</span>)
at numpy/core/src/multiarray/ctors.c:<span class="number">748</span>
<span class="number">748</span>         myfunc(dit-&gt;dataptr, dest-&gt;strides[maxaxis],
</code></pre><p>如你所见，现在我们在numpy的C代码中。我们想要知道什么Python代码触发了这个段错误，因此我们向上查看堆栈直到我们发现Python执行循环：</p>
<pre><code>(gdb) up
#<span class="number">8</span>  <span class="number">0</span>x080ddd23 <span class="keyword">in</span> call_function (f=
    Frame <span class="number">0</span>x85371ec, <span class="keyword">for</span> file /home/varoquau/usr/lib/python2.<span class="number">6</span>/site-packages/numpy/core/arrayprint<span class="class">.py</span>, line <span class="number">156</span>, <span class="keyword">in</span> _leading_trailing (a=&lt;numpy<span class="class">.ndarray</span> at remote <span class="number">0</span>x85371b0&gt;, _nc=&lt;module at remote <span class="number">0</span>xb7f93a64&gt;), throwflag=<span class="number">0</span>)
    at ../Python/ceval<span class="class">.c</span>:<span class="number">3750</span>
<span class="number">3750</span>    ../Python/ceval<span class="class">.c</span>: No such file or directory.
        <span class="keyword">in</span> ../Python/ceval<span class="class">.c</span>

(gdb) up
#<span class="number">9</span>  PyEval_EvalFrameEx (f=
    Frame <span class="number">0</span>x85371ec, <span class="keyword">for</span> file /home/varoquau/usr/lib/python2.<span class="number">6</span>/site-packages/numpy/core/arrayprint<span class="class">.py</span>, line <span class="number">156</span>, <span class="keyword">in</span> _leading_trailing (a=&lt;numpy<span class="class">.ndarray</span> at remote <span class="number">0</span>x85371b0&gt;, _nc=&lt;module at remote <span class="number">0</span>xb7f93a64&gt;), throwflag=<span class="number">0</span>)
    at ../Python/ceval<span class="class">.c</span>:<span class="number">2412</span>
<span class="number">2412</span>    <span class="keyword">in</span> ../Python/ceval<span class="class">.c</span>
(gdb)
</code></pre><p>一旦我们在python执行循环中时，我们可以使用特殊的python帮助函数。例如我们找到相应的Python代码：</p>
<pre><code>(gdb) pyframe
/home/varoquau/usr/<span class="class"><span class="keyword">lib</span>/<span class="title">python2</span>.6/<span class="title">site</span>-<span class="title">packages</span>/<span class="title">numpy</span>/<span class="title">core</span>/<span class="title">arrayprint</span>.<span class="title">py</span> (158): <span class="title">_leading_trailing</span></span>
(gdb)
</code></pre><p>这是numpy的代码，我们需要向上直到找到我们自己写的代码：</p>
<pre><code>(gdb) up
...
(gdb) up
#<span class="number">34</span> <span class="number">0</span>x080dc97a <span class="keyword">in</span> PyEval_EvalFrameEx (f=
    Frame <span class="number">0</span>x82f064c, <span class="keyword">for</span> file segfault<span class="class">.py</span>, line <span class="number">11</span>, <span class="keyword">in</span> print_big_array (small_array=&lt;numpy<span class="class">.ndarray</span> at remote <span class="number">0</span>x853ecf0&gt;, big_array=&lt;numpy<span class="class">.ndarray</span> at remote <span class="number">0</span>x853ed20&gt;), throwflag=<span class="number">0</span>) at ../Python/ceval<span class="class">.c</span>:<span class="number">1630</span>
<span class="number">1630</span>    ../Python/ceval<span class="class">.c</span>: No such file or directory.
        <span class="keyword">in</span> ../Python/ceval<span class="class">.c</span>
(gdb) pyframe
segfault<span class="class">.py</span> (<span class="number">12</span>): print_big_array
</code></pre><p>相应的代码是：</p>
<pre><code><span class="function"><span class="keyword">def</span> <span class="title">print_big_array</span><span class="params">(small_array)</span>:</span>
    big_array = make_big_array(small_array)
    <span class="keyword">print</span> big_array[-<span class="number">10</span>:]
    <span class="keyword">return</span> big_array
</code></pre><p>所以当打印<code>big_array[-10:]</code>时发生段错误。原因很简单，<code>big-array</code>的末尾被分配到程序内存之外了。<a href="也许你得将shape从20000改的大点，2e5或更大。">^5</a></p>
<p><strong>注意：</strong>在gdbinit中定义的专用于python的命令，请阅读这个文件。<a href="提醒下，在gdb7或更高版本中，不再单独需要gdbinit文件。另外，要完成用gdb对python程序的调试，我想你的python程序都应该用`-g`来编译。">^6</a></p>
<h2 id="总结练习">总结练习</h2><p>以下脚本清晰易读，它致力于解决数值计算感兴趣的实际问题。但是它不能工作。你能调试它吗？</p>
<p>Python源码<a href="http://scipy-lectures.github.com/_downloads/to_debug.py" target="_blank" rel="external">to_debug.py</a></p>
<pre><code><span class="string">"""
A script to compare different root-finding algorithms.

This version of the script is buggy and does not execute. It is your task
to find an fix these bugs.

The output of the script sould look like:

    Benching 1D root-finder optimizers from scipy.optimize:
                brenth:   604678 total function calls
                brentq:   594454 total function calls
                ridder:   778394 total function calls
                bisect:  2148380 total function calls
"""</span>
<span class="keyword">from</span> itertools <span class="keyword">import</span> product

<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> scipy <span class="keyword">import</span> optimize

FUNCTIONS = (np.tan,  <span class="comment"># Dilating map</span>
             np.tanh, <span class="comment"># Contracting map</span>
             <span class="keyword">lambda</span> x: x**<span class="number">3</span> + <span class="number">1e-4</span>*x, <span class="comment"># Almost null gradient at the root</span>
             <span class="keyword">lambda</span> x: x+np.sin(<span class="number">2</span>*x), <span class="comment"># Non monotonous function</span>
             <span class="keyword">lambda</span> x: <span class="number">1.1</span>*x+np.sin(<span class="number">4</span>*x), <span class="comment"># Fonction with several local maxima</span>
            )

OPTIMIZERS = (optimize.brenth, optimize.brentq, optimize.ridder,
              optimize.bisect)


<span class="function"><span class="keyword">def</span> <span class="title">apply_optimizer</span><span class="params">(optimizer, func, a, b)</span>:</span>
    <span class="string">""" Return the number of function calls given an root-finding optimizer, 
        a function and upper and lower bounds.
    """</span>
    <span class="keyword">return</span> optimizer(func, a, b, full_output=<span class="keyword">True</span>)[<span class="number">1</span>].function_calls,


<span class="function"><span class="keyword">def</span> <span class="title">bench_optimizer</span><span class="params">(optimizer, param_grid)</span>:</span>
    <span class="string">""" Find roots for all the functions, and upper and lower bounds
        given and return the total number of function calls.
    """</span>
    <span class="keyword">return</span> sum(apply_optimizer(optimizer, func, a, b)
               <span class="keyword">for</span> func, a, b <span class="keyword">in</span> param_grid)


<span class="function"><span class="keyword">def</span> <span class="title">compare_optimizers</span><span class="params">(optimizers)</span>:</span>
    <span class="string">""" Compare all the optimizers given on a grid of a few different
        functions all admitting a signle root in zero and a upper and
        lower bounds.
    """</span>
    random_a = -<span class="number">1.3</span> + np.random.random(size=<span class="number">100</span>)
    random_b =   <span class="number">.3</span> + np.random.random(size=<span class="number">100</span>)
    param_grid = product(FUNCTIONS, random_a, random_b)
    <span class="keyword">print</span> <span class="string">"Benching 1D root-finder optimizers from scipy.optimize:"</span>
    <span class="keyword">for</span> optimizer <span class="keyword">in</span> OPTIMIZERS:
        <span class="keyword">print</span> <span class="string">'% 20s: % 8i total function calls'</span> % (
                    optimizer.__name__, 
                    bench_optimizer(optimizer, param_grid)
                )


<span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:
    compare_optimizers(OPTIMIZERS)
</code></pre><h2 id="Footnotes">Footnotes</h2>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2012/10/30/" itemprop="url">
                  斯普罗站最大风力预测
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2012-10-30T00:00:00+08:00" content="2012-10-30">
              2012-10-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2012/10/30/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2012/10/30//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="斯普罗岛最大风速预测">斯普罗岛最大风速预测</h1><p>翻译自：<a href="http://scipy-lectures.github.com/intro/summary-exercises/stats-interpolate.html" target="_blank" rel="external">http://scipy-lectures.github.com/intro/summary-exercises/stats-interpolate.html</a></p>
<p>这个练习目的在于预测每50年的最大风速，如果没有测量的话。可以获得的数据仅仅由位于丹麦的斯普罗气象站测量了21年。首先，统计步骤将给出，然后通过从scipy.interpolate模块中的函数演示。最后有兴趣的读者将被邀请用稍微不同的方法从原始数据计算结果。</p>
<h2 id="统计方法">统计方法</h2><p>每年最大风速应该符合正态概率密度函数。然而，这个函数将并不会被估计，因为它从最大风速给出概率。这将是分位函数的角色，这个练习的目标将会是找到它。在当前模型，每五十年发生的最大风速被定义为%2上分位。</p>
<p>根据定义，这个分位函数是累积分布函数的反函数，后者描述了一年的最大风速概率分布。在这个练习中。给定年<code>i</code>累积概率<code>p_i</code>被定义为<code>p_i = i/(N+1)</code>,其中N=21，有测量的年数。因此计算每年最大风速的累积概率将是可能的。从这些实验点，scipy.interpolate模块将在拟合分位函数时非常有用。最后这五十年的最大值将被从上%2分位数的累积概率函数中求得。</p>
<h2 id="计算累积概率">计算累积概率</h2><p>每年的最大风力已经被计算并以numpy格式保存在文件<a href="http://scipy-lectures.github.com/_downloads/max-speeds.npy" target="_blank" rel="external">examples/max-speeds.npy</a>中，因此它们将通过numpy载入：</p>
<pre><code>In [<span class="number">1</span>]: import numpy as np

In [<span class="number">2</span>]: max_speeds = np.<span class="function"><span class="title">load</span><span class="params">(<span class="string">'max-speeds.npy'</span>)</span></span>

In [<span class="number">3</span>]: years_nb = max_speeds<span class="class">.shape</span>[<span class="number">0</span>]
</code></pre><p>从上一部分累积概率定义<code>p_i</code>，相应的值将是：</p>
<pre><code>In [<span class="number">5</span>]: cprob = (np.arange(years_nb, dtype=np.float32) + <span class="number">1</span>) / (years_nb + <span class="number">1</span>)
</code></pre><p>它们被假定用来拟合给定风速：</p>
<h2 id="一元样条预测">一元样条预测</h2><p>本章中分位函数将通过使用<code>UnivariateSpline</code>类来估计，这个类可以代表源于数据点的样条。默认的行为是构建一个3级(degree)的样条，数据点可以根据它们的可靠性有不同的权重。变体有<code>InterpolateUnivariateSpline</code>和<code>LSQUnivariateSpline</code>，它们的误差检查将会改变。在需要二维样条的时候，<code>BivariateSpline</code>类一族被提供。所有这些一维和二维样条使用FITPACK Fortran子程序，这就是为何通过分别代表和估值样条的<code>splrep</code>和<code>splev</code>函数，一个低等的库存取可以使用。而且没有使用FITPACK参数的插值函数也被提供给更简单的使用(参见’interp1d’,<code>interp2d</code>,<code>barycentric_interpolate</code>等等)。</p>
<p>对斯普罗最大风速，<code>UnivariateSpline</code>将被使用，因为3级的样条似乎拟合很正确：</p>
<pre><code>In [<span class="number">7</span>]: from scipy<span class="class">.interpolate</span> import UnivariateSpline

In [<span class="number">8</span>]: quantile_func =  <span class="function"><span class="title">UnivariateSpline</span><span class="params">(cprob,sorted_max_speeds)</span></span>
</code></pre><p>分位函数想在将从整个概率范围求值：</p>
<pre><code>In [<span class="number">9</span>]: nprob = np.<span class="function"><span class="title">linspace</span><span class="params">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>e2)</span></span>

In [<span class="number">10</span>]: fitted_max_speeds = <span class="function"><span class="title">quantile_func</span><span class="params">(nprob)</span></span>
</code></pre><p>%2</p>
<p>在目前的模型中，每五十年发生的最大风速被定义为上%2分位。结果，累积概率值将是：</p>
<pre><code>In [<span class="number">11</span>]: fifty_prob = <span class="number">1.</span> - <span class="number">0.02</span>
</code></pre><p>所以每五十年发生的暴风风速可被猜测，通过：</p>
<pre><code>In [<span class="number">12</span>]: fifty_wind = <span class="function"><span class="title">quantile_func</span><span class="params">(fifty_prob)</span></span>

In [<span class="number">13</span>]: fifty_wind
Out[<span class="number">13</span>]: <span class="function"><span class="title">array</span><span class="params">(<span class="number">32.97989825386221</span>)</span></span>
</code></pre><p>结果现在集中在一个Matplotlib图像上：</p>
<p><img src="http://scipy-lectures.github.com/_images/plot_cumulative_wind_speed_prediction_1.png" alt="fifty-wind"></p>
<p><a href="http://scipy-lectures.github.com/_downloads/plot_cumulative_wind_speed_prediction.py" target="_blank" rel="external">source code</a></p>
<h2 id="Gumbell分布练习">Gumbell分布练习</h2><p>感兴趣的读者现在被邀请通过使用二十一年测量的风速来做个练习。这个测量周期是大约90分钟(原始周期大约10分钟，但是文件大小为了让练习更简单已经被减小)。数据以numpy格式存储在文件<a href="http://scipy-lectures.github.com/_downloads/sprog-windspeeds.npy" target="_blank" rel="external">sprog-windspeeds.npy</a>中。在你完成练习之前，不要看绘图源码。</p>
<ul>
<li>第一步将是使用numpy并绘制matplotlib条形图，找到每年最大值。</li>
</ul>
<p><img src="http://scipy-lectures.github.com/_images/plot_sprog_annual_maxima_1.png" alt="bar"></p>
<p><a href="http://scipy-lectures.github.com/_downloads/plot_sprog_annual_maxima.py" target="_blank" rel="external">source code</a></p>
<ul>
<li>第二步是使用Gumble分布——其累积概率<code>p_i</code>被定义为<code>-log(-log(p_i))</code>，来拟合一个线性分位函数(记住你可以定义<code>UnivariateSpline</code>的级数(degree))。绘制每年最大风速与Gumble分布应该给出以下图像：</li>
</ul>
<p><img src="http://scipy-lectures.github.com/_images/plot_gumbell_wind_speed_prediction_1.png" alt="http://scipy-lectures.github.com/_images/plot_gumbell_wind_speed_prediction_1.png"></p>
<p><a href="http://scipy-lectures.github.com/_downloads/plot_gumbell_wind_speed_prediction.py" target="_blank" rel="external">source code</a></p>
<ul>
<li>最后一步是找到每五十年发生的最大风速34.23m/s</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">178</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">63</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.suzibin.cn/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lazymind.me/" target="_blank">mapleray</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/12/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
