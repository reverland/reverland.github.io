<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>评注功能测试 | Reverland的行知阁</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="comment,javascript,web," />
  

  <meta name="description" content="嗨，各位，来点好玩的。移动端什么表现就不知道了
双击文章内容任意地方开启点评功能
回车确定，只允许短评呦~虽然我没有做任何限制，just for fun。
将鼠标移动到点评园钮上将显示评论内容。
评论是实时的。你在一个页面上的评论，会立即同步到所有打开该页面的浏览器中。
这是四点零八分的北京这是四点零八分的北京，一片手的海洋翻动；这是四点零八分的北京，一声雄伟的汽笛长鸣。
北京车站高大的建筑，突然">
<meta property="og:type" content="article">
<meta property="og:title" content="评注功能测试">
<meta property="og:url" content="http://reverland.org/web/2015/11/26/click-and-comment/index.html">
<meta property="og:site_name" content="Reverland的行知阁">
<meta property="og:description" content="嗨，各位，来点好玩的。移动端什么表现就不知道了
双击文章内容任意地方开启点评功能
回车确定，只允许短评呦~虽然我没有做任何限制，just for fun。
将鼠标移动到点评园钮上将显示评论内容。
评论是实时的。你在一个页面上的评论，会立即同步到所有打开该页面的浏览器中。
这是四点零八分的北京这是四点零八分的北京，一片手的海洋翻动；这是四点零八分的北京，一声雄伟的汽笛长鸣。
北京车站高大的建筑，突然">
<meta property="og:updated_time" content="2015-12-06T09:28:00.642Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="评注功能测试">
<meta name="twitter:description" content="嗨，各位，来点好玩的。移动端什么表现就不知道了
双击文章内容任意地方开启点评功能
回车确定，只允许短评呦~虽然我没有做任何限制，just for fun。
将鼠标移动到点评园钮上将显示评论内容。
评论是实时的。你在一个页面上的评论，会立即同步到所有打开该页面的浏览器中。
这是四点零八分的北京这是四点零八分的北京，一片手的海洋翻动；这是四点零八分的北京，一声雄伟的汽笛长鸣。
北京车站高大的建筑，突然">

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  

</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/archives/"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/category/"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/tag/"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/link/"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/about/"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a 
            class="CIRCLE" 
            href="/atom.xml"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#这是四点零八分的北京"><span class="toc-text">这是四点零八分的北京</span></a></li></ol>
  </div>


<a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-click-and-comment" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">评注功能测试</h1>

    <div class="article-meta">
      <span>2015-11-26</span>

      <span> | </span>

      <span class="article-author">Liu Yuyang</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <p>嗨，各位，来点好玩的。移动端什么表现就不知道了</p>
<p>双击文章内容任意地方开启点评功能</p>
<p>回车确定，只允许短评呦~虽然我没有做任何限制，just for fun。</p>
<p>将鼠标移动到点评园钮上将显示评论内容。</p>
<p>评论是实时的。你在一个页面上的评论，会立即同步到所有打开该页面的浏览器中。</p>
<h2 id="这是四点零八分的北京">这是四点零八分的北京</h2><p>这是四点零八分的北京，<br>一片手的海洋翻动；<br>这是四点零八分的北京，<br>一声雄伟的汽笛长鸣。</p>
<p>北京车站高大的建筑，<br>突然一阵剧烈的抖动。<br>我双眼吃惊地望着窗外，<br>不知发生了什么事情。</p>
<p>我的心骤然一阵疼痛，一定是<br>妈妈缀扣子的针线穿透了心胸。<br>这时，我的心变成了一只风筝，<br>风筝的线绳就在妈妈手中。</p>
<p>线绳绷得太紧了，就要扯断了，<br>我不得不把头探出车厢的窗棂。<br>直到这时，直到这时候，<br>我才明白发生了什么事情。</p>
<p>——一阵阵告别的声浪，<br>就要卷走车站；<br>北京在我的脚下，<br>已经缓缓地移动。</p>
<p>我再次向北京挥动手臂，<br>想一把抓住他的衣领，<br>然后对她大声地叫喊：<br>永远记着我，妈妈啊，北京！</p>
<p>终于抓住了什么东西，<br>管他是谁的手，不能松，<br>因为这是我的北京，<br>这是我的最后的北京。</p>
<script src="https://cdn.wilddog.com/js/client/current/wilddog.js"></script>
<script type="text/javascript">
if (window.location.pathname == "/web/2015/11/26/click-and-comment/") {
  //var text = "";
  var ref = new Wilddog("https://wilddog-yurz-0583.wilddogio.com/comments");
  var articlebody = document.querySelector('[itemprop="articleBody"]');
  document.body.style.postion = "relative";

  ref.on('child_added', function(datasnapshot) {
    var key = datasnapshot.key();
    console.log("key when child_added", key);
    var comment = datasnapshot.val();
      var dot = document.createElement('a');
      dot.classList.toggle('dot');
      dot.style.left = comment.x + "px";
      dot.style.top = comment.y  + "px";
      dot.style.position = "absolute";
      dot.style.height = "20px";
      dot.style.width = "20px";
      dot.style.borderRadius = "10px";
      dot.style.background = "rgba(52, 152, 233, 0.6)";
      dot.setAttribute('title', comment.comment);
      document.body.appendChild(dot);
  })

  articlebody.addEventListener('dblclick', function(e) {
    if (e.target.tagName == "TEXTAREA") {
      e.stopPropagation();
      return;
    }

    // add a dot

    var dot = document.createElement('a');
    dot.classList.toggle("dot");
    dot.style.left = e.pageX - 5 + "px";
    dot.style.top = e.pageY - 5 + "px";
    dot.style.position = "absolute";
    dot.style.height = "20px";
    dot.style.width = "20px";
    dot.style.borderRadius = "10px";
    dot.style.background = "rgba(52, 152, 233, 0.6)";
    document.body.appendChild(dot);

    // add a comment text
    var comment = document.createElement('div');
    comment.classList.toggle("comment");

    var textarea = document.createElement('textarea');
    textarea.style.position = "absolute";
    textarea.style.left = "10px";
    textarea.style.top = "10px";
    textarea.style.height = "40px";
    textarea.style.width = "280px";
    textarea.setAttribute("placeholder", "输入评论");
  //  textarea.value = text;
    textarea.addEventListener('keydown', function(e) {
      if (e.which == 13) {
        e.preventDefault();// 为啥没阻止换行，keyup不行
        e.stopPropagation();
        if (textarea.value == "") {
          document.body.removeChild(dot);
          return;
        }
        dot.setAttribute("title", textarea.value);
        comment.removeChild(textarea);
        ref.push({
            x: parseInt(dot.style.left),
            y: parseInt(dot.style.top),
            comment: dot.getAttribute('title')
        });
        document.body.removeChild(dot);
      }
    })
    textarea.addEventListener('blur', function(e) {
      if(!textarea.value) {
        document.body.removeChild(dot);
      } else {
        //text = textarea.value;
        document.body.removeChild(dot);
      }
    })
    comment.appendChild(textarea);
    dot.appendChild(comment);
    textarea.focus();
  });
}
</script>

    
  </div>
</article>

</div>


  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'reverlandblog';
    
    var disqus_url = 'http://reverland.org/web/2015/11/26/click-and-comment/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    




  </div>

  

</body>
</html>
